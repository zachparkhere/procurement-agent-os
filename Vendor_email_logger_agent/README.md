# Vendor Email Logger Agent

이 에이전트는 Gmail에서 벤더 이메일을 모니터링하고, Supabase에 저장하며, MCP를 통해 다른 에이전트들과 통신합니다.

## 기능

- Gmail API를 통한 이메일 모니터링
- 이메일 내용 파싱 및 저장
- Supabase 데이터베이스 연동
- MCP를 통한 다른 에이전트들과의 통신
- 비동기 처리로 효율적인 이메일 처리

## 설치 방법

1. 필요한 패키지 설치:
```bash
pip install -r requirements.txt
```

2. 환경 변수 설정:
`.env` 파일을 생성하고 다음 변수들을 설정합니다:
```env
GMAIL_CREDENTIALS_FILE=credentials.json
GMAIL_TOKEN_FILE=token.json
MCP_SERVER_URL=http://localhost:8000
SUPABASE_URL=your_supabase_url
SUPABASE_KEY=your_supabase_key
```

3. Gmail API 설정:
- Google Cloud Console에서 프로젝트 생성
- Gmail API 활성화
- OAuth 2.0 클라이언트 ID 생성
- `credentials.json` 파일 다운로드하여 프로젝트 루트에 저장

## 실행 방법

1. 가상환경 활성화 (선택사항):
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# 또는
.\venv\Scripts\activate  # Windows
```

2. 에이전트 실행:
```bash
python main.py
```

## 데이터베이스 스키마

Supabase에 다음 테이블이 필요합니다:

```sql
create table email_logs (
  id bigint generated by default as identity primary key,
  message_id text not null,
  thread_id text,
  direction text not null,
  sender_email text not null,
  recipient_email text not null,
  subject text,
  sent_at timestamp with time zone,
  received_at timestamp with time zone not null,
  body_text text,
  status text not null,
  vectorized boolean default false,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);
```

## 주의사항

- Gmail API 할당량에 주의하세요
- 토큰 파일은 안전하게 보관하세요
- 환경 변수는 반드시 설정해야 합니다
- Supabase 연결이 필요합니다

## 문제 해결

1. 인증 오류 발생 시:
   - `token.json` 파일 삭제 후 재실행
   - Gmail API 설정 확인

2. 데이터베이스 연결 오류:
   - Supabase URL과 키 확인
   - 네트워크 연결 확인

3. MCP 연결 오류:
   - MCP 서버 상태 확인
   - URL 설정 확인

## 라이센스

MIT License 