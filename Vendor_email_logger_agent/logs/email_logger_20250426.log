2025-04-26 13:26:18,450 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 13:26:18,451 - INFO - Loading vendor emails from: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 13:26:18,451 - INFO - CSV file content:
vendor_email, name, company, position
ddd7913@gmail.com, John, Mega Industrial Supplies Inc., Manager
yeonip7913@gmail.com, Jiyeon Park, None, Freelancer
jiyeon@shiftsai.com, jiyeon_shiftsai, Shiftsai, Developer
2025-04-26 13:26:18,451 - INFO - CSV headers: ['vendor_email', ' name', ' company', ' position']
2025-04-26 13:26:18,451 - INFO - Processing row: {'vendor_email': 'ddd7913@gmail.com', ' name': ' John', ' company': ' Mega Industrial Supplies Inc.', ' position': ' Manager'}
2025-04-26 13:26:18,451 - INFO - Added vendor email: ddd7913@gmail.com
2025-04-26 13:26:18,451 - INFO - Processing row: {'vendor_email': 'yeonip7913@gmail.com', ' name': ' Jiyeon Park', ' company': ' None', ' position': ' Freelancer'}
2025-04-26 13:26:18,451 - INFO - Added vendor email: yeonip7913@gmail.com
2025-04-26 13:26:18,451 - INFO - Processing row: {'vendor_email': 'jiyeon@shiftsai.com', ' name': ' jiyeon_shiftsai', ' company': ' Shiftsai', ' position': ' Developer'}
2025-04-26 13:26:18,451 - INFO - Added vendor email: jiyeon@shiftsai.com
2025-04-26 13:26:18,451 - INFO - Loaded 3 vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:18,453 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 13:26:18,633 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 13:26:19,718 - INFO - Found 39 messages
2025-04-26 13:26:20,059 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:20,060 - INFO - Is vendor: True
2025-04-26 13:26:20,060 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:26:21,872 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:26:22,791 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:26:22,796 - ERROR - Error saving email log: too many values to unpack (expected 2)
2025-04-26 13:26:22,796 - ERROR - Error type: ValueError
2025-04-26 13:26:22,812 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:26:22,812 - INFO - Processed email: 196675e9f37b6406
2025-04-26 13:26:23,118 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:23,118 - INFO - Is vendor: False
2025-04-26 13:26:23,118 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:26:23,508 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:23,508 - INFO - Is vendor: True
2025-04-26 13:26:23,508 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:26:24,715 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:26:25,689 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:26:25,691 - ERROR - Error saving email log: too many values to unpack (expected 2)
2025-04-26 13:26:25,691 - ERROR - Error type: ValueError
2025-04-26 13:26:25,694 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:26:25,694 - INFO - Processed email: 19661ecddae94e49
2025-04-26 13:26:26,120 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:26,120 - INFO - Is vendor: False
2025-04-26 13:26:26,120 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:26:26,479 - INFO - Checking email noreply@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:26,479 - INFO - Is vendor: False
2025-04-26 13:26:26,479 - INFO - Non-vendor email skipped: noreply@supabase.com
2025-04-26 13:26:26,784 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:26,784 - INFO - Is vendor: True
2025-04-26 13:26:26,784 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:26:28,730 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:26:29,466 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:26:29,468 - ERROR - Error saving email log: too many values to unpack (expected 2)
2025-04-26 13:26:29,468 - ERROR - Error type: ValueError
2025-04-26 13:26:29,471 - INFO - Message sent to MCP server: purchase request
2025-04-26 13:26:29,471 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 13:26:29,861 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:29,861 - INFO - Is vendor: True
2025-04-26 13:26:29,861 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:26:30,856 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:26:31,714 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:26:31,716 - ERROR - Error saving email log: too many values to unpack (expected 2)
2025-04-26 13:26:31,716 - ERROR - Error type: ValueError
2025-04-26 13:26:31,719 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 13:26:31,719 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 13:26:32,035 - INFO - Checking email michaelt@cursor.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:32,035 - INFO - Is vendor: False
2025-04-26 13:26:32,035 - INFO - Non-vendor email skipped: michaelt@cursor.so
2025-04-26 13:26:32,417 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:32,417 - INFO - Is vendor: False
2025-04-26 13:26:32,417 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:26:32,731 - INFO - Checking email michaelt@cursor.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:32,732 - INFO - Is vendor: False
2025-04-26 13:26:32,732 - INFO - Non-vendor email skipped: michaelt@cursor.so
2025-04-26 13:26:33,074 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:33,074 - INFO - Is vendor: False
2025-04-26 13:26:33,075 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:26:33,440 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:33,440 - INFO - Is vendor: False
2025-04-26 13:26:33,441 - INFO - Non-vendor email skipped: welcome@supabase.com
2025-04-26 13:26:33,850 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:33,850 - INFO - Is vendor: False
2025-04-26 13:26:33,850 - INFO - Non-vendor email skipped: welcome@supabase.com
2025-04-26 13:26:34,164 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:34,164 - INFO - Is vendor: False
2025-04-26 13:26:34,164 - INFO - Non-vendor email skipped: welcome@supabase.com
2025-04-26 13:26:34,483 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:34,483 - INFO - Is vendor: False
2025-04-26 13:26:34,483 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:26:34,857 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:34,857 - INFO - Is vendor: False
2025-04-26 13:26:34,857 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:26:35,199 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:35,199 - INFO - Is vendor: False
2025-04-26 13:26:35,199 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:26:35,592 - INFO - Checking email your@product.miro.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:35,592 - INFO - Is vendor: False
2025-04-26 13:26:35,592 - INFO - Non-vendor email skipped: your@product.miro.com
2025-04-26 13:26:35,909 - INFO - Checking email your@product.miro.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:35,909 - INFO - Is vendor: False
2025-04-26 13:26:35,909 - INFO - Non-vendor email skipped: your@product.miro.com
2025-04-26 13:26:36,221 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:36,221 - INFO - Is vendor: False
2025-04-26 13:26:36,221 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:26:36,534 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:36,534 - INFO - Is vendor: False
2025-04-26 13:26:36,534 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:26:36,868 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:36,868 - INFO - Is vendor: False
2025-04-26 13:26:36,868 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:26:37,187 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:37,187 - INFO - Is vendor: False
2025-04-26 13:26:37,187 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:26:37,513 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:37,513 - INFO - Is vendor: False
2025-04-26 13:26:37,513 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:26:37,851 - INFO - Checking email ivan@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:37,851 - INFO - Is vendor: False
2025-04-26 13:26:37,851 - INFO - Non-vendor email skipped: ivan@mail.notion.so
2025-04-26 13:26:38,161 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:38,162 - INFO - Is vendor: False
2025-04-26 13:26:38,162 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:26:38,467 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:38,467 - INFO - Is vendor: False
2025-04-26 13:26:38,467 - INFO - Non-vendor email skipped: no-reply@accounts.google.com
2025-04-26 13:26:38,775 - INFO - Checking email drive-shares-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:38,775 - INFO - Is vendor: False
2025-04-26 13:26:38,775 - INFO - Non-vendor email skipped: drive-shares-noreply@google.com
2025-04-26 13:26:39,120 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:39,120 - INFO - Is vendor: False
2025-04-26 13:26:39,120 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:26:39,423 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:39,424 - INFO - Is vendor: False
2025-04-26 13:26:39,424 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:26:39,737 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:39,737 - INFO - Is vendor: False
2025-04-26 13:26:39,737 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:26:40,042 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:40,042 - INFO - Is vendor: False
2025-04-26 13:26:40,042 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:26:40,404 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:40,404 - INFO - Is vendor: False
2025-04-26 13:26:40,404 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:26:40,713 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:40,713 - INFO - Is vendor: False
2025-04-26 13:26:40,713 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:26:41,024 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:41,024 - INFO - Is vendor: False
2025-04-26 13:26:41,024 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:26:41,339 - INFO - Checking email workspace-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:41,339 - INFO - Is vendor: False
2025-04-26 13:26:41,339 - INFO - Non-vendor email skipped: workspace-noreply@google.com
2025-04-26 13:26:41,645 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:41,646 - INFO - Is vendor: False
2025-04-26 13:26:41,646 - INFO - Non-vendor email skipped: no-reply@accounts.google.com
2025-04-26 13:26:41,940 - INFO - Checking email mail-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:41,940 - INFO - Is vendor: False
2025-04-26 13:26:41,940 - INFO - Non-vendor email skipped: mail-noreply@google.com
2025-04-26 13:26:42,262 - INFO - Checking email mail-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:26:42,262 - INFO - Is vendor: False
2025-04-26 13:26:42,262 - INFO - Non-vendor email skipped: mail-noreply@google.com
2025-04-26 13:26:42,262 - INFO - GmailWatcher initialized
2025-04-26 13:28:59,577 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x107fcda30>
2025-04-26 13:29:02,039 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 13:29:02,039 - INFO - Loading vendor emails from: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 13:29:02,039 - INFO - CSV file content:
vendor_email, name, company, position
ddd7913@gmail.com, John, Mega Industrial Supplies Inc., Manager
yeonip7913@gmail.com, Jiyeon Park, None, Freelancer
jiyeon@shiftsai.com, jiyeon_shiftsai, Shiftsai, Developer
2025-04-26 13:29:02,039 - INFO - CSV headers: ['vendor_email', ' name', ' company', ' position']
2025-04-26 13:29:02,039 - INFO - Processing row: {'vendor_email': 'ddd7913@gmail.com', ' name': ' John', ' company': ' Mega Industrial Supplies Inc.', ' position': ' Manager'}
2025-04-26 13:29:02,039 - INFO - Added vendor email: ddd7913@gmail.com
2025-04-26 13:29:02,039 - INFO - Processing row: {'vendor_email': 'yeonip7913@gmail.com', ' name': ' Jiyeon Park', ' company': ' None', ' position': ' Freelancer'}
2025-04-26 13:29:02,039 - INFO - Added vendor email: yeonip7913@gmail.com
2025-04-26 13:29:02,039 - INFO - Processing row: {'vendor_email': 'jiyeon@shiftsai.com', ' name': ' jiyeon_shiftsai', ' company': ' Shiftsai', ' position': ' Developer'}
2025-04-26 13:29:02,039 - INFO - Added vendor email: jiyeon@shiftsai.com
2025-04-26 13:29:02,039 - INFO - Loaded 3 vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:02,041 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 13:29:02,185 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 13:29:02,208 - INFO - Supabase client initialized successfully
2025-04-26 13:29:02,209 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 13:29:03,047 - INFO - Found 39 messages
2025-04-26 13:29:03,363 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:03,363 - INFO - Is vendor: True
2025-04-26 13:29:03,363 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:29:05,104 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:29:05,852 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:29:05,861 - ERROR - Error saving email log: too many values to unpack (expected 2)
2025-04-26 13:29:05,861 - ERROR - Error type: ValueError
2025-04-26 13:29:05,868 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:29:05,868 - INFO - Processed email: 196675e9f37b6406
2025-04-26 13:29:06,221 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:06,222 - INFO - Is vendor: False
2025-04-26 13:29:06,222 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:29:06,528 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:06,529 - INFO - Is vendor: True
2025-04-26 13:29:06,529 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:29:07,658 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:29:08,476 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:29:08,479 - ERROR - Error saving email log: too many values to unpack (expected 2)
2025-04-26 13:29:08,480 - ERROR - Error type: ValueError
2025-04-26 13:29:08,483 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:29:08,483 - INFO - Processed email: 19661ecddae94e49
2025-04-26 13:29:08,802 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:08,803 - INFO - Is vendor: False
2025-04-26 13:29:08,803 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:29:09,192 - INFO - Checking email noreply@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:09,192 - INFO - Is vendor: False
2025-04-26 13:29:09,192 - INFO - Non-vendor email skipped: noreply@supabase.com
2025-04-26 13:29:09,502 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:09,502 - INFO - Is vendor: True
2025-04-26 13:29:09,503 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:29:10,830 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:29:11,545 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:29:11,547 - ERROR - Error saving email log: too many values to unpack (expected 2)
2025-04-26 13:29:11,548 - ERROR - Error type: ValueError
2025-04-26 13:29:11,550 - INFO - Message sent to MCP server: purchase request
2025-04-26 13:29:11,551 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 13:29:11,857 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:11,857 - INFO - Is vendor: True
2025-04-26 13:29:11,858 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:29:12,826 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:29:13,642 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:29:13,644 - ERROR - Error saving email log: too many values to unpack (expected 2)
2025-04-26 13:29:13,645 - ERROR - Error type: ValueError
2025-04-26 13:29:13,648 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 13:29:13,648 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 13:29:13,950 - INFO - Checking email michaelt@cursor.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:13,950 - INFO - Is vendor: False
2025-04-26 13:29:13,950 - INFO - Non-vendor email skipped: michaelt@cursor.so
2025-04-26 13:29:14,284 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:14,284 - INFO - Is vendor: False
2025-04-26 13:29:14,284 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:29:14,591 - INFO - Checking email michaelt@cursor.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:14,592 - INFO - Is vendor: False
2025-04-26 13:29:14,592 - INFO - Non-vendor email skipped: michaelt@cursor.so
2025-04-26 13:29:14,937 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:14,937 - INFO - Is vendor: False
2025-04-26 13:29:14,937 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:29:15,641 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:15,641 - INFO - Is vendor: False
2025-04-26 13:29:15,642 - INFO - Non-vendor email skipped: welcome@supabase.com
2025-04-26 13:29:15,953 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:15,953 - INFO - Is vendor: False
2025-04-26 13:29:15,953 - INFO - Non-vendor email skipped: welcome@supabase.com
2025-04-26 13:29:16,267 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:16,267 - INFO - Is vendor: False
2025-04-26 13:29:16,268 - INFO - Non-vendor email skipped: welcome@supabase.com
2025-04-26 13:29:16,580 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:16,580 - INFO - Is vendor: False
2025-04-26 13:29:16,580 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:29:16,881 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:16,881 - INFO - Is vendor: False
2025-04-26 13:29:16,881 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:29:17,184 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:17,185 - INFO - Is vendor: False
2025-04-26 13:29:17,185 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:29:17,497 - INFO - Checking email your@product.miro.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:17,497 - INFO - Is vendor: False
2025-04-26 13:29:17,497 - INFO - Non-vendor email skipped: your@product.miro.com
2025-04-26 13:29:17,806 - INFO - Checking email your@product.miro.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:17,806 - INFO - Is vendor: False
2025-04-26 13:29:17,806 - INFO - Non-vendor email skipped: your@product.miro.com
2025-04-26 13:29:18,107 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:18,107 - INFO - Is vendor: False
2025-04-26 13:29:18,107 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:29:18,508 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:18,508 - INFO - Is vendor: False
2025-04-26 13:29:18,508 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:29:18,815 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:18,815 - INFO - Is vendor: False
2025-04-26 13:29:18,815 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:29:19,128 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:19,129 - INFO - Is vendor: False
2025-04-26 13:29:19,129 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:29:19,427 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:19,427 - INFO - Is vendor: False
2025-04-26 13:29:19,428 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:29:20,124 - INFO - Checking email ivan@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:20,124 - INFO - Is vendor: False
2025-04-26 13:29:20,124 - INFO - Non-vendor email skipped: ivan@mail.notion.so
2025-04-26 13:29:20,455 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:20,456 - INFO - Is vendor: False
2025-04-26 13:29:20,456 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:29:20,778 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:20,779 - INFO - Is vendor: False
2025-04-26 13:29:20,779 - INFO - Non-vendor email skipped: no-reply@accounts.google.com
2025-04-26 13:29:21,100 - INFO - Checking email drive-shares-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:21,100 - INFO - Is vendor: False
2025-04-26 13:29:21,100 - INFO - Non-vendor email skipped: drive-shares-noreply@google.com
2025-04-26 13:29:21,412 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:21,413 - INFO - Is vendor: False
2025-04-26 13:29:21,413 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:29:21,721 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:21,722 - INFO - Is vendor: False
2025-04-26 13:29:21,722 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:29:22,093 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:22,093 - INFO - Is vendor: False
2025-04-26 13:29:22,093 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:29:22,410 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:22,410 - INFO - Is vendor: False
2025-04-26 13:29:22,410 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:29:22,720 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:22,720 - INFO - Is vendor: False
2025-04-26 13:29:22,720 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:29:23,022 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:23,023 - INFO - Is vendor: False
2025-04-26 13:29:23,023 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:29:23,342 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:23,342 - INFO - Is vendor: False
2025-04-26 13:29:23,342 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:29:23,670 - INFO - Checking email workspace-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:23,671 - INFO - Is vendor: False
2025-04-26 13:29:23,671 - INFO - Non-vendor email skipped: workspace-noreply@google.com
2025-04-26 13:29:23,980 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:23,980 - INFO - Is vendor: False
2025-04-26 13:29:23,980 - INFO - Non-vendor email skipped: no-reply@accounts.google.com
2025-04-26 13:29:24,684 - INFO - Checking email mail-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:24,685 - INFO - Is vendor: False
2025-04-26 13:29:24,685 - INFO - Non-vendor email skipped: mail-noreply@google.com
2025-04-26 13:29:24,987 - INFO - Checking email mail-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:29:24,988 - INFO - Is vendor: False
2025-04-26 13:29:24,988 - INFO - Non-vendor email skipped: mail-noreply@google.com
2025-04-26 13:29:24,988 - INFO - GmailWatcher initialized
2025-04-26 13:29:30,113 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x107733440>
2025-04-26 13:30:57,759 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 13:30:57,760 - INFO - Loading vendor emails from: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 13:30:57,760 - INFO - CSV file content:
vendor_email, name, company, position
ddd7913@gmail.com, John, Mega Industrial Supplies Inc., Manager
yeonip7913@gmail.com, Jiyeon Park, None, Freelancer
jiyeon@shiftsai.com, jiyeon_shiftsai, Shiftsai, Developer
2025-04-26 13:30:57,760 - INFO - CSV headers: ['vendor_email', ' name', ' company', ' position']
2025-04-26 13:30:57,760 - INFO - Processing row: {'vendor_email': 'ddd7913@gmail.com', ' name': ' John', ' company': ' Mega Industrial Supplies Inc.', ' position': ' Manager'}
2025-04-26 13:30:57,760 - INFO - Added vendor email: ddd7913@gmail.com
2025-04-26 13:30:57,760 - INFO - Processing row: {'vendor_email': 'yeonip7913@gmail.com', ' name': ' Jiyeon Park', ' company': ' None', ' position': ' Freelancer'}
2025-04-26 13:30:57,760 - INFO - Added vendor email: yeonip7913@gmail.com
2025-04-26 13:30:57,760 - INFO - Processing row: {'vendor_email': 'jiyeon@shiftsai.com', ' name': ' jiyeon_shiftsai', ' company': ' Shiftsai', ' position': ' Developer'}
2025-04-26 13:30:57,760 - INFO - Added vendor email: jiyeon@shiftsai.com
2025-04-26 13:30:57,760 - INFO - Loaded 3 vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:30:57,762 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 13:30:57,913 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 13:30:57,937 - INFO - Supabase client initialized successfully
2025-04-26 13:30:57,938 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 13:30:58,701 - INFO - Found 39 messages
2025-04-26 13:30:58,995 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:30:58,995 - INFO - Is vendor: True
2025-04-26 13:30:58,995 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:31:00,436 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:31:00,442 - INFO - Generated summary length: 101
2025-04-26 13:31:00,442 - INFO - Generated email type: update
2025-04-26 13:31:01,111 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:31:01,116 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 13:31:01,116 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:31:01,355 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:31:01,360 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:31:01,364 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:31:01,364 - INFO - Processed email: 196675e9f37b6406
2025-04-26 13:31:01,652 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:01,652 - INFO - Is vendor: False
2025-04-26 13:31:01,652 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:31:01,936 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:01,936 - INFO - Is vendor: True
2025-04-26 13:31:01,936 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:31:03,258 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:31:03,262 - INFO - Generated summary length: 72
2025-04-26 13:31:03,262 - INFO - Generated email type: confirmation
2025-04-26 13:31:03,931 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:31:03,933 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 13:31:03,933 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:31:04,007 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:31:04,010 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:31:04,011 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:31:04,011 - INFO - Processed email: 19661ecddae94e49
2025-04-26 13:31:04,307 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:04,307 - INFO - Is vendor: False
2025-04-26 13:31:04,307 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:31:04,594 - INFO - Checking email noreply@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:04,594 - INFO - Is vendor: False
2025-04-26 13:31:04,594 - INFO - Non-vendor email skipped: noreply@supabase.com
2025-04-26 13:31:04,903 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:04,903 - INFO - Is vendor: True
2025-04-26 13:31:04,903 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:31:06,143 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:31:06,151 - INFO - Generated summary length: 20
2025-04-26 13:31:06,151 - INFO - Generated email type: inquiry
2025-04-26 13:31:11,251 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:31:11,950 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:31:11,951 - INFO - Parsed delivery date: 2024-04-20
2025-04-26 13:31:11,951 - INFO - Attempting to save email log: purchase request
2025-04-26 13:31:12,101 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:31:12,103 - INFO - Email saved successfully: purchase request
2025-04-26 13:31:12,103 - INFO - Attempting to save attachment: sample_purchase_order.pdf
2025-04-26 13:31:12,179 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 13:31:12,180 - ERROR - Error saving attachment: {}
2025-04-26 13:31:12,180 - ERROR - Error type: APIError
2025-04-26 13:31:12,180 - ERROR - Attachment data: {'email_log_id': 123, 'filename': 'sample_purchase_order.pdf', 'mime_type': 'application/pdf', 'content': 'Purchase Order\nPO Number: PO-2024-001\nDate: 2025-04-14\nVendor: ABC Industrial Supplies Co.\nVendor Email: sales@abcindustrial.com\nBuyer: ShiftsAI Manufacturing Ltd.\nBuyer Contact: procurement@shiftsai.com\nItem Description Quantity Unit Price Total\nHigh-grade Steel Sheets 1000 $15.75 $15750.00\nIndustrial Lubricant (5L) 50 $22.50 $1125.00\nProtective Gloves (Box) 200 $6.80 $1360.00\nTotal $18235.00\nRequested Delivery Date: 2024-04-20\nDelivery Location: ShiftsAI Warehouse, 123 Industry Rd, Seoul, South Korea\n'}
2025-04-26 13:31:12,180 - ERROR - Error saving email log: {}
2025-04-26 13:31:12,180 - ERROR - Error type: APIError
2025-04-26 13:31:12,181 - ERROR - Error sending message to MCP server: [Errno 54] Connection reset by peer
2025-04-26 13:31:12,181 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 13:31:12,469 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:12,469 - INFO - Is vendor: True
2025-04-26 13:31:12,469 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:31:13,965 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:31:13,967 - INFO - Generated summary length: 52
2025-04-26 13:31:13,967 - INFO - Generated email type: inquiry
2025-04-26 13:31:17,703 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:31:18,427 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:31:18,428 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 13:31:18,428 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 13:31:18,593 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:31:18,597 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 13:31:18,597 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 13:31:18,670 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 13:31:18,671 - ERROR - Error saving attachment: {}
2025-04-26 13:31:18,671 - ERROR - Error type: APIError
2025-04-26 13:31:18,671 - ERROR - Attachment data: {'email_log_id': 124, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 13:31:18,671 - ERROR - Error saving email log: {}
2025-04-26 13:31:18,671 - ERROR - Error type: APIError
2025-04-26 13:31:18,676 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 13:31:18,676 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 13:31:18,959 - INFO - Checking email michaelt@cursor.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:18,959 - INFO - Is vendor: False
2025-04-26 13:31:18,959 - INFO - Non-vendor email skipped: michaelt@cursor.so
2025-04-26 13:31:19,247 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:19,248 - INFO - Is vendor: False
2025-04-26 13:31:19,248 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:31:19,557 - INFO - Checking email michaelt@cursor.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:19,557 - INFO - Is vendor: False
2025-04-26 13:31:19,557 - INFO - Non-vendor email skipped: michaelt@cursor.so
2025-04-26 13:31:19,853 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:19,853 - INFO - Is vendor: False
2025-04-26 13:31:19,853 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:31:20,139 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:20,139 - INFO - Is vendor: False
2025-04-26 13:31:20,139 - INFO - Non-vendor email skipped: welcome@supabase.com
2025-04-26 13:31:20,466 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:20,466 - INFO - Is vendor: False
2025-04-26 13:31:20,466 - INFO - Non-vendor email skipped: welcome@supabase.com
2025-04-26 13:31:20,772 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:20,773 - INFO - Is vendor: False
2025-04-26 13:31:20,773 - INFO - Non-vendor email skipped: welcome@supabase.com
2025-04-26 13:31:21,080 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:21,081 - INFO - Is vendor: False
2025-04-26 13:31:21,081 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:31:21,800 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:21,800 - INFO - Is vendor: False
2025-04-26 13:31:21,800 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:31:22,107 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:22,107 - INFO - Is vendor: False
2025-04-26 13:31:22,107 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:31:22,392 - INFO - Checking email your@product.miro.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:22,392 - INFO - Is vendor: False
2025-04-26 13:31:22,392 - INFO - Non-vendor email skipped: your@product.miro.com
2025-04-26 13:31:22,719 - INFO - Checking email your@product.miro.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:22,719 - INFO - Is vendor: False
2025-04-26 13:31:22,719 - INFO - Non-vendor email skipped: your@product.miro.com
2025-04-26 13:31:23,128 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:23,128 - INFO - Is vendor: False
2025-04-26 13:31:23,128 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:31:23,438 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:23,438 - INFO - Is vendor: False
2025-04-26 13:31:23,439 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:31:23,747 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:23,747 - INFO - Is vendor: False
2025-04-26 13:31:23,747 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:31:24,051 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:24,051 - INFO - Is vendor: False
2025-04-26 13:31:24,051 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:31:24,393 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:24,393 - INFO - Is vendor: False
2025-04-26 13:31:24,393 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:31:24,684 - INFO - Checking email ivan@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:24,684 - INFO - Is vendor: False
2025-04-26 13:31:24,684 - INFO - Non-vendor email skipped: ivan@mail.notion.so
2025-04-26 13:31:24,972 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:24,972 - INFO - Is vendor: False
2025-04-26 13:31:24,972 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:31:25,278 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:25,279 - INFO - Is vendor: False
2025-04-26 13:31:25,279 - INFO - Non-vendor email skipped: no-reply@accounts.google.com
2025-04-26 13:31:25,561 - INFO - Checking email drive-shares-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:25,561 - INFO - Is vendor: False
2025-04-26 13:31:25,561 - INFO - Non-vendor email skipped: drive-shares-noreply@google.com
2025-04-26 13:31:25,895 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:25,895 - INFO - Is vendor: False
2025-04-26 13:31:25,895 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:31:26,201 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:26,201 - INFO - Is vendor: False
2025-04-26 13:31:26,201 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:31:26,508 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:26,508 - INFO - Is vendor: False
2025-04-26 13:31:26,508 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:31:27,224 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:27,224 - INFO - Is vendor: False
2025-04-26 13:31:27,225 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:31:27,531 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:27,532 - INFO - Is vendor: False
2025-04-26 13:31:27,532 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:31:27,839 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:27,839 - INFO - Is vendor: False
2025-04-26 13:31:27,839 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:31:28,150 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:28,150 - INFO - Is vendor: False
2025-04-26 13:31:28,150 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:31:28,456 - INFO - Checking email workspace-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:28,456 - INFO - Is vendor: False
2025-04-26 13:31:28,456 - INFO - Non-vendor email skipped: workspace-noreply@google.com
2025-04-26 13:31:28,760 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:28,760 - INFO - Is vendor: False
2025-04-26 13:31:28,760 - INFO - Non-vendor email skipped: no-reply@accounts.google.com
2025-04-26 13:31:29,080 - INFO - Checking email mail-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:29,081 - INFO - Is vendor: False
2025-04-26 13:31:29,081 - INFO - Non-vendor email skipped: mail-noreply@google.com
2025-04-26 13:31:29,375 - INFO - Checking email mail-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 13:31:29,375 - INFO - Is vendor: False
2025-04-26 13:31:29,375 - INFO - Non-vendor email skipped: mail-noreply@google.com
2025-04-26 13:31:29,375 - INFO - GmailWatcher initialized
2025-04-26 13:36:39,458 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x10d9616a0>
2025-04-26 13:36:49,051 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 13:36:49,051 - INFO - Loading vendor emails from: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 13:36:49,052 - INFO - CSV file content:
vendor_email, name, company, position
ddd7913@gmail.com, John, Mega Industrial Supplies Inc., Manager
yeonip7913@gmail.com, Jiyeon Park, None, Freelancer
jiyeon@shiftsai.com, jiyeon_shiftsai, Shiftsai, Developer
2025-04-26 13:36:49,052 - INFO - CSV headers: ['vendor_email', ' name', ' company', ' position']
2025-04-26 13:36:49,052 - INFO - Processing row: {'vendor_email': 'ddd7913@gmail.com', ' name': ' John', ' company': ' Mega Industrial Supplies Inc.', ' position': ' Manager'}
2025-04-26 13:36:49,052 - INFO - Added vendor email: ddd7913@gmail.com
2025-04-26 13:36:49,052 - INFO - Processing row: {'vendor_email': 'yeonip7913@gmail.com', ' name': ' Jiyeon Park', ' company': ' None', ' position': ' Freelancer'}
2025-04-26 13:36:49,052 - INFO - Added vendor email: yeonip7913@gmail.com
2025-04-26 13:36:49,052 - INFO - Processing row: {'vendor_email': 'jiyeon@shiftsai.com', ' name': ' jiyeon_shiftsai', ' company': ' Shiftsai', ' position': ' Developer'}
2025-04-26 13:36:49,052 - INFO - Added vendor email: jiyeon@shiftsai.com
2025-04-26 13:36:49,052 - INFO - Loaded 3 vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:36:49,054 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 13:36:49,281 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 13:36:49,308 - INFO - Supabase client initialized successfully
2025-04-26 13:36:49,309 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 13:36:50,132 - INFO - Found 39 received messages
2025-04-26 13:36:50,429 - INFO - Found 3 sent messages
2025-04-26 13:36:50,719 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:36:50,720 - INFO - Is vendor: True
2025-04-26 13:36:50,720 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:36:52,424 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:36:52,440 - INFO - Generated summary length: 75
2025-04-26 13:36:52,440 - INFO - Generated email type: delivery
2025-04-26 13:36:53,118 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:36:53,120 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 13:36:53,120 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:36:53,781 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:36:53,785 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:36:53,788 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:36:53,788 - INFO - Processed email: 196675e9f37b6406
2025-04-26 13:36:54,096 - INFO - Checking email notify@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:36:54,096 - INFO - Is vendor: False
2025-04-26 13:36:54,096 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:36:54,388 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:36:54,388 - INFO - Is vendor: True
2025-04-26 13:36:54,389 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:36:55,826 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:36:55,827 - INFO - Generated summary length: 95
2025-04-26 13:36:55,827 - INFO - Generated email type: confirmation
2025-04-26 13:36:56,739 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:36:56,740 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 13:36:56,740 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:36:56,826 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:36:56,829 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:36:56,832 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:36:56,832 - INFO - Processed email: 19661ecddae94e49
2025-04-26 13:36:57,157 - INFO - Checking email notify@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:36:57,157 - INFO - Is vendor: False
2025-04-26 13:36:57,158 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:36:57,460 - INFO - Checking email noreply@supabase.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:36:57,460 - INFO - Is vendor: False
2025-04-26 13:36:57,460 - INFO - Non-vendor email skipped: noreply@supabase.com
2025-04-26 13:36:57,747 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:36:57,747 - INFO - Is vendor: True
2025-04-26 13:36:57,747 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:36:59,095 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:36:59,097 - INFO - Generated summary length: 32
2025-04-26 13:36:59,097 - INFO - Generated email type: inquiry
2025-04-26 13:36:59,925 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:37:00,740 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:37:00,741 - INFO - Parsed delivery date: 2024-04-20
2025-04-26 13:37:00,741 - INFO - Attempting to save email log: purchase request
2025-04-26 13:37:00,826 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:37:00,829 - INFO - Email saved successfully: purchase request
2025-04-26 13:37:00,829 - INFO - Attempting to save attachment: sample_purchase_order.pdf
2025-04-26 13:37:00,899 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 13:37:00,900 - ERROR - Error saving attachment: {}
2025-04-26 13:37:00,900 - ERROR - Error type: APIError
2025-04-26 13:37:00,900 - ERROR - Attachment data: {'email_log_id': 127, 'filename': 'sample_purchase_order.pdf', 'mime_type': 'application/pdf', 'content': 'Purchase Order\nPO Number: PO-2024-001\nDate: 2025-04-14\nVendor: ABC Industrial Supplies Co.\nVendor Email: sales@abcindustrial.com\nBuyer: ShiftsAI Manufacturing Ltd.\nBuyer Contact: procurement@shiftsai.com\nItem Description Quantity Unit Price Total\nHigh-grade Steel Sheets 1000 $15.75 $15750.00\nIndustrial Lubricant (5L) 50 $22.50 $1125.00\nProtective Gloves (Box) 200 $6.80 $1360.00\nTotal $18235.00\nRequested Delivery Date: 2024-04-20\nDelivery Location: ShiftsAI Warehouse, 123 Industry Rd, Seoul, South Korea\n'}
2025-04-26 13:37:00,900 - ERROR - Error saving email log: {}
2025-04-26 13:37:00,900 - ERROR - Error type: APIError
2025-04-26 13:37:00,902 - INFO - Message sent to MCP server: purchase request
2025-04-26 13:37:00,903 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 13:37:01,255 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:01,255 - INFO - Is vendor: True
2025-04-26 13:37:01,255 - INFO - Found vendor email: ddd7913@gmail.com
2025-04-26 13:37:02,952 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:37:02,953 - INFO - Generated summary length: 64
2025-04-26 13:37:02,953 - INFO - Generated email type: request
2025-04-26 13:37:03,715 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:37:04,615 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:37:04,620 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 13:37:04,620 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 13:37:04,692 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:37:04,693 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 13:37:04,693 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 13:37:04,788 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 13:37:04,789 - ERROR - Error saving attachment: {}
2025-04-26 13:37:04,789 - ERROR - Error type: APIError
2025-04-26 13:37:04,789 - ERROR - Attachment data: {'email_log_id': 128, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 13:37:04,789 - ERROR - Error saving email log: {}
2025-04-26 13:37:04,790 - ERROR - Error type: APIError
2025-04-26 13:37:04,792 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 13:37:04,792 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 13:37:05,145 - INFO - Checking email michaelt@cursor.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:05,145 - INFO - Is vendor: False
2025-04-26 13:37:05,145 - INFO - Non-vendor email skipped: michaelt@cursor.so
2025-04-26 13:37:05,437 - INFO - Checking email notify@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:05,438 - INFO - Is vendor: False
2025-04-26 13:37:05,438 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:37:05,863 - INFO - Checking email michaelt@cursor.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:05,863 - INFO - Is vendor: False
2025-04-26 13:37:05,863 - INFO - Non-vendor email skipped: michaelt@cursor.so
2025-04-26 13:37:06,167 - INFO - Checking email notify@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:06,168 - INFO - Is vendor: False
2025-04-26 13:37:06,168 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:37:06,475 - INFO - Checking email welcome@supabase.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:06,475 - INFO - Is vendor: False
2025-04-26 13:37:06,475 - INFO - Non-vendor email skipped: welcome@supabase.com
2025-04-26 13:37:06,757 - INFO - Checking email welcome@supabase.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:06,757 - INFO - Is vendor: False
2025-04-26 13:37:06,757 - INFO - Non-vendor email skipped: welcome@supabase.com
2025-04-26 13:37:07,089 - INFO - Checking email welcome@supabase.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:07,089 - INFO - Is vendor: False
2025-04-26 13:37:07,089 - INFO - Non-vendor email skipped: welcome@supabase.com
2025-04-26 13:37:07,376 - INFO - Checking email notify@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:07,377 - INFO - Is vendor: False
2025-04-26 13:37:07,377 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:37:07,687 - INFO - Checking email team@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:07,687 - INFO - Is vendor: False
2025-04-26 13:37:07,687 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:37:07,965 - INFO - Checking email notify@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:07,965 - INFO - Is vendor: False
2025-04-26 13:37:07,965 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:37:08,317 - INFO - Checking email your@product.miro.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:08,317 - INFO - Is vendor: False
2025-04-26 13:37:08,317 - INFO - Non-vendor email skipped: your@product.miro.com
2025-04-26 13:37:08,996 - INFO - Checking email your@product.miro.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:08,996 - INFO - Is vendor: False
2025-04-26 13:37:08,996 - INFO - Non-vendor email skipped: your@product.miro.com
2025-04-26 13:37:09,342 - INFO - Checking email team@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:09,342 - INFO - Is vendor: False
2025-04-26 13:37:09,342 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:37:09,631 - INFO - Checking email notify@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:09,631 - INFO - Is vendor: False
2025-04-26 13:37:09,632 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:37:09,903 - INFO - Checking email notify@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:09,903 - INFO - Is vendor: False
2025-04-26 13:37:09,903 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:37:10,171 - INFO - Checking email notify@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:10,172 - INFO - Is vendor: False
2025-04-26 13:37:10,172 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:37:10,450 - INFO - Checking email notify@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:10,450 - INFO - Is vendor: False
2025-04-26 13:37:10,450 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:37:10,774 - INFO - Checking email ivan@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:10,774 - INFO - Is vendor: False
2025-04-26 13:37:10,775 - INFO - Non-vendor email skipped: ivan@mail.notion.so
2025-04-26 13:37:11,041 - INFO - Checking email notify@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:11,042 - INFO - Is vendor: False
2025-04-26 13:37:11,042 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:37:11,389 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:11,390 - INFO - Is vendor: False
2025-04-26 13:37:11,390 - INFO - Non-vendor email skipped: no-reply@accounts.google.com
2025-04-26 13:37:11,687 - INFO - Checking email drive-shares-noreply@google.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:11,687 - INFO - Is vendor: False
2025-04-26 13:37:11,687 - INFO - Non-vendor email skipped: drive-shares-noreply@google.com
2025-04-26 13:37:12,003 - INFO - Checking email team@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:12,004 - INFO - Is vendor: False
2025-04-26 13:37:12,004 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:37:12,311 - INFO - Checking email team@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:12,311 - INFO - Is vendor: False
2025-04-26 13:37:12,311 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:37:12,592 - INFO - Checking email team@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:12,592 - INFO - Is vendor: False
2025-04-26 13:37:12,592 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:37:12,895 - INFO - Checking email team@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:12,895 - INFO - Is vendor: False
2025-04-26 13:37:12,895 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:37:13,233 - INFO - Checking email notify@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:13,233 - INFO - Is vendor: False
2025-04-26 13:37:13,234 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:37:13,542 - INFO - Checking email team@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:13,542 - INFO - Is vendor: False
2025-04-26 13:37:13,543 - INFO - Non-vendor email skipped: team@mail.notion.so
2025-04-26 13:37:13,850 - INFO - Checking email notify@mail.notion.so against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:13,850 - INFO - Is vendor: False
2025-04-26 13:37:13,850 - INFO - Non-vendor email skipped: notify@mail.notion.so
2025-04-26 13:37:14,129 - INFO - Checking email workspace-noreply@google.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:14,129 - INFO - Is vendor: False
2025-04-26 13:37:14,130 - INFO - Non-vendor email skipped: workspace-noreply@google.com
2025-04-26 13:37:14,461 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:14,461 - INFO - Is vendor: False
2025-04-26 13:37:14,461 - INFO - Non-vendor email skipped: no-reply@accounts.google.com
2025-04-26 13:37:14,771 - INFO - Checking email mail-noreply@google.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:14,771 - INFO - Is vendor: False
2025-04-26 13:37:14,771 - INFO - Non-vendor email skipped: mail-noreply@google.com
2025-04-26 13:37:15,080 - INFO - Checking email mail-noreply@google.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:15,080 - INFO - Is vendor: False
2025-04-26 13:37:15,080 - INFO - Non-vendor email skipped: mail-noreply@google.com
2025-04-26 13:37:15,390 - INFO - Checking email jiyeon@shiftsai.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:15,390 - INFO - Is vendor: True
2025-04-26 13:37:15,390 - INFO - Found vendor email: jiyeon@shiftsai.com
2025-04-26 13:37:17,254 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:37:17,261 - INFO - Generated summary length: 108
2025-04-26 13:37:17,262 - INFO - Generated email type: inquiry
2025-04-26 13:37:17,907 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:37:17,909 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 13:37:17,909 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:37:18,095 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:37:18,099 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:37:18,100 - ERROR - Error sending message to MCP server: [Errno 32] Broken pipe
2025-04-26 13:37:18,100 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 13:37:18,455 - INFO - Checking email jiyeon@shiftsai.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:18,456 - INFO - Is vendor: True
2025-04-26 13:37:18,456 - INFO - Found vendor email: jiyeon@shiftsai.com
2025-04-26 13:37:19,895 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:37:19,897 - INFO - Generated summary length: 104
2025-04-26 13:37:19,897 - INFO - Generated email type: order
2025-04-26 13:37:20,775 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:37:21,905 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:37:21,906 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 13:37:21,907 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:37:21,971 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:37:21,974 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:37:21,974 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 13:37:22,052 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 13:37:22,053 - ERROR - Error saving attachment: {}
2025-04-26 13:37:22,053 - ERROR - Error type: APIError
2025-04-26 13:37:22,053 - ERROR - Attachment data: {'email_log_id': 130, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 13:37:22,054 - ERROR - Error saving email log: {}
2025-04-26 13:37:22,054 - ERROR - Error type: APIError
2025-04-26 13:37:22,058 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:37:22,059 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 13:37:22,326 - INFO - Checking email jiyeon@shiftsai.com against vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 13:37:22,326 - INFO - Is vendor: True
2025-04-26 13:37:22,326 - INFO - Found vendor email: jiyeon@shiftsai.com
2025-04-26 13:37:23,727 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:37:23,730 - INFO - Generated summary length: 71
2025-04-26 13:37:23,730 - INFO - Generated email type: file-sharing
2025-04-26 13:37:24,313 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:37:24,315 - INFO - Parsed delivery date: None
2025-04-26 13:37:24,315 - INFO - Attempting to save email log: procurement
2025-04-26 13:37:24,386 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:37:24,388 - INFO - Email saved successfully: procurement
2025-04-26 13:37:24,391 - INFO - Message sent to MCP server: procurement
2025-04-26 13:37:24,391 - INFO - Processed email: 1964825ab5c28d35
2025-04-26 13:37:24,391 - INFO - GmailWatcher initialized
2025-04-26 13:39:37,241 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x104e72e40>
2025-04-26 13:52:28,935 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 13:52:28,935 - INFO - Loading vendor emails from: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 13:52:28,935 - INFO - CSV file content:
vendor_email, name, company, position
ddd7913@gmail.com, John, Mega Industrial Supplies Inc., Manager
yeonip7913@gmail.com, Jiyeon Park, None, Freelancer
jiyeon@shiftsai.com, jiyeon_shiftsai, Shiftsai, Developer
2025-04-26 13:52:28,935 - INFO - CSV headers: ['vendor_email', ' name', ' company', ' position']
2025-04-26 13:52:28,936 - INFO - Processing row: {'vendor_email': 'ddd7913@gmail.com', ' name': ' John', ' company': ' Mega Industrial Supplies Inc.', ' position': ' Manager'}
2025-04-26 13:52:28,936 - INFO - Added vendor email: ddd7913@gmail.com
2025-04-26 13:52:28,936 - INFO - Processing row: {'vendor_email': 'yeonip7913@gmail.com', ' name': ' Jiyeon Park', ' company': ' None', ' position': ' Freelancer'}
2025-04-26 13:52:28,936 - INFO - Added vendor email: yeonip7913@gmail.com
2025-04-26 13:52:28,936 - INFO - Processing row: {'vendor_email': 'jiyeon@shiftsai.com', ' name': ' jiyeon_shiftsai', ' company': ' Shiftsai', ' position': ' Developer'}
2025-04-26 13:52:28,936 - INFO - Added vendor email: jiyeon@shiftsai.com
2025-04-26 13:52:28,936 - INFO - Loaded 3 vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:28,938 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 13:52:29,165 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 13:52:29,190 - INFO - Supabase client initialized successfully
2025-04-26 13:52:29,191 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 13:52:30,027 - INFO - Found 39 received messages
2025-04-26 13:52:30,759 - INFO - Found 3 sent messages
2025-04-26 13:52:31,096 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:31,096 - INFO - Is vendor: True
2025-04-26 13:52:31,096 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 13:52:32,918 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:52:32,926 - INFO - Generated summary length: 97
2025-04-26 13:52:32,927 - INFO - Generated email type: update
2025-04-26 13:52:33,627 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:52:33,628 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 13:52:33,628 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:52:34,220 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:52:34,226 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:52:34,234 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:52:34,235 - INFO - Processed email: 196675e9f37b6406
2025-04-26 13:52:34,543 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:34,543 - INFO - Is vendor: False
2025-04-26 13:52:34,543 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:34,543 - INFO - Skipped non-vendor email: 196651cd71e2d02d
2025-04-26 13:52:34,853 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:34,853 - INFO - Is vendor: True
2025-04-26 13:52:34,853 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 13:52:36,584 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:52:36,587 - INFO - Generated summary length: 72
2025-04-26 13:52:36,587 - INFO - Generated email type: order
2025-04-26 13:52:37,237 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:52:37,241 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 13:52:37,241 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:52:37,311 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:52:37,313 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:52:37,314 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:52:37,314 - INFO - Processed email: 19661ecddae94e49
2025-04-26 13:52:37,698 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:37,699 - INFO - Is vendor: False
2025-04-26 13:52:37,699 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:37,699 - INFO - Skipped non-vendor email: 1965fe7da333da4b
2025-04-26 13:52:38,012 - INFO - Checking email noreply@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:38,012 - INFO - Is vendor: False
2025-04-26 13:52:38,012 - INFO - Non-vendor email skipped: from=noreply@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:38,012 - INFO - Skipped non-vendor email: 1965eb11dccf8919
2025-04-26 13:52:38,347 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:38,347 - INFO - Is vendor: True
2025-04-26 13:52:38,347 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 13:52:39,762 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:52:39,764 - INFO - Generated summary length: 20
2025-04-26 13:52:39,764 - INFO - Generated email type: inquiry
2025-04-26 13:52:40,873 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:52:41,494 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:52:41,495 - INFO - Parsed delivery date: 2024-04-20
2025-04-26 13:52:41,495 - INFO - Attempting to save email log: purchase request
2025-04-26 13:52:41,558 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:52:41,560 - INFO - Email saved successfully: purchase request
2025-04-26 13:52:41,560 - INFO - Attempting to save attachment: sample_purchase_order.pdf
2025-04-26 13:52:41,614 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 13:52:41,615 - ERROR - Error saving attachment: {}
2025-04-26 13:52:41,615 - ERROR - Error type: APIError
2025-04-26 13:52:41,615 - ERROR - Attachment data: {'email_log_id': 134, 'filename': 'sample_purchase_order.pdf', 'mime_type': 'application/pdf', 'content': 'Purchase Order\nPO Number: PO-2024-001\nDate: 2025-04-14\nVendor: ABC Industrial Supplies Co.\nVendor Email: sales@abcindustrial.com\nBuyer: ShiftsAI Manufacturing Ltd.\nBuyer Contact: procurement@shiftsai.com\nItem Description Quantity Unit Price Total\nHigh-grade Steel Sheets 1000 $15.75 $15750.00\nIndustrial Lubricant (5L) 50 $22.50 $1125.00\nProtective Gloves (Box) 200 $6.80 $1360.00\nTotal $18235.00\nRequested Delivery Date: 2024-04-20\nDelivery Location: ShiftsAI Warehouse, 123 Industry Rd, Seoul, South Korea\n'}
2025-04-26 13:52:41,615 - ERROR - Error saving email log: {}
2025-04-26 13:52:41,615 - ERROR - Error type: APIError
2025-04-26 13:52:41,617 - INFO - Message sent to MCP server: purchase request
2025-04-26 13:52:41,617 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 13:52:42,018 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:42,018 - INFO - Is vendor: True
2025-04-26 13:52:42,018 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 13:52:43,432 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:52:43,434 - INFO - Generated summary length: 64
2025-04-26 13:52:43,434 - INFO - Generated email type: request
2025-04-26 13:52:44,368 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:52:44,955 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:52:44,956 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 13:52:44,956 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 13:52:45,059 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:52:45,060 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 13:52:45,060 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 13:52:45,118 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 13:52:45,119 - ERROR - Error saving attachment: {}
2025-04-26 13:52:45,119 - ERROR - Error type: APIError
2025-04-26 13:52:45,119 - ERROR - Attachment data: {'email_log_id': 135, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 13:52:45,119 - ERROR - Error saving email log: {}
2025-04-26 13:52:45,119 - ERROR - Error type: APIError
2025-04-26 13:52:45,122 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 13:52:45,122 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 13:52:45,428 - INFO - Checking email michaelt@cursor.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:45,429 - INFO - Is vendor: False
2025-04-26 13:52:45,429 - INFO - Non-vendor email skipped: from=michaelt@cursor.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:45,429 - INFO - Skipped non-vendor email: 1965d801cc9d1b08
2025-04-26 13:52:45,799 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:45,800 - INFO - Is vendor: False
2025-04-26 13:52:45,800 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:45,800 - INFO - Skipped non-vendor email: 1965aa8b3b388a9e
2025-04-26 13:52:46,206 - INFO - Checking email michaelt@cursor.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:46,206 - INFO - Is vendor: False
2025-04-26 13:52:46,206 - INFO - Non-vendor email skipped: from=michaelt@cursor.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:46,206 - INFO - Skipped non-vendor email: 19658577debe3a64
2025-04-26 13:52:46,608 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:46,608 - INFO - Is vendor: False
2025-04-26 13:52:46,608 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:46,608 - INFO - Skipped non-vendor email: 1965599e9295c5bf
2025-04-26 13:52:46,925 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:46,925 - INFO - Is vendor: False
2025-04-26 13:52:46,926 - INFO - Non-vendor email skipped: from=welcome@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:46,926 - INFO - Skipped non-vendor email: 19649b9a7d379bdd
2025-04-26 13:52:47,267 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:47,267 - INFO - Is vendor: False
2025-04-26 13:52:47,267 - INFO - Non-vendor email skipped: from=welcome@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:47,267 - INFO - Skipped non-vendor email: 19649b979fd40216
2025-04-26 13:52:47,629 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:47,629 - INFO - Is vendor: False
2025-04-26 13:52:47,629 - INFO - Non-vendor email skipped: from=welcome@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:47,629 - INFO - Skipped non-vendor email: 1964785213e795c7
2025-04-26 13:52:47,940 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:47,940 - INFO - Is vendor: False
2025-04-26 13:52:47,940 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:47,940 - INFO - Skipped non-vendor email: 19645ee513d6bff6
2025-04-26 13:52:48,287 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:48,287 - INFO - Is vendor: False
2025-04-26 13:52:48,287 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:48,288 - INFO - Skipped non-vendor email: 1964461589df2bf2
2025-04-26 13:52:48,602 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:48,602 - INFO - Is vendor: False
2025-04-26 13:52:48,602 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:48,602 - INFO - Skipped non-vendor email: 19640c539745c984
2025-04-26 13:52:48,909 - INFO - Checking email your@product.miro.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:48,910 - INFO - Is vendor: False
2025-04-26 13:52:48,910 - INFO - Non-vendor email skipped: from=your@product.miro.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:48,910 - INFO - Skipped non-vendor email: 1963cf041b5ffa98
2025-04-26 13:52:49,210 - INFO - Checking email your@product.miro.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:49,210 - INFO - Is vendor: False
2025-04-26 13:52:49,210 - INFO - Non-vendor email skipped: from=your@product.miro.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:49,210 - INFO - Skipped non-vendor email: 1963ceb01203537b
2025-04-26 13:52:49,518 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:49,518 - INFO - Is vendor: False
2025-04-26 13:52:49,518 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:49,518 - INFO - Skipped non-vendor email: 19634eda2b58f9c0
2025-04-26 13:52:49,913 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:49,913 - INFO - Is vendor: False
2025-04-26 13:52:49,913 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:49,914 - INFO - Skipped non-vendor email: 19623e431247bcda
2025-04-26 13:52:50,253 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:50,253 - INFO - Is vendor: False
2025-04-26 13:52:50,253 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:50,253 - INFO - Skipped non-vendor email: 19621e0e7c0c4047
2025-04-26 13:52:50,609 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:50,610 - INFO - Is vendor: False
2025-04-26 13:52:50,610 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:50,610 - INFO - Skipped non-vendor email: 195e8f69e3a9b1cb
2025-04-26 13:52:50,927 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:50,928 - INFO - Is vendor: False
2025-04-26 13:52:50,928 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:50,928 - INFO - Skipped non-vendor email: 195e4ea41453cb70
2025-04-26 13:52:51,270 - INFO - Checking email ivan@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:51,270 - INFO - Is vendor: False
2025-04-26 13:52:51,270 - INFO - Non-vendor email skipped: from=ivan@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:51,271 - INFO - Skipped non-vendor email: 195dd623e7ba2b53
2025-04-26 13:52:51,652 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:51,652 - INFO - Is vendor: False
2025-04-26 13:52:51,652 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:51,652 - INFO - Skipped non-vendor email: 195daeae90f76840
2025-04-26 13:52:51,999 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:52,000 - INFO - Is vendor: False
2025-04-26 13:52:52,000 - INFO - Non-vendor email skipped: from=no-reply@accounts.google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:52,000 - INFO - Skipped non-vendor email: 195daeae518fecdd
2025-04-26 13:52:52,333 - INFO - Checking email drive-shares-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:52,333 - INFO - Is vendor: False
2025-04-26 13:52:52,333 - INFO - Non-vendor email skipped: from=drive-shares-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:52,333 - INFO - Skipped non-vendor email: 195d671ec15ec846
2025-04-26 13:52:52,664 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:52,664 - INFO - Is vendor: False
2025-04-26 13:52:52,665 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:52,665 - INFO - Skipped non-vendor email: 195cf892e4f7db12
2025-04-26 13:52:52,989 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:52,989 - INFO - Is vendor: False
2025-04-26 13:52:52,989 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:52,989 - INFO - Skipped non-vendor email: 195c53cde474e1ae
2025-04-26 13:52:53,393 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:53,393 - INFO - Is vendor: False
2025-04-26 13:52:53,393 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:53,393 - INFO - Skipped non-vendor email: 195b6f0625b261e8
2025-04-26 13:52:53,803 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:53,803 - INFO - Is vendor: False
2025-04-26 13:52:53,803 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:53,803 - INFO - Skipped non-vendor email: 195aca3ad97ae936
2025-04-26 13:52:54,622 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:54,622 - INFO - Is vendor: False
2025-04-26 13:52:54,622 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:54,622 - INFO - Skipped non-vendor email: 195a77bc0134c788
2025-04-26 13:52:54,931 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:54,931 - INFO - Is vendor: False
2025-04-26 13:52:54,931 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:54,931 - INFO - Skipped non-vendor email: 195a256e8510b298
2025-04-26 13:52:55,243 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:55,243 - INFO - Is vendor: False
2025-04-26 13:52:55,243 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:55,243 - INFO - Skipped non-vendor email: 195a25038936df85
2025-04-26 13:52:55,616 - INFO - Checking email workspace-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:55,616 - INFO - Is vendor: False
2025-04-26 13:52:55,617 - INFO - Non-vendor email skipped: from=workspace-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:55,617 - INFO - Skipped non-vendor email: 19595c64c6c6d6eb
2025-04-26 13:52:55,948 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:55,948 - INFO - Is vendor: False
2025-04-26 13:52:55,948 - INFO - Non-vendor email skipped: from=no-reply@accounts.google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:55,948 - INFO - Skipped non-vendor email: 1958eee70835096e
2025-04-26 13:52:56,333 - INFO - Checking email mail-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:56,333 - INFO - Is vendor: False
2025-04-26 13:52:56,334 - INFO - Non-vendor email skipped: from=mail-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:56,334 - INFO - Skipped non-vendor email: 1958ddcf16172961
2025-04-26 13:52:56,640 - INFO - Checking email mail-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:56,640 - INFO - Is vendor: False
2025-04-26 13:52:56,640 - INFO - Non-vendor email skipped: from=mail-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 13:52:56,640 - INFO - Skipped non-vendor email: 1958ddcf0696f6d5
2025-04-26 13:52:56,947 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:56,948 - INFO - Is vendor: True
2025-04-26 13:52:56,948 - INFO - Found outbound email to vendor: ddd7913@gmail.com
2025-04-26 13:52:58,586 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:52:58,587 - INFO - Generated summary length: 109
2025-04-26 13:52:58,587 - INFO - Generated email type: delivery
2025-04-26 13:52:59,213 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:52:59,215 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 13:52:59,215 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:52:59,396 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:52:59,398 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:52:59,399 - ERROR - Error sending message to MCP server: [Errno 32] Broken pipe
2025-04-26 13:52:59,400 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 13:52:59,712 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:52:59,713 - INFO - Is vendor: True
2025-04-26 13:52:59,713 - INFO - Found outbound email to vendor: ddd7913@gmail.com
2025-04-26 13:53:01,043 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:53:01,044 - INFO - Generated summary length: 87
2025-04-26 13:53:01,044 - INFO - Generated email type: order
2025-04-26 13:53:01,969 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 13:53:02,648 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 13:53:02,649 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 13:53:02,649 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:53:02,722 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 13:53:02,724 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:53:02,724 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 13:53:02,792 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 13:53:02,793 - ERROR - Error saving attachment: {}
2025-04-26 13:53:02,793 - ERROR - Error type: APIError
2025-04-26 13:53:02,793 - ERROR - Attachment data: {'email_log_id': 137, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 13:53:02,793 - ERROR - Error saving email log: {}
2025-04-26 13:53:02,793 - ERROR - Error type: APIError
2025-04-26 13:53:02,797 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 13:53:02,797 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 13:53:03,113 - INFO - Checking email zach@shiftsai.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 13:53:03,114 - INFO - Is vendor: False
2025-04-26 13:53:03,114 - INFO - Non-vendor email skipped: from=jiyeon@shiftsai.com, to=zach@shiftsai.com, is_outbound=True
2025-04-26 13:53:03,114 - INFO - Skipped non-vendor email: 1964825ab5c28d35
2025-04-26 13:53:03,114 - INFO - GmailWatcher initialized
2025-04-26 14:10:43,600 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x108df49b0>
2025-04-26 14:10:52,704 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 14:10:52,704 - INFO - Loading vendor emails from: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 14:10:52,705 - INFO - CSV file content:
vendor_email, name, company, position
ddd7913@gmail.com, John, Mega Industrial Supplies Inc., Manager
yeonip7913@gmail.com, Jiyeon Park, None, Freelancer
jiyeon@shiftsai.com, jiyeon_shiftsai, Shiftsai, Developer
2025-04-26 14:10:52,705 - INFO - CSV headers: ['vendor_email', ' name', ' company', ' position']
2025-04-26 14:10:52,705 - INFO - Processing row: {'vendor_email': 'ddd7913@gmail.com', ' name': ' John', ' company': ' Mega Industrial Supplies Inc.', ' position': ' Manager'}
2025-04-26 14:10:52,705 - INFO - Added vendor email: ddd7913@gmail.com
2025-04-26 14:10:52,705 - INFO - Processing row: {'vendor_email': 'yeonip7913@gmail.com', ' name': ' Jiyeon Park', ' company': ' None', ' position': ' Freelancer'}
2025-04-26 14:10:52,705 - INFO - Added vendor email: yeonip7913@gmail.com
2025-04-26 14:10:52,705 - INFO - Processing row: {'vendor_email': 'jiyeon@shiftsai.com', ' name': ' jiyeon_shiftsai', ' company': ' Shiftsai', ' position': ' Developer'}
2025-04-26 14:10:52,705 - INFO - Added vendor email: jiyeon@shiftsai.com
2025-04-26 14:10:52,705 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:10:52,707 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 14:10:52,853 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 14:10:52,876 - INFO - Supabase client initialized successfully
2025-04-26 14:10:52,877 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 14:10:54,132 - INFO - Found 39 received messages
2025-04-26 14:10:54,450 - INFO - Found 3 sent messages
2025-04-26 14:10:55,203 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:10:55,203 - INFO - Is vendor: True
2025-04-26 14:10:55,203 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 14:10:57,355 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:10:57,361 - INFO - Generated summary length: 68
2025-04-26 14:10:57,361 - INFO - Generated email type: delay
2025-04-26 14:10:58,043 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:10:58,049 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 14:10:58,049 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:10:58,660 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:10:58,668 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:10:58,678 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:10:58,678 - INFO - Processed email: 196675e9f37b6406
2025-04-26 14:10:59,415 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:10:59,415 - INFO - Is vendor: False
2025-04-26 14:10:59,416 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:10:59,416 - INFO - Skipped non-vendor email: 196651cd71e2d02d
2025-04-26 14:10:59,743 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:10:59,743 - INFO - Is vendor: True
2025-04-26 14:10:59,743 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 14:11:01,096 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:11:01,101 - INFO - Generated summary length: 71
2025-04-26 14:11:01,101 - INFO - Generated email type: confirmation
2025-04-26 14:11:02,125 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:11:02,127 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 14:11:02,127 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:11:02,203 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:11:02,208 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:11:02,211 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:11:02,211 - INFO - Processed email: 19661ecddae94e49
2025-04-26 14:11:02,534 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:02,535 - INFO - Is vendor: False
2025-04-26 14:11:02,535 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:02,535 - INFO - Skipped non-vendor email: 1965fe7da333da4b
2025-04-26 14:11:02,878 - INFO - Checking email noreply@supabase.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:02,879 - INFO - Is vendor: False
2025-04-26 14:11:02,879 - INFO - Non-vendor email skipped: from=noreply@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:02,879 - INFO - Skipped non-vendor email: 1965eb11dccf8919
2025-04-26 14:11:03,199 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:03,200 - INFO - Is vendor: True
2025-04-26 14:11:03,200 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 14:11:04,571 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:11:04,574 - INFO - Generated summary length: 20
2025-04-26 14:11:04,574 - INFO - Generated email type: purchase
2025-04-26 14:11:05,659 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 14:11:06,415 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:11:06,417 - INFO - Parsed delivery date: 2024-04-20
2025-04-26 14:11:06,417 - INFO - Attempting to save email log: purchase request
2025-04-26 14:11:06,476 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:11:06,480 - INFO - Email saved successfully: purchase request
2025-04-26 14:11:06,480 - INFO - Attempting to save attachment: sample_purchase_order.pdf
2025-04-26 14:11:06,548 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 14:11:06,550 - ERROR - Error saving attachment: {}
2025-04-26 14:11:06,550 - ERROR - Error type: APIError
2025-04-26 14:11:06,550 - ERROR - Attachment data: {'email_log_id': 140, 'filename': 'sample_purchase_order.pdf', 'mime_type': 'application/pdf', 'content': 'Purchase Order\nPO Number: PO-2024-001\nDate: 2025-04-14\nVendor: ABC Industrial Supplies Co.\nVendor Email: sales@abcindustrial.com\nBuyer: ShiftsAI Manufacturing Ltd.\nBuyer Contact: procurement@shiftsai.com\nItem Description Quantity Unit Price Total\nHigh-grade Steel Sheets 1000 $15.75 $15750.00\nIndustrial Lubricant (5L) 50 $22.50 $1125.00\nProtective Gloves (Box) 200 $6.80 $1360.00\nTotal $18235.00\nRequested Delivery Date: 2024-04-20\nDelivery Location: ShiftsAI Warehouse, 123 Industry Rd, Seoul, South Korea\n'}
2025-04-26 14:11:06,550 - ERROR - Error saving email log: {}
2025-04-26 14:11:06,550 - ERROR - Error type: APIError
2025-04-26 14:11:06,553 - INFO - Message sent to MCP server: purchase request
2025-04-26 14:11:06,553 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 14:11:06,862 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:06,862 - INFO - Is vendor: True
2025-04-26 14:11:06,862 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 14:11:09,551 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:11:09,553 - INFO - Generated summary length: 64
2025-04-26 14:11:09,553 - INFO - Generated email type: inquiry
2025-04-26 14:11:10,707 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 14:11:11,356 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:11:11,361 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 14:11:11,361 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 14:11:11,434 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:11:11,435 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 14:11:11,435 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 14:11:11,493 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 14:11:11,494 - ERROR - Error saving attachment: {}
2025-04-26 14:11:11,494 - ERROR - Error type: APIError
2025-04-26 14:11:11,494 - ERROR - Attachment data: {'email_log_id': 141, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 14:11:11,494 - ERROR - Error saving email log: {}
2025-04-26 14:11:11,494 - ERROR - Error type: APIError
2025-04-26 14:11:11,497 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 14:11:11,497 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 14:11:11,806 - INFO - Checking email michaelt@cursor.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:11,806 - INFO - Is vendor: False
2025-04-26 14:11:11,806 - INFO - Non-vendor email skipped: from=michaelt@cursor.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:11,806 - INFO - Skipped non-vendor email: 1965d801cc9d1b08
2025-04-26 14:11:12,114 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:12,114 - INFO - Is vendor: False
2025-04-26 14:11:12,115 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:12,115 - INFO - Skipped non-vendor email: 1965aa8b3b388a9e
2025-04-26 14:11:12,427 - INFO - Checking email michaelt@cursor.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:12,427 - INFO - Is vendor: False
2025-04-26 14:11:12,428 - INFO - Non-vendor email skipped: from=michaelt@cursor.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:12,428 - INFO - Skipped non-vendor email: 19658577debe3a64
2025-04-26 14:11:12,811 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:12,811 - INFO - Is vendor: False
2025-04-26 14:11:12,811 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:12,811 - INFO - Skipped non-vendor email: 1965599e9295c5bf
2025-04-26 14:11:13,132 - INFO - Checking email welcome@supabase.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:13,132 - INFO - Is vendor: False
2025-04-26 14:11:13,132 - INFO - Non-vendor email skipped: from=welcome@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:13,132 - INFO - Skipped non-vendor email: 19649b9a7d379bdd
2025-04-26 14:11:13,454 - INFO - Checking email welcome@supabase.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:13,455 - INFO - Is vendor: False
2025-04-26 14:11:13,455 - INFO - Non-vendor email skipped: from=welcome@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:13,455 - INFO - Skipped non-vendor email: 19649b979fd40216
2025-04-26 14:11:13,773 - INFO - Checking email welcome@supabase.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:13,773 - INFO - Is vendor: False
2025-04-26 14:11:13,773 - INFO - Non-vendor email skipped: from=welcome@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:13,774 - INFO - Skipped non-vendor email: 1964785213e795c7
2025-04-26 14:11:14,084 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:14,084 - INFO - Is vendor: False
2025-04-26 14:11:14,084 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:14,084 - INFO - Skipped non-vendor email: 19645ee513d6bff6
2025-04-26 14:11:14,406 - INFO - Checking email team@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:14,406 - INFO - Is vendor: False
2025-04-26 14:11:14,406 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:14,406 - INFO - Skipped non-vendor email: 1964461589df2bf2
2025-04-26 14:11:14,728 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:14,728 - INFO - Is vendor: False
2025-04-26 14:11:14,728 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:14,728 - INFO - Skipped non-vendor email: 19640c539745c984
2025-04-26 14:11:15,064 - INFO - Checking email your@product.miro.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:15,064 - INFO - Is vendor: False
2025-04-26 14:11:15,064 - INFO - Non-vendor email skipped: from=your@product.miro.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:15,064 - INFO - Skipped non-vendor email: 1963cf041b5ffa98
2025-04-26 14:11:15,768 - INFO - Checking email your@product.miro.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:15,768 - INFO - Is vendor: False
2025-04-26 14:11:15,768 - INFO - Non-vendor email skipped: from=your@product.miro.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:15,768 - INFO - Skipped non-vendor email: 1963ceb01203537b
2025-04-26 14:11:16,107 - INFO - Checking email team@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:16,107 - INFO - Is vendor: False
2025-04-26 14:11:16,107 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:16,107 - INFO - Skipped non-vendor email: 19634eda2b58f9c0
2025-04-26 14:11:16,473 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:16,473 - INFO - Is vendor: False
2025-04-26 14:11:16,473 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:16,474 - INFO - Skipped non-vendor email: 19623e431247bcda
2025-04-26 14:11:16,907 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:16,908 - INFO - Is vendor: False
2025-04-26 14:11:16,908 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:16,908 - INFO - Skipped non-vendor email: 19621e0e7c0c4047
2025-04-26 14:11:17,217 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:17,217 - INFO - Is vendor: False
2025-04-26 14:11:17,217 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:17,218 - INFO - Skipped non-vendor email: 195e8f69e3a9b1cb
2025-04-26 14:11:17,527 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:17,528 - INFO - Is vendor: False
2025-04-26 14:11:17,528 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:17,528 - INFO - Skipped non-vendor email: 195e4ea41453cb70
2025-04-26 14:11:17,849 - INFO - Checking email ivan@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:17,850 - INFO - Is vendor: False
2025-04-26 14:11:17,850 - INFO - Non-vendor email skipped: from=ivan@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:17,850 - INFO - Skipped non-vendor email: 195dd623e7ba2b53
2025-04-26 14:11:18,239 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:18,239 - INFO - Is vendor: False
2025-04-26 14:11:18,239 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:18,239 - INFO - Skipped non-vendor email: 195daeae90f76840
2025-04-26 14:11:18,557 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:18,557 - INFO - Is vendor: False
2025-04-26 14:11:18,557 - INFO - Non-vendor email skipped: from=no-reply@accounts.google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:18,557 - INFO - Skipped non-vendor email: 195daeae518fecdd
2025-04-26 14:11:19,261 - INFO - Checking email drive-shares-noreply@google.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:19,261 - INFO - Is vendor: False
2025-04-26 14:11:19,261 - INFO - Non-vendor email skipped: from=drive-shares-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:19,261 - INFO - Skipped non-vendor email: 195d671ec15ec846
2025-04-26 14:11:19,570 - INFO - Checking email team@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:19,571 - INFO - Is vendor: False
2025-04-26 14:11:19,571 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:19,571 - INFO - Skipped non-vendor email: 195cf892e4f7db12
2025-04-26 14:11:19,886 - INFO - Checking email team@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:19,887 - INFO - Is vendor: False
2025-04-26 14:11:19,887 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:19,887 - INFO - Skipped non-vendor email: 195c53cde474e1ae
2025-04-26 14:11:20,192 - INFO - Checking email team@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:20,192 - INFO - Is vendor: False
2025-04-26 14:11:20,192 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:20,192 - INFO - Skipped non-vendor email: 195b6f0625b261e8
2025-04-26 14:11:20,505 - INFO - Checking email team@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:20,505 - INFO - Is vendor: False
2025-04-26 14:11:20,505 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:20,505 - INFO - Skipped non-vendor email: 195aca3ad97ae936
2025-04-26 14:11:20,811 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:20,811 - INFO - Is vendor: False
2025-04-26 14:11:20,811 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:20,812 - INFO - Skipped non-vendor email: 195a77bc0134c788
2025-04-26 14:11:21,120 - INFO - Checking email team@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:21,120 - INFO - Is vendor: False
2025-04-26 14:11:21,120 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:21,120 - INFO - Skipped non-vendor email: 195a256e8510b298
2025-04-26 14:11:21,435 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:21,435 - INFO - Is vendor: False
2025-04-26 14:11:21,436 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:21,436 - INFO - Skipped non-vendor email: 195a25038936df85
2025-04-26 14:11:21,824 - INFO - Checking email workspace-noreply@google.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:21,825 - INFO - Is vendor: False
2025-04-26 14:11:21,825 - INFO - Non-vendor email skipped: from=workspace-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:21,825 - INFO - Skipped non-vendor email: 19595c64c6c6d6eb
2025-04-26 14:11:22,139 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:22,139 - INFO - Is vendor: False
2025-04-26 14:11:22,139 - INFO - Non-vendor email skipped: from=no-reply@accounts.google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:22,139 - INFO - Skipped non-vendor email: 1958eee70835096e
2025-04-26 14:11:22,448 - INFO - Checking email mail-noreply@google.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:22,448 - INFO - Is vendor: False
2025-04-26 14:11:22,449 - INFO - Non-vendor email skipped: from=mail-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:22,449 - INFO - Skipped non-vendor email: 1958ddcf16172961
2025-04-26 14:11:22,847 - INFO - Checking email mail-noreply@google.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:22,847 - INFO - Is vendor: False
2025-04-26 14:11:22,847 - INFO - Non-vendor email skipped: from=mail-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:11:22,847 - INFO - Skipped non-vendor email: 1958ddcf0696f6d5
2025-04-26 14:11:23,154 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:23,154 - INFO - Is vendor: True
2025-04-26 14:11:23,154 - INFO - Found outbound email to vendor: ddd7913@gmail.com
2025-04-26 14:11:24,644 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:11:24,648 - INFO - Generated summary length: 56
2025-04-26 14:11:24,648 - INFO - Generated email type: delivery
2025-04-26 14:11:25,260 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:11:25,260 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 14:11:25,260 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:11:25,478 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:11:25,480 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:11:25,481 - ERROR - Error sending message to MCP server: [Errno 32] Broken pipe
2025-04-26 14:11:25,481 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 14:11:25,817 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:25,817 - INFO - Is vendor: True
2025-04-26 14:11:25,817 - INFO - Found outbound email to vendor: ddd7913@gmail.com
2025-04-26 14:11:27,251 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:11:27,253 - INFO - Generated summary length: 58
2025-04-26 14:11:27,253 - INFO - Generated email type: order
2025-04-26 14:11:28,071 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 14:11:28,731 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:11:28,732 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 14:11:28,733 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:11:28,816 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:11:28,819 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:11:28,819 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 14:11:28,905 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 14:11:28,906 - ERROR - Error saving attachment: {}
2025-04-26 14:11:28,906 - ERROR - Error type: APIError
2025-04-26 14:11:28,906 - ERROR - Attachment data: {'email_log_id': 143, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 14:11:28,906 - ERROR - Error saving email log: {}
2025-04-26 14:11:28,906 - ERROR - Error type: APIError
2025-04-26 14:11:28,910 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:11:28,910 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 14:11:29,214 - INFO - Checking email zach@shiftsai.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:11:29,215 - INFO - Is vendor: False
2025-04-26 14:11:29,215 - INFO - Non-vendor email skipped: from=jiyeon@shiftsai.com, to=zach@shiftsai.com, is_outbound=True
2025-04-26 14:11:29,215 - INFO - Skipped non-vendor email: 1964825ab5c28d35
2025-04-26 14:11:29,215 - INFO - GmailWatcher initialized
2025-04-26 14:36:35,210 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x1097b9970>
2025-04-26 14:40:42,007 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 14:40:42,007 - INFO - Loading vendor emails from: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 14:40:42,007 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:40:42,009 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 14:40:42,157 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 14:40:42,181 - INFO - Supabase client initialized successfully
2025-04-26 14:40:42,182 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 14:40:43,070 - INFO - Found 39 received messages
2025-04-26 14:40:43,445 - INFO - Found 3 sent messages
2025-04-26 14:40:43,768 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:40:43,769 - INFO - Is vendor: True
2025-04-26 14:40:43,769 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 14:40:45,910 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:40:45,919 - INFO - Generated summary length: 57
2025-04-26 14:40:45,919 - INFO - Generated email type: delay
2025-04-26 14:40:45,920 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 14:40:46,630 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 14:40:46,635 - INFO - Found 0 emails in thread
2025-04-26 14:40:47,316 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:40:47,317 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 14:40:47,318 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:40:47,397 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:40:47,398 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:40:47,407 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:40:47,407 - INFO - Processed email: 196675e9f37b6406
2025-04-26 14:40:47,734 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:40:47,734 - INFO - Is vendor: False
2025-04-26 14:40:47,734 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:40:47,735 - INFO - Skipped non-vendor email: 196651cd71e2d02d
2025-04-26 14:40:48,057 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:40:48,058 - INFO - Is vendor: True
2025-04-26 14:40:48,058 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 14:40:49,695 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:40:49,696 - INFO - Generated summary length: 71
2025-04-26 14:40:49,696 - INFO - Generated email type: confirmation
2025-04-26 14:40:49,696 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 14:40:49,788 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 14:40:49,790 - INFO - Found 1 emails in thread
2025-04-26 14:40:50,677 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:40:50,679 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 14:40:50,679 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:40:50,767 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:40:50,767 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:40:50,769 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:40:50,770 - INFO - Processed email: 19661ecddae94e49
2025-04-26 14:40:51,128 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:40:51,128 - INFO - Is vendor: False
2025-04-26 14:40:51,128 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:40:51,128 - INFO - Skipped non-vendor email: 1965fe7da333da4b
2025-04-26 14:40:51,476 - INFO - Checking email noreply@supabase.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:40:51,476 - INFO - Is vendor: False
2025-04-26 14:40:51,476 - INFO - Non-vendor email skipped: from=noreply@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:40:51,476 - INFO - Skipped non-vendor email: 1965eb11dccf8919
2025-04-26 14:40:51,840 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:40:51,841 - INFO - Is vendor: True
2025-04-26 14:40:51,841 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 14:40:53,290 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:40:53,292 - INFO - Generated summary length: 20
2025-04-26 14:40:53,292 - INFO - Generated email type: procurement
2025-04-26 14:40:54,406 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 14:40:54,408 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 14:40:54,492 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 14:40:54,495 - INFO - Found 0 emails in thread
2025-04-26 14:40:55,084 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:40:55,086 - INFO - Parsed delivery date: 2024-04-20
2025-04-26 14:40:55,086 - INFO - Attempting to save email log: purchase request
2025-04-26 14:40:55,183 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:40:55,187 - INFO - Email saved successfully: purchase request
2025-04-26 14:40:55,187 - INFO - Attempting to save attachment: sample_purchase_order.pdf
2025-04-26 14:40:55,269 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 14:40:55,270 - ERROR - Error saving attachment: {}
2025-04-26 14:40:55,270 - ERROR - Error type: APIError
2025-04-26 14:40:55,270 - ERROR - Attachment data: {'email_log_id': 150, 'filename': 'sample_purchase_order.pdf', 'mime_type': 'application/pdf', 'content': 'Purchase Order\nPO Number: PO-2024-001\nDate: 2025-04-14\nVendor: ABC Industrial Supplies Co.\nVendor Email: sales@abcindustrial.com\nBuyer: ShiftsAI Manufacturing Ltd.\nBuyer Contact: procurement@shiftsai.com\nItem Description Quantity Unit Price Total\nHigh-grade Steel Sheets 1000 $15.75 $15750.00\nIndustrial Lubricant (5L) 50 $22.50 $1125.00\nProtective Gloves (Box) 200 $6.80 $1360.00\nTotal $18235.00\nRequested Delivery Date: 2024-04-20\nDelivery Location: ShiftsAI Warehouse, 123 Industry Rd, Seoul, South Korea\n'}
2025-04-26 14:40:55,270 - ERROR - Error saving email log: {}
2025-04-26 14:40:55,270 - ERROR - Error type: APIError
2025-04-26 14:40:55,273 - INFO - Message sent to MCP server: purchase request
2025-04-26 14:40:55,273 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 14:40:55,629 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:40:55,629 - INFO - Is vendor: True
2025-04-26 14:40:55,629 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 14:40:57,063 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:40:57,065 - INFO - Generated summary length: 63
2025-04-26 14:40:57,065 - INFO - Generated email type: request
2025-04-26 14:40:58,295 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 14:40:58,297 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 14:40:58,408 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 14:40:58,410 - INFO - Found 0 emails in thread
2025-04-26 14:40:59,120 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:40:59,121 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 14:40:59,121 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 14:40:59,193 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:40:59,193 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 14:40:59,193 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 14:40:59,277 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 14:40:59,277 - ERROR - Error saving attachment: {}
2025-04-26 14:40:59,278 - ERROR - Error type: APIError
2025-04-26 14:40:59,278 - ERROR - Attachment data: {'email_log_id': 151, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 14:40:59,278 - ERROR - Error saving email log: {}
2025-04-26 14:40:59,278 - ERROR - Error type: APIError
2025-04-26 14:40:59,280 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 14:40:59,280 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 14:40:59,584 - INFO - Checking email michaelt@cursor.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:40:59,584 - INFO - Is vendor: False
2025-04-26 14:40:59,585 - INFO - Non-vendor email skipped: from=michaelt@cursor.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:40:59,585 - INFO - Skipped non-vendor email: 1965d801cc9d1b08
2025-04-26 14:40:59,896 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:40:59,896 - INFO - Is vendor: False
2025-04-26 14:40:59,897 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:40:59,897 - INFO - Skipped non-vendor email: 1965aa8b3b388a9e
2025-04-26 14:41:00,641 - INFO - Checking email michaelt@cursor.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:00,642 - INFO - Is vendor: False
2025-04-26 14:41:00,642 - INFO - Non-vendor email skipped: from=michaelt@cursor.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:00,642 - INFO - Skipped non-vendor email: 19658577debe3a64
2025-04-26 14:41:00,969 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:00,970 - INFO - Is vendor: False
2025-04-26 14:41:00,970 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:00,970 - INFO - Skipped non-vendor email: 1965599e9295c5bf
2025-04-26 14:41:01,294 - INFO - Checking email welcome@supabase.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:01,294 - INFO - Is vendor: False
2025-04-26 14:41:01,294 - INFO - Non-vendor email skipped: from=welcome@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:01,294 - INFO - Skipped non-vendor email: 19649b9a7d379bdd
2025-04-26 14:41:01,671 - INFO - Checking email welcome@supabase.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:01,671 - INFO - Is vendor: False
2025-04-26 14:41:01,671 - INFO - Non-vendor email skipped: from=welcome@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:01,671 - INFO - Skipped non-vendor email: 19649b979fd40216
2025-04-26 14:41:01,984 - INFO - Checking email welcome@supabase.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:01,984 - INFO - Is vendor: False
2025-04-26 14:41:01,984 - INFO - Non-vendor email skipped: from=welcome@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:01,985 - INFO - Skipped non-vendor email: 1964785213e795c7
2025-04-26 14:41:02,698 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:02,699 - INFO - Is vendor: False
2025-04-26 14:41:02,699 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:02,699 - INFO - Skipped non-vendor email: 19645ee513d6bff6
2025-04-26 14:41:03,027 - INFO - Checking email team@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:03,027 - INFO - Is vendor: False
2025-04-26 14:41:03,027 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:03,028 - INFO - Skipped non-vendor email: 1964461589df2bf2
2025-04-26 14:41:03,428 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:03,429 - INFO - Is vendor: False
2025-04-26 14:41:03,429 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:03,429 - INFO - Skipped non-vendor email: 19640c539745c984
2025-04-26 14:41:03,838 - INFO - Checking email your@product.miro.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:03,838 - INFO - Is vendor: False
2025-04-26 14:41:03,838 - INFO - Non-vendor email skipped: from=your@product.miro.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:03,838 - INFO - Skipped non-vendor email: 1963cf041b5ffa98
2025-04-26 14:41:04,256 - INFO - Checking email your@product.miro.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:04,257 - INFO - Is vendor: False
2025-04-26 14:41:04,257 - INFO - Non-vendor email skipped: from=your@product.miro.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:04,257 - INFO - Skipped non-vendor email: 1963ceb01203537b
2025-04-26 14:41:04,659 - INFO - Checking email team@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:04,659 - INFO - Is vendor: False
2025-04-26 14:41:04,659 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:04,659 - INFO - Skipped non-vendor email: 19634eda2b58f9c0
2025-04-26 14:41:05,170 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:05,170 - INFO - Is vendor: False
2025-04-26 14:41:05,170 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:05,170 - INFO - Skipped non-vendor email: 19623e431247bcda
2025-04-26 14:41:05,563 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:05,564 - INFO - Is vendor: False
2025-04-26 14:41:05,564 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:05,564 - INFO - Skipped non-vendor email: 19621e0e7c0c4047
2025-04-26 14:41:05,877 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:05,878 - INFO - Is vendor: False
2025-04-26 14:41:05,878 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:05,878 - INFO - Skipped non-vendor email: 195e8f69e3a9b1cb
2025-04-26 14:41:06,192 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:06,192 - INFO - Is vendor: False
2025-04-26 14:41:06,192 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:06,192 - INFO - Skipped non-vendor email: 195e4ea41453cb70
2025-04-26 14:41:06,505 - INFO - Checking email ivan@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:06,505 - INFO - Is vendor: False
2025-04-26 14:41:06,506 - INFO - Non-vendor email skipped: from=ivan@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:06,506 - INFO - Skipped non-vendor email: 195dd623e7ba2b53
2025-04-26 14:41:06,917 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:06,917 - INFO - Is vendor: False
2025-04-26 14:41:06,917 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:06,917 - INFO - Skipped non-vendor email: 195daeae90f76840
2025-04-26 14:41:07,240 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:07,240 - INFO - Is vendor: False
2025-04-26 14:41:07,240 - INFO - Non-vendor email skipped: from=no-reply@accounts.google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:07,240 - INFO - Skipped non-vendor email: 195daeae518fecdd
2025-04-26 14:41:07,619 - INFO - Checking email drive-shares-noreply@google.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:07,619 - INFO - Is vendor: False
2025-04-26 14:41:07,619 - INFO - Non-vendor email skipped: from=drive-shares-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:07,619 - INFO - Skipped non-vendor email: 195d671ec15ec846
2025-04-26 14:41:07,926 - INFO - Checking email team@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:07,926 - INFO - Is vendor: False
2025-04-26 14:41:07,926 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:07,926 - INFO - Skipped non-vendor email: 195cf892e4f7db12
2025-04-26 14:41:08,232 - INFO - Checking email team@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:08,233 - INFO - Is vendor: False
2025-04-26 14:41:08,233 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:08,233 - INFO - Skipped non-vendor email: 195c53cde474e1ae
2025-04-26 14:41:08,542 - INFO - Checking email team@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:08,543 - INFO - Is vendor: False
2025-04-26 14:41:08,543 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:08,543 - INFO - Skipped non-vendor email: 195b6f0625b261e8
2025-04-26 14:41:08,853 - INFO - Checking email team@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:08,853 - INFO - Is vendor: False
2025-04-26 14:41:08,853 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:08,853 - INFO - Skipped non-vendor email: 195aca3ad97ae936
2025-04-26 14:41:09,156 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:09,156 - INFO - Is vendor: False
2025-04-26 14:41:09,156 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:09,156 - INFO - Skipped non-vendor email: 195a77bc0134c788
2025-04-26 14:41:09,674 - INFO - Checking email team@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:09,674 - INFO - Is vendor: False
2025-04-26 14:41:09,674 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:09,674 - INFO - Skipped non-vendor email: 195a256e8510b298
2025-04-26 14:41:10,395 - INFO - Checking email notify@mail.notion.so against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:10,395 - INFO - Is vendor: False
2025-04-26 14:41:10,395 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:10,395 - INFO - Skipped non-vendor email: 195a25038936df85
2025-04-26 14:41:10,785 - INFO - Checking email workspace-noreply@google.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:10,785 - INFO - Is vendor: False
2025-04-26 14:41:10,785 - INFO - Non-vendor email skipped: from=workspace-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:10,785 - INFO - Skipped non-vendor email: 19595c64c6c6d6eb
2025-04-26 14:41:11,101 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:11,101 - INFO - Is vendor: False
2025-04-26 14:41:11,102 - INFO - Non-vendor email skipped: from=no-reply@accounts.google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:11,102 - INFO - Skipped non-vendor email: 1958eee70835096e
2025-04-26 14:41:11,404 - INFO - Checking email mail-noreply@google.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:11,404 - INFO - Is vendor: False
2025-04-26 14:41:11,404 - INFO - Non-vendor email skipped: from=mail-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:11,404 - INFO - Skipped non-vendor email: 1958ddcf16172961
2025-04-26 14:41:11,729 - INFO - Checking email mail-noreply@google.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:11,729 - INFO - Is vendor: False
2025-04-26 14:41:11,729 - INFO - Non-vendor email skipped: from=mail-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:41:11,729 - INFO - Skipped non-vendor email: 1958ddcf0696f6d5
2025-04-26 14:41:12,116 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:12,116 - INFO - Is vendor: True
2025-04-26 14:41:12,117 - INFO - Found outbound email to vendor: ddd7913@gmail.com
2025-04-26 14:41:13,912 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:41:13,914 - INFO - Generated summary length: 56
2025-04-26 14:41:13,914 - INFO - Generated email type: delivery
2025-04-26 14:41:13,914 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 14:41:14,079 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 14:41:14,081 - INFO - Found 2 emails in thread
2025-04-26 14:41:14,779 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:41:14,781 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 14:41:14,781 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:41:14,840 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:41:14,840 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:41:14,843 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:41:14,844 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 14:41:15,188 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:15,188 - INFO - Is vendor: True
2025-04-26 14:41:15,188 - INFO - Found outbound email to vendor: ddd7913@gmail.com
2025-04-26 14:41:16,567 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:41:16,571 - INFO - Generated summary length: 58
2025-04-26 14:41:16,571 - INFO - Generated email type: order confirmation
2025-04-26 14:41:17,340 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 14:41:17,343 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 14:41:17,427 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 14:41:17,428 - INFO - Found 3 emails in thread
2025-04-26 14:41:18,053 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:41:18,056 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 14:41:18,056 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:41:18,118 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:41:18,119 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:41:18,119 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 14:41:18,173 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 14:41:18,204 - ERROR - Error saving attachment: {}
2025-04-26 14:41:18,204 - ERROR - Error type: APIError
2025-04-26 14:41:18,204 - ERROR - Attachment data: {'email_log_id': 153, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 14:41:18,204 - ERROR - Error saving email log: {}
2025-04-26 14:41:18,204 - ERROR - Error type: APIError
2025-04-26 14:41:18,207 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:41:18,207 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 14:41:18,594 - INFO - Checking email zach@shiftsai.com against vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 14:41:18,594 - INFO - Is vendor: False
2025-04-26 14:41:18,594 - INFO - Non-vendor email skipped: from=jiyeon@shiftsai.com, to=zach@shiftsai.com, is_outbound=True
2025-04-26 14:41:18,594 - INFO - Skipped non-vendor email: 1964825ab5c28d35
2025-04-26 14:41:18,595 - INFO - GmailWatcher initialized
2025-04-26 14:51:50,335 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x111c81610>
2025-04-26 14:51:53,075 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 14:51:53,075 - INFO - Loading vendor emails from: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 14:51:53,076 - INFO - Loaded 3 vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:51:53,077 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 14:51:53,221 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 14:51:53,244 - INFO - Supabase client initialized successfully
2025-04-26 14:51:53,245 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 14:51:54,386 - INFO - Found 39 received messages
2025-04-26 14:51:54,722 - INFO - Found 3 sent messages
2025-04-26 14:51:55,108 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:51:55,108 - INFO - Is vendor: True
2025-04-26 14:51:55,108 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 14:51:57,159 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:51:57,171 - INFO - Generated summary length: 68
2025-04-26 14:51:57,171 - INFO - Generated email type: delay
2025-04-26 14:51:57,171 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 14:51:57,971 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 14:51:57,979 - INFO - Found 4 emails in thread
2025-04-26 14:51:58,699 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:51:58,702 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 14:51:58,702 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:51:58,828 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:51:58,830 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:51:58,836 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:51:58,836 - INFO - Processed email: 196675e9f37b6406
2025-04-26 14:51:59,175 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:51:59,175 - INFO - Is vendor: False
2025-04-26 14:51:59,175 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:51:59,175 - INFO - Skipped non-vendor email: 196651cd71e2d02d
2025-04-26 14:51:59,486 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:51:59,486 - INFO - Is vendor: True
2025-04-26 14:51:59,486 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 14:52:01,188 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:52:01,189 - INFO - Generated summary length: 68
2025-04-26 14:52:01,189 - INFO - Generated email type: confirmation
2025-04-26 14:52:01,189 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 14:52:01,312 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 14:52:01,315 - INFO - Found 5 emails in thread
2025-04-26 14:52:02,045 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:52:02,047 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 14:52:02,048 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:52:02,229 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:52:02,230 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:52:02,233 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:52:02,233 - INFO - Processed email: 19661ecddae94e49
2025-04-26 14:52:02,559 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:02,560 - INFO - Is vendor: False
2025-04-26 14:52:02,560 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:02,560 - INFO - Skipped non-vendor email: 1965fe7da333da4b
2025-04-26 14:52:03,017 - INFO - Checking email noreply@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:03,017 - INFO - Is vendor: False
2025-04-26 14:52:03,017 - INFO - Non-vendor email skipped: from=noreply@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:03,017 - INFO - Skipped non-vendor email: 1965eb11dccf8919
2025-04-26 14:52:03,429 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:03,429 - INFO - Is vendor: True
2025-04-26 14:52:03,429 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 14:52:05,178 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:52:05,180 - INFO - Generated summary length: 20
2025-04-26 14:52:05,180 - INFO - Generated email type: procurement
2025-04-26 14:52:06,372 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 14:52:06,375 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 14:52:06,496 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 14:52:06,499 - INFO - Found 1 emails in thread
2025-04-26 14:52:07,212 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:52:07,214 - INFO - Parsed delivery date: 2024-04-20
2025-04-26 14:52:07,214 - INFO - Attempting to save email log: purchase request
2025-04-26 14:52:07,314 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:52:07,317 - INFO - Email saved successfully: purchase request
2025-04-26 14:52:07,318 - INFO - Attempting to save attachment: sample_purchase_order.pdf
2025-04-26 14:52:07,442 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 14:52:07,442 - ERROR - Error saving attachment: {}
2025-04-26 14:52:07,442 - ERROR - Error type: APIError
2025-04-26 14:52:07,442 - ERROR - Attachment data: {'email_log_id': 156, 'filename': 'sample_purchase_order.pdf', 'mime_type': 'application/pdf', 'content': 'Purchase Order\nPO Number: PO-2024-001\nDate: 2025-04-14\nVendor: ABC Industrial Supplies Co.\nVendor Email: sales@abcindustrial.com\nBuyer: ShiftsAI Manufacturing Ltd.\nBuyer Contact: procurement@shiftsai.com\nItem Description Quantity Unit Price Total\nHigh-grade Steel Sheets 1000 $15.75 $15750.00\nIndustrial Lubricant (5L) 50 $22.50 $1125.00\nProtective Gloves (Box) 200 $6.80 $1360.00\nTotal $18235.00\nRequested Delivery Date: 2024-04-20\nDelivery Location: ShiftsAI Warehouse, 123 Industry Rd, Seoul, South Korea\n'}
2025-04-26 14:52:07,442 - ERROR - Error saving email log: {}
2025-04-26 14:52:07,442 - ERROR - Error type: APIError
2025-04-26 14:52:07,443 - ERROR - Error sending message to MCP server: [Errno 32] Broken pipe
2025-04-26 14:52:07,443 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 14:52:07,814 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:07,814 - INFO - Is vendor: True
2025-04-26 14:52:07,814 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 14:52:09,339 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:52:09,341 - INFO - Generated summary length: 47
2025-04-26 14:52:09,341 - INFO - Generated email type: inquiry
2025-04-26 14:52:10,440 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 14:52:10,446 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 14:52:10,544 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 14:52:10,546 - INFO - Found 1 emails in thread
2025-04-26 14:52:11,221 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:52:11,222 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 14:52:11,222 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 14:52:11,306 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:52:11,307 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 14:52:11,307 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 14:52:11,400 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 14:52:11,401 - ERROR - Error saving attachment: {}
2025-04-26 14:52:11,401 - ERROR - Error type: APIError
2025-04-26 14:52:11,401 - ERROR - Attachment data: {'email_log_id': 157, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 14:52:11,401 - ERROR - Error saving email log: {}
2025-04-26 14:52:11,401 - ERROR - Error type: APIError
2025-04-26 14:52:11,405 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 14:52:11,405 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 14:52:11,800 - INFO - Checking email michaelt@cursor.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:11,800 - INFO - Is vendor: False
2025-04-26 14:52:11,800 - INFO - Non-vendor email skipped: from=michaelt@cursor.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:11,800 - INFO - Skipped non-vendor email: 1965d801cc9d1b08
2025-04-26 14:52:12,210 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:12,210 - INFO - Is vendor: False
2025-04-26 14:52:12,210 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:12,210 - INFO - Skipped non-vendor email: 1965aa8b3b388a9e
2025-04-26 14:52:12,533 - INFO - Checking email michaelt@cursor.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:12,533 - INFO - Is vendor: False
2025-04-26 14:52:12,533 - INFO - Non-vendor email skipped: from=michaelt@cursor.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:12,533 - INFO - Skipped non-vendor email: 19658577debe3a64
2025-04-26 14:52:12,938 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:12,938 - INFO - Is vendor: False
2025-04-26 14:52:12,938 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:12,938 - INFO - Skipped non-vendor email: 1965599e9295c5bf
2025-04-26 14:52:13,333 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:13,333 - INFO - Is vendor: False
2025-04-26 14:52:13,333 - INFO - Non-vendor email skipped: from=welcome@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:13,334 - INFO - Skipped non-vendor email: 19649b9a7d379bdd
2025-04-26 14:52:13,666 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:13,667 - INFO - Is vendor: False
2025-04-26 14:52:13,667 - INFO - Non-vendor email skipped: from=welcome@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:13,667 - INFO - Skipped non-vendor email: 19649b979fd40216
2025-04-26 14:52:14,044 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:14,044 - INFO - Is vendor: False
2025-04-26 14:52:14,044 - INFO - Non-vendor email skipped: from=welcome@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:14,044 - INFO - Skipped non-vendor email: 1964785213e795c7
2025-04-26 14:52:14,459 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:14,459 - INFO - Is vendor: False
2025-04-26 14:52:14,460 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:14,460 - INFO - Skipped non-vendor email: 19645ee513d6bff6
2025-04-26 14:52:14,792 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:14,793 - INFO - Is vendor: False
2025-04-26 14:52:14,793 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:14,793 - INFO - Skipped non-vendor email: 1964461589df2bf2
2025-04-26 14:52:15,173 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:15,173 - INFO - Is vendor: False
2025-04-26 14:52:15,174 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:15,174 - INFO - Skipped non-vendor email: 19640c539745c984
2025-04-26 14:52:15,492 - INFO - Checking email your@product.miro.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:15,492 - INFO - Is vendor: False
2025-04-26 14:52:15,492 - INFO - Non-vendor email skipped: from=your@product.miro.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:15,492 - INFO - Skipped non-vendor email: 1963cf041b5ffa98
2025-04-26 14:52:15,895 - INFO - Checking email your@product.miro.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:15,895 - INFO - Is vendor: False
2025-04-26 14:52:15,895 - INFO - Non-vendor email skipped: from=your@product.miro.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:15,895 - INFO - Skipped non-vendor email: 1963ceb01203537b
2025-04-26 14:52:16,302 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:16,302 - INFO - Is vendor: False
2025-04-26 14:52:16,302 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:16,303 - INFO - Skipped non-vendor email: 19634eda2b58f9c0
2025-04-26 14:52:16,709 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:16,710 - INFO - Is vendor: False
2025-04-26 14:52:16,710 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:16,710 - INFO - Skipped non-vendor email: 19623e431247bcda
2025-04-26 14:52:17,026 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:17,026 - INFO - Is vendor: False
2025-04-26 14:52:17,026 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:17,026 - INFO - Skipped non-vendor email: 19621e0e7c0c4047
2025-04-26 14:52:17,352 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:17,352 - INFO - Is vendor: False
2025-04-26 14:52:17,352 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:17,352 - INFO - Skipped non-vendor email: 195e8f69e3a9b1cb
2025-04-26 14:52:17,735 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:17,735 - INFO - Is vendor: False
2025-04-26 14:52:17,736 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:17,736 - INFO - Skipped non-vendor email: 195e4ea41453cb70
2025-04-26 14:52:18,054 - INFO - Checking email ivan@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:18,055 - INFO - Is vendor: False
2025-04-26 14:52:18,055 - INFO - Non-vendor email skipped: from=ivan@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:18,055 - INFO - Skipped non-vendor email: 195dd623e7ba2b53
2025-04-26 14:52:18,446 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:18,446 - INFO - Is vendor: False
2025-04-26 14:52:18,446 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:18,446 - INFO - Skipped non-vendor email: 195daeae90f76840
2025-04-26 14:52:19,165 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:19,165 - INFO - Is vendor: False
2025-04-26 14:52:19,165 - INFO - Non-vendor email skipped: from=no-reply@accounts.google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:19,165 - INFO - Skipped non-vendor email: 195daeae518fecdd
2025-04-26 14:52:19,513 - INFO - Checking email drive-shares-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:19,513 - INFO - Is vendor: False
2025-04-26 14:52:19,513 - INFO - Non-vendor email skipped: from=drive-shares-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:19,513 - INFO - Skipped non-vendor email: 195d671ec15ec846
2025-04-26 14:52:19,849 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:19,849 - INFO - Is vendor: False
2025-04-26 14:52:19,849 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:19,850 - INFO - Skipped non-vendor email: 195cf892e4f7db12
2025-04-26 14:52:20,187 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:20,187 - INFO - Is vendor: False
2025-04-26 14:52:20,187 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:20,187 - INFO - Skipped non-vendor email: 195c53cde474e1ae
2025-04-26 14:52:20,607 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:20,607 - INFO - Is vendor: False
2025-04-26 14:52:20,607 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:20,607 - INFO - Skipped non-vendor email: 195b6f0625b261e8
2025-04-26 14:52:21,378 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:21,378 - INFO - Is vendor: False
2025-04-26 14:52:21,378 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:21,378 - INFO - Skipped non-vendor email: 195aca3ad97ae936
2025-04-26 14:52:21,853 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:21,854 - INFO - Is vendor: False
2025-04-26 14:52:21,854 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:21,854 - INFO - Skipped non-vendor email: 195a77bc0134c788
2025-04-26 14:52:22,256 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:22,256 - INFO - Is vendor: False
2025-04-26 14:52:22,256 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:22,256 - INFO - Skipped non-vendor email: 195a256e8510b298
2025-04-26 14:52:22,766 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:22,766 - INFO - Is vendor: False
2025-04-26 14:52:22,766 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:22,766 - INFO - Skipped non-vendor email: 195a25038936df85
2025-04-26 14:52:23,175 - INFO - Checking email workspace-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:23,175 - INFO - Is vendor: False
2025-04-26 14:52:23,175 - INFO - Non-vendor email skipped: from=workspace-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:23,175 - INFO - Skipped non-vendor email: 19595c64c6c6d6eb
2025-04-26 14:52:23,496 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:23,496 - INFO - Is vendor: False
2025-04-26 14:52:23,496 - INFO - Non-vendor email skipped: from=no-reply@accounts.google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:23,496 - INFO - Skipped non-vendor email: 1958eee70835096e
2025-04-26 14:52:23,882 - INFO - Checking email mail-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:23,883 - INFO - Is vendor: False
2025-04-26 14:52:23,883 - INFO - Non-vendor email skipped: from=mail-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:23,883 - INFO - Skipped non-vendor email: 1958ddcf16172961
2025-04-26 14:52:24,306 - INFO - Checking email mail-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:24,306 - INFO - Is vendor: False
2025-04-26 14:52:24,306 - INFO - Non-vendor email skipped: from=mail-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 14:52:24,307 - INFO - Skipped non-vendor email: 1958ddcf0696f6d5
2025-04-26 14:52:24,916 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:24,917 - INFO - Is vendor: True
2025-04-26 14:52:24,917 - INFO - Found outbound email to vendor: ddd7913@gmail.com
2025-04-26 14:52:27,230 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:52:27,234 - INFO - Generated summary length: 56
2025-04-26 14:52:27,234 - INFO - Generated email type: delivery
2025-04-26 14:52:27,234 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 14:52:27,405 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 14:52:27,409 - INFO - Found 6 emails in thread
2025-04-26 14:52:27,982 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:52:27,983 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 14:52:27,983 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:52:28,070 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:52:28,072 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:52:28,076 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:52:28,076 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 14:52:28,398 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:28,398 - INFO - Is vendor: True
2025-04-26 14:52:28,398 - INFO - Found outbound email to vendor: ddd7913@gmail.com
2025-04-26 14:52:29,817 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:52:29,818 - INFO - Generated summary length: 88
2025-04-26 14:52:29,818 - INFO - Generated email type: order confirmation
2025-04-26 14:52:30,960 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 14:52:30,962 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 14:52:31,024 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 14:52:31,025 - INFO - Found 7 emails in thread
2025-04-26 14:52:31,578 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 14:52:31,580 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 14:52:31,580 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:52:31,647 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 14:52:31,648 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:52:31,648 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 14:52:31,728 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 14:52:31,728 - ERROR - Error saving attachment: {}
2025-04-26 14:52:31,728 - ERROR - Error type: APIError
2025-04-26 14:52:31,728 - ERROR - Attachment data: {'email_log_id': 159, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 14:52:31,729 - ERROR - Error saving email log: {}
2025-04-26 14:52:31,729 - ERROR - Error type: APIError
2025-04-26 14:52:31,730 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 14:52:31,731 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 14:52:32,063 - INFO - Checking email zach@shiftsai.com against vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 14:52:32,063 - INFO - Is vendor: False
2025-04-26 14:52:32,063 - INFO - Non-vendor email skipped: from=jiyeon@shiftsai.com, to=zach@shiftsai.com, is_outbound=True
2025-04-26 14:52:32,063 - INFO - Skipped non-vendor email: 1964825ab5c28d35
2025-04-26 14:52:32,063 - INFO - GmailWatcher initialized
2025-04-26 15:09:12,343 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x11c492ab0>
2025-04-26 15:10:11,286 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 15:10:11,287 - INFO - Loading vendor emails from: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 15:10:11,287 - INFO - Loaded 3 vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:11,289 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 15:10:11,442 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 15:10:11,465 - INFO - Supabase client initialized successfully
2025-04-26 15:10:11,466 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 15:10:12,366 - INFO - Found 39 received messages
2025-04-26 15:10:12,744 - INFO - Found 3 sent messages
2025-04-26 15:10:13,074 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:13,075 - INFO - Is vendor: True
2025-04-26 15:10:13,075 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 15:10:15,115 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:10:15,124 - INFO - Generated summary length: 57
2025-04-26 15:10:15,124 - INFO - Generated email type: delay
2025-04-26 15:10:15,124 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:10:15,819 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:10:15,827 - INFO - Found 0 emails in thread
2025-04-26 15:10:16,446 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:10:16,449 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 15:10:16,449 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:10:16,541 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:10:16,542 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:10:16,551 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:10:16,551 - INFO - Processed email: 196675e9f37b6406
2025-04-26 15:10:16,944 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:16,944 - INFO - Is vendor: False
2025-04-26 15:10:16,945 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:16,945 - INFO - Skipped non-vendor email: 196651cd71e2d02d
2025-04-26 15:10:17,255 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:17,256 - INFO - Is vendor: True
2025-04-26 15:10:17,256 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 15:10:20,056 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:10:20,060 - INFO - Generated summary length: 71
2025-04-26 15:10:20,060 - INFO - Generated email type: confirmation
2025-04-26 15:10:20,060 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:10:20,150 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:10:20,153 - INFO - Found 1 emails in thread
2025-04-26 15:10:20,799 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:10:20,801 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 15:10:20,801 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:10:20,901 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:10:20,902 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:10:20,905 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:10:20,905 - INFO - Processed email: 19661ecddae94e49
2025-04-26 15:10:21,244 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:21,244 - INFO - Is vendor: False
2025-04-26 15:10:21,244 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:21,244 - INFO - Skipped non-vendor email: 1965fe7da333da4b
2025-04-26 15:10:21,655 - INFO - Checking email noreply@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:21,655 - INFO - Is vendor: False
2025-04-26 15:10:21,655 - INFO - Non-vendor email skipped: from=noreply@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:21,655 - INFO - Skipped non-vendor email: 1965eb11dccf8919
2025-04-26 15:10:21,967 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:21,967 - INFO - Is vendor: True
2025-04-26 15:10:21,967 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 15:10:23,308 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:10:23,310 - INFO - Generated summary length: 20
2025-04-26 15:10:23,310 - INFO - Generated email type: procurement
2025-04-26 15:10:24,365 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:10:24,368 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 15:10:24,470 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:10:24,472 - INFO - Found 0 emails in thread
2025-04-26 15:10:25,081 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:10:25,083 - INFO - Parsed delivery date: None
2025-04-26 15:10:25,083 - INFO - Attempting to save email log: purchase request
2025-04-26 15:10:25,158 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:10:25,161 - INFO - Email saved successfully: purchase request
2025-04-26 15:10:25,161 - INFO - Attempting to save attachment: sample_purchase_order.pdf
2025-04-26 15:10:25,273 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 15:10:25,274 - ERROR - Error saving attachment: {}
2025-04-26 15:10:25,274 - ERROR - Error type: APIError
2025-04-26 15:10:25,274 - ERROR - Attachment data: {'email_log_id': 162, 'filename': 'sample_purchase_order.pdf', 'mime_type': 'application/pdf', 'content': 'Purchase Order\nPO Number: PO-2024-001\nDate: 2025-04-14\nVendor: ABC Industrial Supplies Co.\nVendor Email: sales@abcindustrial.com\nBuyer: ShiftsAI Manufacturing Ltd.\nBuyer Contact: procurement@shiftsai.com\nItem Description Quantity Unit Price Total\nHigh-grade Steel Sheets 1000 $15.75 $15750.00\nIndustrial Lubricant (5L) 50 $22.50 $1125.00\nProtective Gloves (Box) 200 $6.80 $1360.00\nTotal $18235.00\nRequested Delivery Date: 2024-04-20\nDelivery Location: ShiftsAI Warehouse, 123 Industry Rd, Seoul, South Korea\n'}
2025-04-26 15:10:25,274 - ERROR - Error saving email log: {}
2025-04-26 15:10:25,275 - ERROR - Error type: APIError
2025-04-26 15:10:25,277 - INFO - Message sent to MCP server: purchase request
2025-04-26 15:10:25,277 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 15:10:25,592 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:25,593 - INFO - Is vendor: True
2025-04-26 15:10:25,593 - INFO - Found inbound email from vendor: ddd7913@gmail.com
2025-04-26 15:10:27,011 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:10:27,012 - INFO - Generated summary length: 52
2025-04-26 15:10:27,013 - INFO - Generated email type: inquiry
2025-04-26 15:10:28,019 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:10:28,021 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 15:10:28,102 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:10:28,105 - INFO - Found 0 emails in thread
2025-04-26 15:10:38,671 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:10:38,673 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 15:10:38,673 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 15:10:38,851 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:10:38,853 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 15:10:38,853 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 15:10:38,926 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 15:10:38,927 - ERROR - Error saving attachment: {}
2025-04-26 15:10:38,927 - ERROR - Error type: APIError
2025-04-26 15:10:38,927 - ERROR - Attachment data: {'email_log_id': 163, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 15:10:38,928 - ERROR - Error saving email log: {}
2025-04-26 15:10:38,928 - ERROR - Error type: APIError
2025-04-26 15:10:38,929 - ERROR - Error sending message to MCP server: [Errno 32] Broken pipe
2025-04-26 15:10:38,929 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 15:10:39,269 - INFO - Checking email michaelt@cursor.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:39,270 - INFO - Is vendor: False
2025-04-26 15:10:39,271 - INFO - Non-vendor email skipped: from=michaelt@cursor.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:39,271 - INFO - Skipped non-vendor email: 1965d801cc9d1b08
2025-04-26 15:10:39,594 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:39,594 - INFO - Is vendor: False
2025-04-26 15:10:39,594 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:39,594 - INFO - Skipped non-vendor email: 1965aa8b3b388a9e
2025-04-26 15:10:39,986 - INFO - Checking email michaelt@cursor.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:39,987 - INFO - Is vendor: False
2025-04-26 15:10:39,987 - INFO - Non-vendor email skipped: from=michaelt@cursor.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:39,987 - INFO - Skipped non-vendor email: 19658577debe3a64
2025-04-26 15:10:40,404 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:40,404 - INFO - Is vendor: False
2025-04-26 15:10:40,404 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:40,404 - INFO - Skipped non-vendor email: 1965599e9295c5bf
2025-04-26 15:10:40,735 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:40,736 - INFO - Is vendor: False
2025-04-26 15:10:40,736 - INFO - Non-vendor email skipped: from=welcome@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:40,736 - INFO - Skipped non-vendor email: 19649b9a7d379bdd
2025-04-26 15:10:41,116 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:41,116 - INFO - Is vendor: False
2025-04-26 15:10:41,116 - INFO - Non-vendor email skipped: from=welcome@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:41,117 - INFO - Skipped non-vendor email: 19649b979fd40216
2025-04-26 15:10:41,523 - INFO - Checking email welcome@supabase.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:41,523 - INFO - Is vendor: False
2025-04-26 15:10:41,524 - INFO - Non-vendor email skipped: from=welcome@supabase.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:41,524 - INFO - Skipped non-vendor email: 1964785213e795c7
2025-04-26 15:10:41,836 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:41,837 - INFO - Is vendor: False
2025-04-26 15:10:41,837 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:41,837 - INFO - Skipped non-vendor email: 19645ee513d6bff6
2025-04-26 15:10:42,153 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:42,154 - INFO - Is vendor: False
2025-04-26 15:10:42,154 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:42,154 - INFO - Skipped non-vendor email: 1964461589df2bf2
2025-04-26 15:10:42,545 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:42,546 - INFO - Is vendor: False
2025-04-26 15:10:42,546 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:42,546 - INFO - Skipped non-vendor email: 19640c539745c984
2025-04-26 15:10:42,871 - INFO - Checking email your@product.miro.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:42,871 - INFO - Is vendor: False
2025-04-26 15:10:42,871 - INFO - Non-vendor email skipped: from=your@product.miro.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:42,871 - INFO - Skipped non-vendor email: 1963cf041b5ffa98
2025-04-26 15:10:43,262 - INFO - Checking email your@product.miro.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:43,262 - INFO - Is vendor: False
2025-04-26 15:10:43,262 - INFO - Non-vendor email skipped: from=your@product.miro.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:43,263 - INFO - Skipped non-vendor email: 1963ceb01203537b
2025-04-26 15:10:43,578 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:43,579 - INFO - Is vendor: False
2025-04-26 15:10:43,579 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:43,579 - INFO - Skipped non-vendor email: 19634eda2b58f9c0
2025-04-26 15:10:43,979 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:43,979 - INFO - Is vendor: False
2025-04-26 15:10:43,979 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:43,979 - INFO - Skipped non-vendor email: 19623e431247bcda
2025-04-26 15:10:44,388 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:44,388 - INFO - Is vendor: False
2025-04-26 15:10:44,388 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:44,388 - INFO - Skipped non-vendor email: 19621e0e7c0c4047
2025-04-26 15:10:44,701 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:44,701 - INFO - Is vendor: False
2025-04-26 15:10:44,701 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:44,701 - INFO - Skipped non-vendor email: 195e8f69e3a9b1cb
2025-04-26 15:10:45,127 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:45,128 - INFO - Is vendor: False
2025-04-26 15:10:45,128 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:45,128 - INFO - Skipped non-vendor email: 195e4ea41453cb70
2025-04-26 15:10:45,440 - INFO - Checking email ivan@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:45,440 - INFO - Is vendor: False
2025-04-26 15:10:45,440 - INFO - Non-vendor email skipped: from=ivan@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:45,440 - INFO - Skipped non-vendor email: 195dd623e7ba2b53
2025-04-26 15:10:45,826 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:45,826 - INFO - Is vendor: False
2025-04-26 15:10:45,826 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:45,826 - INFO - Skipped non-vendor email: 195daeae90f76840
2025-04-26 15:10:46,143 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:46,144 - INFO - Is vendor: False
2025-04-26 15:10:46,144 - INFO - Non-vendor email skipped: from=no-reply@accounts.google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:46,144 - INFO - Skipped non-vendor email: 195daeae518fecdd
2025-04-26 15:10:46,479 - INFO - Checking email drive-shares-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:46,479 - INFO - Is vendor: False
2025-04-26 15:10:46,479 - INFO - Non-vendor email skipped: from=drive-shares-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:46,479 - INFO - Skipped non-vendor email: 195d671ec15ec846
2025-04-26 15:10:46,861 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:46,861 - INFO - Is vendor: False
2025-04-26 15:10:46,862 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:46,862 - INFO - Skipped non-vendor email: 195cf892e4f7db12
2025-04-26 15:10:47,184 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:47,184 - INFO - Is vendor: False
2025-04-26 15:10:47,184 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:47,184 - INFO - Skipped non-vendor email: 195c53cde474e1ae
2025-04-26 15:10:47,591 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:47,591 - INFO - Is vendor: False
2025-04-26 15:10:47,591 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:47,591 - INFO - Skipped non-vendor email: 195b6f0625b261e8
2025-04-26 15:10:47,997 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:47,997 - INFO - Is vendor: False
2025-04-26 15:10:47,997 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:47,997 - INFO - Skipped non-vendor email: 195aca3ad97ae936
2025-04-26 15:10:48,386 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:48,386 - INFO - Is vendor: False
2025-04-26 15:10:48,386 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:48,386 - INFO - Skipped non-vendor email: 195a77bc0134c788
2025-04-26 15:10:48,697 - INFO - Checking email team@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:48,697 - INFO - Is vendor: False
2025-04-26 15:10:48,697 - INFO - Non-vendor email skipped: from=team@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:48,698 - INFO - Skipped non-vendor email: 195a256e8510b298
2025-04-26 15:10:49,011 - INFO - Checking email notify@mail.notion.so against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:49,011 - INFO - Is vendor: False
2025-04-26 15:10:49,011 - INFO - Non-vendor email skipped: from=notify@mail.notion.so, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:49,011 - INFO - Skipped non-vendor email: 195a25038936df85
2025-04-26 15:10:49,319 - INFO - Checking email workspace-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:49,319 - INFO - Is vendor: False
2025-04-26 15:10:49,319 - INFO - Non-vendor email skipped: from=workspace-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:49,319 - INFO - Skipped non-vendor email: 19595c64c6c6d6eb
2025-04-26 15:10:49,714 - INFO - Checking email no-reply@accounts.google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:49,714 - INFO - Is vendor: False
2025-04-26 15:10:49,715 - INFO - Non-vendor email skipped: from=no-reply@accounts.google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:49,715 - INFO - Skipped non-vendor email: 1958eee70835096e
2025-04-26 15:10:50,025 - INFO - Checking email mail-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:50,025 - INFO - Is vendor: False
2025-04-26 15:10:50,025 - INFO - Non-vendor email skipped: from=mail-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:50,025 - INFO - Skipped non-vendor email: 1958ddcf16172961
2025-04-26 15:10:50,373 - INFO - Checking email mail-noreply@google.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:50,373 - INFO - Is vendor: False
2025-04-26 15:10:50,373 - INFO - Non-vendor email skipped: from=mail-noreply@google.com, to=jiyeon@shiftsai.com, is_outbound=False
2025-04-26 15:10:50,373 - INFO - Skipped non-vendor email: 1958ddcf0696f6d5
2025-04-26 15:10:50,737 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:50,737 - INFO - Is vendor: True
2025-04-26 15:10:50,737 - INFO - Found outbound email to vendor: ddd7913@gmail.com
2025-04-26 15:10:52,749 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:10:52,760 - INFO - Generated summary length: 82
2025-04-26 15:10:52,760 - INFO - Generated email type: expedite
2025-04-26 15:10:52,760 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:10:52,966 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:10:52,969 - INFO - Found 2 emails in thread
2025-04-26 15:10:53,722 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:10:53,728 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 15:10:53,728 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:10:53,803 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:10:53,803 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:10:53,807 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:10:53,807 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 15:10:54,123 - INFO - Checking email ddd7913@gmail.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:54,123 - INFO - Is vendor: True
2025-04-26 15:10:54,123 - INFO - Found outbound email to vendor: ddd7913@gmail.com
2025-04-26 15:10:55,779 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:10:55,780 - INFO - Generated summary length: 58
2025-04-26 15:10:55,780 - INFO - Generated email type: order confirmation
2025-04-26 15:10:56,784 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:10:56,786 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:10:56,869 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:10:56,870 - INFO - Found 3 emails in thread
2025-04-26 15:10:57,601 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:10:57,603 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 15:10:57,603 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:10:57,684 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:10:57,685 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:10:57,685 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 15:10:57,779 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 15:10:57,780 - ERROR - Error saving attachment: {}
2025-04-26 15:10:57,780 - ERROR - Error type: APIError
2025-04-26 15:10:57,780 - ERROR - Attachment data: {'email_log_id': 165, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 15:10:57,780 - ERROR - Error saving email log: {}
2025-04-26 15:10:57,780 - ERROR - Error type: APIError
2025-04-26 15:10:57,782 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:10:57,782 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 15:10:58,110 - INFO - Checking email zach@shiftsai.com against vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 15:10:58,110 - INFO - Is vendor: False
2025-04-26 15:10:58,110 - INFO - Non-vendor email skipped: from=jiyeon@shiftsai.com, to=zach@shiftsai.com, is_outbound=True
2025-04-26 15:10:58,110 - INFO - Skipped non-vendor email: 1964825ab5c28d35
2025-04-26 15:10:58,110 - INFO - GmailWatcher initialized
2025-04-26 15:11:00,375 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x107337cb0>
2025-04-26 15:11:00,375 - ERROR - Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x109f3ae10>, 249380.780232666)]']
connector: <aiohttp.connector.TCPConnector object at 0x109f24320>
2025-04-26 15:14:58,595 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 15:14:58,596 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'yeonip7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 15:14:58,598 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 15:14:58,752 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 15:14:58,776 - INFO - Supabase client initialized successfully
2025-04-26 15:14:58,777 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 15:14:59,638 - INFO - Found 39 received messages
2025-04-26 15:14:59,985 - INFO - Found 3 sent messages
2025-04-26 15:15:00,348 - INFO - Is vendor: True
2025-04-26 15:15:02,341 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:15:02,352 - INFO - Generated summary length: 107
2025-04-26 15:15:02,352 - INFO - Generated email type: delivery
2025-04-26 15:15:02,352 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:15:02,990 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:15:02,997 - INFO - Found 4 emails in thread
2025-04-26 15:15:03,789 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:15:03,797 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 15:15:03,797 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:15:03,941 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:15:03,942 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:15:03,949 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:15:03,949 - INFO - Processed email: 196675e9f37b6406
2025-04-26 15:15:04,283 - INFO - Is vendor: False
2025-04-26 15:15:04,283 - INFO - Skipped non-vendor email: 196651cd71e2d02d
2025-04-26 15:15:04,595 - INFO - Is vendor: True
2025-04-26 15:15:06,127 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:15:06,129 - INFO - Generated summary length: 71
2025-04-26 15:15:06,130 - INFO - Generated email type: confirmation
2025-04-26 15:15:06,130 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:15:06,236 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:15:06,239 - INFO - Found 5 emails in thread
2025-04-26 15:15:07,048 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:15:07,049 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 15:15:07,050 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:15:07,152 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:15:07,153 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:15:07,157 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:15:07,157 - INFO - Processed email: 19661ecddae94e49
2025-04-26 15:15:07,879 - INFO - Is vendor: False
2025-04-26 15:15:07,879 - INFO - Skipped non-vendor email: 1965fe7da333da4b
2025-04-26 15:15:08,254 - INFO - Is vendor: False
2025-04-26 15:15:08,255 - INFO - Skipped non-vendor email: 1965eb11dccf8919
2025-04-26 15:15:08,567 - INFO - Is vendor: True
2025-04-26 15:15:10,026 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:15:10,027 - INFO - Generated summary length: 20
2025-04-26 15:15:10,027 - INFO - Generated email type: procurement
2025-04-26 15:15:10,941 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:15:10,944 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 15:15:11,043 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:15:11,046 - INFO - Found 1 emails in thread
2025-04-26 15:15:12,440 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:15:12,443 - INFO - Parsed delivery date: None
2025-04-26 15:15:12,444 - INFO - Attempting to save email log: purchase request
2025-04-26 15:15:12,525 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:15:12,527 - INFO - Email saved successfully: purchase request
2025-04-26 15:15:12,528 - INFO - Attempting to save attachment: sample_purchase_order.pdf
2025-04-26 15:15:12,594 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 15:15:12,595 - ERROR - Error saving attachment: {}
2025-04-26 15:15:12,595 - ERROR - Error type: APIError
2025-04-26 15:15:12,595 - ERROR - Attachment data: {'email_log_id': 168, 'filename': 'sample_purchase_order.pdf', 'mime_type': 'application/pdf', 'content': 'Purchase Order\nPO Number: PO-2024-001\nDate: 2025-04-14\nVendor: ABC Industrial Supplies Co.\nVendor Email: sales@abcindustrial.com\nBuyer: ShiftsAI Manufacturing Ltd.\nBuyer Contact: procurement@shiftsai.com\nItem Description Quantity Unit Price Total\nHigh-grade Steel Sheets 1000 $15.75 $15750.00\nIndustrial Lubricant (5L) 50 $22.50 $1125.00\nProtective Gloves (Box) 200 $6.80 $1360.00\nTotal $18235.00\nRequested Delivery Date: 2024-04-20\nDelivery Location: ShiftsAI Warehouse, 123 Industry Rd, Seoul, South Korea\n'}
2025-04-26 15:15:12,595 - ERROR - Error saving email log: {}
2025-04-26 15:15:12,595 - ERROR - Error type: APIError
2025-04-26 15:15:12,596 - ERROR - Error sending message to MCP server: [Errno 32] Broken pipe
2025-04-26 15:15:12,596 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 15:15:13,304 - INFO - Is vendor: True
2025-04-26 15:15:14,626 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:15:14,628 - INFO - Generated summary length: 54
2025-04-26 15:15:14,628 - INFO - Generated email type: request
2025-04-26 15:15:16,088 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:15:16,091 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 15:15:16,171 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:15:16,174 - INFO - Found 1 emails in thread
2025-04-26 15:15:16,876 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:15:17,049 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 15:15:17,049 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 15:15:17,120 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:15:17,121 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 15:15:17,121 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 15:15:17,204 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 15:15:17,205 - ERROR - Error saving attachment: {}
2025-04-26 15:15:17,205 - ERROR - Error type: APIError
2025-04-26 15:15:17,205 - ERROR - Attachment data: {'email_log_id': 169, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 15:15:17,206 - ERROR - Error saving email log: {}
2025-04-26 15:15:17,206 - ERROR - Error type: APIError
2025-04-26 15:15:17,210 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 15:15:17,210 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 15:15:17,517 - INFO - Is vendor: False
2025-04-26 15:15:17,517 - INFO - Skipped non-vendor email: 1965d801cc9d1b08
2025-04-26 15:15:17,817 - INFO - Is vendor: False
2025-04-26 15:15:17,817 - INFO - Skipped non-vendor email: 1965aa8b3b388a9e
2025-04-26 15:15:18,213 - INFO - Is vendor: False
2025-04-26 15:15:18,213 - INFO - Skipped non-vendor email: 19658577debe3a64
2025-04-26 15:15:18,530 - INFO - Is vendor: False
2025-04-26 15:15:18,530 - INFO - Skipped non-vendor email: 1965599e9295c5bf
2025-04-26 15:15:18,839 - INFO - Is vendor: False
2025-04-26 15:15:18,839 - INFO - Skipped non-vendor email: 19649b9a7d379bdd
2025-04-26 15:15:19,159 - INFO - Is vendor: False
2025-04-26 15:15:19,160 - INFO - Skipped non-vendor email: 19649b979fd40216
2025-04-26 15:15:19,541 - INFO - Is vendor: False
2025-04-26 15:15:19,541 - INFO - Skipped non-vendor email: 1964785213e795c7
2025-04-26 15:15:19,871 - INFO - Is vendor: False
2025-04-26 15:15:19,872 - INFO - Skipped non-vendor email: 19645ee513d6bff6
2025-04-26 15:15:20,175 - INFO - Is vendor: False
2025-04-26 15:15:20,175 - INFO - Skipped non-vendor email: 1964461589df2bf2
2025-04-26 15:15:20,564 - INFO - Is vendor: False
2025-04-26 15:15:20,565 - INFO - Skipped non-vendor email: 19640c539745c984
2025-04-26 15:15:20,882 - INFO - Is vendor: False
2025-04-26 15:15:20,882 - INFO - Skipped non-vendor email: 1963cf041b5ffa98
2025-04-26 15:15:21,184 - INFO - Is vendor: False
2025-04-26 15:15:21,184 - INFO - Skipped non-vendor email: 1963ceb01203537b
2025-04-26 15:15:21,513 - INFO - Is vendor: False
2025-04-26 15:15:21,513 - INFO - Skipped non-vendor email: 19634eda2b58f9c0
2025-04-26 15:15:21,913 - INFO - Is vendor: False
2025-04-26 15:15:21,914 - INFO - Skipped non-vendor email: 19623e431247bcda
2025-04-26 15:15:22,306 - INFO - Is vendor: False
2025-04-26 15:15:22,306 - INFO - Skipped non-vendor email: 19621e0e7c0c4047
2025-04-26 15:15:22,617 - INFO - Is vendor: False
2025-04-26 15:15:22,617 - INFO - Skipped non-vendor email: 195e8f69e3a9b1cb
2025-04-26 15:15:23,031 - INFO - Is vendor: False
2025-04-26 15:15:23,032 - INFO - Skipped non-vendor email: 195e4ea41453cb70
2025-04-26 15:15:23,343 - INFO - Is vendor: False
2025-04-26 15:15:23,343 - INFO - Skipped non-vendor email: 195dd623e7ba2b53
2025-04-26 15:15:23,660 - INFO - Is vendor: False
2025-04-26 15:15:23,660 - INFO - Skipped non-vendor email: 195daeae90f76840
2025-04-26 15:15:23,988 - INFO - Is vendor: False
2025-04-26 15:15:23,988 - INFO - Skipped non-vendor email: 195daeae518fecdd
2025-04-26 15:15:24,293 - INFO - Is vendor: False
2025-04-26 15:15:24,293 - INFO - Skipped non-vendor email: 195d671ec15ec846
2025-04-26 15:15:24,668 - INFO - Is vendor: False
2025-04-26 15:15:24,668 - INFO - Skipped non-vendor email: 195cf892e4f7db12
2025-04-26 15:15:24,982 - INFO - Is vendor: False
2025-04-26 15:15:24,982 - INFO - Skipped non-vendor email: 195c53cde474e1ae
2025-04-26 15:15:25,296 - INFO - Is vendor: False
2025-04-26 15:15:25,297 - INFO - Skipped non-vendor email: 195b6f0625b261e8
2025-04-26 15:15:25,686 - INFO - Is vendor: False
2025-04-26 15:15:25,686 - INFO - Skipped non-vendor email: 195aca3ad97ae936
2025-04-26 15:15:26,008 - INFO - Is vendor: False
2025-04-26 15:15:26,008 - INFO - Skipped non-vendor email: 195a77bc0134c788
2025-04-26 15:15:26,315 - INFO - Is vendor: False
2025-04-26 15:15:26,316 - INFO - Skipped non-vendor email: 195a256e8510b298
2025-04-26 15:15:26,709 - INFO - Is vendor: False
2025-04-26 15:15:26,709 - INFO - Skipped non-vendor email: 195a25038936df85
2025-04-26 15:15:27,010 - INFO - Is vendor: False
2025-04-26 15:15:27,010 - INFO - Skipped non-vendor email: 19595c64c6c6d6eb
2025-04-26 15:15:27,325 - INFO - Is vendor: False
2025-04-26 15:15:27,325 - INFO - Skipped non-vendor email: 1958eee70835096e
2025-04-26 15:15:27,630 - INFO - Is vendor: False
2025-04-26 15:15:27,630 - INFO - Skipped non-vendor email: 1958ddcf16172961
2025-04-26 15:15:28,328 - INFO - Is vendor: False
2025-04-26 15:15:28,328 - INFO - Skipped non-vendor email: 1958ddcf0696f6d5
2025-04-26 15:15:28,654 - INFO - Is vendor: True
2025-04-26 15:15:30,594 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:15:30,599 - INFO - Generated summary length: 56
2025-04-26 15:15:30,599 - INFO - Generated email type: delivery
2025-04-26 15:15:30,599 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:15:30,748 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:15:30,752 - INFO - Found 6 emails in thread
2025-04-26 15:15:31,555 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:15:31,557 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 15:15:31,557 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:15:31,628 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:15:31,629 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:15:31,629 - ERROR - Error sending message to MCP server: [Errno 32] Broken pipe
2025-04-26 15:15:31,629 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 15:15:31,941 - INFO - Is vendor: True
2025-04-26 15:15:33,491 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:15:33,492 - INFO - Generated summary length: 58
2025-04-26 15:15:33,492 - INFO - Generated email type: order
2025-04-26 15:15:34,703 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:15:34,704 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:15:34,784 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:15:34,785 - INFO - Found 7 emails in thread
2025-04-26 15:15:35,547 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:15:35,620 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 15:15:35,620 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:15:35,674 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:15:35,674 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:15:35,675 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 15:15:35,740 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 15:15:35,741 - ERROR - Error saving attachment: {}
2025-04-26 15:15:35,741 - ERROR - Error type: APIError
2025-04-26 15:15:35,741 - ERROR - Attachment data: {'email_log_id': 171, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 15:15:35,741 - ERROR - Error saving email log: {}
2025-04-26 15:15:35,741 - ERROR - Error type: APIError
2025-04-26 15:15:35,744 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:15:35,745 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 15:15:36,057 - INFO - Is vendor: False
2025-04-26 15:15:36,057 - INFO - Skipped non-vendor email: 1964825ab5c28d35
2025-04-26 15:15:36,057 - INFO - GmailWatcher initialized
2025-04-26 15:47:39,769 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x10985fbc0>
2025-04-26 15:48:53,877 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 15:48:53,877 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 15:48:53,879 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 15:48:54,027 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 15:48:54,051 - INFO - Supabase client initialized successfully
2025-04-26 15:48:54,051 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 15:48:54,741 - INFO - Found 39 received messages
2025-04-26 15:48:55,426 - INFO - Found 3 sent messages
2025-04-26 15:48:55,733 - INFO - Is vendor: True
2025-04-26 15:48:57,795 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:48:57,804 - INFO - Generated summary length: 68
2025-04-26 15:48:57,804 - INFO - Generated email type: delay
2025-04-26 15:48:57,804 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:48:58,270 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:48:58,277 - INFO - Found 0 emails in thread
2025-04-26 15:48:58,277 - ERROR - Error saving email log: name 'sent_date' is not defined
2025-04-26 15:48:58,277 - ERROR - Error type: NameError
2025-04-26 15:48:58,283 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:48:58,283 - INFO - Processed email: 196675e9f37b6406
2025-04-26 15:48:58,589 - INFO - Is vendor: False
2025-04-26 15:48:58,872 - INFO - Is vendor: True
2025-04-26 15:49:00,217 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:49:00,219 - INFO - Generated summary length: 71
2025-04-26 15:49:00,219 - INFO - Generated email type: confirmation
2025-04-26 15:49:00,220 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:49:00,308 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:49:00,310 - INFO - Found 0 emails in thread
2025-04-26 15:49:00,310 - ERROR - Error saving email log: name 'sent_date' is not defined
2025-04-26 15:49:00,310 - ERROR - Error type: NameError
2025-04-26 15:49:00,315 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:49:00,315 - INFO - Processed email: 19661ecddae94e49
2025-04-26 15:49:00,650 - INFO - Is vendor: False
2025-04-26 15:49:00,946 - INFO - Is vendor: False
2025-04-26 15:49:01,653 - INFO - Is vendor: True
2025-04-26 15:49:02,927 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:49:02,929 - INFO - Generated summary length: 20
2025-04-26 15:49:02,929 - INFO - Generated email type: purchase
2025-04-26 15:49:04,860 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:49:04,863 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 15:49:04,929 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:49:04,932 - INFO - Found 0 emails in thread
2025-04-26 15:49:04,932 - ERROR - Error saving email log: name 'sent_date' is not defined
2025-04-26 15:49:04,932 - ERROR - Error type: NameError
2025-04-26 15:49:04,934 - INFO - Message sent to MCP server: purchase request
2025-04-26 15:49:04,934 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 15:49:05,266 - INFO - Is vendor: True
2025-04-26 15:49:06,815 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:49:06,816 - INFO - Generated summary length: 45
2025-04-26 15:49:06,817 - INFO - Generated email type: request
2025-04-26 15:49:08,208 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:49:08,209 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 15:49:08,303 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:49:08,306 - INFO - Found 0 emails in thread
2025-04-26 15:49:08,306 - ERROR - Error saving email log: name 'sent_date' is not defined
2025-04-26 15:49:08,306 - ERROR - Error type: NameError
2025-04-26 15:49:08,308 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 15:49:08,308 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 15:49:08,657 - INFO - Is vendor: False
2025-04-26 15:49:08,966 - INFO - Is vendor: False
2025-04-26 15:49:09,382 - INFO - Is vendor: False
2025-04-26 15:49:09,702 - INFO - Is vendor: False
2025-04-26 15:49:10,093 - INFO - Is vendor: False
2025-04-26 15:49:10,515 - INFO - Is vendor: False
2025-04-26 15:49:11,323 - INFO - Is vendor: False
2025-04-26 15:49:11,631 - INFO - Is vendor: False
2025-04-26 15:49:11,940 - INFO - Is vendor: False
2025-04-26 15:49:12,264 - INFO - Is vendor: False
2025-04-26 15:49:12,987 - INFO - Is vendor: False
2025-04-26 15:49:13,376 - INFO - Is vendor: False
2025-04-26 15:49:13,785 - INFO - Is vendor: False
2025-04-26 15:49:14,096 - INFO - Is vendor: False
2025-04-26 15:49:14,400 - INFO - Is vendor: False
2025-04-26 15:49:14,808 - INFO - Is vendor: False
2025-04-26 15:49:15,112 - INFO - Is vendor: False
2025-04-26 15:49:15,848 - INFO - Is vendor: False
2025-04-26 15:49:16,130 - INFO - Is vendor: False
2025-04-26 15:49:16,829 - INFO - Is vendor: False
2025-04-26 15:49:17,134 - INFO - Is vendor: False
2025-04-26 15:49:17,448 - INFO - Is vendor: False
2025-04-26 15:49:17,734 - INFO - Is vendor: False
2025-04-26 15:49:18,434 - INFO - Is vendor: False
2025-04-26 15:49:18,722 - INFO - Is vendor: False
2025-04-26 15:49:19,004 - INFO - Is vendor: False
2025-04-26 15:49:19,292 - INFO - Is vendor: False
2025-04-26 15:49:19,599 - INFO - Is vendor: False
2025-04-26 15:49:19,901 - INFO - Is vendor: False
2025-04-26 15:49:20,207 - INFO - Is vendor: False
2025-04-26 15:49:20,514 - INFO - Is vendor: False
2025-04-26 15:49:20,833 - INFO - Is vendor: False
2025-04-26 15:49:21,232 - INFO - Is vendor: True
2025-04-26 15:49:23,265 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:49:23,270 - INFO - Generated summary length: 91
2025-04-26 15:49:23,270 - INFO - Generated email type: delay
2025-04-26 15:49:23,270 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:49:23,483 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:49:23,485 - INFO - Found 0 emails in thread
2025-04-26 15:49:23,485 - ERROR - Error saving email log: name 'sent_date' is not defined
2025-04-26 15:49:23,485 - ERROR - Error type: NameError
2025-04-26 15:49:23,488 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:49:23,488 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 15:49:23,773 - INFO - Is vendor: True
2025-04-26 15:49:25,440 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:49:25,445 - INFO - Generated summary length: 94
2025-04-26 15:49:25,445 - INFO - Generated email type: order confirmation
2025-04-26 15:49:26,593 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:49:26,596 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:49:26,690 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:49:26,691 - INFO - Found 0 emails in thread
2025-04-26 15:49:26,691 - ERROR - Error saving email log: name 'sent_date' is not defined
2025-04-26 15:49:26,692 - ERROR - Error type: NameError
2025-04-26 15:49:26,693 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:49:26,693 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 15:49:27,074 - INFO - Is vendor: False
2025-04-26 15:49:27,074 - INFO - GmailWatcher initialized
2025-04-26 15:50:46,644 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x10b171eb0>
2025-04-26 15:50:49,284 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 15:50:49,285 - INFO - Loaded 3 vendor emails: ['yeonip7913@gmail.com', 'jiyeon@shiftsai.com', 'ddd7913@gmail.com']
2025-04-26 15:50:49,286 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 15:50:49,431 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 15:50:49,454 - INFO - Supabase client initialized successfully
2025-04-26 15:50:49,455 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 15:50:50,423 - INFO - Found 39 received messages
2025-04-26 15:50:50,833 - INFO - Found 3 sent messages
2025-04-26 15:50:51,168 - INFO - Is vendor: True
2025-04-26 15:50:52,991 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:50:52,999 - INFO - Generated summary length: 68
2025-04-26 15:50:53,000 - INFO - Generated email type: delay
2025-04-26 15:50:53,000 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:50:53,579 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:50:53,586 - INFO - Found 0 emails in thread
2025-04-26 15:50:54,318 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:50:54,320 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 15:50:54,321 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:50:54,437 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:50:54,439 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:50:54,445 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:50:54,445 - INFO - Processed email: 196675e9f37b6406
2025-04-26 15:50:54,827 - INFO - Is vendor: False
2025-04-26 15:50:55,153 - INFO - Is vendor: True
2025-04-26 15:50:56,686 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:50:56,687 - INFO - Generated summary length: 71
2025-04-26 15:50:56,688 - INFO - Generated email type: confirmation
2025-04-26 15:50:56,688 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:50:56,774 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:50:56,777 - INFO - Found 1 emails in thread
2025-04-26 15:50:57,574 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:50:57,576 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 15:50:57,576 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:50:57,659 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:50:57,660 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:50:57,663 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:50:57,663 - INFO - Processed email: 19661ecddae94e49
2025-04-26 15:50:58,001 - INFO - Is vendor: False
2025-04-26 15:50:58,320 - INFO - Is vendor: False
2025-04-26 15:50:58,642 - INFO - Is vendor: True
2025-04-26 15:51:00,063 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:51:00,065 - INFO - Generated summary length: 20
2025-04-26 15:51:00,065 - INFO - Generated email type: purchase
2025-04-26 15:51:01,192 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:51:01,196 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 15:51:01,273 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:51:01,276 - INFO - Found 0 emails in thread
2025-04-26 15:51:01,907 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:51:01,909 - INFO - Parsed delivery date: 2024-04-20
2025-04-26 15:51:01,909 - INFO - Attempting to save email log: purchase request
2025-04-26 15:51:01,984 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:51:01,988 - INFO - Email saved successfully: purchase request
2025-04-26 15:51:01,988 - INFO - Attempting to save attachment: sample_purchase_order.pdf
2025-04-26 15:51:02,055 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 15:51:02,056 - ERROR - Error saving attachment: {}
2025-04-26 15:51:02,056 - ERROR - Error type: APIError
2025-04-26 15:51:02,056 - ERROR - Attachment data: {'email_log_id': 174, 'filename': 'sample_purchase_order.pdf', 'mime_type': 'application/pdf', 'content': 'Purchase Order\nPO Number: PO-2024-001\nDate: 2025-04-14\nVendor: ABC Industrial Supplies Co.\nVendor Email: sales@abcindustrial.com\nBuyer: ShiftsAI Manufacturing Ltd.\nBuyer Contact: procurement@shiftsai.com\nItem Description Quantity Unit Price Total\nHigh-grade Steel Sheets 1000 $15.75 $15750.00\nIndustrial Lubricant (5L) 50 $22.50 $1125.00\nProtective Gloves (Box) 200 $6.80 $1360.00\nTotal $18235.00\nRequested Delivery Date: 2024-04-20\nDelivery Location: ShiftsAI Warehouse, 123 Industry Rd, Seoul, South Korea\n'}
2025-04-26 15:51:02,056 - ERROR - Error saving email log: {}
2025-04-26 15:51:02,056 - ERROR - Error type: APIError
2025-04-26 15:51:02,060 - INFO - Message sent to MCP server: purchase request
2025-04-26 15:51:02,060 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 15:51:02,405 - INFO - Is vendor: True
2025-04-26 15:51:03,846 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:51:03,848 - INFO - Generated summary length: 53
2025-04-26 15:51:03,848 - INFO - Generated email type: request
2025-04-26 15:51:04,886 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:51:04,888 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 15:51:04,971 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:51:04,973 - INFO - Found 0 emails in thread
2025-04-26 15:51:05,725 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:51:05,727 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 15:51:05,727 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 15:51:05,809 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:51:05,810 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 15:51:05,810 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 15:51:05,897 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 15:51:05,898 - ERROR - Error saving attachment: {}
2025-04-26 15:51:05,898 - ERROR - Error type: APIError
2025-04-26 15:51:05,898 - ERROR - Attachment data: {'email_log_id': 175, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 15:51:05,899 - ERROR - Error saving email log: {}
2025-04-26 15:51:05,899 - ERROR - Error type: APIError
2025-04-26 15:51:05,902 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 15:51:05,902 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 15:51:06,298 - INFO - Is vendor: False
2025-04-26 15:51:06,617 - INFO - Is vendor: False
2025-04-26 15:51:07,020 - INFO - Is vendor: False
2025-04-26 15:51:07,333 - INFO - Is vendor: False
2025-04-26 15:51:07,665 - INFO - Is vendor: False
2025-04-26 15:51:08,009 - INFO - Is vendor: False
2025-04-26 15:51:08,373 - INFO - Is vendor: False
2025-04-26 15:51:08,756 - INFO - Is vendor: False
2025-04-26 15:51:09,077 - INFO - Is vendor: False
2025-04-26 15:51:10,082 - INFO - Is vendor: False
2025-04-26 15:51:10,426 - INFO - Is vendor: False
2025-04-26 15:51:10,830 - INFO - Is vendor: False
2025-04-26 15:51:11,232 - INFO - Is vendor: False
2025-04-26 15:51:11,622 - INFO - Is vendor: False
2025-04-26 15:51:12,038 - INFO - Is vendor: False
2025-04-26 15:51:12,351 - INFO - Is vendor: False
2025-04-26 15:51:12,659 - INFO - Is vendor: False
2025-04-26 15:51:12,990 - INFO - Is vendor: False
2025-04-26 15:51:13,361 - INFO - Is vendor: False
2025-04-26 15:51:13,678 - INFO - Is vendor: False
2025-04-26 15:51:14,079 - INFO - Is vendor: False
2025-04-26 15:51:14,488 - INFO - Is vendor: False
2025-04-26 15:51:14,811 - INFO - Is vendor: False
2025-04-26 15:51:15,128 - INFO - Is vendor: False
2025-04-26 15:51:15,513 - INFO - Is vendor: False
2025-04-26 15:51:15,820 - INFO - Is vendor: False
2025-04-26 15:51:16,156 - INFO - Is vendor: False
2025-04-26 15:51:16,546 - INFO - Is vendor: False
2025-04-26 15:51:16,953 - INFO - Is vendor: False
2025-04-26 15:51:17,274 - INFO - Is vendor: False
2025-04-26 15:51:17,609 - INFO - Is vendor: False
2025-04-26 15:51:17,970 - INFO - Is vendor: False
2025-04-26 15:51:18,379 - INFO - Is vendor: True
2025-04-26 15:51:20,035 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:51:20,036 - INFO - Generated summary length: 91
2025-04-26 15:51:20,036 - INFO - Generated email type: delay
2025-04-26 15:51:20,036 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:51:20,225 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:51:20,229 - INFO - Found 2 emails in thread
2025-04-26 15:51:21,042 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:51:21,045 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 15:51:21,045 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:51:21,116 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:51:21,119 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:51:21,123 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:51:21,124 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 15:51:21,451 - INFO - Is vendor: True
2025-04-26 15:51:22,935 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:51:22,937 - INFO - Generated summary length: 58
2025-04-26 15:51:22,937 - INFO - Generated email type: order confirmation
2025-04-26 15:51:23,729 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:51:23,731 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:51:23,813 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:51:23,815 - INFO - Found 3 emails in thread
2025-04-26 15:51:24,532 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:51:24,533 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 15:51:24,533 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:51:24,617 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:51:24,617 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:51:24,618 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 15:51:24,704 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 15:51:24,704 - ERROR - Error saving attachment: {}
2025-04-26 15:51:24,705 - ERROR - Error type: APIError
2025-04-26 15:51:24,705 - ERROR - Attachment data: {'email_log_id': 177, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 15:51:24,705 - ERROR - Error saving email log: {}
2025-04-26 15:51:24,705 - ERROR - Error type: APIError
2025-04-26 15:51:24,707 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:51:24,708 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 15:51:25,008 - INFO - Is vendor: False
2025-04-26 15:51:25,008 - INFO - GmailWatcher initialized
2025-04-26 15:53:31,718 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x109ebb4a0>
2025-04-26 15:53:45,736 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 15:53:45,737 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 15:53:45,739 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 15:53:45,888 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 15:53:45,915 - INFO - Supabase client initialized successfully
2025-04-26 15:53:45,915 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 15:53:46,675 - INFO - Found 39 received messages
2025-04-26 15:53:47,005 - INFO - Found 3 sent messages
2025-04-26 15:53:47,357 - INFO - Is vendor: True
2025-04-26 15:53:48,945 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:53:48,954 - INFO - Generated summary length: 68
2025-04-26 15:53:48,954 - INFO - Generated email type: delay
2025-04-26 15:53:48,954 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:53:49,627 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:53:49,634 - INFO - Found 0 emails in thread
2025-04-26 15:53:49,634 - ERROR - Error saving email log: cannot access local variable 'received_at' where it is not associated with a value
2025-04-26 15:53:49,634 - ERROR - Error type: UnboundLocalError
2025-04-26 15:53:49,641 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:53:49,641 - INFO - Processed email: 196675e9f37b6406
2025-04-26 15:53:49,955 - INFO - Is vendor: False
2025-04-26 15:53:50,264 - INFO - Is vendor: True
2025-04-26 15:53:51,784 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:53:51,786 - INFO - Generated summary length: 71
2025-04-26 15:53:51,786 - INFO - Generated email type: confirmation
2025-04-26 15:53:51,786 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:53:51,850 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:53:51,852 - INFO - Found 0 emails in thread
2025-04-26 15:53:51,852 - ERROR - Error saving email log: cannot access local variable 'received_at' where it is not associated with a value
2025-04-26 15:53:51,853 - ERROR - Error type: UnboundLocalError
2025-04-26 15:53:51,855 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:53:51,855 - INFO - Processed email: 19661ecddae94e49
2025-04-26 15:53:52,170 - INFO - Is vendor: False
2025-04-26 15:53:52,493 - INFO - Is vendor: False
2025-04-26 15:53:52,801 - INFO - Is vendor: True
2025-04-26 15:53:54,137 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:53:54,139 - INFO - Generated summary length: 23
2025-04-26 15:53:54,139 - INFO - Generated email type: purchase
2025-04-26 15:53:55,055 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:53:55,056 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 15:53:55,147 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:53:55,151 - INFO - Found 0 emails in thread
2025-04-26 15:53:55,151 - ERROR - Error saving email log: cannot access local variable 'received_at' where it is not associated with a value
2025-04-26 15:53:55,151 - ERROR - Error type: UnboundLocalError
2025-04-26 15:53:55,153 - INFO - Message sent to MCP server: purchase request
2025-04-26 15:53:55,154 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 15:53:55,471 - INFO - Is vendor: True
2025-04-26 15:53:56,864 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:53:56,866 - INFO - Generated summary length: 59
2025-04-26 15:53:56,866 - INFO - Generated email type: request
2025-04-26 15:53:57,859 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:53:57,862 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 15:53:57,943 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:53:57,946 - INFO - Found 0 emails in thread
2025-04-26 15:53:57,946 - ERROR - Error saving email log: cannot access local variable 'received_at' where it is not associated with a value
2025-04-26 15:53:57,946 - ERROR - Error type: UnboundLocalError
2025-04-26 15:53:57,948 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 15:53:57,949 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 15:53:58,270 - INFO - Is vendor: False
2025-04-26 15:53:58,583 - INFO - Is vendor: False
2025-04-26 15:53:59,282 - INFO - Is vendor: False
2025-04-26 15:53:59,592 - INFO - Is vendor: False
2025-04-26 15:53:59,937 - INFO - Is vendor: False
2025-04-26 15:54:00,254 - INFO - Is vendor: False
2025-04-26 15:54:00,597 - INFO - Is vendor: False
2025-04-26 15:54:00,897 - INFO - Is vendor: False
2025-04-26 15:54:01,197 - INFO - Is vendor: False
2025-04-26 15:54:01,505 - INFO - Is vendor: False
2025-04-26 15:54:01,854 - INFO - Is vendor: False
2025-04-26 15:54:02,164 - INFO - Is vendor: False
2025-04-26 15:54:02,555 - INFO - Is vendor: False
2025-04-26 15:54:02,878 - INFO - Is vendor: False
2025-04-26 15:54:03,246 - INFO - Is vendor: False
2025-04-26 15:54:03,553 - INFO - Is vendor: False
2025-04-26 15:54:03,862 - INFO - Is vendor: False
2025-04-26 15:54:04,168 - INFO - Is vendor: False
2025-04-26 15:54:04,482 - INFO - Is vendor: False
2025-04-26 15:54:04,794 - INFO - Is vendor: False
2025-04-26 15:54:05,192 - INFO - Is vendor: False
2025-04-26 15:54:05,509 - INFO - Is vendor: False
2025-04-26 15:54:06,226 - INFO - Is vendor: False
2025-04-26 15:54:06,626 - INFO - Is vendor: False
2025-04-26 15:54:07,341 - INFO - Is vendor: False
2025-04-26 15:54:07,650 - INFO - Is vendor: False
2025-04-26 15:54:08,360 - INFO - Is vendor: False
2025-04-26 15:54:08,681 - INFO - Is vendor: False
2025-04-26 15:54:08,994 - INFO - Is vendor: False
2025-04-26 15:54:09,326 - INFO - Is vendor: False
2025-04-26 15:54:09,663 - INFO - Is vendor: False
2025-04-26 15:54:09,975 - INFO - Is vendor: False
2025-04-26 15:54:10,313 - INFO - Is vendor: True
2025-04-26 15:54:12,494 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:54:12,496 - INFO - Generated summary length: 85
2025-04-26 15:54:12,496 - INFO - Generated email type: urgency
2025-04-26 15:54:12,496 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:54:12,732 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:54:12,734 - INFO - Found 0 emails in thread
2025-04-26 15:54:12,734 - ERROR - Error saving email log: cannot access local variable 'received_at' where it is not associated with a value
2025-04-26 15:54:12,734 - ERROR - Error type: UnboundLocalError
2025-04-26 15:54:12,734 - ERROR - Error sending message to MCP server: [Errno 32] Broken pipe
2025-04-26 15:54:12,734 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 15:54:13,516 - INFO - Is vendor: True
2025-04-26 15:54:14,920 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:54:14,922 - INFO - Generated summary length: 58
2025-04-26 15:54:14,922 - INFO - Generated email type: order
2025-04-26 15:54:15,960 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:54:15,963 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:54:16,284 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:54:16,287 - INFO - Found 0 emails in thread
2025-04-26 15:54:16,287 - ERROR - Error saving email log: cannot access local variable 'received_at' where it is not associated with a value
2025-04-26 15:54:16,287 - ERROR - Error type: UnboundLocalError
2025-04-26 15:54:16,291 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:54:16,291 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 15:54:16,661 - INFO - Is vendor: False
2025-04-26 15:54:16,661 - INFO - GmailWatcher initialized
2025-04-26 15:54:43,259 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x1073c6300>
2025-04-26 15:54:45,349 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 15:54:45,349 - INFO - Loaded 3 vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 15:54:45,351 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 15:54:45,495 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 15:54:45,520 - INFO - Supabase client initialized successfully
2025-04-26 15:54:45,521 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 15:54:46,287 - INFO - Found 39 received messages
2025-04-26 15:54:46,668 - INFO - Found 3 sent messages
2025-04-26 15:54:46,984 - INFO - Is vendor: True
2025-04-26 15:54:48,542 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:54:48,552 - INFO - Generated summary length: 68
2025-04-26 15:54:48,552 - INFO - Generated email type: delay
2025-04-26 15:54:48,552 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:54:48,832 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:54:48,836 - INFO - Found 0 emails in thread
2025-04-26 15:54:49,500 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:54:49,503 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 15:54:49,503 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:54:49,636 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:54:49,638 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:54:49,643 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:54:49,643 - INFO - Processed email: 196675e9f37b6406
2025-04-26 15:54:49,946 - INFO - Is vendor: False
2025-04-26 15:54:50,249 - INFO - Is vendor: True
2025-04-26 15:54:51,632 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:54:51,634 - INFO - Generated summary length: 71
2025-04-26 15:54:51,635 - INFO - Generated email type: confirmation
2025-04-26 15:54:51,635 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:54:51,705 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:54:51,707 - INFO - Found 1 emails in thread
2025-04-26 15:54:52,399 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:54:52,402 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 15:54:52,402 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:54:52,474 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:54:52,475 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:54:52,478 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:54:52,478 - INFO - Processed email: 19661ecddae94e49
2025-04-26 15:54:52,810 - INFO - Is vendor: False
2025-04-26 15:54:53,123 - INFO - Is vendor: False
2025-04-26 15:54:53,529 - INFO - Is vendor: True
2025-04-26 15:54:54,830 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:54:54,861 - INFO - Generated summary length: 20
2025-04-26 15:54:54,861 - INFO - Generated email type: procurement
2025-04-26 15:54:55,510 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:54:55,513 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 15:54:55,582 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:54:55,585 - INFO - Found 0 emails in thread
2025-04-26 15:54:56,231 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:54:56,233 - INFO - Parsed delivery date: 2024-04-20
2025-04-26 15:54:56,233 - INFO - Attempting to save email log: purchase request
2025-04-26 15:54:56,303 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:54:56,307 - INFO - Email saved successfully: purchase request
2025-04-26 15:54:56,307 - INFO - Attempting to save attachment: sample_purchase_order.pdf
2025-04-26 15:54:56,371 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 15:54:56,372 - ERROR - Error saving attachment: {}
2025-04-26 15:54:56,372 - ERROR - Error type: APIError
2025-04-26 15:54:56,373 - ERROR - Attachment data: {'email_log_id': 180, 'filename': 'sample_purchase_order.pdf', 'mime_type': 'application/pdf', 'content': 'Purchase Order\nPO Number: PO-2024-001\nDate: 2025-04-14\nVendor: ABC Industrial Supplies Co.\nVendor Email: sales@abcindustrial.com\nBuyer: ShiftsAI Manufacturing Ltd.\nBuyer Contact: procurement@shiftsai.com\nItem Description Quantity Unit Price Total\nHigh-grade Steel Sheets 1000 $15.75 $15750.00\nIndustrial Lubricant (5L) 50 $22.50 $1125.00\nProtective Gloves (Box) 200 $6.80 $1360.00\nTotal $18235.00\nRequested Delivery Date: 2024-04-20\nDelivery Location: ShiftsAI Warehouse, 123 Industry Rd, Seoul, South Korea\n'}
2025-04-26 15:54:56,373 - ERROR - Error saving email log: {}
2025-04-26 15:54:56,373 - ERROR - Error type: APIError
2025-04-26 15:54:56,376 - INFO - Message sent to MCP server: purchase request
2025-04-26 15:54:56,376 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 15:54:56,700 - INFO - Is vendor: True
2025-04-26 15:54:58,036 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:54:58,038 - INFO - Generated summary length: 44
2025-04-26 15:54:58,038 - INFO - Generated email type: inquiry
2025-04-26 15:54:59,161 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:54:59,163 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 15:54:59,235 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:54:59,238 - INFO - Found 0 emails in thread
2025-04-26 15:54:59,927 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:54:59,929 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 15:54:59,929 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 15:54:59,994 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:54:59,995 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 15:54:59,995 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 15:55:00,060 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 15:55:00,062 - ERROR - Error saving attachment: {}
2025-04-26 15:55:00,062 - ERROR - Error type: APIError
2025-04-26 15:55:00,062 - ERROR - Attachment data: {'email_log_id': 181, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 15:55:00,062 - ERROR - Error saving email log: {}
2025-04-26 15:55:00,062 - ERROR - Error type: APIError
2025-04-26 15:55:00,065 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 15:55:00,065 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 15:55:00,346 - INFO - Is vendor: False
2025-04-26 15:55:00,693 - INFO - Is vendor: False
2025-04-26 15:55:01,000 - INFO - Is vendor: False
2025-04-26 15:55:01,321 - INFO - Is vendor: False
2025-04-26 15:55:01,598 - INFO - Is vendor: False
2025-04-26 15:55:01,875 - INFO - Is vendor: False
2025-04-26 15:55:02,230 - INFO - Is vendor: False
2025-04-26 15:55:02,536 - INFO - Is vendor: False
2025-04-26 15:55:02,816 - INFO - Is vendor: False
2025-04-26 15:55:03,104 - INFO - Is vendor: False
2025-04-26 15:55:03,417 - INFO - Is vendor: False
2025-04-26 15:55:03,727 - INFO - Is vendor: False
2025-04-26 15:55:04,026 - INFO - Is vendor: False
2025-04-26 15:55:04,332 - INFO - Is vendor: False
2025-04-26 15:55:04,636 - INFO - Is vendor: False
2025-04-26 15:55:04,937 - INFO - Is vendor: False
2025-04-26 15:55:05,227 - INFO - Is vendor: False
2025-04-26 15:55:06,052 - INFO - Is vendor: False
2025-04-26 15:55:06,351 - INFO - Is vendor: False
2025-04-26 15:55:06,671 - INFO - Is vendor: False
2025-04-26 15:55:07,074 - INFO - Is vendor: False
2025-04-26 15:55:07,385 - INFO - Is vendor: False
2025-04-26 15:55:07,687 - INFO - Is vendor: False
2025-04-26 15:55:08,095 - INFO - Is vendor: False
2025-04-26 15:55:08,914 - INFO - Is vendor: False
2025-04-26 15:55:09,246 - INFO - Is vendor: False
2025-04-26 15:55:09,603 - INFO - Is vendor: False
2025-04-26 15:55:09,909 - INFO - Is vendor: False
2025-04-26 15:55:10,216 - INFO - Is vendor: False
2025-04-26 15:55:10,524 - INFO - Is vendor: False
2025-04-26 15:55:11,206 - INFO - Is vendor: False
2025-04-26 15:55:11,651 - INFO - Is vendor: False
2025-04-26 15:55:11,939 - INFO - Is vendor: True
2025-04-26 15:55:13,445 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:55:13,447 - INFO - Generated summary length: 91
2025-04-26 15:55:13,447 - INFO - Generated email type: delay
2025-04-26 15:55:13,447 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:55:13,617 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:55:13,622 - INFO - Found 2 emails in thread
2025-04-26 15:55:14,201 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:55:14,205 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 15:55:14,205 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:55:14,279 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:55:14,280 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:55:14,281 - ERROR - Error sending message to MCP server: [Errno 32] Broken pipe
2025-04-26 15:55:14,281 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 15:55:14,561 - INFO - Is vendor: True
2025-04-26 15:55:15,951 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:55:15,953 - INFO - Generated summary length: 58
2025-04-26 15:55:15,953 - INFO - Generated email type: order
2025-04-26 15:55:16,682 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 15:55:16,684 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 15:55:16,754 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 15:55:16,755 - INFO - Found 3 emails in thread
2025-04-26 15:55:17,455 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 15:55:17,457 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 15:55:17,457 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:55:17,525 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 15:55:17,526 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:55:17,526 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 15:55:17,590 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 15:55:17,591 - ERROR - Error saving attachment: {}
2025-04-26 15:55:17,591 - ERROR - Error type: APIError
2025-04-26 15:55:17,591 - ERROR - Attachment data: {'email_log_id': 183, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 15:55:17,591 - ERROR - Error saving email log: {}
2025-04-26 15:55:17,591 - ERROR - Error type: APIError
2025-04-26 15:55:17,594 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 15:55:17,594 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 15:55:17,875 - INFO - Is vendor: False
2025-04-26 15:55:17,875 - INFO - GmailWatcher initialized
2025-04-26 16:03:46,509 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x1075e6480>
2025-04-26 16:05:42,296 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 16:05:42,296 - INFO - Loaded 3 vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 16:05:42,298 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 16:05:42,446 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 16:05:42,469 - INFO - Supabase client initialized successfully
2025-04-26 16:05:42,470 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 16:05:53,286 - WARNING - Failed to parse date for msg 195daeae518fecdd: time data 'Fri, 28 Mar 2025 04:02:59 GMT' does not match format '%a, %d %b %Y %H:%M:%S %z'
2025-04-26 16:05:56,373 - WARNING - Failed to parse date for msg 1958eee70835096e: time data 'Thu, 13 Mar 2025 09:55:43 GMT' does not match format '%a, %d %b %Y %H:%M:%S %z'
2025-04-26 16:05:57,937 - ERROR - Error collecting historical emails: can't compare offset-naive and offset-aware datetimes
2025-04-26 16:05:57,938 - INFO - GmailWatcher initialized
2025-04-26 16:08:41,681 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 16:08:41,682 - INFO - Loaded 3 vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 16:08:41,684 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 16:08:41,830 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 16:08:41,853 - INFO - Supabase client initialized successfully
2025-04-26 16:08:41,854 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 16:08:58,576 - INFO - Is vendor: False
2025-04-26 16:08:58,906 - INFO - Is vendor: False
2025-04-26 16:08:59,282 - INFO - Is vendor: False
2025-04-26 16:08:59,597 - INFO - Is vendor: False
2025-04-26 16:08:59,902 - INFO - Is vendor: False
2025-04-26 16:09:00,207 - INFO - Is vendor: False
2025-04-26 16:09:00,594 - INFO - Is vendor: False
2025-04-26 16:09:00,911 - INFO - Is vendor: False
2025-04-26 16:09:01,220 - INFO - Is vendor: False
2025-04-26 16:09:01,534 - INFO - Is vendor: False
2025-04-26 16:09:01,850 - INFO - Is vendor: False
2025-04-26 16:09:02,237 - INFO - Is vendor: False
2025-04-26 16:09:02,557 - INFO - Is vendor: False
2025-04-26 16:09:02,950 - INFO - Is vendor: False
2025-04-26 16:09:03,256 - INFO - Is vendor: False
2025-04-26 16:09:03,564 - INFO - Is vendor: False
2025-04-26 16:09:03,871 - INFO - Is vendor: False
2025-04-26 16:09:04,180 - INFO - Is vendor: False
2025-04-26 16:09:04,496 - INFO - Is vendor: False
2025-04-26 16:09:04,808 - INFO - Is vendor: False
2025-04-26 16:09:05,122 - INFO - Is vendor: False
2025-04-26 16:09:05,918 - INFO - Is vendor: False
2025-04-26 16:09:06,228 - INFO - Is vendor: False
2025-04-26 16:09:06,533 - INFO - Is vendor: False
2025-04-26 16:09:06,841 - INFO - Is vendor: False
2025-04-26 16:09:07,155 - INFO - Is vendor: False
2025-04-26 16:09:07,462 - INFO - Is vendor: False
2025-04-26 16:09:07,769 - INFO - Is vendor: False
2025-04-26 16:09:08,081 - INFO - Is vendor: False
2025-04-26 16:09:08,385 - INFO - Is vendor: False
2025-04-26 16:09:08,692 - INFO - Is vendor: False
2025-04-26 16:09:08,995 - INFO - Is vendor: False
2025-04-26 16:09:09,304 - INFO - Is vendor: False
2025-04-26 16:09:10,016 - INFO - Is vendor: True
2025-04-26 16:09:11,656 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:09:11,665 - INFO - Generated summary length: 63
2025-04-26 16:09:11,665 - INFO - Generated email type: request
2025-04-26 16:09:12,576 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 16:09:12,578 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 16:09:13,294 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:09:13,305 - INFO - Found 1 emails in thread
2025-04-26 16:09:13,944 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:09:13,946 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 16:09:13,947 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 16:09:14,029 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:09:14,030 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 16:09:14,031 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 16:09:14,237 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 16:09:14,238 - ERROR - Error saving attachment: {}
2025-04-26 16:09:14,238 - ERROR - Error type: APIError
2025-04-26 16:09:14,238 - ERROR - Attachment data: {'email_log_id': 184, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 16:09:14,238 - ERROR - Error saving email log: {}
2025-04-26 16:09:14,238 - ERROR - Error type: APIError
2025-04-26 16:09:14,246 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 16:09:14,246 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 16:09:14,627 - INFO - Is vendor: True
2025-04-26 16:09:15,962 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:09:15,964 - INFO - Generated summary length: 29
2025-04-26 16:09:15,965 - INFO - Generated email type: order
2025-04-26 16:09:16,981 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 16:09:16,983 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 16:09:17,062 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:09:17,065 - INFO - Found 1 emails in thread
2025-04-26 16:09:17,694 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:09:17,696 - INFO - Parsed delivery date: 2024-04-20
2025-04-26 16:09:17,696 - INFO - Attempting to save email log: purchase request
2025-04-26 16:09:17,769 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:09:17,771 - INFO - Email saved successfully: purchase request
2025-04-26 16:09:17,771 - INFO - Attempting to save attachment: sample_purchase_order.pdf
2025-04-26 16:09:17,827 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 16:09:17,828 - ERROR - Error saving attachment: {}
2025-04-26 16:09:17,828 - ERROR - Error type: APIError
2025-04-26 16:09:17,828 - ERROR - Attachment data: {'email_log_id': 185, 'filename': 'sample_purchase_order.pdf', 'mime_type': 'application/pdf', 'content': 'Purchase Order\nPO Number: PO-2024-001\nDate: 2025-04-14\nVendor: ABC Industrial Supplies Co.\nVendor Email: sales@abcindustrial.com\nBuyer: ShiftsAI Manufacturing Ltd.\nBuyer Contact: procurement@shiftsai.com\nItem Description Quantity Unit Price Total\nHigh-grade Steel Sheets 1000 $15.75 $15750.00\nIndustrial Lubricant (5L) 50 $22.50 $1125.00\nProtective Gloves (Box) 200 $6.80 $1360.00\nTotal $18235.00\nRequested Delivery Date: 2024-04-20\nDelivery Location: ShiftsAI Warehouse, 123 Industry Rd, Seoul, South Korea\n'}
2025-04-26 16:09:17,828 - ERROR - Error saving email log: {}
2025-04-26 16:09:17,828 - ERROR - Error type: APIError
2025-04-26 16:09:17,831 - INFO - Message sent to MCP server: purchase request
2025-04-26 16:09:17,831 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 16:09:18,215 - INFO - Is vendor: False
2025-04-26 16:09:18,516 - INFO - Is vendor: False
2025-04-26 16:09:18,825 - INFO - Is vendor: True
2025-04-26 16:09:20,191 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:09:20,193 - INFO - Generated summary length: 58
2025-04-26 16:09:20,193 - INFO - Generated email type: order
2025-04-26 16:09:21,146 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 16:09:21,148 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:09:21,235 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:09:21,239 - INFO - Found 4 emails in thread
2025-04-26 16:09:21,880 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:09:21,882 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 16:09:21,882 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:09:21,954 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:09:21,955 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:09:21,955 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 16:09:22,026 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 16:09:22,027 - ERROR - Error saving attachment: {}
2025-04-26 16:09:22,027 - ERROR - Error type: APIError
2025-04-26 16:09:22,027 - ERROR - Attachment data: {'email_log_id': 186, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 16:09:22,027 - ERROR - Error saving email log: {}
2025-04-26 16:09:22,027 - ERROR - Error type: APIError
2025-04-26 16:09:22,030 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:09:22,031 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 16:09:22,334 - INFO - Is vendor: True
2025-04-26 16:09:23,648 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:09:23,650 - INFO - Generated summary length: 71
2025-04-26 16:09:23,650 - INFO - Generated email type: confirmation
2025-04-26 16:09:23,650 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:09:23,724 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:09:23,728 - INFO - Found 5 emails in thread
2025-04-26 16:09:29,062 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:09:29,064 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 16:09:29,064 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:09:29,241 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:09:29,242 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:09:29,243 - ERROR - Error sending message to MCP server: [Errno 32] Broken pipe
2025-04-26 16:09:29,244 - INFO - Processed email: 19661ecddae94e49
2025-04-26 16:09:29,574 - INFO - Is vendor: False
2025-04-26 16:09:29,887 - INFO - Is vendor: True
2025-04-26 16:09:35,768 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:09:35,771 - INFO - Generated summary length: 69
2025-04-26 16:09:35,771 - INFO - Generated email type: delay
2025-04-26 16:09:35,771 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:09:35,940 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:09:35,943 - INFO - Found 6 emails in thread
2025-04-26 16:09:36,650 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:09:36,655 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 16:09:36,655 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:09:36,784 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:09:36,785 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:09:36,787 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:09:36,787 - INFO - Processed email: 196675e9f37b6406
2025-04-26 16:09:37,103 - INFO - Is vendor: True
2025-04-26 16:09:41,468 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:09:41,470 - INFO - Generated summary length: 73
2025-04-26 16:09:41,470 - INFO - Generated email type: delay
2025-04-26 16:09:41,471 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:09:41,571 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:09:41,574 - INFO - Found 7 emails in thread
2025-04-26 16:09:42,388 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:09:42,390 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 16:09:42,390 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:09:42,458 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:09:42,459 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:09:42,460 - ERROR - Error sending message to MCP server: [Errno 32] Broken pipe
2025-04-26 16:09:42,460 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 16:09:42,460 - INFO - GmailWatcher initialized
2025-04-26 16:25:31,991 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x113df6f00>
2025-04-26 16:25:48,269 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 16:25:48,270 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'yeonip7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 16:25:48,272 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 16:25:48,500 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 16:25:48,526 - INFO - Supabase client initialized successfully
2025-04-26 16:25:48,526 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 16:26:03,795 - INFO - Is vendor: False
2025-04-26 16:26:04,105 - INFO - Is vendor: False
2025-04-26 16:26:04,409 - INFO - Is vendor: False
2025-04-26 16:26:04,689 - INFO - Is vendor: False
2025-04-26 16:26:05,027 - INFO - Is vendor: False
2025-04-26 16:26:05,350 - INFO - Is vendor: False
2025-04-26 16:26:05,745 - INFO - Is vendor: False
2025-04-26 16:26:06,052 - INFO - Is vendor: False
2025-04-26 16:26:06,354 - INFO - Is vendor: False
2025-04-26 16:26:06,645 - INFO - Is vendor: False
2025-04-26 16:26:06,925 - INFO - Is vendor: False
2025-04-26 16:26:07,276 - INFO - Is vendor: False
2025-04-26 16:26:07,570 - INFO - Is vendor: False
2025-04-26 16:26:07,892 - INFO - Is vendor: False
2025-04-26 16:26:08,214 - INFO - Is vendor: False
2025-04-26 16:26:08,492 - INFO - Is vendor: False
2025-04-26 16:26:08,813 - INFO - Is vendor: False
2025-04-26 16:26:09,121 - INFO - Is vendor: False
2025-04-26 16:26:09,433 - INFO - Is vendor: False
2025-04-26 16:26:09,722 - INFO - Is vendor: False
2025-04-26 16:26:10,043 - INFO - Is vendor: False
2025-04-26 16:26:10,347 - INFO - Is vendor: False
2025-04-26 16:26:10,656 - INFO - Is vendor: False
2025-04-26 16:26:10,940 - INFO - Is vendor: False
2025-04-26 16:26:11,219 - INFO - Is vendor: False
2025-04-26 16:26:11,504 - INFO - Is vendor: False
2025-04-26 16:26:11,782 - INFO - Is vendor: False
2025-04-26 16:26:12,089 - INFO - Is vendor: False
2025-04-26 16:26:12,395 - INFO - Is vendor: False
2025-04-26 16:26:12,682 - INFO - Is vendor: False
2025-04-26 16:26:13,010 - INFO - Is vendor: False
2025-04-26 16:26:13,322 - INFO - Is vendor: False
2025-04-26 16:26:13,625 - INFO - Is vendor: False
2025-04-26 16:26:13,933 - INFO - Is vendor: True
2025-04-26 16:26:15,683 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:26:15,694 - INFO - Generated summary length: 28
2025-04-26 16:26:15,694 - INFO - Generated email type: inquiry
2025-04-26 16:26:16,576 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 16:26:16,579 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 16:26:17,209 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:26:17,217 - INFO - Found 1 emails in thread
2025-04-26 16:26:17,926 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:26:17,929 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 16:26:17,929 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 16:26:17,995 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:26:17,997 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 16:26:17,997 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 16:26:18,080 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 16:26:18,081 - ERROR - Error saving attachment: {}
2025-04-26 16:26:18,081 - ERROR - Error type: APIError
2025-04-26 16:26:18,081 - ERROR - Attachment data: {'email_log_id': 191, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 16:26:18,081 - ERROR - Error saving email log: {}
2025-04-26 16:26:18,081 - ERROR - Error type: APIError
2025-04-26 16:26:18,090 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 16:26:18,091 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 16:26:18,438 - INFO - Is vendor: True
2025-04-26 16:26:19,728 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:26:19,733 - INFO - Generated summary length: 30
2025-04-26 16:26:19,733 - INFO - Generated email type: order
2025-04-26 16:26:20,742 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 16:26:20,744 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 16:26:20,818 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:26:20,822 - INFO - Found 1 emails in thread
2025-04-26 16:26:23,377 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:26:23,380 - INFO - Parsed delivery date: 2024-04-20
2025-04-26 16:26:23,380 - INFO - Attempting to save email log: purchase request
2025-04-26 16:26:23,444 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:26:23,445 - INFO - Email saved successfully: purchase request
2025-04-26 16:26:23,445 - INFO - Attempting to save attachment: sample_purchase_order.pdf
2025-04-26 16:26:23,513 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 16:26:23,514 - ERROR - Error saving attachment: {}
2025-04-26 16:26:23,514 - ERROR - Error type: APIError
2025-04-26 16:26:23,514 - ERROR - Attachment data: {'email_log_id': 192, 'filename': 'sample_purchase_order.pdf', 'mime_type': 'application/pdf', 'content': 'Purchase Order\nPO Number: PO-2024-001\nDate: 2025-04-14\nVendor: ABC Industrial Supplies Co.\nVendor Email: sales@abcindustrial.com\nBuyer: ShiftsAI Manufacturing Ltd.\nBuyer Contact: procurement@shiftsai.com\nItem Description Quantity Unit Price Total\nHigh-grade Steel Sheets 1000 $15.75 $15750.00\nIndustrial Lubricant (5L) 50 $22.50 $1125.00\nProtective Gloves (Box) 200 $6.80 $1360.00\nTotal $18235.00\nRequested Delivery Date: 2024-04-20\nDelivery Location: ShiftsAI Warehouse, 123 Industry Rd, Seoul, South Korea\n'}
2025-04-26 16:26:23,514 - ERROR - Error saving email log: {}
2025-04-26 16:26:23,514 - ERROR - Error type: APIError
2025-04-26 16:26:23,515 - ERROR - Error sending message to MCP server: [Errno 32] Broken pipe
2025-04-26 16:26:23,515 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 16:26:23,855 - INFO - Is vendor: False
2025-04-26 16:26:24,175 - INFO - Is vendor: False
2025-04-26 16:26:24,481 - INFO - Is vendor: True
2025-04-26 16:26:26,020 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:26:26,022 - INFO - Generated summary length: 113
2025-04-26 16:26:26,022 - INFO - Generated email type: order
2025-04-26 16:26:26,944 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 16:26:26,947 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:26:27,017 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:26:27,020 - INFO - Found 4 emails in thread
2025-04-26 16:26:27,633 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:26:27,634 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 16:26:27,635 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:26:27,715 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:26:27,716 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:26:27,716 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 16:26:27,790 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 16:26:27,791 - ERROR - Error saving attachment: {}
2025-04-26 16:26:27,791 - ERROR - Error type: APIError
2025-04-26 16:26:27,791 - ERROR - Attachment data: {'email_log_id': 193, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 16:26:27,792 - ERROR - Error saving email log: {}
2025-04-26 16:26:27,792 - ERROR - Error type: APIError
2025-04-26 16:26:27,795 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:26:27,795 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 16:26:28,167 - INFO - Is vendor: True
2025-04-26 16:26:29,701 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:26:29,703 - INFO - Generated summary length: 131
2025-04-26 16:26:29,703 - INFO - Generated email type: order
2025-04-26 16:26:29,703 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:26:29,768 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:26:29,772 - INFO - Found 5 emails in thread
2025-04-26 16:26:30,450 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:26:30,452 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 16:26:30,452 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:26:30,523 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:26:30,525 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:26:30,528 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:26:30,528 - INFO - Processed email: 19661ecddae94e49
2025-04-26 16:26:30,811 - INFO - Is vendor: False
2025-04-26 16:26:31,116 - INFO - Is vendor: True
2025-04-26 16:26:32,612 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:26:32,614 - INFO - Generated summary length: 154
2025-04-26 16:26:32,614 - INFO - Generated email type: delivery
2025-04-26 16:26:32,614 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:26:32,696 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:26:32,700 - INFO - Found 6 emails in thread
2025-04-26 16:26:33,383 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:26:33,385 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 16:26:33,385 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:26:33,480 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:26:33,481 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:26:33,484 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:26:33,484 - INFO - Processed email: 196675e9f37b6406
2025-04-26 16:26:33,778 - INFO - Is vendor: True
2025-04-26 16:26:35,259 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:26:35,261 - INFO - Generated summary length: 177
2025-04-26 16:26:35,261 - INFO - Generated email type: delivery
2025-04-26 16:26:35,262 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:26:35,348 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:26:35,350 - INFO - Found 7 emails in thread
2025-04-26 16:26:36,038 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:26:36,040 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 16:26:36,040 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:26:36,110 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:26:36,110 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:26:36,112 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:26:36,113 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 16:26:36,113 - INFO - GmailWatcher initialized
2025-04-26 16:31:36,026 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x10cf63c80>
2025-04-26 16:31:39,764 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 16:31:39,764 - INFO - Loaded 3 vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 16:31:39,766 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 16:31:39,916 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 16:31:39,940 - INFO - Supabase client initialized successfully
2025-04-26 16:31:39,941 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 16:31:54,698 - INFO - Is vendor: False
2025-04-26 16:31:55,033 - INFO - Is vendor: False
2025-04-26 16:31:55,327 - INFO - Is vendor: False
2025-04-26 16:31:55,605 - INFO - Is vendor: False
2025-04-26 16:31:55,954 - INFO - Is vendor: False
2025-04-26 16:31:56,232 - INFO - Is vendor: False
2025-04-26 16:31:56,515 - INFO - Is vendor: False
2025-04-26 16:31:56,879 - INFO - Is vendor: False
2025-04-26 16:31:57,152 - INFO - Is vendor: False
2025-04-26 16:31:57,492 - INFO - Is vendor: False
2025-04-26 16:31:57,770 - INFO - Is vendor: False
2025-04-26 16:31:58,104 - INFO - Is vendor: False
2025-04-26 16:31:58,385 - INFO - Is vendor: False
2025-04-26 16:31:58,719 - INFO - Is vendor: False
2025-04-26 16:31:59,027 - INFO - Is vendor: False
2025-04-26 16:31:59,333 - INFO - Is vendor: False
2025-04-26 16:31:59,603 - INFO - Is vendor: False
2025-04-26 16:31:59,888 - INFO - Is vendor: False
2025-04-26 16:32:00,163 - INFO - Is vendor: False
2025-04-26 16:32:00,464 - INFO - Is vendor: False
2025-04-26 16:32:00,767 - INFO - Is vendor: False
2025-04-26 16:32:01,075 - INFO - Is vendor: False
2025-04-26 16:32:01,382 - INFO - Is vendor: False
2025-04-26 16:32:01,677 - INFO - Is vendor: False
2025-04-26 16:32:01,996 - INFO - Is vendor: False
2025-04-26 16:32:02,282 - INFO - Is vendor: False
2025-04-26 16:32:02,611 - INFO - Is vendor: False
2025-04-26 16:32:02,885 - INFO - Is vendor: False
2025-04-26 16:32:03,225 - INFO - Is vendor: False
2025-04-26 16:32:03,534 - INFO - Is vendor: False
2025-04-26 16:32:03,861 - INFO - Is vendor: False
2025-04-26 16:32:04,146 - INFO - Is vendor: False
2025-04-26 16:32:04,454 - INFO - Is vendor: False
2025-04-26 16:32:04,763 - INFO - Is vendor: True
2025-04-26 16:32:06,711 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:32:06,720 - INFO - Generated summary length: 61
2025-04-26 16:32:06,720 - INFO - Generated email type: inquiry
2025-04-26 16:32:07,425 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 16:32:07,428 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 16:32:07,638 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:32:07,645 - INFO - Found 1 emails in thread
2025-04-26 16:32:08,660 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:32:08,663 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 16:32:08,663 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 16:32:08,729 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:32:08,731 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 16:32:08,731 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 16:32:08,810 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 16:32:08,810 - ERROR - Error saving attachment: {}
2025-04-26 16:32:08,810 - ERROR - Error type: APIError
2025-04-26 16:32:08,810 - ERROR - Attachment data: {'email_log_id': 197, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 16:32:08,810 - ERROR - Error saving email log: {}
2025-04-26 16:32:08,810 - ERROR - Error type: APIError
2025-04-26 16:32:08,816 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 16:32:08,816 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 16:32:09,165 - INFO - Is vendor: True
2025-04-26 16:32:10,861 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:32:10,865 - INFO - Generated summary length: 49
2025-04-26 16:32:10,865 - INFO - Generated email type: order
2025-04-26 16:32:11,828 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 16:32:11,910 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 16:32:12,001 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:32:12,004 - INFO - Found 1 emails in thread
2025-04-26 16:32:12,955 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:32:12,957 - INFO - Parsed delivery date: 2024-04-20
2025-04-26 16:32:12,957 - INFO - Attempting to save email log: purchase request
2025-04-26 16:32:13,028 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:32:13,030 - INFO - Email saved successfully: purchase request
2025-04-26 16:32:13,030 - INFO - Attempting to save attachment: sample_purchase_order.pdf
2025-04-26 16:32:13,105 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 16:32:13,106 - ERROR - Error saving attachment: {}
2025-04-26 16:32:13,106 - ERROR - Error type: APIError
2025-04-26 16:32:13,106 - ERROR - Attachment data: {'email_log_id': 198, 'filename': 'sample_purchase_order.pdf', 'mime_type': 'application/pdf', 'content': 'Purchase Order\nPO Number: PO-2024-001\nDate: 2025-04-14\nVendor: ABC Industrial Supplies Co.\nVendor Email: sales@abcindustrial.com\nBuyer: ShiftsAI Manufacturing Ltd.\nBuyer Contact: procurement@shiftsai.com\nItem Description Quantity Unit Price Total\nHigh-grade Steel Sheets 1000 $15.75 $15750.00\nIndustrial Lubricant (5L) 50 $22.50 $1125.00\nProtective Gloves (Box) 200 $6.80 $1360.00\nTotal $18235.00\nRequested Delivery Date: 2024-04-20\nDelivery Location: ShiftsAI Warehouse, 123 Industry Rd, Seoul, South Korea\n'}
2025-04-26 16:32:13,106 - ERROR - Error saving email log: {}
2025-04-26 16:32:13,106 - ERROR - Error type: APIError
2025-04-26 16:32:13,108 - INFO - Message sent to MCP server: purchase request
2025-04-26 16:32:13,109 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 16:32:13,465 - INFO - Is vendor: False
2025-04-26 16:32:13,772 - INFO - Is vendor: False
2025-04-26 16:32:14,082 - INFO - Is vendor: True
2025-04-26 16:32:16,337 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:32:16,340 - INFO - Generated summary length: 131
2025-04-26 16:32:16,340 - INFO - Generated email type: order
2025-04-26 16:32:17,361 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 16:32:17,363 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:32:17,438 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:32:17,441 - INFO - Found 4 emails in thread
2025-04-26 16:32:18,320 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:32:18,323 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 16:32:18,323 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:32:18,424 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:32:18,426 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:32:18,426 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 16:32:18,488 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 16:32:18,490 - ERROR - Error saving attachment: {}
2025-04-26 16:32:18,490 - ERROR - Error type: APIError
2025-04-26 16:32:18,490 - ERROR - Attachment data: {'email_log_id': 199, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 16:32:18,490 - ERROR - Error saving email log: {}
2025-04-26 16:32:18,490 - ERROR - Error type: APIError
2025-04-26 16:32:18,491 - ERROR - Error sending message to MCP server: [Errno 32] Broken pipe
2025-04-26 16:32:18,491 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 16:32:18,809 - INFO - Is vendor: True
2025-04-26 16:32:21,364 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:32:21,368 - INFO - Generated summary length: 228
2025-04-26 16:32:21,368 - INFO - Generated email type: confirmation
2025-04-26 16:32:21,369 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:32:21,440 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:32:21,444 - INFO - Found 5 emails in thread
2025-04-26 16:32:22,286 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:32:22,290 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 16:32:22,290 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:32:22,371 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:32:22,372 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:32:22,374 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:32:22,374 - INFO - Processed email: 19661ecddae94e49
2025-04-26 16:32:22,683 - INFO - Is vendor: False
2025-04-26 16:32:22,988 - INFO - Is vendor: True
2025-04-26 16:32:25,351 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:32:25,353 - INFO - Generated summary length: 202
2025-04-26 16:32:25,354 - INFO - Generated email type: delivery
2025-04-26 16:32:25,354 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:32:25,544 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:32:25,549 - INFO - Found 6 emails in thread
2025-04-26 16:32:26,533 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:32:26,536 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 16:32:26,536 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:32:26,862 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:32:26,863 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:32:26,866 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:32:26,866 - INFO - Processed email: 196675e9f37b6406
2025-04-26 16:32:27,196 - INFO - Is vendor: True
2025-04-26 16:32:29,795 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:32:29,797 - INFO - Generated summary length: 194
2025-04-26 16:32:29,797 - INFO - Generated email type: delivery
2025-04-26 16:32:29,797 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:32:30,031 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:32:30,034 - INFO - Found 7 emails in thread
2025-04-26 16:32:30,982 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:32:30,983 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 16:32:30,983 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:32:31,419 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:32:31,421 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:32:31,424 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:32:31,424 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 16:32:31,424 - INFO - GmailWatcher initialized
2025-04-26 16:43:26,347 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x11564ba70>
2025-04-26 16:43:32,785 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 16:43:32,785 - INFO - Loaded 3 vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 16:43:32,787 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 16:43:32,931 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 16:43:32,954 - INFO - Supabase client initialized successfully
2025-04-26 16:43:32,954 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 16:43:49,349 - INFO - Is vendor: False
2025-04-26 16:43:49,659 - INFO - Is vendor: False
2025-04-26 16:43:49,995 - INFO - Is vendor: False
2025-04-26 16:43:50,312 - INFO - Is vendor: False
2025-04-26 16:43:50,622 - INFO - Is vendor: False
2025-04-26 16:43:50,937 - INFO - Is vendor: False
2025-04-26 16:43:51,344 - INFO - Is vendor: False
2025-04-26 16:43:51,652 - INFO - Is vendor: False
2025-04-26 16:43:51,958 - INFO - Is vendor: False
2025-04-26 16:43:52,256 - INFO - Is vendor: False
2025-04-26 16:43:52,558 - INFO - Is vendor: False
2025-04-26 16:43:52,983 - INFO - Is vendor: False
2025-04-26 16:43:53,340 - INFO - Is vendor: False
2025-04-26 16:43:53,691 - INFO - Is vendor: False
2025-04-26 16:43:53,997 - INFO - Is vendor: False
2025-04-26 16:43:54,521 - INFO - Is vendor: False
2025-04-26 16:43:54,830 - INFO - Is vendor: False
2025-04-26 16:43:55,135 - INFO - Is vendor: False
2025-04-26 16:43:55,430 - INFO - Is vendor: False
2025-04-26 16:43:55,747 - INFO - Is vendor: False
2025-04-26 16:43:56,115 - INFO - Is vendor: False
2025-04-26 16:43:56,428 - INFO - Is vendor: False
2025-04-26 16:43:56,757 - INFO - Is vendor: False
2025-04-26 16:43:57,073 - INFO - Is vendor: False
2025-04-26 16:43:57,787 - INFO - Is vendor: False
2025-04-26 16:43:58,094 - INFO - Is vendor: False
2025-04-26 16:43:58,383 - INFO - Is vendor: False
2025-04-26 16:43:58,758 - INFO - Is vendor: False
2025-04-26 16:43:59,080 - INFO - Is vendor: False
2025-04-26 16:43:59,402 - INFO - Is vendor: False
2025-04-26 16:43:59,700 - INFO - Is vendor: False
2025-04-26 16:44:00,019 - INFO - Is vendor: False
2025-04-26 16:44:00,723 - INFO - Is vendor: False
2025-04-26 16:44:01,063 - INFO - Is vendor: True
2025-04-26 16:44:03,097 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:44:03,106 - INFO - Generated summary length: 107
2025-04-26 16:44:03,106 - INFO - Generated email type: document submission
2025-04-26 16:44:04,382 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 16:44:04,385 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 16:44:05,441 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:44:05,446 - INFO - Found 1 emails in thread
2025-04-26 16:44:06,227 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:44:06,230 - INFO - Parsed delivery date: 2025-04-22
2025-04-26 16:44:06,230 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 16:44:06,317 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:44:06,318 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 16:44:06,319 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 16:44:06,421 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 16:44:06,422 - ERROR - Error saving attachment: {}
2025-04-26 16:44:06,422 - ERROR - Error type: APIError
2025-04-26 16:44:06,422 - ERROR - Attachment data: {'email_log_id': 203, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 16:44:06,422 - ERROR - Error saving email log: {}
2025-04-26 16:44:06,422 - ERROR - Error type: APIError
2025-04-26 16:44:06,428 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 16:44:06,428 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 16:44:06,813 - INFO - Is vendor: True
2025-04-26 16:44:09,266 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:44:09,267 - INFO - Generated summary length: 53
2025-04-26 16:44:09,268 - INFO - Generated email type: purchase request
2025-04-26 16:44:10,384 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 16:44:10,386 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 16:44:10,463 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:44:10,465 - INFO - Found 1 emails in thread
2025-04-26 16:44:11,324 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:44:11,330 - INFO - Parsed delivery date: 2024-04-20
2025-04-26 16:44:11,330 - INFO - Attempting to save email log: purchase request
2025-04-26 16:44:11,416 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:44:11,417 - INFO - Email saved successfully: purchase request
2025-04-26 16:44:11,417 - INFO - Attempting to save attachment: sample_purchase_order.pdf
2025-04-26 16:44:11,498 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 16:44:11,499 - ERROR - Error saving attachment: {}
2025-04-26 16:44:11,499 - ERROR - Error type: APIError
2025-04-26 16:44:11,500 - ERROR - Attachment data: {'email_log_id': 204, 'filename': 'sample_purchase_order.pdf', 'mime_type': 'application/pdf', 'content': 'Purchase Order\nPO Number: PO-2024-001\nDate: 2025-04-14\nVendor: ABC Industrial Supplies Co.\nVendor Email: sales@abcindustrial.com\nBuyer: ShiftsAI Manufacturing Ltd.\nBuyer Contact: procurement@shiftsai.com\nItem Description Quantity Unit Price Total\nHigh-grade Steel Sheets 1000 $15.75 $15750.00\nIndustrial Lubricant (5L) 50 $22.50 $1125.00\nProtective Gloves (Box) 200 $6.80 $1360.00\nTotal $18235.00\nRequested Delivery Date: 2024-04-20\nDelivery Location: ShiftsAI Warehouse, 123 Industry Rd, Seoul, South Korea\n'}
2025-04-26 16:44:11,500 - ERROR - Error saving email log: {}
2025-04-26 16:44:11,500 - ERROR - Error type: APIError
2025-04-26 16:44:11,502 - ERROR - Error sending message to MCP server: [Errno 32] Broken pipe
2025-04-26 16:44:11,502 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 16:44:11,817 - INFO - Is vendor: False
2025-04-26 16:44:12,250 - INFO - Is vendor: False
2025-04-26 16:44:12,635 - INFO - Is vendor: True
2025-04-26 16:44:14,784 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:44:14,786 - INFO - Generated summary length: 131
2025-04-26 16:44:14,786 - INFO - Generated email type: order confirmation
2025-04-26 16:44:15,678 - INFO - HTTP Request: POST https://api.openai.com/v1/embeddings "HTTP/1.1 200 OK"
2025-04-26 16:44:15,681 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:44:15,783 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:44:15,787 - INFO - Found 4 emails in thread
2025-04-26 16:44:16,781 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:44:16,792 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 16:44:16,792 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:44:16,962 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:44:16,963 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:44:16,963 - INFO - Attempting to save attachment: test_po.pdf
2025-04-26 16:44:17,125 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_attachments "HTTP/1.1 404 Not Found"
2025-04-26 16:44:17,126 - ERROR - Error saving attachment: {}
2025-04-26 16:44:17,126 - ERROR - Error type: APIError
2025-04-26 16:44:17,126 - ERROR - Attachment data: {'email_log_id': 205, 'filename': 'test_po.pdf', 'mime_type': 'application/pdf', 'content': 'PURCHASE ORDER Company Name: Acme Manufacturing Co. Company Address: 123 Industry Park, Springfield, USA PO Number: PO-20250413-001   Date: 2025-04-13 Vendor: Mega Industrial Supplies Inc.   Vendor Address: 456 Supplier Blvd, Austin, TX 73301   Contact: John Doe (john@megais.com) \nSubtotal: $1,325.00   Tax (8.25%): $109.31   Total: **$1,434.31** Requested Delivery Date: 2025-04-22   Delivery Location: 789 Assembly Line Rd, Houston, TX Special Instructions:   - Ensure batch # is recorded on packaging   - Use freight carrier: FedEx Freight Item No.DescriptionQuantity Unit PriceTotal1Steel Bolts M8500$0.25$125.00 2Aluminum Sheets200$3.50 $700.003Industrial Glue50$10.00$500.00\n'}
2025-04-26 16:44:17,126 - ERROR - Error saving email log: {}
2025-04-26 16:44:17,126 - ERROR - Error type: APIError
2025-04-26 16:44:17,131 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:44:17,131 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 16:44:17,516 - INFO - Is vendor: True
2025-04-26 16:44:20,126 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:44:20,127 - INFO - Generated summary length: 198
2025-04-26 16:44:20,127 - INFO - Generated email type: order confirmation
2025-04-26 16:44:20,127 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:44:20,248 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:44:20,254 - INFO - Found 5 emails in thread
2025-04-26 16:44:21,115 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:44:21,120 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 16:44:21,120 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:44:21,190 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:44:21,191 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:44:21,194 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:44:21,195 - INFO - Processed email: 19661ecddae94e49
2025-04-26 16:44:21,547 - INFO - Is vendor: False
2025-04-26 16:44:21,885 - INFO - Is vendor: True
2025-04-26 16:44:24,636 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:44:24,637 - INFO - Generated summary length: 172
2025-04-26 16:44:24,637 - INFO - Generated email type: delivery delay
2025-04-26 16:44:24,637 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:44:24,791 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:44:24,794 - INFO - Found 6 emails in thread
2025-04-26 16:44:26,098 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:44:26,100 - INFO - Parsed delivery date: 2025-05-04
2025-04-26 16:44:26,100 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:44:26,173 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:44:26,174 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:44:26,176 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:44:26,176 - INFO - Processed email: 196675e9f37b6406
2025-04-26 16:44:26,537 - INFO - Is vendor: True
2025-04-26 16:44:28,868 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:44:28,876 - INFO - Generated summary length: 184
2025-04-26 16:44:28,877 - INFO - Generated email type: expedite delivery
2025-04-26 16:44:28,877 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 16:44:29,067 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 16:44:29,071 - INFO - Found 7 emails in thread
2025-04-26 16:44:30,201 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 16:44:30,203 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 16:44:30,203 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:44:30,459 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 16:44:30,460 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:44:30,461 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 16:44:30,461 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 16:44:30,461 - INFO - GmailWatcher initialized
2025-04-26 20:36:44,271 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x11c4a3f80>
2025-04-26 20:57:17,594 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 20:57:17,596 - INFO - Loaded 3 vendor emails: ['yeonip7913@gmail.com', 'jiyeon@shiftsai.com', 'ddd7913@gmail.com']
2025-04-26 20:57:17,597 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 20:57:17,744 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 20:57:17,769 - INFO - Supabase client initialized successfully
2025-04-26 20:57:17,769 - ERROR - Error in main: EmailProcessor.__init__() got an unexpected keyword argument 'supabase_client'
2025-04-26 20:58:48,011 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 20:58:48,011 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 20:58:48,011 - ERROR - Error in main: object of type 'NoneType' has no len()
2025-04-26 20:59:32,349 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 20:59:32,349 - INFO - Loaded 3 vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 20:59:32,349 - INFO - Loaded vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 20:59:32,350 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 20:59:32,500 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 20:59:32,524 - INFO - Supabase client initialized successfully
2025-04-26 20:59:32,551 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 20:59:49,124 - INFO - Is vendor: False
2025-04-26 20:59:49,431 - INFO - Is vendor: False
2025-04-26 20:59:49,841 - INFO - Is vendor: False
2025-04-26 20:59:50,147 - INFO - Is vendor: False
2025-04-26 20:59:50,446 - INFO - Is vendor: False
2025-04-26 20:59:50,764 - INFO - Is vendor: False
2025-04-26 20:59:51,078 - INFO - Is vendor: False
2025-04-26 20:59:51,421 - INFO - Is vendor: False
2025-04-26 20:59:51,788 - INFO - Is vendor: False
2025-04-26 20:59:52,196 - INFO - Is vendor: False
2025-04-26 20:59:52,504 - INFO - Is vendor: False
2025-04-26 20:59:52,918 - INFO - Is vendor: False
2025-04-26 20:59:53,323 - INFO - Is vendor: False
2025-04-26 20:59:53,732 - INFO - Is vendor: False
2025-04-26 20:59:54,142 - INFO - Is vendor: False
2025-04-26 20:59:54,551 - INFO - Is vendor: False
2025-04-26 20:59:54,961 - INFO - Is vendor: False
2025-04-26 20:59:55,268 - INFO - Is vendor: False
2025-04-26 20:59:55,576 - INFO - Is vendor: False
2025-04-26 20:59:55,985 - INFO - Is vendor: False
2025-04-26 20:59:56,395 - INFO - Is vendor: False
2025-04-26 20:59:56,805 - INFO - Is vendor: False
2025-04-26 20:59:57,214 - INFO - Is vendor: False
2025-04-26 20:59:57,623 - INFO - Is vendor: False
2025-04-26 20:59:58,033 - INFO - Is vendor: False
2025-04-26 20:59:58,340 - INFO - Is vendor: False
2025-04-26 20:59:58,647 - INFO - Is vendor: False
2025-04-26 20:59:59,057 - INFO - Is vendor: False
2025-04-26 20:59:59,467 - INFO - Is vendor: False
2025-04-26 20:59:59,773 - INFO - Is vendor: False
2025-04-26 21:00:00,081 - INFO - Is vendor: False
2025-04-26 21:00:00,490 - INFO - Is vendor: False
2025-04-26 21:00:00,798 - INFO - Is vendor: False
2025-04-26 21:00:01,208 - INFO - Is vendor: True
2025-04-26 21:00:01,618 - ERROR - Error saving email log: 'coroutine' object is not reversible
2025-04-26 21:00:01,633 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 21:00:01,633 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 21:00:02,028 - INFO - Is vendor: True
2025-04-26 21:00:02,354 - ERROR - Error saving email log: 'coroutine' object is not reversible
2025-04-26 21:00:02,357 - INFO - Message sent to MCP server: purchase request
2025-04-26 21:00:02,357 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 21:00:02,747 - INFO - Is vendor: False
2025-04-26 21:00:03,153 - INFO - Is vendor: False
2025-04-26 21:00:03,563 - INFO - Is vendor: True
2025-04-26 21:00:03,972 - ERROR - Error saving email log: 'coroutine' object is not reversible
2025-04-26 21:00:03,974 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 21:00:03,974 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 21:00:04,279 - INFO - Is vendor: True
2025-04-26 21:00:04,689 - ERROR - Error saving email log: 'coroutine' object is not reversible
2025-04-26 21:00:04,691 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 21:00:04,692 - INFO - Processed email: 19661ecddae94e49
2025-04-26 21:00:05,100 - INFO - Is vendor: False
2025-04-26 21:00:05,406 - INFO - Is vendor: True
2025-04-26 21:00:05,815 - ERROR - Error saving email log: 'coroutine' object is not reversible
2025-04-26 21:00:05,817 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 21:00:05,817 - INFO - Processed email: 196675e9f37b6406
2025-04-26 21:00:06,226 - INFO - Is vendor: True
2025-04-26 21:00:06,532 - ERROR - Error saving email log: 'coroutine' object is not reversible
2025-04-26 21:00:06,534 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 21:00:06,535 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 21:00:06,535 - ERROR - Error in main: GmailWatcher.__init__() takes 2 positional arguments but 4 were given
2025-04-26 21:00:06,535 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x115adf440>
2025-04-26 21:00:06,535 - ERROR - Unclosed connector
connections: ['[(<aiohttp.client_proto.ResponseHandler object at 0x115abf170>, 261676.134671208)]']
connector: <aiohttp.connector.TCPConnector object at 0x115adc4d0>
2025-04-26 21:01:42,448 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 21:01:42,449 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 21:01:42,449 - INFO - Loaded vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 21:01:42,450 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 21:01:42,603 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 21:01:42,627 - INFO - Supabase client initialized successfully
2025-04-26 21:01:42,652 - ERROR - Error collecting historical emails: type object 'datetime.datetime' has no attribute 'UTC'
2025-04-26 21:45:35,086 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 21:45:35,086 - INFO - Loaded 3 vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 21:45:35,088 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 21:45:35,271 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 21:45:35,295 - INFO - Supabase client initialized successfully
2025-04-26 21:45:35,295 - ERROR - Error in main: EmailProcessor.__init__() got an unexpected keyword argument 'supabase_client'
2025-04-26 21:57:20,848 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 21:57:20,849 - INFO - Loaded 3 vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 21:57:20,850 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 21:57:20,993 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 21:57:21,018 - INFO - Supabase client initialized successfully
2025-04-26 21:57:21,018 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 22:01:53,026 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 22:01:53,027 - INFO - Loaded 3 vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 22:01:53,028 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 22:01:53,176 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 22:01:53,200 - INFO - Supabase client initialized successfully
2025-04-26 22:01:53,201 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 22:02:08,580 - INFO - Is vendor: False
2025-04-26 22:02:08,861 - INFO - Is vendor: False
2025-04-26 22:02:09,193 - INFO - Is vendor: False
2025-04-26 22:02:09,500 - INFO - Is vendor: False
2025-04-26 22:02:09,792 - INFO - Is vendor: False
2025-04-26 22:02:10,075 - INFO - Is vendor: False
2025-04-26 22:02:10,361 - INFO - Is vendor: False
2025-04-26 22:02:10,730 - INFO - Is vendor: False
2025-04-26 22:02:11,003 - INFO - Is vendor: False
2025-04-26 22:02:11,343 - INFO - Is vendor: False
2025-04-26 22:02:11,652 - INFO - Is vendor: False
2025-04-26 22:02:11,958 - INFO - Is vendor: False
2025-04-26 22:02:12,265 - INFO - Is vendor: False
2025-04-26 22:02:12,573 - INFO - Is vendor: False
2025-04-26 22:02:12,879 - INFO - Is vendor: False
2025-04-26 22:02:13,289 - INFO - Is vendor: False
2025-04-26 22:02:13,596 - INFO - Is vendor: False
2025-04-26 22:02:13,904 - INFO - Is vendor: False
2025-04-26 22:02:14,211 - INFO - Is vendor: False
2025-04-26 22:02:14,893 - INFO - Is vendor: False
2025-04-26 22:02:15,235 - INFO - Is vendor: False
2025-04-26 22:02:15,542 - INFO - Is vendor: False
2025-04-26 22:02:15,821 - INFO - Is vendor: False
2025-04-26 22:02:16,157 - INFO - Is vendor: False
2025-04-26 22:02:16,464 - INFO - Is vendor: False
2025-04-26 22:02:16,772 - INFO - Is vendor: False
2025-04-26 22:02:17,078 - INFO - Is vendor: False
2025-04-26 22:02:17,386 - INFO - Is vendor: False
2025-04-26 22:02:17,693 - INFO - Is vendor: False
2025-04-26 22:02:17,974 - INFO - Is vendor: False
2025-04-26 22:02:18,307 - INFO - Is vendor: False
2025-04-26 22:02:18,614 - INFO - Is vendor: False
2025-04-26 22:02:18,922 - INFO - Is vendor: False
2025-04-26 22:02:19,229 - INFO - Is vendor: True
2025-04-26 22:02:21,793 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 22:02:21,804 - INFO - Generated summary length: 107
2025-04-26 22:02:21,804 - INFO - Generated email type: request submission
2025-04-26 22:02:21,804 - ERROR - Error processing attachment: 'data'
2025-04-26 22:02:21,804 - ERROR - Error type: KeyError
2025-04-26 22:02:21,804 - ERROR - Error saving email log: 'data'
2025-04-26 22:02:21,804 - ERROR - Error type: KeyError
2025-04-26 22:02:21,822 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 22:02:21,822 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 22:02:22,199 - INFO - Is vendor: True
2025-04-26 22:02:24,168 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 22:02:24,171 - INFO - Generated summary length: 53
2025-04-26 22:02:24,171 - INFO - Generated email type: purchase request
2025-04-26 22:02:24,171 - ERROR - Error processing attachment: 'data'
2025-04-26 22:02:24,171 - ERROR - Error type: KeyError
2025-04-26 22:02:24,171 - ERROR - Error saving email log: 'data'
2025-04-26 22:02:24,171 - ERROR - Error type: KeyError
2025-04-26 22:02:24,174 - INFO - Message sent to MCP server: purchase request
2025-04-26 22:02:24,174 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 22:02:24,554 - INFO - Is vendor: False
2025-04-26 22:02:24,860 - INFO - Is vendor: False
2025-04-26 22:02:25,141 - INFO - Is vendor: True
2025-04-26 22:02:27,114 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 22:02:27,115 - INFO - Generated summary length: 131
2025-04-26 22:02:27,115 - INFO - Generated email type: order confirmation
2025-04-26 22:02:27,115 - ERROR - Error processing attachment: 'data'
2025-04-26 22:02:27,115 - ERROR - Error type: KeyError
2025-04-26 22:02:27,115 - ERROR - Error saving email log: 'data'
2025-04-26 22:02:27,115 - ERROR - Error type: KeyError
2025-04-26 22:02:27,117 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 22:02:27,117 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 22:02:27,421 - INFO - Is vendor: True
2025-04-26 22:02:29,878 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 22:02:29,878 - INFO - Generated summary length: 198
2025-04-26 22:02:29,879 - INFO - Generated email type: order confirmation
2025-04-26 22:02:29,879 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 22:02:31,009 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 22:02:31,017 - INFO - Found 8 emails in thread
2025-04-26 22:02:31,928 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 22:02:31,929 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 22:02:31,929 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 22:02:32,002 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 22:02:32,004 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 22:02:32,006 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 22:02:32,006 - INFO - Processed email: 19661ecddae94e49
2025-04-26 22:02:32,336 - INFO - Is vendor: False
2025-04-26 22:02:32,616 - INFO - Is vendor: True
2025-04-26 22:02:35,408 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 22:02:35,409 - INFO - Generated summary length: 158
2025-04-26 22:02:35,409 - INFO - Generated email type: delivery delay
2025-04-26 22:02:35,409 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 22:02:35,455 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 22:02:35,457 - INFO - Found 9 emails in thread
2025-04-26 22:02:36,534 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 22:02:36,535 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 22:02:36,535 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 22:02:36,585 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 22:02:36,586 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 22:02:36,587 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 22:02:36,587 - INFO - Processed email: 196675e9f37b6406
2025-04-26 22:02:36,944 - INFO - Is vendor: True
2025-04-26 22:02:39,073 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 22:02:39,074 - INFO - Generated summary length: 156
2025-04-26 22:02:39,075 - INFO - Generated email type: delivery expedite
2025-04-26 22:02:39,075 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 22:02:39,198 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 22:02:39,201 - INFO - Found 10 emails in thread
2025-04-26 22:02:40,118 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 22:02:40,120 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 22:02:40,120 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 22:02:40,157 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 22:02:40,158 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 22:02:40,161 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 22:02:40,161 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 22:02:40,161 - INFO - GmailWatcher initialized
2025-04-26 22:52:25,061 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x11c866000>
2025-04-26 23:01:22,013 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:01:22,014 - INFO - Loaded 3 vendor emails: ['yeonip7913@gmail.com', 'jiyeon@shiftsai.com', 'ddd7913@gmail.com']
2025-04-26 23:01:22,016 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 23:01:22,166 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 23:01:22,189 - INFO - Supabase client initialized successfully
2025-04-26 23:01:22,190 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 23:01:22,435 - ERROR - Error collecting historical emails: ('invalid_scope: Bad Request', {'error': 'invalid_scope', 'error_description': 'Bad Request'})
2025-04-26 23:01:22,435 - INFO - GmailWatcher initialized
2025-04-26 23:12:37,129 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:12:37,130 - INFO - Loaded 3 vendor emails: ['yeonip7913@gmail.com', 'jiyeon@shiftsai.com', 'ddd7913@gmail.com']
2025-04-26 23:12:37,132 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 23:12:37,288 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 23:12:37,313 - INFO - Supabase client initialized successfully
2025-04-26 23:12:37,314 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 23:12:37,641 - ERROR - Error collecting historical emails: ('invalid_scope: Bad Request', {'error': 'invalid_scope', 'error_description': 'Bad Request'})
2025-04-26 23:12:37,641 - INFO - GmailWatcher initialized
2025-04-26 23:13:46,690 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:13:46,690 - INFO - Loaded 3 vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 23:13:46,691 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 23:13:46,829 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 23:13:46,853 - INFO - Supabase client initialized successfully
2025-04-26 23:13:46,855 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 23:13:47,150 - ERROR - Error collecting historical emails: ('invalid_scope: Bad Request', {'error': 'invalid_scope', 'error_description': 'Bad Request'})
2025-04-26 23:13:47,151 - INFO - GmailWatcher initialized
2025-04-26 23:14:52,165 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:14:52,165 - INFO - Loaded 3 vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 23:15:03,744 - INFO - "GET /?state=yqAjIXCJHjpOuBxXm1PjPCPZdQ6kUC&code=4/0Ab_5qlkv1lbqbinkfn1wG6_PY6CSgmyykJRAlTzByRJ5w3bZ4QGoZXojRAsWTs5zBfcyNw&scope=https://www.googleapis.com/auth/gmail.readonly%20https://www.googleapis.com/auth/gmail.modify HTTP/1.1" 200 65
2025-04-26 23:15:04,081 - ERROR - Error in main: Scope has changed from "https://www.googleapis.com/auth/gmail.modify https://www.googleapis.com/auth/gmail.labels https://www.googleapis.com/auth/gmail.metadata https://www.googleapis.com/auth/gmail.readonly" to "https://www.googleapis.com/auth/gmail.modify https://www.googleapis.com/auth/gmail.readonly".
2025-04-26 23:15:13,805 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:15:13,806 - INFO - Loaded 3 vendor emails: ['jiyeon@shiftsai.com', 'yeonip7913@gmail.com', 'ddd7913@gmail.com']
2025-04-26 23:15:13,809 - ERROR - Error in main: [Errno 48] Address already in use
2025-04-26 23:16:20,857 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:16:20,857 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'yeonip7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 23:16:20,860 - ERROR - Error in main: [Errno 48] Address already in use
2025-04-26 23:16:57,513 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:16:57,513 - INFO - Loaded 3 vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 23:17:43,064 - INFO - "GET /?state=o1EZZObom3e0sI9GbXQGvfkN8XPjfX&code=4/0Ab_5qlmCLqRHSdcPc9Q-okSVTQ8wllcOud8uxHdqGRj8A5Z176hzuu7gltSvZcXZjlgDxw&scope=https://www.googleapis.com/auth/gmail.labels%20https://www.googleapis.com/auth/gmail.metadata%20https://www.googleapis.com/auth/gmail.readonly%20https://www.googleapis.com/auth/gmail.modify HTTP/1.1" 200 65
2025-04-26 23:17:43,410 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 23:17:43,545 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 23:17:43,569 - INFO - Supabase client initialized successfully
2025-04-26 23:17:43,570 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 23:17:44,264 - WARNING - Encountered 403 Forbidden with reason "forbidden"
2025-04-26 23:17:44,264 - ERROR - Error collecting historical emails: <HttpError 403 when requesting https://gmail.googleapis.com/gmail/v1/users/me/messages?labelIds=INBOX&q=after%3A2025%2F01%2F26&maxResults=100&alt=json returned "Metadata scope does not support 'q' parameter". Details: "[{'message': "Metadata scope does not support 'q' parameter", 'domain': 'global', 'reason': 'forbidden'}]">
2025-04-26 23:17:44,264 - INFO - GmailWatcher initialized
2025-04-26 23:17:44,738 - WARNING - Encountered 403 Forbidden with reason "forbidden"
2025-04-26 23:18:13,065 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:18:13,065 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 23:18:13,066 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 23:18:13,215 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 23:18:13,240 - INFO - Supabase client initialized successfully
2025-04-26 23:18:13,241 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 23:18:14,128 - WARNING - Encountered 403 Forbidden with reason "forbidden"
2025-04-26 23:18:14,129 - ERROR - Error collecting historical emails: <HttpError 403 when requesting https://gmail.googleapis.com/gmail/v1/users/me/messages?labelIds=INBOX&q=after%3A2025%2F01%2F26&maxResults=100&alt=json returned "Metadata scope does not support 'q' parameter". Details: "[{'message': "Metadata scope does not support 'q' parameter", 'domain': 'global', 'reason': 'forbidden'}]">
2025-04-26 23:18:14,129 - INFO - GmailWatcher initialized
2025-04-26 23:18:14,434 - WARNING - Encountered 403 Forbidden with reason "forbidden"
2025-04-26 23:19:38,389 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:19:38,389 - INFO - Loaded 3 vendor emails: ['jiyeon@shiftsai.com', 'ddd7913@gmail.com', 'yeonip7913@gmail.com']
2025-04-26 23:19:46,335 - INFO - "GET /?state=NG8ByxZhnBtQTrkpLGylltUC4Lcu5m&code=4/0Ab_5qll793hxG2CApMs3SJdBGHEZ2L_iwbejg4raidPt5WsnPSsOq9cbFiKBdpsFctboeA&scope=https://mail.google.com/ HTTP/1.1" 200 65
2025-04-26 23:19:46,647 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 23:19:46,781 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 23:19:46,805 - INFO - Supabase client initialized successfully
2025-04-26 23:19:46,806 - INFO - Searching emails with query: after:2025/01/26
2025-04-26 23:20:04,619 - INFO - Is vendor: False
2025-04-26 23:20:04,926 - INFO - Is vendor: False
2025-04-26 23:20:05,234 - INFO - Is vendor: False
2025-04-26 23:20:05,541 - INFO - Is vendor: False
2025-04-26 23:20:05,848 - INFO - Is vendor: False
2025-04-26 23:20:06,155 - INFO - Is vendor: False
2025-04-26 23:20:06,463 - INFO - Is vendor: False
2025-04-26 23:20:06,770 - INFO - Is vendor: False
2025-04-26 23:20:07,122 - INFO - Is vendor: False
2025-04-26 23:20:07,396 - INFO - Is vendor: False
2025-04-26 23:20:08,072 - INFO - Is vendor: False
2025-04-26 23:20:08,360 - INFO - Is vendor: False
2025-04-26 23:20:08,646 - INFO - Is vendor: False
2025-04-26 23:20:08,922 - INFO - Is vendor: False
2025-04-26 23:20:09,638 - INFO - Is vendor: False
2025-04-26 23:20:09,945 - INFO - Is vendor: False
2025-04-26 23:20:10,230 - INFO - Is vendor: False
2025-04-26 23:20:10,517 - INFO - Is vendor: False
2025-04-26 23:20:10,793 - INFO - Is vendor: False
2025-04-26 23:20:11,073 - INFO - Is vendor: False
2025-04-26 23:20:11,353 - INFO - Is vendor: False
2025-04-26 23:20:12,023 - INFO - Is vendor: False
2025-04-26 23:20:12,302 - INFO - Is vendor: False
2025-04-26 23:20:12,609 - INFO - Is vendor: False
2025-04-26 23:20:12,914 - INFO - Is vendor: False
2025-04-26 23:20:13,221 - INFO - Is vendor: False
2025-04-26 23:20:13,499 - INFO - Is vendor: False
2025-04-26 23:20:13,835 - INFO - Is vendor: False
2025-04-26 23:20:14,142 - INFO - Is vendor: False
2025-04-26 23:20:14,450 - INFO - Is vendor: False
2025-04-26 23:20:14,757 - INFO - Is vendor: False
2025-04-26 23:20:15,064 - INFO - Is vendor: False
2025-04-26 23:20:15,375 - INFO - Is vendor: False
2025-04-26 23:20:15,678 - INFO - Is vendor: True
2025-04-26 23:20:17,934 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:20:17,943 - INFO - Generated email type: request submission
2025-04-26 23:20:18,751 - ERROR - Error downloading attachment: 'SupabaseService' object has no attribute 'storage'
2025-04-26 23:20:18,752 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 23:20:19,268 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 23:20:19,272 - INFO - Found 0 emails in thread
2025-04-26 23:20:20,009 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:20:20,011 - INFO - Parsed delivery date: None
2025-04-26 23:20:20,011 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 23:20:20,062 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 23:20:20,063 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 23:20:20,069 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 23:20:20,070 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 23:20:20,350 - INFO - Is vendor: True
2025-04-26 23:20:22,029 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:20:22,033 - INFO - Generated email type: purchase request
2025-04-26 23:20:22,539 - ERROR - Error downloading attachment: 'SupabaseService' object has no attribute 'storage'
2025-04-26 23:20:22,540 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 23:20:22,576 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 23:20:22,577 - INFO - Found 0 emails in thread
2025-04-26 23:20:23,512 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:20:23,518 - INFO - Parsed delivery date: None
2025-04-26 23:20:23,518 - INFO - Attempting to save email log: purchase request
2025-04-26 23:20:23,567 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 23:20:23,568 - INFO - Email saved successfully: purchase request
2025-04-26 23:20:23,570 - INFO - Message sent to MCP server: purchase request
2025-04-26 23:20:23,570 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 23:20:23,851 - INFO - Is vendor: False
2025-04-26 23:20:24,178 - INFO - Is vendor: False
2025-04-26 23:20:24,485 - INFO - Is vendor: True
2025-04-26 23:20:26,637 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:20:26,638 - INFO - Generated email type: order confirmation
2025-04-26 23:20:27,098 - ERROR - Error downloading attachment: 'SupabaseService' object has no attribute 'storage'
2025-04-26 23:20:27,098 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:20:27,140 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 23:20:27,142 - INFO - Found 0 emails in thread
2025-04-26 23:20:28,815 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:20:28,816 - INFO - Parsed delivery date: None
2025-04-26 23:20:28,816 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:20:28,867 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 23:20:28,870 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:20:28,871 - ERROR - Error sending message to MCP server: [Errno 32] Broken pipe
2025-04-26 23:20:28,871 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 23:20:29,307 - INFO - Is vendor: True
2025-04-26 23:20:31,964 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:20:31,965 - INFO - Generated email type: order confirmation
2025-04-26 23:20:31,965 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:20:32,002 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 23:20:32,004 - INFO - Found 1 emails in thread
2025-04-26 23:20:32,897 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:20:32,898 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 23:20:32,898 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:20:32,932 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 23:20:32,932 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:20:32,935 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:20:32,935 - INFO - Processed email: 19661ecddae94e49
2025-04-26 23:20:33,216 - INFO - Is vendor: False
2025-04-26 23:20:33,481 - INFO - Is vendor: True
2025-04-26 23:20:35,854 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:20:35,855 - INFO - Generated email type: delivery delay
2025-04-26 23:20:35,855 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:20:35,899 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 23:20:35,899 - INFO - Found 2 emails in thread
2025-04-26 23:20:36,743 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:20:36,745 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 23:20:36,745 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:20:36,793 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 23:20:36,794 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:20:36,795 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:20:36,796 - INFO - Processed email: 196675e9f37b6406
2025-04-26 23:20:37,069 - INFO - Is vendor: True
2025-04-26 23:20:40,562 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:20:40,564 - INFO - Generated email type: delivery expedite
2025-04-26 23:20:40,564 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:20:40,603 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at "HTTP/1.1 200 OK"
2025-04-26 23:20:40,604 - INFO - Found 3 emails in thread
2025-04-26 23:20:41,416 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:20:41,417 - INFO - Parsed delivery date: 2025-05-04
2025-04-26 23:20:41,418 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:20:41,468 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/1.1 201 Created"
2025-04-26 23:20:41,469 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:20:41,471 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:20:41,471 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 23:20:41,471 - INFO - GmailWatcher initialized
2025-04-26 23:22:18,767 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x11498d3a0>
2025-04-26 23:23:05,483 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:23:05,484 - INFO - Loaded 3 vendor emails: ['yeonip7913@gmail.com', 'ddd7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 23:23:05,486 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 23:23:05,669 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 23:23:05,718 - INFO - Supabase client initialized successfully
2025-04-26 23:23:06,282 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/bucket/attachments-from-vendor "HTTP/2 400 Bad Request"
2025-04-26 23:23:06,351 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/bucket "HTTP/2 400 Bad Request"
2025-04-26 23:23:06,352 - ERROR - Failed to initialize Supabase client: {'statusCode': 403, 'error': Unauthorized, 'message': new row violates row-level security policy}
2025-04-26 23:23:06,352 - ERROR - Error type: StorageApiError
2025-04-26 23:23:06,352 - ERROR - Error in main: {'statusCode': 403, 'error': Unauthorized, 'message': new row violates row-level security policy}
2025-04-26 23:23:34,574 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:23:34,574 - INFO - Loaded 3 vendor emails: ['yeonip7913@gmail.com', 'jiyeon@shiftsai.com', 'ddd7913@gmail.com']
2025-04-26 23:23:34,576 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 23:23:34,746 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 23:23:34,795 - INFO - Supabase client initialized successfully
2025-04-26 23:23:34,796 - INFO - Searching emails with query: after:2025/03/27
2025-04-26 23:23:52,079 - INFO - Is vendor: False
2025-04-26 23:23:52,386 - INFO - Is vendor: False
2025-04-26 23:23:52,771 - INFO - Is vendor: False
2025-04-26 23:23:53,181 - INFO - Is vendor: False
2025-04-26 23:23:53,494 - INFO - Is vendor: False
2025-04-26 23:23:53,806 - INFO - Is vendor: False
2025-04-26 23:23:54,205 - INFO - Is vendor: False
2025-04-26 23:23:54,615 - INFO - Is vendor: False
2025-04-26 23:23:55,024 - INFO - Is vendor: False
2025-04-26 23:23:55,433 - INFO - Is vendor: False
2025-04-26 23:23:55,843 - INFO - Is vendor: False
2025-04-26 23:23:56,253 - INFO - Is vendor: False
2025-04-26 23:23:56,662 - INFO - Is vendor: False
2025-04-26 23:23:57,482 - INFO - Is vendor: False
2025-04-26 23:23:57,891 - INFO - Is vendor: False
2025-04-26 23:23:58,607 - INFO - Is vendor: False
2025-04-26 23:23:59,308 - INFO - Is vendor: False
2025-04-26 23:23:59,632 - INFO - Is vendor: False
2025-04-26 23:24:00,042 - INFO - Is vendor: False
2025-04-26 23:24:00,759 - INFO - Is vendor: False
2025-04-26 23:24:01,168 - INFO - Is vendor: False
2025-04-26 23:24:01,475 - INFO - Is vendor: False
2025-04-26 23:24:01,886 - INFO - Is vendor: True
2025-04-26 23:24:04,404 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:24:04,428 - INFO - Generated email type: request submission
2025-04-26 23:24:04,969 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/object/attachments-from-vendor/attachments/None "HTTP/2 400 Bad Request"
2025-04-26 23:24:04,969 - ERROR - Error downloading attachment: {'statusCode': 403, 'error': Unauthorized, 'message': new row violates row-level security policy}
2025-04-26 23:24:04,970 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 23:24:05,088 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:24:05,092 - INFO - Found 1 emails in thread
2025-04-26 23:24:05,670 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:24:05,671 - INFO - Parsed delivery date: None
2025-04-26 23:24:05,671 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 23:24:05,727 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:24:05,728 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 23:24:05,732 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 23:24:05,733 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 23:24:06,444 - INFO - Is vendor: True
2025-04-26 23:24:08,236 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:24:08,237 - INFO - Generated email type: purchase request
2025-04-26 23:24:08,657 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/object/attachments-from-vendor/attachments/None "HTTP/2 400 Bad Request"
2025-04-26 23:24:08,657 - ERROR - Error downloading attachment: {'statusCode': 403, 'error': Unauthorized, 'message': new row violates row-level security policy}
2025-04-26 23:24:08,657 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 23:24:08,731 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:24:08,733 - INFO - Found 1 emails in thread
2025-04-26 23:24:09,465 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:24:09,465 - INFO - Parsed delivery date: None
2025-04-26 23:24:09,465 - INFO - Attempting to save email log: purchase request
2025-04-26 23:24:09,555 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:24:09,556 - INFO - Email saved successfully: purchase request
2025-04-26 23:24:09,559 - INFO - Message sent to MCP server: purchase request
2025-04-26 23:24:09,560 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 23:24:09,872 - INFO - Is vendor: False
2025-04-26 23:24:10,282 - INFO - Is vendor: False
2025-04-26 23:24:10,589 - INFO - Is vendor: True
2025-04-26 23:24:12,561 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:24:12,563 - INFO - Generated email type: order confirmation
2025-04-26 23:24:13,086 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/object/attachments-from-vendor/attachments/None "HTTP/2 400 Bad Request"
2025-04-26 23:24:13,087 - ERROR - Error downloading attachment: {'statusCode': 403, 'error': Unauthorized, 'message': new row violates row-level security policy}
2025-04-26 23:24:13,087 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:24:13,152 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:24:13,153 - INFO - Found 4 emails in thread
2025-04-26 23:24:13,868 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:24:13,869 - INFO - Parsed delivery date: None
2025-04-26 23:24:13,869 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:24:13,921 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:24:13,922 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:24:13,924 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:24:13,925 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 23:24:14,276 - INFO - Is vendor: True
2025-04-26 23:24:16,836 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:24:16,836 - INFO - Generated email type: order confirmation
2025-04-26 23:24:16,836 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:24:16,886 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:24:16,887 - INFO - Found 5 emails in thread
2025-04-26 23:24:17,723 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:24:17,723 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 23:24:17,723 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:24:17,771 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:24:17,772 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:24:17,774 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:24:17,774 - INFO - Processed email: 19661ecddae94e49
2025-04-26 23:24:18,576 - INFO - Is vendor: False
2025-04-26 23:24:18,986 - INFO - Is vendor: True
2025-04-26 23:24:21,648 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:24:21,649 - INFO - Generated email type: delivery delay
2025-04-26 23:24:21,649 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:24:21,699 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:24:21,700 - INFO - Found 6 emails in thread
2025-04-26 23:24:22,674 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:24:22,675 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 23:24:22,675 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:24:22,720 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:24:22,720 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:24:22,722 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:24:22,722 - INFO - Processed email: 196675e9f37b6406
2025-04-26 23:24:23,082 - INFO - Is vendor: True
2025-04-26 23:24:25,336 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:24:25,336 - INFO - Generated email type: delivery expedite
2025-04-26 23:24:25,336 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:24:25,381 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:24:25,382 - INFO - Found 7 emails in thread
2025-04-26 23:24:26,256 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:24:26,257 - INFO - Parsed delivery date: 2025-05-04
2025-04-26 23:24:26,257 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:24:26,330 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:24:26,331 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:24:26,332 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:24:26,332 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 23:24:26,333 - INFO - GmailWatcher initialized
2025-04-26 23:39:06,495 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:39:06,495 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 23:39:06,497 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 23:39:06,669 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 23:39:06,716 - INFO - Supabase client initialized successfully
2025-04-26 23:39:06,717 - INFO - Searching emails with query: after:2025/03/27
2025-04-26 23:39:17,356 - INFO - Is vendor: False
2025-04-26 23:39:17,636 - INFO - Is vendor: False
2025-04-26 23:39:17,967 - INFO - Is vendor: False
2025-04-26 23:39:18,275 - INFO - Is vendor: False
2025-04-26 23:39:18,581 - INFO - Is vendor: False
2025-04-26 23:39:18,889 - INFO - Is vendor: False
2025-04-26 23:39:19,175 - INFO - Is vendor: False
2025-04-26 23:39:19,503 - INFO - Is vendor: False
2025-04-26 23:39:19,913 - INFO - Is vendor: False
2025-04-26 23:39:20,324 - INFO - Is vendor: False
2025-04-26 23:39:20,622 - INFO - Is vendor: False
2025-04-26 23:39:20,936 - INFO - Is vendor: False
2025-04-26 23:39:21,222 - INFO - Is vendor: False
2025-04-26 23:39:21,504 - INFO - Is vendor: False
2025-04-26 23:39:21,788 - INFO - Is vendor: False
2025-04-26 23:39:22,165 - INFO - Is vendor: False
2025-04-26 23:39:22,472 - INFO - Is vendor: False
2025-04-26 23:39:22,779 - INFO - Is vendor: False
2025-04-26 23:39:23,086 - INFO - Is vendor: False
2025-04-26 23:39:23,395 - INFO - Is vendor: False
2025-04-26 23:39:23,703 - INFO - Is vendor: False
2025-04-26 23:39:24,009 - INFO - Is vendor: False
2025-04-26 23:39:24,316 - INFO - Is vendor: True
2025-04-26 23:39:28,109 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:39:28,119 - INFO - Generated email type: request submission
2025-04-26 23:39:29,028 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/object/attachments-from-vendor/attachments/None "HTTP/2 200 OK"
2025-04-26 23:39:29,029 - ERROR - Error downloading attachment: 'UploadResponse' object has no attribute 'status_code'
2025-04-26 23:39:29,030 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 23:39:29,181 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:39:29,189 - INFO - Found 0 emails in thread
2025-04-26 23:39:29,948 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:39:29,950 - INFO - Parsed delivery date: None
2025-04-26 23:39:29,950 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 23:39:30,012 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:39:30,012 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 23:39:30,019 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 23:39:30,019 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 23:39:30,360 - INFO - Is vendor: True
2025-04-26 23:39:31,996 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:39:31,997 - INFO - Generated email type: purchase request
2025-04-26 23:39:32,374 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/object/attachments-from-vendor/attachments/None "HTTP/2 400 Bad Request"
2025-04-26 23:39:32,375 - ERROR - Error downloading attachment: {'statusCode': 409, 'error': Duplicate, 'message': The resource already exists}
2025-04-26 23:39:32,376 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 23:39:32,425 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:39:32,428 - INFO - Found 0 emails in thread
2025-04-26 23:39:33,533 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:39:33,534 - INFO - Parsed delivery date: None
2025-04-26 23:39:33,534 - INFO - Attempting to save email log: purchase request
2025-04-26 23:39:33,590 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:39:33,590 - INFO - Email saved successfully: purchase request
2025-04-26 23:39:33,592 - INFO - Message sent to MCP server: purchase request
2025-04-26 23:39:33,592 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 23:39:33,941 - INFO - Is vendor: False
2025-04-26 23:39:34,222 - INFO - Is vendor: False
2025-04-26 23:39:34,556 - INFO - Is vendor: True
2025-04-26 23:39:38,346 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:39:38,348 - INFO - Generated email type: order confirmation
2025-04-26 23:39:38,860 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/object/attachments-from-vendor/attachments/None "HTTP/2 400 Bad Request"
2025-04-26 23:39:38,860 - ERROR - Error downloading attachment: {'statusCode': 409, 'error': Duplicate, 'message': The resource already exists}
2025-04-26 23:39:38,860 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:39:38,939 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:39:38,942 - INFO - Found 0 emails in thread
2025-04-26 23:39:39,677 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:39:39,678 - INFO - Parsed delivery date: None
2025-04-26 23:39:39,678 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:39:39,733 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:39:39,734 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:39:39,734 - ERROR - Error sending message to MCP server: Server disconnected
2025-04-26 23:39:39,734 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 23:39:40,095 - INFO - Is vendor: True
2025-04-26 23:39:43,158 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:39:43,159 - INFO - Generated email type: order confirmation
2025-04-26 23:39:43,159 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:39:43,214 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:39:43,216 - INFO - Found 1 emails in thread
2025-04-26 23:39:44,356 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:39:44,360 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 23:39:44,360 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:39:44,399 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:39:44,400 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:39:44,403 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:39:44,403 - INFO - Processed email: 19661ecddae94e49
2025-04-26 23:39:44,695 - INFO - Is vendor: False
2025-04-26 23:39:45,001 - INFO - Is vendor: True
2025-04-26 23:39:48,074 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:39:48,076 - INFO - Generated email type: delivery delay
2025-04-26 23:39:48,076 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:39:48,126 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:39:48,128 - INFO - Found 2 emails in thread
2025-04-26 23:39:49,097 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:39:49,099 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 23:39:49,099 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:39:49,137 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:39:49,139 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:39:49,141 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:39:49,141 - INFO - Processed email: 196675e9f37b6406
2025-04-26 23:39:49,506 - INFO - Is vendor: True
2025-04-26 23:39:51,965 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:39:51,966 - INFO - Generated email type: delivery expedite
2025-04-26 23:39:51,966 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:39:52,006 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:39:52,008 - INFO - Found 3 emails in thread
2025-04-26 23:39:53,296 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:39:53,298 - INFO - Parsed delivery date: 2025-05-04
2025-04-26 23:39:53,298 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:39:53,358 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:39:53,360 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:39:53,363 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:39:53,363 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 23:39:53,363 - INFO - GmailWatcher initialized
2025-04-26 23:42:27,021 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x107fded50>
2025-04-26 23:43:15,672 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x10c5b2b70>
2025-04-26 23:43:20,318 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:43:20,319 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 23:43:20,320 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 23:43:20,496 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 23:43:20,541 - INFO - Supabase client initialized successfully
2025-04-26 23:43:20,542 - INFO - Searching emails with query: after:2025/03/27
2025-04-26 23:43:34,176 - INFO - Is vendor: False
2025-04-26 23:43:34,587 - INFO - Is vendor: False
2025-04-26 23:43:34,996 - INFO - Is vendor: False
2025-04-26 23:43:35,508 - INFO - Is vendor: False
2025-04-26 23:43:37,557 - INFO - Is vendor: False
2025-04-26 23:43:37,965 - INFO - Is vendor: False
2025-04-26 23:43:38,377 - INFO - Is vendor: False
2025-04-26 23:43:38,785 - INFO - Is vendor: False
2025-04-26 23:43:39,196 - INFO - Is vendor: False
2025-04-26 23:43:39,604 - INFO - Is vendor: False
2025-04-26 23:43:39,911 - INFO - Is vendor: False
2025-04-26 23:43:40,321 - INFO - Is vendor: False
2025-04-26 23:43:40,730 - INFO - Is vendor: False
2025-04-26 23:43:41,038 - INFO - Is vendor: False
2025-04-26 23:43:41,349 - INFO - Is vendor: False
2025-04-26 23:43:41,755 - INFO - Is vendor: False
2025-04-26 23:43:42,061 - INFO - Is vendor: False
2025-04-26 23:43:42,369 - INFO - Is vendor: False
2025-04-26 23:43:42,676 - INFO - Is vendor: False
2025-04-26 23:43:43,086 - INFO - Is vendor: False
2025-04-26 23:43:43,385 - INFO - Is vendor: False
2025-04-26 23:43:43,700 - INFO - Is vendor: False
2025-04-26 23:43:44,110 - INFO - Is vendor: True
2025-04-26 23:43:46,263 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:43:46,269 - INFO - Generated email type: document submission
2025-04-26 23:43:46,672 - ERROR - Error uploading file to Supabase Storage: Header value must be str or bytes, not <class 'bool'>
2025-04-26 23:43:46,673 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 23:43:47,797 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:43:47,802 - INFO - Found 1 emails in thread
2025-04-26 23:43:48,617 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:43:48,618 - INFO - Parsed delivery date: None
2025-04-26 23:43:48,618 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 23:43:48,676 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:43:48,677 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 23:43:48,680 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 23:43:48,680 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 23:43:49,025 - INFO - Is vendor: True
2025-04-26 23:43:50,824 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:43:50,827 - INFO - Generated email type: purchase request
2025-04-26 23:43:51,179 - ERROR - Error uploading file to Supabase Storage: Header value must be str or bytes, not <class 'bool'>
2025-04-26 23:43:51,179 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 23:43:51,228 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:43:51,230 - INFO - Found 1 emails in thread
2025-04-26 23:43:51,996 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:43:51,997 - INFO - Parsed delivery date: None
2025-04-26 23:43:51,997 - INFO - Attempting to save email log: purchase request
2025-04-26 23:43:52,032 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:43:52,033 - INFO - Email saved successfully: purchase request
2025-04-26 23:43:52,086 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x11b6ba780>
2025-04-26 23:44:17,020 - DEBUG - Using selector: KqueueSelector
2025-04-26 23:44:17,020 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:44:17,020 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'yeonip7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 23:44:17,021 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 23:44:17,188 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 23:44:17,234 - INFO - Supabase client initialized successfully
2025-04-26 23:44:17,234 - INFO - Searching emails with query: after:2025/03/27
2025-04-26 23:44:17,236 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages?labelIds=INBOX&q=after%3A2025%2F03%2F27&maxResults=100&alt=json
2025-04-26 23:44:18,109 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages?labelIds=SENT&q=after%3A2025%2F03%2F27&maxResults=100&alt=json
2025-04-26 23:44:18,416 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/196675e9f37b6406?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:18,723 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/196651cd71e2d02d?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:19,030 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19661ecddae94e49?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:19,747 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965fe7da333da4b?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:20,055 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965eb11dccf8919?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:20,363 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ffd06abe66?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:20,669 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ccd4a098a9?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:20,976 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965d801cc9d1b08?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:21,257 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965aa8b3b388a9e?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:21,537 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19658577debe3a64?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:21,810 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965599e9295c5bf?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:22,102 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19649b9a7d379bdd?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:22,376 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19649b979fd40216?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:22,716 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1964785213e795c7?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:23,025 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19645ee513d6bff6?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:23,331 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1964461589df2bf2?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:23,638 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19640c539745c984?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:23,946 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1963cf041b5ffa98?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:24,662 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1963ceb01203537b?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:25,379 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19634eda2b58f9c0?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:25,687 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19623e431247bcda?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:25,994 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19621e0e7c0c4047?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:26,301 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195e8f69e3a9b1cb?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:26,608 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195e4ea41453cb70?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:26,915 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195dd623e7ba2b53?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:27,222 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195daeae90f76840?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:27,531 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195daeae518fecdd?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:27,837 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195d671ec15ec846?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:28,144 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19667636e36ec3ed?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:28,452 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19661e7fd594a8a4?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:28,759 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1964825ab5c28d35?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:29,065 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195d671ec15ec846?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:29,372 - INFO - Is vendor: False
2025-04-26 23:44:29,374 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195daeae518fecdd?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:29,679 - INFO - Is vendor: False
2025-04-26 23:44:29,680 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195daeae90f76840?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:29,986 - INFO - Is vendor: False
2025-04-26 23:44:29,987 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195dd623e7ba2b53?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:30,293 - INFO - Is vendor: False
2025-04-26 23:44:30,295 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195e4ea41453cb70?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:30,602 - INFO - Is vendor: False
2025-04-26 23:44:30,603 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195e8f69e3a9b1cb?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:30,908 - INFO - Is vendor: False
2025-04-26 23:44:30,909 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19621e0e7c0c4047?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:31,215 - INFO - Is vendor: False
2025-04-26 23:44:31,216 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19623e431247bcda?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:31,522 - INFO - Is vendor: False
2025-04-26 23:44:31,523 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19634eda2b58f9c0?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:31,829 - INFO - Is vendor: False
2025-04-26 23:44:31,830 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1963ceb01203537b?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:32,546 - INFO - Is vendor: False
2025-04-26 23:44:32,548 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1963cf041b5ffa98?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:32,853 - INFO - Is vendor: False
2025-04-26 23:44:32,855 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19640c539745c984?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:33,161 - INFO - Is vendor: False
2025-04-26 23:44:33,162 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1964461589df2bf2?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:33,468 - INFO - Is vendor: False
2025-04-26 23:44:33,469 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19645ee513d6bff6?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:33,776 - INFO - Is vendor: False
2025-04-26 23:44:33,777 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1964785213e795c7?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:34,082 - INFO - Is vendor: False
2025-04-26 23:44:34,084 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1964825ab5c28d35?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:34,390 - INFO - Is vendor: False
2025-04-26 23:44:34,391 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19649b979fd40216?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:34,698 - INFO - Is vendor: False
2025-04-26 23:44:34,700 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19649b9a7d379bdd?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:35,012 - INFO - Is vendor: False
2025-04-26 23:44:35,014 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965599e9295c5bf?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:35,311 - INFO - Is vendor: False
2025-04-26 23:44:35,312 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19658577debe3a64?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:35,618 - INFO - Is vendor: False
2025-04-26 23:44:35,619 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965aa8b3b388a9e?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:35,925 - INFO - Is vendor: False
2025-04-26 23:44:35,927 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965d801cc9d1b08?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:36,200 - INFO - Is vendor: False
2025-04-26 23:44:36,201 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ccd4a098a9?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:36,540 - INFO - Is vendor: True
2025-04-26 23:44:36,541 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ccd4a098a9?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:44:36,848 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ccd4a098a9?format=full&alt=json
2025-04-26 23:44:37,158 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a procurement specialist analyzing emails.'}, {'role': 'user', 'content': '\nYou are a procurement specialist assistant.\n\nYour task is to analyze the following email and deliver two outputs:\n\n1. **Summary** (1–3 clear sentences):  \n   Focus specifically on the procurement-related **action** or **request**.  \n   Exclude unnecessary greetings, background stories, or non-actionable information.  \n   Be direct and practical as a procurement professional would expect.\n\n2. **Type** (short 2–3 word category):  \n   Provide a short but clear 2–3 word phrase that best describes the critical **action and purpose** of this email for a procurement specialist.  \n   Avoid vague or generic words. Be specific and professional.\n\nExamples:\n- delivery delay\n- delay confirmation\n- purchase order\n- payment request\n- contract negotiation\n- shipment inquiry\n- invoice issue\n\nPick a phrase that immediately tells a procurement professional what the email is about.\n\n\nFormat your response exactly like this:\n---\nSUMMARY: [your 1–3 sentence summary]  \nTYPE: [your single word]\n---\n\nEmail content:\nHere is my request sheet\r\n\n\n'}], 'model': 'gpt-4-turbo', 'max_tokens': 150, 'temperature': 0.0}}
2025-04-26 23:44:37,184 - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-04-26 23:44:37,185 - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-04-26 23:44:37,210 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x10c447800>
2025-04-26 23:44:37,210 - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x10c33aed0> server_hostname='api.openai.com' timeout=5.0
2025-04-26 23:44:37,221 - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x10c3dbad0>
2025-04-26 23:44:37,221 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-26 23:44:37,222 - DEBUG - send_request_headers.complete
2025-04-26 23:44:37,222 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-26 23:44:37,222 - DEBUG - send_request_body.complete
2025-04-26 23:44:37,222 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-26 23:44:38,487 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 26 Apr 2025 14:44:40 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'jiyeon-4fdfbx'), (b'openai-processing-ms', b'834'), (b'openai-version', b'2020-10-01'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'30000'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'29724'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'552ms'), (b'x-request-id', b'req_0f61de260a849bb34380be0a26df387c'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=wytZKoYrGGAZ3fyKuhaQDTsA0lYC6qrydU12z7O_1Dg-1745678680-1.0.1.1-6zBbYDEMiNGFj3X7Tiyhu6oS_GWGkLmPsIDSv9GGwO0NNulLg4G2JPJOb64f9rNZ_.YQWgyRFFDfNif9sB2hgTj6NRAxdrJIkQEt_C1kfUw; path=/; expires=Sat, 26-Apr-25 15:14:40 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=GSKlyyRyvDHEeR.p9rEV8HGsyx9b9hECSyfd2Y4JNuU-1745678680565-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9366dc020999ea97-ICN'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:44:38,488 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:44:38,488 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-04-26 23:44:38,488 - DEBUG - receive_response_body.complete
2025-04-26 23:44:38,488 - DEBUG - response_closed.started
2025-04-26 23:44:38,488 - DEBUG - response_closed.complete
2025-04-26 23:44:38,488 - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Sat, 26 Apr 2025 14:44:40 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'jiyeon-4fdfbx'), ('openai-processing-ms', '834'), ('openai-version', '2020-10-01'), ('x-ratelimit-limit-requests', '500'), ('x-ratelimit-limit-tokens', '30000'), ('x-ratelimit-remaining-requests', '499'), ('x-ratelimit-remaining-tokens', '29724'), ('x-ratelimit-reset-requests', '120ms'), ('x-ratelimit-reset-tokens', '552ms'), ('x-request-id', 'req_0f61de260a849bb34380be0a26df387c'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=wytZKoYrGGAZ3fyKuhaQDTsA0lYC6qrydU12z7O_1Dg-1745678680-1.0.1.1-6zBbYDEMiNGFj3X7Tiyhu6oS_GWGkLmPsIDSv9GGwO0NNulLg4G2JPJOb64f9rNZ_.YQWgyRFFDfNif9sB2hgTj6NRAxdrJIkQEt_C1kfUw; path=/; expires=Sat, 26-Apr-25 15:14:40 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=GSKlyyRyvDHEeR.p9rEV8HGsyx9b9hECSyfd2Y4JNuU-1745678680565-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '9366dc020999ea97-ICN'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-04-26 23:44:38,488 - DEBUG - request_id: req_0f61de260a849bb34380be0a26df387c
2025-04-26 23:44:38,494 - INFO - Generated email type: document submission
2025-04-26 23:44:38,496 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ccd4a098a9/attachments/ANGjdJ99JnR7G0Eazqnc01iauO_GhNAjMl9ZvW9ClEYzXQ4a_tPqjIB2Cyhte3CNtqIPr15iQnTo38406IGRL43Jx0ZiTGjR_0z7mSYDjTZjVPVUEqpf616cDvnrCxTtJFrCGyrzn1zQ7-QH0cRlr5yK4WM9WVH23DdNK23nCadvf2vbpOojrCSZJQHJJEHhjMKHAnFy4MEPHVro8FX4a-H-KLvNEdsnU72Rg4KIpXhVlkdnEyDlSkhuycVJ6kXSxRKzi-7i9yC6ewMg0jv3RMdStNk4OG16aX_VdWzC5JcVhrkSWTjENjDD0MFKIx22kSO7LxC78tLfr1gLXfyv7KKKyKt8GJy1AFY7iJfLiyag41z5NzXslgW1LciqMFAF5FvUIWj8CX2FUoGoKUgx?alt=json
2025-04-26 23:44:38,897 - ERROR - Error uploading file to Supabase Storage: Header value must be str or bytes, not <class 'bool'>
2025-04-26 23:44:38,898 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 23:44:38,922 - DEBUG - connect_tcp.started host='ujvbinqvvgbzgwqluian.supabase.co' port=443 local_address=None timeout=120 socket_options=None
2025-04-26 23:44:38,931 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x10c3e7a70>
2025-04-26 23:44:38,931 - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x10c3e9450> server_hostname='ujvbinqvvgbzgwqluian.supabase.co' timeout=120
2025-04-26 23:44:38,946 - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x10c3e7bc0>
2025-04-26 23:44:38,946 - DEBUG - send_connection_init.started request=<Request [b'GET']>
2025-04-26 23:44:38,946 - DEBUG - send_connection_init.complete
2025-04-26 23:44:38,946 - DEBUG - send_request_headers.started request=<Request [b'GET']> stream_id=1
2025-04-26 23:44:38,946 - DEBUG - Adding (b':method', b'GET') to the header table, sensitive:False, huffman:True
2025-04-26 23:44:38,947 - DEBUG - Encoding 2 with 7 bits
2025-04-26 23:44:38,947 - DEBUG - Adding (b':authority', b'ujvbinqvvgbzgwqluian.supabase.co') to the header table, sensitive:False, huffman:True
2025-04-26 23:44:38,947 - DEBUG - Encoding 1 with 6 bits
2025-04-26 23:44:38,947 - DEBUG - Encoding 24 with 7 bits
2025-04-26 23:44:38,947 - DEBUG - Adding (b':scheme', b'https') to the header table, sensitive:False, huffman:True
2025-04-26 23:44:38,947 - DEBUG - Encoding 7 with 7 bits
2025-04-26 23:44:38,947 - DEBUG - Adding (b':path', b'/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at.asc') to the header table, sensitive:False, huffman:True
2025-04-26 23:44:38,947 - DEBUG - Encoding 4 with 6 bits
2025-04-26 23:44:38,947 - DEBUG - Encoding 56 with 7 bits
2025-04-26 23:44:38,947 - DEBUG - Adding (b'accept', b'*/*') to the header table, sensitive:False, huffman:True
2025-04-26 23:44:38,947 - DEBUG - Encoding 19 with 6 bits
2025-04-26 23:44:38,947 - DEBUG - Encoding 3 with 7 bits
2025-04-26 23:44:38,947 - DEBUG - Adding (b'accept-encoding', b'gzip, deflate') to the header table, sensitive:False, huffman:True
2025-04-26 23:44:38,947 - DEBUG - Encoding 16 with 7 bits
2025-04-26 23:44:38,947 - DEBUG - Adding (b'user-agent', b'python-httpx/0.28.1') to the header table, sensitive:False, huffman:True
2025-04-26 23:44:38,947 - DEBUG - Encoding 58 with 6 bits
2025-04-26 23:44:38,947 - DEBUG - Encoding 14 with 7 bits
2025-04-26 23:44:38,947 - DEBUG - Adding (b'x-client-info', b'supabase-py/2.15.0') to the header table, sensitive:False, huffman:True
2025-04-26 23:44:38,947 - DEBUG - Encoding 10 with 7 bits
2025-04-26 23:44:38,947 - DEBUG - Encoding 13 with 7 bits
2025-04-26 23:44:38,947 - DEBUG - Adding (b'apikey', b'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:False, huffman:True
2025-04-26 23:44:38,947 - DEBUG - Encoding 5 with 7 bits
2025-04-26 23:44:38,947 - DEBUG - Encoding 166 with 7 bits
2025-04-26 23:44:38,947 - DEBUG - Adding (b'authorization', b'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:True, huffman:True
2025-04-26 23:44:38,947 - DEBUG - Encoding 23 with 4 bits
2025-04-26 23:44:38,947 - DEBUG - Encoding 171 with 7 bits
2025-04-26 23:44:38,947 - DEBUG - Adding (b'accept-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:44:38,947 - DEBUG - Encoding 10 with 7 bits
2025-04-26 23:44:38,947 - DEBUG - Encoding 5 with 7 bits
2025-04-26 23:44:38,947 - DEBUG - Adding (b'content-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:44:38,947 - DEBUG - Encoding 11 with 7 bits
2025-04-26 23:44:38,947 - DEBUG - Encoding 5 with 7 bits
2025-04-26 23:44:38,948 - DEBUG - Encoded header block to b"\x82A\x98\xb7\xa7x\xcdWn\xfd\xe6\x8f\xdc\xde;Qi\x87R\xe8\xb6\xb1\xc64\x15r\x1f\x87D\xb8b\xc2\xa1,w\x0b\x05\xa4f\xa2*\x0f2?\xc4\x16\x82\x910*(~\x13=\x85\x1c\x91\x1aH\x0b\xd9p\xbe\xe3ed\x84\x91\xa1\x81\xf7\x86\xff\xc1\xec\x90\xb6@\x82\xd4\x98\x86\x95\xc6\x82\x7fS\x83\xf9c\xe7\x90z\x8e\xaf\xd2g=KN\x94\xd7\xe5\x80.'\x97\x0f@\x8a\xf2\xb1(1jJ\xc6\xaaS\xff\x8dE\xb5\x8e1\xa0\xabW\xe9\x81.\x16\xd7\x07@\x85\x1df\xea__\xff'/\xac\xb3\xc7\x88\x86\xd4l\xb98{\xc8\x1d&\xc8\x8c\x95ml\x97\xb29\x93\xad\x7f\x9coe}r\xfa\xcbY\x19\xd0mF\xcb\xeeO\xcb\xb3\xf3\xa7\x0f\xbf\xdd\xd9\x11\x92\xac\xb4~\x9b#\x99*\xe3\xdaJr\xd7\x1dXE%2\x18\xb4\xc8\xc99y\x08\xf9a\xb7!\xbc\x18\x94\xbe\x8f\xdd\xd9\x1c\xc9N\x1bc\x13F\xcf{-|\xff6\x1bWL\x0c\xe9\xbf\xb1\xbd;\xe1oU\xfe\x08\xc9O\x16\x89{#\x9a:B-\x17\xf8z\xd3\xd3\xabZ\x7f\x00\xbf\xb768)\xe5'\xefZ(\x0e;\xbaz\xe8\xaa\xefsT\x8f\xcfp\xb7\xe2\xd6\xa7\xdeG\xf4\xed\xc1#6n\xf1\x1f\x08\xff,\xbaQ\xd8[\x14/\xac\xb3\xc7\x88\x86\xd4l\xb98{\xc8\x1d&\xc8\x8c\x95ml\x97\xb29\x93\xad\x7f\x9coe}r\xfa\xcbY\x19\xd0mF\xcb\xeeO\xcb\xb3\xf3\xa7\x0f\xbf\xdd\xd9\x11\x92\xac\xb4~\x9b#\x99*\xe3\xdaJr\xd7\x1dXE%2\x18\xb4\xc8\xc99y\x08\xf9a\xb7!\xbc\x18\x94\xbe\x8f\xdd\xd9\x1c\xc9N\x1bc\x13F\xcf{-|\xff6\x1bWL\x0c\xe9\xbf\xb1\xbd;\xe1oU\xfe\x08\xc9O\x16\x89{#\x9a:B-\x17\xf8z\xd3\xd3\xabZ\x7f\x00\xbf\xb768)\xe5'\xefZ(\x0e;\xbaz\xe8\xaa\xefsT\x8f\xcfp\xb7\xe2\xd6\xa7\xdeG\xf4\xed\xc1#6n\xf1@\x8a\x19\x08Z\xd2\xb5v\x1eSP_\x85\xae\xd8\xe81?@\x8b!\xeaIjJ\xd5\xd8yMA\x7f\x85\xae\xd8\xe81?"
2025-04-26 23:44:38,948 - DEBUG - send_request_headers.complete
2025-04-26 23:44:38,948 - DEBUG - send_request_body.started request=<Request [b'GET']> stream_id=1
2025-04-26 23:44:38,948 - DEBUG - send_request_body.complete
2025-04-26 23:44:38,948 - DEBUG - receive_response_headers.started request=<Request [b'GET']> stream_id=1
2025-04-26 23:44:38,952 - DEBUG - receive_remote_settings.started
2025-04-26 23:44:38,952 - DEBUG - receive_remote_settings.complete return_value=<RemoteSettingsChanged changed_settings:{ChangedSetting(setting=3, original_value=None, new_value=100), ChangedSetting(setting=4, original_value=65535, new_value=65536), ChangedSetting(setting=5, original_value=16384, new_value=16777215)}>
2025-04-26 23:44:39,022 - DEBUG - Decoding b'?\xe1\x1f\x88a\x96\xdc4\xfd(\'\x14\x86\xbb\x14\x10\x04\xda\x81j\xe3M\\h*b\xd1\xbf_\x96\x1du\xd0b\r&=LtA\xea\xfbP\x93\x8e\xc4\x150Z\x99V{^\x84\x02\xc1c\xe7@\x85$\xabX?_\x8f}\x97\x1c\x90\x80$\x85e\xd6D\xf9\x16\xc9{O@\x8a$\xab\x10d\x9c\xab!#M\xa8\x86\xbf\xcfL:2^Z\x83\x9b\xd9\xab]\xb2`\xb4\x8c\xd4EA\xe6G\xf8{$-\x90 \xb5&!\xa5q\xa0\x9f\x08-\x05"`TP\xfc&{\n9"4\x90\x17\xb2\xe1}\xc6\xca\xc9\t#C\x03\xef\r\xffx\xa0\xa4~V\x1c\xc5\x81\x90\xb6\xcb\x80\x00>\xd45D\xa2\xd9\x0b\xba\xd8\xef\x9e\x91\x9a\xa4}\xa9]\x85\xa0\xe3\x93{\x8b\x84\x84-i[\x05D<\x86\xaao@\x8b!\xeaIjJ\xd5\xd8yMA\x7f\x85\xae\xd8\xe81?@\x8dDkL4\x97\xc0\xfd-\xdc\xb6 \xc7\xab\x011@\x8aDkWa\xfa\x14\x89Z\xc2\xcb\x90\xb7\xa7x\xcdWn\xfd\xe6\x8f\xdc\xde;Qi\x87W@\x90\xf2\xb1\x0fRKRVO\xaa\xca\xb1\xebI\x8fR?\x85\xa8\xe8\xa8\xd2\xcb@\x8f\xf2\xb1j\xee\x7fK\r)-5\xa5b\x1e\xda\x93\x011@\x95\xf2\xb1j\xee\x7fK[Z\x13aGJ\xc8-\x9d\xccB\xac\x93R_\x0217v\x87%\x07\xb6Ih\x1d\x85@\x85\x1d\tY\x1d\xc9\x90\x9d\x98?\x9b\x8d4\xcf\xf3\xf6\xa5#\x81\xe7\x1a\x00?'
2025-04-26 23:44:39,022 - DEBUG - Decoded 4096, consumed 3 bytes
2025-04-26 23:44:39,022 - DEBUG - Resizing header table to 4096 from 4096
2025-04-26 23:44:39,022 - DEBUG - Decoded 8, consumed 1 bytes
2025-04-26 23:44:39,022 - DEBUG - Decoded (b':status', b'200'), consumed 1
2025-04-26 23:44:39,022 - DEBUG - Decoded 33, consumed 1 bytes
2025-04-26 23:44:39,022 - DEBUG - Decoded 22, consumed 1 bytes
2025-04-26 23:44:39,022 - DEBUG - Decoded (b'date', b'Sat, 26 Apr 2025 14:44:41 GMT'), total consumed 24 bytes, indexed True
2025-04-26 23:44:39,022 - DEBUG - Decoded 31, consumed 1 bytes
2025-04-26 23:44:39,022 - DEBUG - Decoded 22, consumed 1 bytes
2025-04-26 23:44:39,022 - DEBUG - Decoded (b'content-type', b'application/json; charset=utf-8'), total consumed 24 bytes, indexed True
2025-04-26 23:44:39,022 - DEBUG - Decoded 30, consumed 1 bytes
2025-04-26 23:44:39,022 - DEBUG - Decoded 4, consumed 1 bytes
2025-04-26 23:44:39,022 - DEBUG - Decoded (b'content-range', b'0-1/*'), total consumed 6 bytes, indexed True
2025-04-26 23:44:39,023 - DEBUG - Decoded 5, consumed 1 bytes
2025-04-26 23:44:39,023 - DEBUG - Decoded 15, consumed 1 bytes
2025-04-26 23:44:39,023 - DEBUG - Decoded (b'cf-ray', b'9366dc0cde37329c-ICN'), total consumed 23 bytes, indexed True
2025-04-26 23:44:39,023 - DEBUG - Decoded 10, consumed 1 bytes
2025-04-26 23:44:39,023 - DEBUG - Decoded 6, consumed 1 bytes
2025-04-26 23:44:39,023 - DEBUG - Decoded (b'cf-cache-status', b'DYNAMIC'), total consumed 19 bytes, indexed True
2025-04-26 23:44:39,023 - DEBUG - Decoded 26, consumed 1 bytes
2025-04-26 23:44:39,023 - DEBUG - Decoded 3, consumed 1 bytes
2025-04-26 23:44:39,023 - DEBUG - Decoded (b'content-encoding', b'gzip'), total consumed 5 bytes, indexed True
2025-04-26 23:44:39,023 - DEBUG - Decoded 29, consumed 1 bytes
2025-04-26 23:44:39,023 - DEBUG - Decoded 50, consumed 1 bytes
2025-04-26 23:44:39,023 - DEBUG - Decoded (b'content-location', b'/email_logs?order=sent_at.asc&select=%2A&thread_id=eq.1965e3ccd4a098a9'), total consumed 52 bytes, indexed True
2025-04-26 23:44:39,023 - DEBUG - Decoded 56, consumed 1 bytes
2025-04-26 23:44:39,023 - DEBUG - Decoded 32, consumed 1 bytes
2025-04-26 23:44:39,023 - DEBUG - Decoded (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), total consumed 34 bytes, indexed True
2025-04-26 23:44:39,023 - DEBUG - Decoded 59, consumed 1 bytes
2025-04-26 23:44:39,023 - DEBUG - Decoded 11, consumed 1 bytes
2025-04-26 23:44:39,023 - DEBUG - Decoded (b'vary', b'Accept-Encoding'), total consumed 13 bytes, indexed True
2025-04-26 23:44:39,024 - DEBUG - Decoded 11, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded 5, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded (b'content-profile', b'public'), total consumed 19 bytes, indexed True
2025-04-26 23:44:39,024 - DEBUG - Decoded 13, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded 1, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded (b'sb-gateway-version', <memory at 0x10c400640>), total consumed 17 bytes, indexed True
2025-04-26 23:44:39,024 - DEBUG - Decoded 10, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded 16, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), total consumed 29 bytes, indexed True
2025-04-26 23:44:39,024 - DEBUG - Decoded 16, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded 5, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded (b'x-content-type-options', b'nosniff'), total consumed 24 bytes, indexed True
2025-04-26 23:44:39,024 - DEBUG - Decoded 15, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded 1, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded (b'x-envoy-attempt-count', <memory at 0x10c400400>), total consumed 19 bytes, indexed True
2025-04-26 23:44:39,024 - DEBUG - Decoded 21, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded 2, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded (b'x-envoy-upstream-service-time', <memory at 0x10c401000>), total consumed 26 bytes, indexed True
2025-04-26 23:44:39,024 - DEBUG - Decoded 54, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded 7, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded (b'server', b'cloudflare'), total consumed 9 bytes, indexed True
2025-04-26 23:44:39,024 - DEBUG - Decoded 5, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded 16, consumed 1 bytes
2025-04-26 23:44:39,024 - DEBUG - Decoded (b'alt-svc', b'h3=":443"; ma=86400'), total consumed 24 bytes, indexed True
2025-04-26 23:44:39,024 - DEBUG - receive_response_headers.complete return_value=(200, [(b'date', b'Sat, 26 Apr 2025 14:44:41 GMT'), (b'content-type', b'application/json; charset=utf-8'), (b'content-range', b'0-1/*'), (b'cf-ray', b'9366dc0cde37329c-ICN'), (b'cf-cache-status', b'DYNAMIC'), (b'content-encoding', b'gzip'), (b'content-location', b'/email_logs?order=sent_at.asc&select=%2A&thread_id=eq.1965e3ccd4a098a9'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'vary', b'Accept-Encoding'), (b'content-profile', b'public'), (b'sb-gateway-version', b'1'), (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), (b'x-content-type-options', b'nosniff'), (b'x-envoy-attempt-count', b'1'), (b'x-envoy-upstream-service-time', b'17'), (b'server', b'cloudflare'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:44:39,025 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:44:39,025 - DEBUG - receive_response_body.started request=<Request [b'GET']> stream_id=1
2025-04-26 23:44:39,025 - DEBUG - receive_response_body.complete
2025-04-26 23:44:39,025 - DEBUG - response_closed.started stream_id=1
2025-04-26 23:44:39,025 - DEBUG - response_closed.complete
2025-04-26 23:44:39,028 - INFO - Found 2 emails in thread
2025-04-26 23:44:39,028 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a procurement expert. Your task is to find the LATEST delivery date mentioned in the document. Return ONLY the date in YYYY-MM-DD format, with no additional text or explanation.'}, {'role': 'user', 'content': '\nYou are a procurement expert. Analyze the email body and attachments to find the latest delivery date.\n\nYou must carefully read both the email content and the attachment texts to extract the most accurate **delivery date**, also known as "requested delivery date", "expected delivery date", "delivery by", or similar expressions.\n\nThe delivery date may be explicitly stated (e.g., "delivery date: 2025-04-30") or implied using relative expressions (e.g., "delayed by 2 days", "delivery next Friday").\n\nUse the following rules carefully:\n\nRules for Choosing the Delivery Date:\n1. If multiple delivery dates are mentioned, ALWAYS choose the LATEST one.\n2. If a delivery date change is described (e.g., "delivery moved from April 24 to April 30", "delayed by a week"), ALWAYS use the NEW (updated) delivery date.\n3. If a clear explicit date is written, use it ONLY IF there is no later delivery update.\n4. Even if an explicit (clearly written) delivery date exists, if a LATER delay or reschedule is mentioned (even indirectly), calculate and use the NEW latest delivery date instead.\n5. When calculating a delivery date from a **relative expression** (e.g., "2 days later", "delayed by one week", "next Friday"):\n    - Prefer using the **reference_date** (most recent scheduled delivery date) as the base.\n    - If no valid reference_date is available, use the **received_date** (email sent/received date) as the base.\n6. If no valid delivery date can be determined, return only the word **"Null"** (case-sensitive).\n7. Final output must be ONLY a date in **YYYY-MM-DD** format, without any other text.\n\nExamples:\n- "Original delivery was 2025-04-24, changed to 2025-04-30" → **2025-04-30**\n- "First batch delivery on 2025-04-24, second batch on 2025-04-30" → **2025-04-30**\n- "Shipment delayed by 2 days" (reference_date = 2025-04-26) → **2025-04-28**\n- "Delivery next Friday" (received_date = 2025-04-26) → **2025-05-02**\n- "Delivery date: 2025-04-26", but later mentions "delayed by 5 days" → **2025-05-01** (even though explicit 4/26 exists, the latest update matters)\n\nContext information:\n- Sent date (received_date): None\n- Reference delivery date (reference_date): None\n\nEmail content:\nHere is my request sheet\r\n\n\nAttachment content:\n\n\nFinal answer (Only one date or "Null"):\n'}], 'model': 'gpt-4-turbo', 'max_tokens': 100, 'temperature': 0.0}}
2025-04-26 23:44:39,029 - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-04-26 23:44:39,029 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-26 23:44:39,029 - DEBUG - send_request_headers.complete
2025-04-26 23:44:39,029 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-26 23:44:39,030 - DEBUG - send_request_body.complete
2025-04-26 23:44:39,030 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-26 23:44:39,379 - DEBUG - receive_response_headers.failed exception=KeyboardInterrupt()
2025-04-26 23:44:39,379 - DEBUG - response_closed.started
2025-04-26 23:44:39,380 - DEBUG - response_closed.complete
2025-04-26 23:44:55,806 - DEBUG - Using selector: KqueueSelector
2025-04-26 23:44:55,807 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:44:55,807 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'yeonip7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 23:44:55,808 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 23:44:55,975 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 23:44:56,022 - INFO - Supabase client initialized successfully
2025-04-26 23:44:56,023 - INFO - Searching emails with query: after:2025/03/27
2025-04-26 23:44:56,026 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages?labelIds=INBOX&q=after%3A2025%2F03%2F27&maxResults=100&alt=json
2025-04-26 23:44:56,612 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages?labelIds=SENT&q=after%3A2025%2F03%2F27&maxResults=100&alt=json
2025-04-26 23:44:57,022 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/196675e9f37b6406?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:57,329 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/196651cd71e2d02d?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:57,738 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19661ecddae94e49?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:58,148 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965fe7da333da4b?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:58,455 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965eb11dccf8919?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:58,865 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ffd06abe66?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:59,172 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ccd4a098a9?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:59,475 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965d801cc9d1b08?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:44:59,786 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965aa8b3b388a9e?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:00,196 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19658577debe3a64?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:00,606 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965599e9295c5bf?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:01,007 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19649b9a7d379bdd?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:01,310 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19649b979fd40216?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:01,630 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1964785213e795c7?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:02,039 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19645ee513d6bff6?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:02,449 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1964461589df2bf2?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:02,756 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19640c539745c984?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:03,063 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1963cf041b5ffa98?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:03,473 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1963ceb01203537b?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:03,781 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19634eda2b58f9c0?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:04,499 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19623e431247bcda?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:04,907 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19621e0e7c0c4047?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:05,318 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195e8f69e3a9b1cb?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:05,624 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195e4ea41453cb70?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:06,033 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195dd623e7ba2b53?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:06,343 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195daeae90f76840?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:06,652 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195daeae518fecdd?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:07,057 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195d671ec15ec846?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:07,364 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19667636e36ec3ed?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:07,774 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19661e7fd594a8a4?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:08,184 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1964825ab5c28d35?format=metadata&metadataHeaders=Date&alt=json
2025-04-26 23:45:08,492 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195d671ec15ec846?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:08,899 - INFO - Is vendor: False
2025-04-26 23:45:08,900 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195daeae518fecdd?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:09,308 - INFO - Is vendor: False
2025-04-26 23:45:09,310 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195daeae90f76840?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:09,718 - INFO - Is vendor: False
2025-04-26 23:45:09,719 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195dd623e7ba2b53?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:10,128 - INFO - Is vendor: False
2025-04-26 23:45:10,129 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195e4ea41453cb70?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:10,539 - INFO - Is vendor: False
2025-04-26 23:45:10,540 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/195e8f69e3a9b1cb?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:10,947 - INFO - Is vendor: False
2025-04-26 23:45:10,948 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19621e0e7c0c4047?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:11,357 - INFO - Is vendor: False
2025-04-26 23:45:11,358 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19623e431247bcda?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:11,663 - INFO - Is vendor: False
2025-04-26 23:45:11,664 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19634eda2b58f9c0?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:12,073 - INFO - Is vendor: False
2025-04-26 23:45:12,075 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1963ceb01203537b?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:12,381 - INFO - Is vendor: False
2025-04-26 23:45:12,382 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1963cf041b5ffa98?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:12,689 - INFO - Is vendor: False
2025-04-26 23:45:12,690 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19640c539745c984?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:13,097 - INFO - Is vendor: False
2025-04-26 23:45:13,099 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1964461589df2bf2?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:13,507 - INFO - Is vendor: False
2025-04-26 23:45:13,509 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19645ee513d6bff6?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:13,917 - INFO - Is vendor: False
2025-04-26 23:45:13,918 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1964785213e795c7?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:14,326 - INFO - Is vendor: False
2025-04-26 23:45:14,328 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1964825ab5c28d35?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:14,639 - INFO - Is vendor: False
2025-04-26 23:45:14,641 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19649b979fd40216?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:15,044 - INFO - Is vendor: False
2025-04-26 23:45:15,046 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19649b9a7d379bdd?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:15,350 - INFO - Is vendor: False
2025-04-26 23:45:15,352 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965599e9295c5bf?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:15,760 - INFO - Is vendor: False
2025-04-26 23:45:15,761 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19658577debe3a64?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:16,170 - INFO - Is vendor: False
2025-04-26 23:45:16,171 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965aa8b3b388a9e?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:16,461 - INFO - Is vendor: False
2025-04-26 23:45:16,462 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965d801cc9d1b08?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:16,784 - INFO - Is vendor: False
2025-04-26 23:45:16,785 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ccd4a098a9?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:17,092 - INFO - Is vendor: True
2025-04-26 23:45:17,093 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ccd4a098a9?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:17,502 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ccd4a098a9?format=full&alt=json
2025-04-26 23:45:17,860 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a procurement specialist analyzing emails.'}, {'role': 'user', 'content': '\nYou are a procurement specialist assistant.\n\nYour task is to analyze the following email and deliver two outputs:\n\n1. **Summary** (1–3 clear sentences):  \n   Focus specifically on the procurement-related **action** or **request**.  \n   Exclude unnecessary greetings, background stories, or non-actionable information.  \n   Be direct and practical as a procurement professional would expect.\n\n2. **Type** (short 2–3 word category):  \n   Provide a short but clear 2–3 word phrase that best describes the critical **action and purpose** of this email for a procurement specialist.  \n   Avoid vague or generic words. Be specific and professional.\n\nExamples:\n- delivery delay\n- delay confirmation\n- purchase order\n- payment request\n- contract negotiation\n- shipment inquiry\n- invoice issue\n\nPick a phrase that immediately tells a procurement professional what the email is about.\n\n\nFormat your response exactly like this:\n---\nSUMMARY: [your 1–3 sentence summary]  \nTYPE: [your single word]\n---\n\nEmail content:\nHere is my request sheet\r\n\n\n'}], 'model': 'gpt-4-turbo', 'max_tokens': 150, 'temperature': 0.0}}
2025-04-26 23:45:17,884 - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-04-26 23:45:17,885 - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2025-04-26 23:45:17,895 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x108ad50a0>
2025-04-26 23:45:17,895 - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x10a042f50> server_hostname='api.openai.com' timeout=5.0
2025-04-26 23:45:17,905 - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x10a0e6bd0>
2025-04-26 23:45:17,906 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-26 23:45:17,906 - DEBUG - send_request_headers.complete
2025-04-26 23:45:17,906 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-26 23:45:17,906 - DEBUG - send_request_body.complete
2025-04-26 23:45:17,906 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-26 23:45:19,141 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 26 Apr 2025 14:45:21 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'jiyeon-4fdfbx'), (b'openai-processing-ms', b'863'), (b'openai-version', b'2020-10-01'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'30000'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'29724'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'552ms'), (b'x-request-id', b'req_7eb489e9ddb81909d97aaca35f47ffac'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=sMPr7R_i8dPazROzmoLp4E3yjK63Wme2oMEoc7fhRSk-1745678721-1.0.1.1-GC53MeavhXGuIQlUSmrvW_lrkj8gmD1gJKCjhT9Rp7_.FOBRpJ.1Z5YvCM_SUqHj7d2StZVAUAOl.C2cR0kP0dVvUiC9qR312L6HYkovvkE; path=/; expires=Sat, 26-Apr-25 15:15:21 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=VySgk9rzIsH_EGEYb_062pInInLotEsLBsTgIkITetA-1745678721249-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9366dd004b4dd1df-ICN'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:19,142 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:45:19,142 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-04-26 23:45:19,143 - DEBUG - receive_response_body.complete
2025-04-26 23:45:19,143 - DEBUG - response_closed.started
2025-04-26 23:45:19,143 - DEBUG - response_closed.complete
2025-04-26 23:45:19,143 - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Sat, 26 Apr 2025 14:45:21 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'jiyeon-4fdfbx'), ('openai-processing-ms', '863'), ('openai-version', '2020-10-01'), ('x-ratelimit-limit-requests', '500'), ('x-ratelimit-limit-tokens', '30000'), ('x-ratelimit-remaining-requests', '499'), ('x-ratelimit-remaining-tokens', '29724'), ('x-ratelimit-reset-requests', '120ms'), ('x-ratelimit-reset-tokens', '552ms'), ('x-request-id', 'req_7eb489e9ddb81909d97aaca35f47ffac'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=sMPr7R_i8dPazROzmoLp4E3yjK63Wme2oMEoc7fhRSk-1745678721-1.0.1.1-GC53MeavhXGuIQlUSmrvW_lrkj8gmD1gJKCjhT9Rp7_.FOBRpJ.1Z5YvCM_SUqHj7d2StZVAUAOl.C2cR0kP0dVvUiC9qR312L6HYkovvkE; path=/; expires=Sat, 26-Apr-25 15:15:21 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=VySgk9rzIsH_EGEYb_062pInInLotEsLBsTgIkITetA-1745678721249-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '9366dd004b4dd1df-ICN'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-04-26 23:45:19,143 - DEBUG - request_id: req_7eb489e9ddb81909d97aaca35f47ffac
2025-04-26 23:45:19,149 - INFO - Generated email type: document submission
2025-04-26 23:45:19,150 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ccd4a098a9/attachments/ANGjdJ-MLtSdkNHFWC6jArrZaoEcOdoCIq2K7ywisgSrneWGmt5yt4jyAPXutgw1-LQd3vV0r7a3ccggSruqTxsqo2rmX6njtPMWhia-maP3m0q3xxIZErI9x9VNyjkjHNwYupBTwUGWl3FCdb5Qev2JTFC25pKxqGYzRZW7MD3CVoFBg1bspIhjmEXWJ-3m56PlayyJ9M396DaKywsC9Zq9SQ-vvS-qO8VT-FpYkbF4o7QyaAyvzSEpJ5sLJ4xFW_Mf5aZeQdIBK2qdOEpycWyDdfehHIV9lM1PZQ8WLLokSdPGJegl68MlMGk80_Avg4X7zCB4Lwieo6o5nkX-WKOdV2gBIVBkJAD0sgZ2V5-yidJFi55ImpwW6SaDxojxxQ3vVMz16CsCWjonWdCx?alt=json
2025-04-26 23:45:19,550 - ERROR - Error uploading file to Supabase Storage: Header value must be str or bytes, not <class 'bool'>
2025-04-26 23:45:19,551 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 23:45:19,575 - DEBUG - connect_tcp.started host='ujvbinqvvgbzgwqluian.supabase.co' port=443 local_address=None timeout=120 socket_options=None
2025-04-26 23:45:19,585 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x10a1040b0>
2025-04-26 23:45:19,585 - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x10a0f04d0> server_hostname='ujvbinqvvgbzgwqluian.supabase.co' timeout=120
2025-04-26 23:45:19,596 - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x10a107290>
2025-04-26 23:45:19,597 - DEBUG - send_connection_init.started request=<Request [b'GET']>
2025-04-26 23:45:19,597 - DEBUG - send_connection_init.complete
2025-04-26 23:45:19,597 - DEBUG - send_request_headers.started request=<Request [b'GET']> stream_id=1
2025-04-26 23:45:19,597 - DEBUG - Adding (b':method', b'GET') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:19,597 - DEBUG - Encoding 2 with 7 bits
2025-04-26 23:45:19,597 - DEBUG - Adding (b':authority', b'ujvbinqvvgbzgwqluian.supabase.co') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:19,597 - DEBUG - Encoding 1 with 6 bits
2025-04-26 23:45:19,597 - DEBUG - Encoding 24 with 7 bits
2025-04-26 23:45:19,597 - DEBUG - Adding (b':scheme', b'https') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:19,597 - DEBUG - Encoding 7 with 7 bits
2025-04-26 23:45:19,597 - DEBUG - Adding (b':path', b'/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at.asc') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:19,597 - DEBUG - Encoding 4 with 6 bits
2025-04-26 23:45:19,597 - DEBUG - Encoding 56 with 7 bits
2025-04-26 23:45:19,597 - DEBUG - Adding (b'accept', b'*/*') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:19,597 - DEBUG - Encoding 19 with 6 bits
2025-04-26 23:45:19,597 - DEBUG - Encoding 3 with 7 bits
2025-04-26 23:45:19,597 - DEBUG - Adding (b'accept-encoding', b'gzip, deflate') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:19,597 - DEBUG - Encoding 16 with 7 bits
2025-04-26 23:45:19,597 - DEBUG - Adding (b'user-agent', b'python-httpx/0.28.1') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:19,597 - DEBUG - Encoding 58 with 6 bits
2025-04-26 23:45:19,597 - DEBUG - Encoding 14 with 7 bits
2025-04-26 23:45:19,597 - DEBUG - Adding (b'x-client-info', b'supabase-py/2.15.0') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:19,598 - DEBUG - Encoding 10 with 7 bits
2025-04-26 23:45:19,598 - DEBUG - Encoding 13 with 7 bits
2025-04-26 23:45:19,598 - DEBUG - Adding (b'apikey', b'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:19,598 - DEBUG - Encoding 5 with 7 bits
2025-04-26 23:45:19,598 - DEBUG - Encoding 166 with 7 bits
2025-04-26 23:45:19,598 - DEBUG - Adding (b'authorization', b'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:True, huffman:True
2025-04-26 23:45:19,598 - DEBUG - Encoding 23 with 4 bits
2025-04-26 23:45:19,598 - DEBUG - Encoding 171 with 7 bits
2025-04-26 23:45:19,598 - DEBUG - Adding (b'accept-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:19,598 - DEBUG - Encoding 10 with 7 bits
2025-04-26 23:45:19,598 - DEBUG - Encoding 5 with 7 bits
2025-04-26 23:45:19,598 - DEBUG - Adding (b'content-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:19,598 - DEBUG - Encoding 11 with 7 bits
2025-04-26 23:45:19,598 - DEBUG - Encoding 5 with 7 bits
2025-04-26 23:45:19,598 - DEBUG - Encoded header block to b"\x82A\x98\xb7\xa7x\xcdWn\xfd\xe6\x8f\xdc\xde;Qi\x87R\xe8\xb6\xb1\xc64\x15r\x1f\x87D\xb8b\xc2\xa1,w\x0b\x05\xa4f\xa2*\x0f2?\xc4\x16\x82\x910*(~\x13=\x85\x1c\x91\x1aH\x0b\xd9p\xbe\xe3ed\x84\x91\xa1\x81\xf7\x86\xff\xc1\xec\x90\xb6@\x82\xd4\x98\x86\x95\xc6\x82\x7fS\x83\xf9c\xe7\x90z\x8e\xaf\xd2g=KN\x94\xd7\xe5\x80.'\x97\x0f@\x8a\xf2\xb1(1jJ\xc6\xaaS\xff\x8dE\xb5\x8e1\xa0\xabW\xe9\x81.\x16\xd7\x07@\x85\x1df\xea__\xff'/\xac\xb3\xc7\x88\x86\xd4l\xb98{\xc8\x1d&\xc8\x8c\x95ml\x97\xb29\x93\xad\x7f\x9coe}r\xfa\xcbY\x19\xd0mF\xcb\xeeO\xcb\xb3\xf3\xa7\x0f\xbf\xdd\xd9\x11\x92\xac\xb4~\x9b#\x99*\xe3\xdaJr\xd7\x1dXE%2\x18\xb4\xc8\xc99y\x08\xf9a\xb7!\xbc\x18\x94\xbe\x8f\xdd\xd9\x1c\xc9N\x1bc\x13F\xcf{-|\xff6\x1bWL\x0c\xe9\xbf\xb1\xbd;\xe1oU\xfe\x08\xc9O\x16\x89{#\x9a:B-\x17\xf8z\xd3\xd3\xabZ\x7f\x00\xbf\xb768)\xe5'\xefZ(\x0e;\xbaz\xe8\xaa\xefsT\x8f\xcfp\xb7\xe2\xd6\xa7\xdeG\xf4\xed\xc1#6n\xf1\x1f\x08\xff,\xbaQ\xd8[\x14/\xac\xb3\xc7\x88\x86\xd4l\xb98{\xc8\x1d&\xc8\x8c\x95ml\x97\xb29\x93\xad\x7f\x9coe}r\xfa\xcbY\x19\xd0mF\xcb\xeeO\xcb\xb3\xf3\xa7\x0f\xbf\xdd\xd9\x11\x92\xac\xb4~\x9b#\x99*\xe3\xdaJr\xd7\x1dXE%2\x18\xb4\xc8\xc99y\x08\xf9a\xb7!\xbc\x18\x94\xbe\x8f\xdd\xd9\x1c\xc9N\x1bc\x13F\xcf{-|\xff6\x1bWL\x0c\xe9\xbf\xb1\xbd;\xe1oU\xfe\x08\xc9O\x16\x89{#\x9a:B-\x17\xf8z\xd3\xd3\xabZ\x7f\x00\xbf\xb768)\xe5'\xefZ(\x0e;\xbaz\xe8\xaa\xefsT\x8f\xcfp\xb7\xe2\xd6\xa7\xdeG\xf4\xed\xc1#6n\xf1@\x8a\x19\x08Z\xd2\xb5v\x1eSP_\x85\xae\xd8\xe81?@\x8b!\xeaIjJ\xd5\xd8yMA\x7f\x85\xae\xd8\xe81?"
2025-04-26 23:45:19,598 - DEBUG - send_request_headers.complete
2025-04-26 23:45:19,598 - DEBUG - send_request_body.started request=<Request [b'GET']> stream_id=1
2025-04-26 23:45:19,598 - DEBUG - send_request_body.complete
2025-04-26 23:45:19,598 - DEBUG - receive_response_headers.started request=<Request [b'GET']> stream_id=1
2025-04-26 23:45:19,604 - DEBUG - receive_remote_settings.started
2025-04-26 23:45:19,604 - DEBUG - receive_remote_settings.complete return_value=<RemoteSettingsChanged changed_settings:{ChangedSetting(setting=3, original_value=None, new_value=100), ChangedSetting(setting=4, original_value=65535, new_value=65536), ChangedSetting(setting=5, original_value=16384, new_value=16777215)}>
2025-04-26 23:45:19,666 - DEBUG - Decoding b'?\xe1\x1f\x88a\x96\xdc4\xfd(\'\x14\x86\xbb\x14\x10\x04\xda\x81j\xe3M\xdc\x10T\xc5\xa3\x7f_\x96\x1du\xd0b\r&=LtA\xea\xfbP\x93\x8e\xc4\x150Z\x99V{^\x84\x02\xc1c\xe7@\x85$\xabX?_\x8f}\x97\x1c\x92@\x0c\xb2\x0cR\x06H\xd6\xc9{O@\x8a$\xab\x10d\x9c\xab!#M\xa8\x86\xbf\xcfL:2^Z\x83\x9b\xd9\xab]\xb2`\xb4\x8c\xd4EA\xe6G\xf8{$-\x90 \xb5&!\xa5q\xa0\x9f\x08-\x05"`TP\xfc&{\n9"4\x90\x17\xb2\xe1}\xc6\xca\xc9\t#C\x03\xef\r\xffx\xa0\xa4~V\x1c\xc5\x81\x90\xb6\xcb\x80\x00>\xd45D\xa2\xd9\x0b\xba\xd8\xef\x9e\x91\x9a\xa4}\xa9]\x85\xa0\xe3\x93{\x8b\x84\x84-i[\x05D<\x86\xaao@\x8b!\xeaIjJ\xd5\xd8yMA\x7f\x85\xae\xd8\xe81?@\x8dDkL4\x97\xc0\xfd-\xdc\xb6 \xc7\xab\x011@\x8aDkWa\xfa\x14\x89Z\xc2\xcb\x90\xb7\xa7x\xcdWn\xfd\xe6\x8f\xdc\xde;Qi\x87W@\x90\xf2\xb1\x0fRKRVO\xaa\xca\xb1\xebI\x8fR?\x85\xa8\xe8\xa8\xd2\xcb@\x8f\xf2\xb1j\xee\x7fK\r)-5\xa5b\x1e\xda\x93\x011@\x95\xf2\xb1j\xee\x7fK[Z\x13aGJ\xc8-\x9d\xccB\xac\x93R_\x0219v\x87%\x07\xb6Ih\x1d\x85@\x85\x1d\tY\x1d\xc9\x90\x9d\x98?\x9b\x8d4\xcf\xf3\xf6\xa5#\x81\xe7\x1a\x00?'
2025-04-26 23:45:19,666 - DEBUG - Decoded 4096, consumed 3 bytes
2025-04-26 23:45:19,666 - DEBUG - Resizing header table to 4096 from 4096
2025-04-26 23:45:19,666 - DEBUG - Decoded 8, consumed 1 bytes
2025-04-26 23:45:19,666 - DEBUG - Decoded (b':status', b'200'), consumed 1
2025-04-26 23:45:19,666 - DEBUG - Decoded 33, consumed 1 bytes
2025-04-26 23:45:19,666 - DEBUG - Decoded 22, consumed 1 bytes
2025-04-26 23:45:19,666 - DEBUG - Decoded (b'date', b'Sat, 26 Apr 2025 14:45:21 GMT'), total consumed 24 bytes, indexed True
2025-04-26 23:45:19,666 - DEBUG - Decoded 31, consumed 1 bytes
2025-04-26 23:45:19,666 - DEBUG - Decoded 22, consumed 1 bytes
2025-04-26 23:45:19,666 - DEBUG - Decoded (b'content-type', b'application/json; charset=utf-8'), total consumed 24 bytes, indexed True
2025-04-26 23:45:19,666 - DEBUG - Decoded 30, consumed 1 bytes
2025-04-26 23:45:19,666 - DEBUG - Decoded 4, consumed 1 bytes
2025-04-26 23:45:19,666 - DEBUG - Decoded (b'content-range', b'0-1/*'), total consumed 6 bytes, indexed True
2025-04-26 23:45:19,666 - DEBUG - Decoded 5, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded 15, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded (b'cf-ray', b'9366dd0aeda2d1db-ICN'), total consumed 23 bytes, indexed True
2025-04-26 23:45:19,667 - DEBUG - Decoded 10, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded 6, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded (b'cf-cache-status', b'DYNAMIC'), total consumed 19 bytes, indexed True
2025-04-26 23:45:19,667 - DEBUG - Decoded 26, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded 3, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded (b'content-encoding', b'gzip'), total consumed 5 bytes, indexed True
2025-04-26 23:45:19,667 - DEBUG - Decoded 29, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded 50, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded (b'content-location', b'/email_logs?order=sent_at.asc&select=%2A&thread_id=eq.1965e3ccd4a098a9'), total consumed 52 bytes, indexed True
2025-04-26 23:45:19,667 - DEBUG - Decoded 56, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded 32, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), total consumed 34 bytes, indexed True
2025-04-26 23:45:19,667 - DEBUG - Decoded 59, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded 11, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded (b'vary', b'Accept-Encoding'), total consumed 13 bytes, indexed True
2025-04-26 23:45:19,667 - DEBUG - Decoded 11, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded 5, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded (b'content-profile', b'public'), total consumed 19 bytes, indexed True
2025-04-26 23:45:19,667 - DEBUG - Decoded 13, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded 1, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded (b'sb-gateway-version', <memory at 0x10a108640>), total consumed 17 bytes, indexed True
2025-04-26 23:45:19,667 - DEBUG - Decoded 10, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded 16, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), total consumed 29 bytes, indexed True
2025-04-26 23:45:19,667 - DEBUG - Decoded 16, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded 5, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded (b'x-content-type-options', b'nosniff'), total consumed 24 bytes, indexed True
2025-04-26 23:45:19,667 - DEBUG - Decoded 15, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded 1, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded (b'x-envoy-attempt-count', <memory at 0x10a108400>), total consumed 19 bytes, indexed True
2025-04-26 23:45:19,667 - DEBUG - Decoded 21, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded 2, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded (b'x-envoy-upstream-service-time', <memory at 0x10a109000>), total consumed 26 bytes, indexed True
2025-04-26 23:45:19,667 - DEBUG - Decoded 54, consumed 1 bytes
2025-04-26 23:45:19,667 - DEBUG - Decoded 7, consumed 1 bytes
2025-04-26 23:45:19,668 - DEBUG - Decoded (b'server', b'cloudflare'), total consumed 9 bytes, indexed True
2025-04-26 23:45:19,668 - DEBUG - Decoded 5, consumed 1 bytes
2025-04-26 23:45:19,668 - DEBUG - Decoded 16, consumed 1 bytes
2025-04-26 23:45:19,668 - DEBUG - Decoded (b'alt-svc', b'h3=":443"; ma=86400'), total consumed 24 bytes, indexed True
2025-04-26 23:45:19,668 - DEBUG - receive_response_headers.complete return_value=(200, [(b'date', b'Sat, 26 Apr 2025 14:45:21 GMT'), (b'content-type', b'application/json; charset=utf-8'), (b'content-range', b'0-1/*'), (b'cf-ray', b'9366dd0aeda2d1db-ICN'), (b'cf-cache-status', b'DYNAMIC'), (b'content-encoding', b'gzip'), (b'content-location', b'/email_logs?order=sent_at.asc&select=%2A&thread_id=eq.1965e3ccd4a098a9'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'vary', b'Accept-Encoding'), (b'content-profile', b'public'), (b'sb-gateway-version', b'1'), (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), (b'x-content-type-options', b'nosniff'), (b'x-envoy-attempt-count', b'1'), (b'x-envoy-upstream-service-time', b'19'), (b'server', b'cloudflare'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:19,668 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:45:19,668 - DEBUG - receive_response_body.started request=<Request [b'GET']> stream_id=1
2025-04-26 23:45:19,668 - DEBUG - receive_response_body.complete
2025-04-26 23:45:19,668 - DEBUG - response_closed.started stream_id=1
2025-04-26 23:45:19,668 - DEBUG - response_closed.complete
2025-04-26 23:45:19,671 - INFO - Found 2 emails in thread
2025-04-26 23:45:19,672 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a procurement expert. Your task is to find the LATEST delivery date mentioned in the document. Return ONLY the date in YYYY-MM-DD format, with no additional text or explanation.'}, {'role': 'user', 'content': '\nYou are a procurement expert. Analyze the email body and attachments to find the latest delivery date.\n\nYou must carefully read both the email content and the attachment texts to extract the most accurate **delivery date**, also known as "requested delivery date", "expected delivery date", "delivery by", or similar expressions.\n\nThe delivery date may be explicitly stated (e.g., "delivery date: 2025-04-30") or implied using relative expressions (e.g., "delayed by 2 days", "delivery next Friday").\n\nUse the following rules carefully:\n\nRules for Choosing the Delivery Date:\n1. If multiple delivery dates are mentioned, ALWAYS choose the LATEST one.\n2. If a delivery date change is described (e.g., "delivery moved from April 24 to April 30", "delayed by a week"), ALWAYS use the NEW (updated) delivery date.\n3. If a clear explicit date is written, use it ONLY IF there is no later delivery update.\n4. Even if an explicit (clearly written) delivery date exists, if a LATER delay or reschedule is mentioned (even indirectly), calculate and use the NEW latest delivery date instead.\n5. When calculating a delivery date from a **relative expression** (e.g., "2 days later", "delayed by one week", "next Friday"):\n    - Prefer using the **reference_date** (most recent scheduled delivery date) as the base.\n    - If no valid reference_date is available, use the **received_date** (email sent/received date) as the base.\n6. If no valid delivery date can be determined, return only the word **"Null"** (case-sensitive).\n7. Final output must be ONLY a date in **YYYY-MM-DD** format, without any other text.\n\nExamples:\n- "Original delivery was 2025-04-24, changed to 2025-04-30" → **2025-04-30**\n- "First batch delivery on 2025-04-24, second batch on 2025-04-30" → **2025-04-30**\n- "Shipment delayed by 2 days" (reference_date = 2025-04-26) → **2025-04-28**\n- "Delivery next Friday" (received_date = 2025-04-26) → **2025-05-02**\n- "Delivery date: 2025-04-26", but later mentions "delayed by 5 days" → **2025-05-01** (even though explicit 4/26 exists, the latest update matters)\n\nContext information:\n- Sent date (received_date): None\n- Reference delivery date (reference_date): None\n\nEmail content:\nHere is my request sheet\r\n\n\nAttachment content:\n\n\nFinal answer (Only one date or "Null"):\n'}], 'model': 'gpt-4-turbo', 'max_tokens': 100, 'temperature': 0.0}}
2025-04-26 23:45:19,673 - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-04-26 23:45:19,673 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-26 23:45:19,673 - DEBUG - send_request_headers.complete
2025-04-26 23:45:19,673 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-26 23:45:19,673 - DEBUG - send_request_body.complete
2025-04-26 23:45:19,673 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-26 23:45:20,677 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 26 Apr 2025 14:45:22 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'jiyeon-4fdfbx'), (b'openai-processing-ms', b'617'), (b'openai-version', b'2020-10-01'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'30000'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'29377'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'1.246s'), (b'x-request-id', b'req_2f401e0b1a5173573f1a190ac478236f'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9366dd0b5dc6d1df-ICN'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:20,677 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:45:20,678 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-04-26 23:45:20,678 - DEBUG - receive_response_body.complete
2025-04-26 23:45:20,678 - DEBUG - response_closed.started
2025-04-26 23:45:20,678 - DEBUG - response_closed.complete
2025-04-26 23:45:20,678 - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Sat, 26 Apr 2025 14:45:22 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'jiyeon-4fdfbx', 'openai-processing-ms': '617', 'openai-version': '2020-10-01', 'x-ratelimit-limit-requests': '500', 'x-ratelimit-limit-tokens': '30000', 'x-ratelimit-remaining-requests': '499', 'x-ratelimit-remaining-tokens': '29377', 'x-ratelimit-reset-requests': '120ms', 'x-ratelimit-reset-tokens': '1.246s', 'x-request-id': 'req_2f401e0b1a5173573f1a190ac478236f', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9366dd0b5dc6d1df-ICN', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-04-26 23:45:20,678 - DEBUG - request_id: req_2f401e0b1a5173573f1a190ac478236f
2025-04-26 23:45:20,679 - INFO - Parsed delivery date: None
2025-04-26 23:45:20,679 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 23:45:20,679 - DEBUG - Email log data: {'thread_id': '1965e3ccd4a098a9', 'direction': 'inbound', 'sender_email': 'Jiyeon Park <ddd7913@gmail.com>', 'recipient_email': '"jiyeon@shiftsai.com" <jiyeon@shiftsai.com>', 'subject': '[purchase request]I want to purchase some stuffs', 'sent_at': None, 'created_at': '2025-04-26T14:45:20.679209', 'updated_at': '2025-04-26T14:45:20.679209', 'received_at': 'Wed, 23 Apr 2025 01:02:31 +0900', 'draft_body': None, 'status': 'received', 'email_type': 'document submission', 'has_attachment': True, 'filename': 'test_po.pdf', 'attachment_types': ['application/pdf'], 'summary': 'The sender has provided a request sheet, likely containing details or requirements for procurement-related actions.', 'sender_role': 'vendor', 'parsed_delivery_date': None, 'trigger_reason': None, 'body': 'Here is my request sheet\r\n'}
2025-04-26 23:45:20,679 - DEBUG - send_request_headers.started request=<Request [b'POST']> stream_id=3
2025-04-26 23:45:20,679 - DEBUG - Adding (b':method', b'POST') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:20,679 - DEBUG - Encoding 3 with 7 bits
2025-04-26 23:45:20,679 - DEBUG - Adding (b':authority', b'ujvbinqvvgbzgwqluian.supabase.co') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:20,679 - DEBUG - Encoding 69 with 7 bits
2025-04-26 23:45:20,680 - DEBUG - Adding (b':scheme', b'https') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:20,680 - DEBUG - Encoding 7 with 7 bits
2025-04-26 23:45:20,680 - DEBUG - Adding (b':path', b'/rest/v1/email_logs') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:20,680 - DEBUG - Encoding 4 with 6 bits
2025-04-26 23:45:20,680 - DEBUG - Encoding 14 with 7 bits
2025-04-26 23:45:20,680 - DEBUG - Adding (b'accept', b'*/*') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:20,680 - DEBUG - Encoding 68 with 7 bits
2025-04-26 23:45:20,680 - DEBUG - Adding (b'accept-encoding', b'gzip, deflate') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:20,680 - DEBUG - Encoding 16 with 7 bits
2025-04-26 23:45:20,680 - DEBUG - Adding (b'user-agent', b'python-httpx/0.28.1') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:20,680 - DEBUG - Encoding 67 with 7 bits
2025-04-26 23:45:20,680 - DEBUG - Adding (b'x-client-info', b'supabase-py/2.15.0') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:20,680 - DEBUG - Encoding 66 with 7 bits
2025-04-26 23:45:20,680 - DEBUG - Adding (b'apikey', b'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:20,680 - DEBUG - Encoding 65 with 7 bits
2025-04-26 23:45:20,680 - DEBUG - Adding (b'authorization', b'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:True, huffman:True
2025-04-26 23:45:20,680 - DEBUG - Encoding 23 with 4 bits
2025-04-26 23:45:20,680 - DEBUG - Encoding 171 with 7 bits
2025-04-26 23:45:20,680 - DEBUG - Adding (b'accept-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:20,680 - DEBUG - Encoding 64 with 7 bits
2025-04-26 23:45:20,680 - DEBUG - Adding (b'content-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:20,680 - DEBUG - Encoding 63 with 7 bits
2025-04-26 23:45:20,680 - DEBUG - Adding (b'prefer', b'return=representation') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:20,680 - DEBUG - Encoding 5 with 7 bits
2025-04-26 23:45:20,680 - DEBUG - Encoding 15 with 7 bits
2025-04-26 23:45:20,680 - DEBUG - Adding (b'content-length', b'775') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:20,680 - DEBUG - Encoding 28 with 6 bits
2025-04-26 23:45:20,680 - DEBUG - Encoding 3 with 7 bits
2025-04-26 23:45:20,680 - DEBUG - Adding (b'content-type', b'application/json') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:20,680 - DEBUG - Encoding 31 with 6 bits
2025-04-26 23:45:20,680 - DEBUG - Encoding 11 with 7 bits
2025-04-26 23:45:20,680 - DEBUG - Encoded header block to b"\x83\xc5\x87D\x8eb\xc2\xa1,w\x0b\x05\xa4f\xa2*\x0f2?\xc4\x90\xc3\xc2\xc1\x1f\x08\xff,\xbaQ\xd8[\x14/\xac\xb3\xc7\x88\x86\xd4l\xb98{\xc8\x1d&\xc8\x8c\x95ml\x97\xb29\x93\xad\x7f\x9coe}r\xfa\xcbY\x19\xd0mF\xcb\xeeO\xcb\xb3\xf3\xa7\x0f\xbf\xdd\xd9\x11\x92\xac\xb4~\x9b#\x99*\xe3\xdaJr\xd7\x1dXE%2\x18\xb4\xc8\xc99y\x08\xf9a\xb7!\xbc\x18\x94\xbe\x8f\xdd\xd9\x1c\xc9N\x1bc\x13F\xcf{-|\xff6\x1bWL\x0c\xe9\xbf\xb1\xbd;\xe1oU\xfe\x08\xc9O\x16\x89{#\x9a:B-\x17\xf8z\xd3\xd3\xabZ\x7f\x00\xbf\xb768)\xe5'\xefZ(\x0e;\xbaz\xe8\xaa\xefsT\x8f\xcfp\xb7\xe2\xd6\xa7\xdeG\xf4\xed\xc1#6n\xf1\xc0\xbf@\x85\xae\xc2\xca[?\x8f\xb0\xa9\xb6\xca\xa0\xb0\xb5\xd8T\x16\xa4\x8d&=_\\\x83u\xd6\xff_\x8b\x1du\xd0b\r&=LtA\xea"
2025-04-26 23:45:20,681 - DEBUG - send_request_headers.complete
2025-04-26 23:45:20,681 - DEBUG - send_request_body.started request=<Request [b'POST']> stream_id=3
2025-04-26 23:45:20,681 - DEBUG - send_request_body.complete
2025-04-26 23:45:20,681 - DEBUG - receive_response_headers.started request=<Request [b'POST']> stream_id=3
2025-04-26 23:45:20,753 - DEBUG - Decoding b"N\x82\x10\x03a\x96\xdc4\xfd('\x14\x86\xbb\x14\x10\x04\xda\x81j\xe3M\xdc\x10\x94\xc5\xa3\x7f\xcf^\x03*/*\x7f\x0f\x8f}\x97\x1c\x92@\x84o\r\xa9\x03$kd\xbd\xa7\xce\xcd\xcb\xca\xc9@\x8d\xae\xc2\xca[\x0bQ\n\xb0\xeb\xae\x83\x16O\x8f\xb0\xa9\xb6\xca\xa0\xb0\xb5\xd8T\x16\xa4\x8d&=_\xc9\xc8\xc7\xc6\x7f\x06\x019\xc5\xc4"
2025-04-26 23:45:20,753 - DEBUG - Decoded 14, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded 2, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded (b':status', b'201'), total consumed 4 bytes, indexed True
2025-04-26 23:45:20,753 - DEBUG - Decoded 33, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded 22, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded (b'date', b'Sat, 26 Apr 2025 14:45:22 GMT'), total consumed 24 bytes, indexed True
2025-04-26 23:45:20,753 - DEBUG - Decoded 79, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded (b'content-type', b'application/json; charset=utf-8'), consumed 1
2025-04-26 23:45:20,753 - DEBUG - Decoded 30, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded 3, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded (b'content-range', <memory at 0x10a108dc0>), total consumed 5 bytes, indexed True
2025-04-26 23:45:20,753 - DEBUG - Decoded 78, consumed 2 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded 15, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded (b'cf-ray', b'9366dd11a8a4d1db-ICN'), total consumed 18 bytes, indexed True
2025-04-26 23:45:20,753 - DEBUG - Decoded 78, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded (b'cf-cache-status', b'DYNAMIC'), consumed 1
2025-04-26 23:45:20,753 - DEBUG - Decoded 77, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded (b'content-encoding', b'gzip'), consumed 1
2025-04-26 23:45:20,753 - DEBUG - Decoded 75, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), consumed 1
2025-04-26 23:45:20,753 - DEBUG - Decoded 74, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded (b'vary', b'Accept-Encoding'), consumed 1
2025-04-26 23:45:20,753 - DEBUG - Decoded 73, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded (b'content-profile', b'public'), consumed 1
2025-04-26 23:45:20,753 - DEBUG - Decoded 13, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded 15, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded (b'preference-applied', b'return=representation'), total consumed 31 bytes, indexed True
2025-04-26 23:45:20,753 - DEBUG - Decoded 73, consumed 1 bytes
2025-04-26 23:45:20,753 - DEBUG - Decoded (b'sb-gateway-version', <memory at 0x10a108640>), consumed 1
2025-04-26 23:45:20,754 - DEBUG - Decoded 72, consumed 1 bytes
2025-04-26 23:45:20,754 - DEBUG - Decoded (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), consumed 1
2025-04-26 23:45:20,754 - DEBUG - Decoded 71, consumed 1 bytes
2025-04-26 23:45:20,754 - DEBUG - Decoded (b'x-content-type-options', b'nosniff'), consumed 1
2025-04-26 23:45:20,754 - DEBUG - Decoded 70, consumed 1 bytes
2025-04-26 23:45:20,754 - DEBUG - Decoded (b'x-envoy-attempt-count', <memory at 0x10a108400>), consumed 1
2025-04-26 23:45:20,754 - DEBUG - Decoded 69, consumed 2 bytes
2025-04-26 23:45:20,754 - DEBUG - Decoded 1, consumed 1 bytes
2025-04-26 23:45:20,754 - DEBUG - Decoded (b'x-envoy-upstream-service-time', <memory at 0x10a108700>), total consumed 4 bytes, indexed True
2025-04-26 23:45:20,754 - DEBUG - Decoded 69, consumed 1 bytes
2025-04-26 23:45:20,754 - DEBUG - Decoded (b'server', b'cloudflare'), consumed 1
2025-04-26 23:45:20,754 - DEBUG - Decoded 68, consumed 1 bytes
2025-04-26 23:45:20,754 - DEBUG - Decoded (b'alt-svc', b'h3=":443"; ma=86400'), consumed 1
2025-04-26 23:45:20,754 - DEBUG - receive_response_headers.complete return_value=(201, [(b'date', b'Sat, 26 Apr 2025 14:45:22 GMT'), (b'content-type', b'application/json; charset=utf-8'), (b'content-range', b'*/*'), (b'cf-ray', b'9366dd11a8a4d1db-ICN'), (b'cf-cache-status', b'DYNAMIC'), (b'content-encoding', b'gzip'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'vary', b'Accept-Encoding'), (b'content-profile', b'public'), (b'preference-applied', b'return=representation'), (b'sb-gateway-version', b'1'), (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), (b'x-content-type-options', b'nosniff'), (b'x-envoy-attempt-count', b'1'), (b'x-envoy-upstream-service-time', b'9'), (b'server', b'cloudflare'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:20,754 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:45:20,754 - DEBUG - receive_response_body.started request=<Request [b'POST']> stream_id=3
2025-04-26 23:45:20,754 - DEBUG - receive_response_body.complete
2025-04-26 23:45:20,755 - DEBUG - response_closed.started stream_id=3
2025-04-26 23:45:20,755 - DEBUG - response_closed.complete
2025-04-26 23:45:20,755 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 23:45:20,759 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 23:45:20,759 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 23:45:20,760 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ffd06abe66?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:21,074 - INFO - Is vendor: True
2025-04-26 23:45:21,076 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ffd06abe66?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:21,379 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ffd06abe66?format=full&alt=json
2025-04-26 23:45:21,677 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a procurement specialist analyzing emails.'}, {'role': 'user', 'content': '\nYou are a procurement specialist assistant.\n\nYour task is to analyze the following email and deliver two outputs:\n\n1. **Summary** (1–3 clear sentences):  \n   Focus specifically on the procurement-related **action** or **request**.  \n   Exclude unnecessary greetings, background stories, or non-actionable information.  \n   Be direct and practical as a procurement professional would expect.\n\n2. **Type** (short 2–3 word category):  \n   Provide a short but clear 2–3 word phrase that best describes the critical **action and purpose** of this email for a procurement specialist.  \n   Avoid vague or generic words. Be specific and professional.\n\nExamples:\n- delivery delay\n- delay confirmation\n- purchase order\n- payment request\n- contract negotiation\n- shipment inquiry\n- invoice issue\n\nPick a phrase that immediately tells a procurement professional what the email is about.\n\n\nFormat your response exactly like this:\n---\nSUMMARY: [your 1–3 sentence summary]  \nTYPE: [your single word]\n---\n\nEmail content:\nI want to purchase some stuffs\r\n\n\n'}], 'model': 'gpt-4-turbo', 'max_tokens': 150, 'temperature': 0.0}}
2025-04-26 23:45:21,678 - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-04-26 23:45:21,678 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-26 23:45:21,679 - DEBUG - send_request_headers.complete
2025-04-26 23:45:21,679 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-26 23:45:21,679 - DEBUG - send_request_body.complete
2025-04-26 23:45:21,679 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-26 23:45:22,764 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 26 Apr 2025 14:45:24 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'jiyeon-4fdfbx'), (b'openai-processing-ms', b'728'), (b'openai-version', b'2020-10-01'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'30000'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'29722'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'556ms'), (b'x-request-id', b'req_3438e47a6562b6b4feec635983ff291a'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9366dd17ed99d1df-ICN'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:22,765 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:45:22,765 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-04-26 23:45:22,765 - DEBUG - receive_response_body.complete
2025-04-26 23:45:22,765 - DEBUG - response_closed.started
2025-04-26 23:45:22,765 - DEBUG - response_closed.complete
2025-04-26 23:45:22,765 - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Sat, 26 Apr 2025 14:45:24 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'jiyeon-4fdfbx', 'openai-processing-ms': '728', 'openai-version': '2020-10-01', 'x-ratelimit-limit-requests': '500', 'x-ratelimit-limit-tokens': '30000', 'x-ratelimit-remaining-requests': '499', 'x-ratelimit-remaining-tokens': '29722', 'x-ratelimit-reset-requests': '120ms', 'x-ratelimit-reset-tokens': '556ms', 'x-request-id': 'req_3438e47a6562b6b4feec635983ff291a', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9366dd17ed99d1df-ICN', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-04-26 23:45:22,766 - DEBUG - request_id: req_3438e47a6562b6b4feec635983ff291a
2025-04-26 23:45:22,766 - INFO - Generated email type: purchase request
2025-04-26 23:45:22,767 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965e3ffd06abe66/attachments/ANGjdJ_KEKf_vOavwE58silK1h-t-d9ThFZnLZ6Gvalwg96kHA3d6QeO3FKWO1cntsSGd-yjwRaGZ22zBj5zS4PwfZ_TCX-5-xQ3j-074mjYXcuW0eSTwWH9MOTdsCT-9SnaMFRQzAO4QJ6BzqKTF09TIz72vnjnJ1FJGod6uqxy7oDkDGFoN-IRviIMeO1RYyTL5I_MlNB7LRmkgYZCjyfnYSjwoIx1GsxTPEynwH57X7QfqjsNVgJj2uV6yZnmiBuHgGhUjCoJwGcECYXpz33J_p741sVcHi70wi7KORTGcgOFsKeK3PCI7T1fpUll-RZF30SO1wICDXnDiYfVGkOG8fG34unbXMWoet9Iv_X6ffCdfGD9RqSr73HIPwIJUp_jnKS0pf3lYdz2DrWF?alt=json
2025-04-26 23:45:23,133 - ERROR - Error uploading file to Supabase Storage: Header value must be str or bytes, not <class 'bool'>
2025-04-26 23:45:23,133 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 23:45:23,134 - DEBUG - send_request_headers.started request=<Request [b'GET']> stream_id=5
2025-04-26 23:45:23,134 - DEBUG - Adding (b':method', b'GET') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:23,134 - DEBUG - Encoding 2 with 7 bits
2025-04-26 23:45:23,134 - DEBUG - Adding (b':authority', b'ujvbinqvvgbzgwqluian.supabase.co') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:23,134 - DEBUG - Encoding 73 with 7 bits
2025-04-26 23:45:23,134 - DEBUG - Adding (b':scheme', b'https') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:23,134 - DEBUG - Encoding 7 with 7 bits
2025-04-26 23:45:23,134 - DEBUG - Adding (b':path', b'/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at.asc') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:23,134 - DEBUG - Encoding 4 with 6 bits
2025-04-26 23:45:23,134 - DEBUG - Encoding 56 with 7 bits
2025-04-26 23:45:23,134 - DEBUG - Adding (b'accept', b'*/*') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:23,134 - DEBUG - Encoding 72 with 7 bits
2025-04-26 23:45:23,134 - DEBUG - Adding (b'accept-encoding', b'gzip, deflate') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:23,134 - DEBUG - Encoding 16 with 7 bits
2025-04-26 23:45:23,134 - DEBUG - Adding (b'user-agent', b'python-httpx/0.28.1') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:23,134 - DEBUG - Encoding 71 with 7 bits
2025-04-26 23:45:23,134 - DEBUG - Adding (b'x-client-info', b'supabase-py/2.15.0') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:23,134 - DEBUG - Encoding 70 with 7 bits
2025-04-26 23:45:23,134 - DEBUG - Adding (b'apikey', b'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:23,134 - DEBUG - Encoding 69 with 7 bits
2025-04-26 23:45:23,134 - DEBUG - Adding (b'authorization', b'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:True, huffman:True
2025-04-26 23:45:23,134 - DEBUG - Encoding 23 with 4 bits
2025-04-26 23:45:23,134 - DEBUG - Encoding 171 with 7 bits
2025-04-26 23:45:23,134 - DEBUG - Adding (b'accept-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:23,134 - DEBUG - Encoding 68 with 7 bits
2025-04-26 23:45:23,134 - DEBUG - Adding (b'content-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:23,134 - DEBUG - Encoding 67 with 7 bits
2025-04-26 23:45:23,134 - DEBUG - Encoded header block to b"\x82\xc9\x87D\xb8b\xc2\xa1,w\x0b\x05\xa4f\xa2*\x0f2?\xc4\x16\x82\x910*(~\x13=\x85\x1c\x91\x1aH\x0b\xd9p\xbe\xe3efYd\x03\x83\x8c\xae9\xf0{$-\x90 \xb5&!\xa5q\xa0\x9f\xc8\x90\xc7\xc6\xc5\x1f\x08\xff,\xbaQ\xd8[\x14/\xac\xb3\xc7\x88\x86\xd4l\xb98{\xc8\x1d&\xc8\x8c\x95ml\x97\xb29\x93\xad\x7f\x9coe}r\xfa\xcbY\x19\xd0mF\xcb\xeeO\xcb\xb3\xf3\xa7\x0f\xbf\xdd\xd9\x11\x92\xac\xb4~\x9b#\x99*\xe3\xdaJr\xd7\x1dXE%2\x18\xb4\xc8\xc99y\x08\xf9a\xb7!\xbc\x18\x94\xbe\x8f\xdd\xd9\x1c\xc9N\x1bc\x13F\xcf{-|\xff6\x1bWL\x0c\xe9\xbf\xb1\xbd;\xe1oU\xfe\x08\xc9O\x16\x89{#\x9a:B-\x17\xf8z\xd3\xd3\xabZ\x7f\x00\xbf\xb768)\xe5'\xefZ(\x0e;\xbaz\xe8\xaa\xefsT\x8f\xcfp\xb7\xe2\xd6\xa7\xdeG\xf4\xed\xc1#6n\xf1\xc4\xc3"
2025-04-26 23:45:23,135 - DEBUG - send_request_headers.complete
2025-04-26 23:45:23,135 - DEBUG - send_request_body.started request=<Request [b'GET']> stream_id=5
2025-04-26 23:45:23,135 - DEBUG - send_request_body.complete
2025-04-26 23:45:23,135 - DEBUG - receive_response_headers.started request=<Request [b'GET']> stream_id=5
2025-04-26 23:45:23,173 - DEBUG - Decoding b'\x88a\x96\xdc4\xfd(\'\x14\x86\xbb\x14\x10\x04\xda\x81j\xe3M\xdc\x13jb\xd1\xbf\xd4\xd3\x7f\x13\x8f}\x97\x1c\x92A\x02RJ\xfc\x81\x925\xb2^\xd3\xd2\xd1]\xb2`\xb4\x8c\xd4EA\xe6G\xf8{$-\x90 \xb5&!\xa5q\xa0\x9f\x08-\x05"`TP\xfc&{\n9"4\x90\x17\xb2\xe1}\xc6\xca\xcc\xb2\xc8\x07\x07\x19\\s\xd0\xcf\xce\xcd\xcc\xcb\xca\x7f\n\x013\xc9\xc8'
2025-04-26 23:45:23,173 - DEBUG - Decoded 8, consumed 1 bytes
2025-04-26 23:45:23,173 - DEBUG - Decoded (b':status', b'200'), consumed 1
2025-04-26 23:45:23,173 - DEBUG - Decoded 33, consumed 1 bytes
2025-04-26 23:45:23,173 - DEBUG - Decoded 22, consumed 1 bytes
2025-04-26 23:45:23,173 - DEBUG - Decoded (b'date', b'Sat, 26 Apr 2025 14:45:25 GMT'), total consumed 24 bytes, indexed True
2025-04-26 23:45:23,174 - DEBUG - Decoded 84, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'content-type', b'application/json; charset=utf-8'), consumed 1
2025-04-26 23:45:23,174 - DEBUG - Decoded 83, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'content-range', b'0-1/*'), consumed 1
2025-04-26 23:45:23,174 - DEBUG - Decoded 82, consumed 2 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded 15, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'cf-ray', b'9366dd20fcf9d1db-ICN'), total consumed 18 bytes, indexed True
2025-04-26 23:45:23,174 - DEBUG - Decoded 82, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'cf-cache-status', b'DYNAMIC'), consumed 1
2025-04-26 23:45:23,174 - DEBUG - Decoded 81, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'content-encoding', b'gzip'), consumed 1
2025-04-26 23:45:23,174 - DEBUG - Decoded 29, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded 50, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'content-location', b'/email_logs?order=sent_at.asc&select=%2A&thread_id=eq.1965e3ffd06abe66'), total consumed 52 bytes, indexed True
2025-04-26 23:45:23,174 - DEBUG - Decoded 80, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), consumed 1
2025-04-26 23:45:23,174 - DEBUG - Decoded 79, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'vary', b'Accept-Encoding'), consumed 1
2025-04-26 23:45:23,174 - DEBUG - Decoded 78, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'content-profile', b'public'), consumed 1
2025-04-26 23:45:23,174 - DEBUG - Decoded 77, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'sb-gateway-version', <memory at 0x10a108640>), consumed 1
2025-04-26 23:45:23,174 - DEBUG - Decoded 76, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), consumed 1
2025-04-26 23:45:23,174 - DEBUG - Decoded 75, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'x-content-type-options', b'nosniff'), consumed 1
2025-04-26 23:45:23,174 - DEBUG - Decoded 74, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'x-envoy-attempt-count', <memory at 0x10a108400>), consumed 1
2025-04-26 23:45:23,174 - DEBUG - Decoded 73, consumed 2 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded 1, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'x-envoy-upstream-service-time', <memory at 0x10a108ac0>), total consumed 4 bytes, indexed True
2025-04-26 23:45:23,174 - DEBUG - Decoded 73, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'server', b'cloudflare'), consumed 1
2025-04-26 23:45:23,174 - DEBUG - Decoded 72, consumed 1 bytes
2025-04-26 23:45:23,174 - DEBUG - Decoded (b'alt-svc', b'h3=":443"; ma=86400'), consumed 1
2025-04-26 23:45:23,175 - DEBUG - receive_response_headers.complete return_value=(200, [(b'date', b'Sat, 26 Apr 2025 14:45:25 GMT'), (b'content-type', b'application/json; charset=utf-8'), (b'content-range', b'0-1/*'), (b'cf-ray', b'9366dd20fcf9d1db-ICN'), (b'cf-cache-status', b'DYNAMIC'), (b'content-encoding', b'gzip'), (b'content-location', b'/email_logs?order=sent_at.asc&select=%2A&thread_id=eq.1965e3ffd06abe66'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'vary', b'Accept-Encoding'), (b'content-profile', b'public'), (b'sb-gateway-version', b'1'), (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), (b'x-content-type-options', b'nosniff'), (b'x-envoy-attempt-count', b'1'), (b'x-envoy-upstream-service-time', b'3'), (b'server', b'cloudflare'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:23,175 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:45:23,175 - DEBUG - receive_response_body.started request=<Request [b'GET']> stream_id=5
2025-04-26 23:45:23,175 - DEBUG - receive_response_body.complete
2025-04-26 23:45:23,175 - DEBUG - response_closed.started stream_id=5
2025-04-26 23:45:23,175 - DEBUG - response_closed.complete
2025-04-26 23:45:23,178 - INFO - Found 2 emails in thread
2025-04-26 23:45:23,178 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a procurement expert. Your task is to find the LATEST delivery date mentioned in the document. Return ONLY the date in YYYY-MM-DD format, with no additional text or explanation.'}, {'role': 'user', 'content': '\nYou are a procurement expert. Analyze the email body and attachments to find the latest delivery date.\n\nYou must carefully read both the email content and the attachment texts to extract the most accurate **delivery date**, also known as "requested delivery date", "expected delivery date", "delivery by", or similar expressions.\n\nThe delivery date may be explicitly stated (e.g., "delivery date: 2025-04-30") or implied using relative expressions (e.g., "delayed by 2 days", "delivery next Friday").\n\nUse the following rules carefully:\n\nRules for Choosing the Delivery Date:\n1. If multiple delivery dates are mentioned, ALWAYS choose the LATEST one.\n2. If a delivery date change is described (e.g., "delivery moved from April 24 to April 30", "delayed by a week"), ALWAYS use the NEW (updated) delivery date.\n3. If a clear explicit date is written, use it ONLY IF there is no later delivery update.\n4. Even if an explicit (clearly written) delivery date exists, if a LATER delay or reschedule is mentioned (even indirectly), calculate and use the NEW latest delivery date instead.\n5. When calculating a delivery date from a **relative expression** (e.g., "2 days later", "delayed by one week", "next Friday"):\n    - Prefer using the **reference_date** (most recent scheduled delivery date) as the base.\n    - If no valid reference_date is available, use the **received_date** (email sent/received date) as the base.\n6. If no valid delivery date can be determined, return only the word **"Null"** (case-sensitive).\n7. Final output must be ONLY a date in **YYYY-MM-DD** format, without any other text.\n\nExamples:\n- "Original delivery was 2025-04-24, changed to 2025-04-30" → **2025-04-30**\n- "First batch delivery on 2025-04-24, second batch on 2025-04-30" → **2025-04-30**\n- "Shipment delayed by 2 days" (reference_date = 2025-04-26) → **2025-04-28**\n- "Delivery next Friday" (received_date = 2025-04-26) → **2025-05-02**\n- "Delivery date: 2025-04-26", but later mentions "delayed by 5 days" → **2025-05-01** (even though explicit 4/26 exists, the latest update matters)\n\nContext information:\n- Sent date (received_date): None\n- Reference delivery date (reference_date): None\n\nEmail content:\nI want to purchase some stuffs\r\n\n\nAttachment content:\n\n\nFinal answer (Only one date or "Null"):\n'}], 'model': 'gpt-4-turbo', 'max_tokens': 100, 'temperature': 0.0}}
2025-04-26 23:45:23,179 - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-04-26 23:45:23,179 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-26 23:45:23,179 - DEBUG - send_request_headers.complete
2025-04-26 23:45:23,179 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-26 23:45:23,179 - DEBUG - send_request_body.complete
2025-04-26 23:45:23,179 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-26 23:45:24,056 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 26 Apr 2025 14:45:26 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'jiyeon-4fdfbx'), (b'openai-processing-ms', b'424'), (b'openai-version', b'2020-10-01'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'30000'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'29376'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'1.248s'), (b'x-request-id', b'req_39445e675284aea6841a34a139f8d503'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9366dd214ab5d1df-ICN'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:24,057 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:45:24,057 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-04-26 23:45:24,057 - DEBUG - receive_response_body.complete
2025-04-26 23:45:24,057 - DEBUG - response_closed.started
2025-04-26 23:45:24,057 - DEBUG - response_closed.complete
2025-04-26 23:45:24,057 - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Sat, 26 Apr 2025 14:45:26 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'jiyeon-4fdfbx', 'openai-processing-ms': '424', 'openai-version': '2020-10-01', 'x-ratelimit-limit-requests': '500', 'x-ratelimit-limit-tokens': '30000', 'x-ratelimit-remaining-requests': '499', 'x-ratelimit-remaining-tokens': '29376', 'x-ratelimit-reset-requests': '120ms', 'x-ratelimit-reset-tokens': '1.248s', 'x-request-id': 'req_39445e675284aea6841a34a139f8d503', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9366dd214ab5d1df-ICN', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-04-26 23:45:24,058 - DEBUG - request_id: req_39445e675284aea6841a34a139f8d503
2025-04-26 23:45:24,058 - INFO - Parsed delivery date: None
2025-04-26 23:45:24,058 - INFO - Attempting to save email log: purchase request
2025-04-26 23:45:24,058 - DEBUG - Email log data: {'thread_id': '1965e3ffd06abe66', 'direction': 'inbound', 'sender_email': 'Jiyeon Park <ddd7913@gmail.com>', 'recipient_email': '"jiyeon@shiftsai.com" <jiyeon@shiftsai.com>', 'subject': 'purchase request', 'sent_at': None, 'created_at': '2025-04-26T14:45:24.058550', 'updated_at': '2025-04-26T14:45:24.058550', 'received_at': 'Wed, 23 Apr 2025 01:06:00 +0900', 'draft_body': None, 'status': 'received', 'email_type': 'purchase request', 'has_attachment': True, 'filename': 'sample_purchase_order.pdf', 'attachment_types': ['application/pdf'], 'summary': 'The sender expresses a desire to initiate a purchase.', 'sender_role': 'vendor', 'parsed_delivery_date': None, 'trigger_reason': None, 'body': 'I want to purchase some stuffs\r\n'}
2025-04-26 23:45:24,059 - DEBUG - send_request_headers.started request=<Request [b'POST']> stream_id=7
2025-04-26 23:45:24,059 - DEBUG - Adding (b':method', b'POST') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:24,059 - DEBUG - Encoding 3 with 7 bits
2025-04-26 23:45:24,059 - DEBUG - Adding (b':authority', b'ujvbinqvvgbzgwqluian.supabase.co') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:24,059 - DEBUG - Encoding 74 with 7 bits
2025-04-26 23:45:24,059 - DEBUG - Adding (b':scheme', b'https') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:24,059 - DEBUG - Encoding 7 with 7 bits
2025-04-26 23:45:24,059 - DEBUG - Adding (b':path', b'/rest/v1/email_logs') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:24,059 - DEBUG - Encoding 66 with 7 bits
2025-04-26 23:45:24,059 - DEBUG - Adding (b'accept', b'*/*') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:24,059 - DEBUG - Encoding 72 with 7 bits
2025-04-26 23:45:24,059 - DEBUG - Adding (b'accept-encoding', b'gzip, deflate') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:24,059 - DEBUG - Encoding 16 with 7 bits
2025-04-26 23:45:24,059 - DEBUG - Adding (b'user-agent', b'python-httpx/0.28.1') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:24,059 - DEBUG - Encoding 71 with 7 bits
2025-04-26 23:45:24,059 - DEBUG - Adding (b'x-client-info', b'supabase-py/2.15.0') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:24,059 - DEBUG - Encoding 70 with 7 bits
2025-04-26 23:45:24,059 - DEBUG - Adding (b'apikey', b'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:24,059 - DEBUG - Encoding 69 with 7 bits
2025-04-26 23:45:24,059 - DEBUG - Adding (b'authorization', b'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:True, huffman:True
2025-04-26 23:45:24,059 - DEBUG - Encoding 23 with 4 bits
2025-04-26 23:45:24,059 - DEBUG - Encoding 171 with 7 bits
2025-04-26 23:45:24,059 - DEBUG - Adding (b'accept-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:24,059 - DEBUG - Encoding 68 with 7 bits
2025-04-26 23:45:24,059 - DEBUG - Adding (b'content-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:24,059 - DEBUG - Encoding 67 with 7 bits
2025-04-26 23:45:24,059 - DEBUG - Adding (b'prefer', b'return=representation') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:24,059 - DEBUG - Encoding 65 with 7 bits
2025-04-26 23:45:24,059 - DEBUG - Adding (b'content-length', b'698') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:24,059 - DEBUG - Encoding 28 with 6 bits
2025-04-26 23:45:24,059 - DEBUG - Encoding 3 with 7 bits
2025-04-26 23:45:24,059 - DEBUG - Adding (b'content-type', b'application/json') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:24,059 - DEBUG - Encoding 64 with 7 bits
2025-04-26 23:45:24,059 - DEBUG - Encoded header block to b"\x83\xca\x87\xc2\xc8\x90\xc7\xc6\xc5\x1f\x08\xff,\xbaQ\xd8[\x14/\xac\xb3\xc7\x88\x86\xd4l\xb98{\xc8\x1d&\xc8\x8c\x95ml\x97\xb29\x93\xad\x7f\x9coe}r\xfa\xcbY\x19\xd0mF\xcb\xeeO\xcb\xb3\xf3\xa7\x0f\xbf\xdd\xd9\x11\x92\xac\xb4~\x9b#\x99*\xe3\xdaJr\xd7\x1dXE%2\x18\xb4\xc8\xc99y\x08\xf9a\xb7!\xbc\x18\x94\xbe\x8f\xdd\xd9\x1c\xc9N\x1bc\x13F\xcf{-|\xff6\x1bWL\x0c\xe9\xbf\xb1\xbd;\xe1oU\xfe\x08\xc9O\x16\x89{#\x9a:B-\x17\xf8z\xd3\xd3\xabZ\x7f\x00\xbf\xb768)\xe5'\xefZ(\x0e;\xbaz\xe8\xaa\xefsT\x8f\xcfp\xb7\xe2\xd6\xa7\xdeG\xf4\xed\xc1#6n\xf1\xc4\xc3\xc1\\\x83q\xf7\xbf\xc0"
2025-04-26 23:45:24,060 - DEBUG - send_request_headers.complete
2025-04-26 23:45:24,060 - DEBUG - send_request_body.started request=<Request [b'POST']> stream_id=7
2025-04-26 23:45:24,060 - DEBUG - send_request_body.complete
2025-04-26 23:45:24,060 - DEBUG - receive_response_headers.started request=<Request [b'POST']> stream_id=7
2025-04-26 23:45:24,113 - DEBUG - Decoding b"\xc7a\x96\xdc4\xfd('\x14\x86\xbb\x14\x10\x04\xda\x81j\xe3M\xdc\x13\x8ab\xd1\xbf\xd8\xc6\x7f\x17\x8f}\x97\x1c\x92A8B\r\xd9\x03$kd\xbd\xa7\xd6\xd5\xd3\xd2\xd1\xc5\xd0\xcf\xce\xcd\x7f\r\x016\xcc\xcb"
2025-04-26 23:45:24,113 - DEBUG - Decoded 71, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b':status', b'201'), consumed 1
2025-04-26 23:45:24,114 - DEBUG - Decoded 33, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded 22, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'date', b'Sat, 26 Apr 2025 14:45:26 GMT'), total consumed 24 bytes, indexed True
2025-04-26 23:45:24,114 - DEBUG - Decoded 88, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'content-type', b'application/json; charset=utf-8'), consumed 1
2025-04-26 23:45:24,114 - DEBUG - Decoded 70, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'content-range', <memory at 0x10a108dc0>), consumed 1
2025-04-26 23:45:24,114 - DEBUG - Decoded 86, consumed 2 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded 15, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'cf-ray', b'9366dd26cca7d1db-ICN'), total consumed 18 bytes, indexed True
2025-04-26 23:45:24,114 - DEBUG - Decoded 86, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'cf-cache-status', b'DYNAMIC'), consumed 1
2025-04-26 23:45:24,114 - DEBUG - Decoded 85, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'content-encoding', b'gzip'), consumed 1
2025-04-26 23:45:24,114 - DEBUG - Decoded 83, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), consumed 1
2025-04-26 23:45:24,114 - DEBUG - Decoded 82, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'vary', b'Accept-Encoding'), consumed 1
2025-04-26 23:45:24,114 - DEBUG - Decoded 81, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'content-profile', b'public'), consumed 1
2025-04-26 23:45:24,114 - DEBUG - Decoded 69, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'preference-applied', b'return=representation'), consumed 1
2025-04-26 23:45:24,114 - DEBUG - Decoded 80, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'sb-gateway-version', <memory at 0x10a108640>), consumed 1
2025-04-26 23:45:24,114 - DEBUG - Decoded 79, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), consumed 1
2025-04-26 23:45:24,114 - DEBUG - Decoded 78, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'x-content-type-options', b'nosniff'), consumed 1
2025-04-26 23:45:24,114 - DEBUG - Decoded 77, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'x-envoy-attempt-count', <memory at 0x10a108400>), consumed 1
2025-04-26 23:45:24,114 - DEBUG - Decoded 76, consumed 2 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded 1, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'x-envoy-upstream-service-time', <memory at 0x10a108580>), total consumed 4 bytes, indexed True
2025-04-26 23:45:24,114 - DEBUG - Decoded 76, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'server', b'cloudflare'), consumed 1
2025-04-26 23:45:24,114 - DEBUG - Decoded 75, consumed 1 bytes
2025-04-26 23:45:24,114 - DEBUG - Decoded (b'alt-svc', b'h3=":443"; ma=86400'), consumed 1
2025-04-26 23:45:24,114 - DEBUG - receive_response_headers.complete return_value=(201, [(b'date', b'Sat, 26 Apr 2025 14:45:26 GMT'), (b'content-type', b'application/json; charset=utf-8'), (b'content-range', b'*/*'), (b'cf-ray', b'9366dd26cca7d1db-ICN'), (b'cf-cache-status', b'DYNAMIC'), (b'content-encoding', b'gzip'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'vary', b'Accept-Encoding'), (b'content-profile', b'public'), (b'preference-applied', b'return=representation'), (b'sb-gateway-version', b'1'), (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), (b'x-content-type-options', b'nosniff'), (b'x-envoy-attempt-count', b'1'), (b'x-envoy-upstream-service-time', b'6'), (b'server', b'cloudflare'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:24,115 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:45:24,115 - DEBUG - receive_response_body.started request=<Request [b'POST']> stream_id=7
2025-04-26 23:45:24,115 - DEBUG - receive_response_body.complete
2025-04-26 23:45:24,115 - DEBUG - response_closed.started stream_id=7
2025-04-26 23:45:24,115 - DEBUG - response_closed.complete
2025-04-26 23:45:24,115 - INFO - Email saved successfully: purchase request
2025-04-26 23:45:24,117 - INFO - Message sent to MCP server: purchase request
2025-04-26 23:45:24,117 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 23:45:24,118 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965eb11dccf8919?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:24,464 - INFO - Is vendor: False
2025-04-26 23:45:24,465 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/1965fe7da333da4b?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:24,875 - INFO - Is vendor: False
2025-04-26 23:45:24,876 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19661e7fd594a8a4?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:25,181 - INFO - Is vendor: True
2025-04-26 23:45:25,183 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19661e7fd594a8a4?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:25,489 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19661e7fd594a8a4?format=full&alt=json
2025-04-26 23:45:25,796 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a procurement specialist analyzing emails.'}, {'role': 'user', 'content': '\nYou are a procurement specialist assistant.\n\nYour task is to analyze the following email and deliver two outputs:\n\n1. **Summary** (1–3 clear sentences):  \n   Focus specifically on the procurement-related **action** or **request**.  \n   Exclude unnecessary greetings, background stories, or non-actionable information.  \n   Be direct and practical as a procurement professional would expect.\n\n2. **Type** (short 2–3 word category):  \n   Provide a short but clear 2–3 word phrase that best describes the critical **action and purpose** of this email for a procurement specialist.  \n   Avoid vague or generic words. Be specific and professional.\n\nExamples:\n- delivery delay\n- delay confirmation\n- purchase order\n- payment request\n- contract negotiation\n- shipment inquiry\n- invoice issue\n\nPick a phrase that immediately tells a procurement professional what the email is about.\n\n\nFormat your response exactly like this:\n---\nSUMMARY: [your 1–3 sentence summary]  \nTYPE: [your single word]\n---\n\nEmail content:\nDear Vendor,\r\n\r\nI hope this message finds you well.\r\n\r\nPlease find attached our purchase order for the following items\r\n\r\nWe kindly ask you to confirm receipt of the order and let us know if the\r\ndelivery timeline is feasible. If there are any questions or additional\r\ninformation required, feel free to reach out at any time.\r\n\r\nThank you for your continued support.\r\n\r\nBest regards,\r\nJiyeon Park\r\n\r\nShiftsai\r\n\r\njiyeon@shiftsai.com\r\n\n\n'}], 'model': 'gpt-4-turbo', 'max_tokens': 150, 'temperature': 0.0}}
2025-04-26 23:45:25,797 - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-04-26 23:45:25,798 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-26 23:45:25,798 - DEBUG - send_request_headers.complete
2025-04-26 23:45:25,798 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-26 23:45:25,798 - DEBUG - send_request_body.complete
2025-04-26 23:45:25,798 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-26 23:45:27,434 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 26 Apr 2025 14:45:29 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'jiyeon-4fdfbx'), (b'openai-processing-ms', b'1223'), (b'openai-version', b'2020-10-01'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'30000'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'29622'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'756ms'), (b'x-request-id', b'req_54479a797293e221b34cb3cbd40f22cc'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9366dd31ad58d1df-ICN'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:27,435 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:45:27,435 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-04-26 23:45:27,435 - DEBUG - receive_response_body.complete
2025-04-26 23:45:27,435 - DEBUG - response_closed.started
2025-04-26 23:45:27,436 - DEBUG - response_closed.complete
2025-04-26 23:45:27,436 - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Sat, 26 Apr 2025 14:45:29 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'jiyeon-4fdfbx', 'openai-processing-ms': '1223', 'openai-version': '2020-10-01', 'x-ratelimit-limit-requests': '500', 'x-ratelimit-limit-tokens': '30000', 'x-ratelimit-remaining-requests': '499', 'x-ratelimit-remaining-tokens': '29622', 'x-ratelimit-reset-requests': '120ms', 'x-ratelimit-reset-tokens': '756ms', 'x-request-id': 'req_54479a797293e221b34cb3cbd40f22cc', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9366dd31ad58d1df-ICN', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-04-26 23:45:27,436 - DEBUG - request_id: req_54479a797293e221b34cb3cbd40f22cc
2025-04-26 23:45:27,436 - INFO - Generated email type: order confirmation
2025-04-26 23:45:27,438 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19661e7fd594a8a4/attachments/ANGjdJ8lyxRzZNAfyapFucTJvSMP22uRlJcyCifO5y_Y-4ynXYJiBNmGoa4uUy4E0jPr_x3xcD-fSiqmqi5OT6XMVx6Ui-Yk8OmAUOAn5wD4q4kIpgyzcxU3IFbOre_ehLJIFD1kzDU5Zkq69FZg7hHBvT7ehrEDNdPgC97id2rtWHKRKf_zh6foH1yT2YgpWjA3udwp8CVlRBBwS2dna6L8Hrtl20IqUQrKjKwK3kn2KSb47rRzJruz_hOSHGk0lpp1TefO65i8c4Hq__nhvKOa11aj0hIBiSreLAonoKsWhsDHviYe8Ssjn74ahPE?alt=json
2025-04-26 23:45:27,889 - ERROR - Error uploading file to Supabase Storage: Header value must be str or bytes, not <class 'bool'>
2025-04-26 23:45:27,889 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:45:27,890 - DEBUG - send_request_headers.started request=<Request [b'GET']> stream_id=9
2025-04-26 23:45:27,890 - DEBUG - Adding (b':method', b'GET') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:27,890 - DEBUG - Encoding 2 with 7 bits
2025-04-26 23:45:27,890 - DEBUG - Adding (b':authority', b'ujvbinqvvgbzgwqluian.supabase.co') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:27,890 - DEBUG - Encoding 75 with 7 bits
2025-04-26 23:45:27,890 - DEBUG - Adding (b':scheme', b'https') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:27,890 - DEBUG - Encoding 7 with 7 bits
2025-04-26 23:45:27,890 - DEBUG - Adding (b':path', b'/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:27,890 - DEBUG - Encoding 4 with 6 bits
2025-04-26 23:45:27,890 - DEBUG - Encoding 56 with 7 bits
2025-04-26 23:45:27,890 - DEBUG - Adding (b'accept', b'*/*') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:27,890 - DEBUG - Encoding 74 with 7 bits
2025-04-26 23:45:27,890 - DEBUG - Adding (b'accept-encoding', b'gzip, deflate') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:27,890 - DEBUG - Encoding 16 with 7 bits
2025-04-26 23:45:27,890 - DEBUG - Adding (b'user-agent', b'python-httpx/0.28.1') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:27,890 - DEBUG - Encoding 73 with 7 bits
2025-04-26 23:45:27,890 - DEBUG - Adding (b'x-client-info', b'supabase-py/2.15.0') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:27,890 - DEBUG - Encoding 72 with 7 bits
2025-04-26 23:45:27,891 - DEBUG - Adding (b'apikey', b'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:27,891 - DEBUG - Encoding 71 with 7 bits
2025-04-26 23:45:27,891 - DEBUG - Adding (b'authorization', b'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:True, huffman:True
2025-04-26 23:45:27,891 - DEBUG - Encoding 23 with 4 bits
2025-04-26 23:45:27,891 - DEBUG - Encoding 171 with 7 bits
2025-04-26 23:45:27,891 - DEBUG - Adding (b'accept-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:27,891 - DEBUG - Encoding 70 with 7 bits
2025-04-26 23:45:27,891 - DEBUG - Adding (b'content-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:27,891 - DEBUG - Encoding 69 with 7 bits
2025-04-26 23:45:27,891 - DEBUG - Encoded header block to b"\x82\xcb\x87D\xb8b\xc2\xa1,w\x0b\x05\xa4f\xa2*\x0f2?\xc4\x16\x82\x910*(~\x13=\x85\x1c\x91\x1aH\x0b\xd9p\xbe\xe3\x81+l\xb4\xf3\x8e\x8d\xd0?\xf0{$-\x90 \xb5&!\xa5q\xa0\x9f\xca\x90\xc9\xc8\xc7\x1f\x08\xff,\xbaQ\xd8[\x14/\xac\xb3\xc7\x88\x86\xd4l\xb98{\xc8\x1d&\xc8\x8c\x95ml\x97\xb29\x93\xad\x7f\x9coe}r\xfa\xcbY\x19\xd0mF\xcb\xeeO\xcb\xb3\xf3\xa7\x0f\xbf\xdd\xd9\x11\x92\xac\xb4~\x9b#\x99*\xe3\xdaJr\xd7\x1dXE%2\x18\xb4\xc8\xc99y\x08\xf9a\xb7!\xbc\x18\x94\xbe\x8f\xdd\xd9\x1c\xc9N\x1bc\x13F\xcf{-|\xff6\x1bWL\x0c\xe9\xbf\xb1\xbd;\xe1oU\xfe\x08\xc9O\x16\x89{#\x9a:B-\x17\xf8z\xd3\xd3\xabZ\x7f\x00\xbf\xb768)\xe5'\xefZ(\x0e;\xbaz\xe8\xaa\xefsT\x8f\xcfp\xb7\xe2\xd6\xa7\xdeG\xf4\xed\xc1#6n\xf1\xc6\xc5"
2025-04-26 23:45:27,891 - DEBUG - send_request_headers.complete
2025-04-26 23:45:27,891 - DEBUG - send_request_body.started request=<Request [b'GET']> stream_id=9
2025-04-26 23:45:27,891 - DEBUG - send_request_body.complete
2025-04-26 23:45:27,891 - DEBUG - receive_response_headers.started request=<Request [b'GET']> stream_id=9
2025-04-26 23:45:27,935 - DEBUG - Decoding b'\x88a\x96\xdc4\xfd(\'\x14\x86\xbb\x14\x10\x04\xda\x81j\xe3M\xdcd\nb\xd1\xbf\xdb^\x84\x02\xcc\xb1\xf3\x7f\x1b\x8f}\x97\x1c\x92FK\x19\\n@\xc9\x1a\xd9/i\xda\xd9]\xb2`\xb4\x8c\xd4EA\xe6G\xf8{$-\x90 \xb5&!\xa5q\xa0\x9f\x08-\x05"`TP\xfc&{\n9"4\x90\x17\xb2\xe1}\xc7\x02V\xd9i\xe7\x1d\x1b\xa0\x7f\xd8\xd7\xd6\xd5\xd4\xd3\xd2\x7f\x12\x0212\xd1\xd0'
2025-04-26 23:45:27,935 - DEBUG - Decoded 8, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded (b':status', b'200'), consumed 1
2025-04-26 23:45:27,935 - DEBUG - Decoded 33, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded 22, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded (b'date', b'Sat, 26 Apr 2025 14:45:30 GMT'), total consumed 24 bytes, indexed True
2025-04-26 23:45:27,935 - DEBUG - Decoded 91, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded (b'content-type', b'application/json; charset=utf-8'), consumed 1
2025-04-26 23:45:27,935 - DEBUG - Decoded 30, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded 4, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded (b'content-range', b'0-3/*'), total consumed 6 bytes, indexed True
2025-04-26 23:45:27,935 - DEBUG - Decoded 90, consumed 2 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded 15, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded (b'cf-ray', b'9366dd3ebe65d1db-ICN'), total consumed 18 bytes, indexed True
2025-04-26 23:45:27,935 - DEBUG - Decoded 90, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded (b'cf-cache-status', b'DYNAMIC'), consumed 1
2025-04-26 23:45:27,935 - DEBUG - Decoded 89, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded (b'content-encoding', b'gzip'), consumed 1
2025-04-26 23:45:27,935 - DEBUG - Decoded 29, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded 50, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded (b'content-location', b'/email_logs?order=sent_at.asc&select=%2A&thread_id=eq.19661e534867a709'), total consumed 52 bytes, indexed True
2025-04-26 23:45:27,935 - DEBUG - Decoded 88, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), consumed 1
2025-04-26 23:45:27,935 - DEBUG - Decoded 87, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded (b'vary', b'Accept-Encoding'), consumed 1
2025-04-26 23:45:27,935 - DEBUG - Decoded 86, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded (b'content-profile', b'public'), consumed 1
2025-04-26 23:45:27,935 - DEBUG - Decoded 85, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded (b'sb-gateway-version', <memory at 0x10a108640>), consumed 1
2025-04-26 23:45:27,935 - DEBUG - Decoded 84, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), consumed 1
2025-04-26 23:45:27,935 - DEBUG - Decoded 83, consumed 1 bytes
2025-04-26 23:45:27,935 - DEBUG - Decoded (b'x-content-type-options', b'nosniff'), consumed 1
2025-04-26 23:45:27,935 - DEBUG - Decoded 82, consumed 1 bytes
2025-04-26 23:45:27,936 - DEBUG - Decoded (b'x-envoy-attempt-count', <memory at 0x10a108400>), consumed 1
2025-04-26 23:45:27,936 - DEBUG - Decoded 81, consumed 2 bytes
2025-04-26 23:45:27,936 - DEBUG - Decoded 2, consumed 1 bytes
2025-04-26 23:45:27,936 - DEBUG - Decoded (b'x-envoy-upstream-service-time', <memory at 0x10a109480>), total consumed 5 bytes, indexed True
2025-04-26 23:45:27,936 - DEBUG - Decoded 81, consumed 1 bytes
2025-04-26 23:45:27,936 - DEBUG - Decoded (b'server', b'cloudflare'), consumed 1
2025-04-26 23:45:27,936 - DEBUG - Decoded 80, consumed 1 bytes
2025-04-26 23:45:27,936 - DEBUG - Decoded (b'alt-svc', b'h3=":443"; ma=86400'), consumed 1
2025-04-26 23:45:27,936 - DEBUG - receive_response_headers.complete return_value=(200, [(b'date', b'Sat, 26 Apr 2025 14:45:30 GMT'), (b'content-type', b'application/json; charset=utf-8'), (b'content-range', b'0-3/*'), (b'cf-ray', b'9366dd3ebe65d1db-ICN'), (b'cf-cache-status', b'DYNAMIC'), (b'content-encoding', b'gzip'), (b'content-location', b'/email_logs?order=sent_at.asc&select=%2A&thread_id=eq.19661e534867a709'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'vary', b'Accept-Encoding'), (b'content-profile', b'public'), (b'sb-gateway-version', b'1'), (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), (b'x-content-type-options', b'nosniff'), (b'x-envoy-attempt-count', b'1'), (b'x-envoy-upstream-service-time', b'12'), (b'server', b'cloudflare'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:27,936 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:45:27,936 - DEBUG - receive_response_body.started request=<Request [b'GET']> stream_id=9
2025-04-26 23:45:27,936 - DEBUG - receive_response_body.complete
2025-04-26 23:45:27,936 - DEBUG - response_closed.started stream_id=9
2025-04-26 23:45:27,936 - DEBUG - response_closed.complete
2025-04-26 23:45:27,938 - INFO - Found 4 emails in thread
2025-04-26 23:45:27,938 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a procurement expert. Your task is to find the LATEST delivery date mentioned in the document. Return ONLY the date in YYYY-MM-DD format, with no additional text or explanation.'}, {'role': 'user', 'content': '\nYou are a procurement expert. Analyze the email body and attachments to find the latest delivery date.\n\nYou must carefully read both the email content and the attachment texts to extract the most accurate **delivery date**, also known as "requested delivery date", "expected delivery date", "delivery by", or similar expressions.\n\nThe delivery date may be explicitly stated (e.g., "delivery date: 2025-04-30") or implied using relative expressions (e.g., "delayed by 2 days", "delivery next Friday").\n\nUse the following rules carefully:\n\nRules for Choosing the Delivery Date:\n1. If multiple delivery dates are mentioned, ALWAYS choose the LATEST one.\n2. If a delivery date change is described (e.g., "delivery moved from April 24 to April 30", "delayed by a week"), ALWAYS use the NEW (updated) delivery date.\n3. If a clear explicit date is written, use it ONLY IF there is no later delivery update.\n4. Even if an explicit (clearly written) delivery date exists, if a LATER delay or reschedule is mentioned (even indirectly), calculate and use the NEW latest delivery date instead.\n5. When calculating a delivery date from a **relative expression** (e.g., "2 days later", "delayed by one week", "next Friday"):\n    - Prefer using the **reference_date** (most recent scheduled delivery date) as the base.\n    - If no valid reference_date is available, use the **received_date** (email sent/received date) as the base.\n6. If no valid delivery date can be determined, return only the word **"Null"** (case-sensitive).\n7. Final output must be ONLY a date in **YYYY-MM-DD** format, without any other text.\n\nExamples:\n- "Original delivery was 2025-04-24, changed to 2025-04-30" → **2025-04-30**\n- "First batch delivery on 2025-04-24, second batch on 2025-04-30" → **2025-04-30**\n- "Shipment delayed by 2 days" (reference_date = 2025-04-26) → **2025-04-28**\n- "Delivery next Friday" (received_date = 2025-04-26) → **2025-05-02**\n- "Delivery date: 2025-04-26", but later mentions "delayed by 5 days" → **2025-05-01** (even though explicit 4/26 exists, the latest update matters)\n\nContext information:\n- Sent date (received_date): None\n- Reference delivery date (reference_date): 2025-05-02\n\nEmail content:\nDear Vendor,\r\n\r\nI hope this message finds you well.\r\n\r\nPlease find attached our purchase order for the following items\r\n\r\nWe kindly ask you to confirm receipt of the order and let us know if the\r\ndelivery timeline is feasible. If there are any questions or additional\r\ninformation required, feel free to reach out at any time.\r\n\r\nThank you for your continued support.\r\n\r\nBest regards,\r\nJiyeon Park\r\n\r\nShiftsai\r\n\r\njiyeon@shiftsai.com\r\n\n\nAttachment content:\n\n\nFinal answer (Only one date or "Null"):\n'}], 'model': 'gpt-4-turbo', 'max_tokens': 100, 'temperature': 0.0}}
2025-04-26 23:45:27,939 - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-04-26 23:45:27,939 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-26 23:45:27,939 - DEBUG - send_request_headers.complete
2025-04-26 23:45:27,939 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-26 23:45:27,940 - DEBUG - send_request_body.complete
2025-04-26 23:45:27,940 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-26 23:45:28,805 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 26 Apr 2025 14:45:30 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'jiyeon-4fdfbx'), (b'openai-processing-ms', b'487'), (b'openai-version', b'2020-10-01'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'30000'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'29274'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'1.452s'), (b'x-request-id', b'req_0386f2e5437c1ebc22ab426c5c62cb86'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9366dd3f0e2ed1df-ICN'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:28,805 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:45:28,805 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-04-26 23:45:28,806 - DEBUG - receive_response_body.complete
2025-04-26 23:45:28,806 - DEBUG - response_closed.started
2025-04-26 23:45:28,806 - DEBUG - response_closed.complete
2025-04-26 23:45:28,806 - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Sat, 26 Apr 2025 14:45:30 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'jiyeon-4fdfbx', 'openai-processing-ms': '487', 'openai-version': '2020-10-01', 'x-ratelimit-limit-requests': '500', 'x-ratelimit-limit-tokens': '30000', 'x-ratelimit-remaining-requests': '499', 'x-ratelimit-remaining-tokens': '29274', 'x-ratelimit-reset-requests': '120ms', 'x-ratelimit-reset-tokens': '1.452s', 'x-request-id': 'req_0386f2e5437c1ebc22ab426c5c62cb86', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9366dd3f0e2ed1df-ICN', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-04-26 23:45:28,806 - DEBUG - request_id: req_0386f2e5437c1ebc22ab426c5c62cb86
2025-04-26 23:45:28,806 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 23:45:28,806 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:45:28,806 - DEBUG - Email log data: {'thread_id': '19661e534867a709', 'direction': 'outbound', 'sender_email': 'Jiyeon Park <jiyeon@shiftsai.com>', 'recipient_email': 'ddd7913@gmail.com', 'subject': '[Purchase Order Attached] Request for Supply – Shiftsai', 'sent_at': 'Wed, 23 Apr 2025 18:08:35 +0900', 'created_at': '2025-04-26T14:45:28.806893', 'updated_at': '2025-04-26T14:45:28.806893', 'received_at': None, 'draft_body': None, 'status': 'sent', 'email_type': 'order confirmation', 'has_attachment': True, 'filename': 'test_po.pdf', 'attachment_types': ['application/pdf'], 'summary': 'Jiyeon Park from Shiftsai has sent a purchase order and requests confirmation of receipt and verification of the delivery timeline.', 'sender_role': 'admin', 'parsed_delivery_date': '2025-05-02', 'trigger_reason': None, 'body': 'Dear Vendor,\r\n\r\nI hope this message finds you well.\r\n\r\nPlease find attached our purchase order for the following items\r\n\r\nWe kindly ask you to confirm receipt of the order and let us know if the\r\ndelivery timeline is feasible. If there are any questions or additional\r\ninformation required, feel free to reach out at any time.\r\n\r\nThank you for your continued support.\r\n\r\nBest regards,\r\nJiyeon Park\r\n\r\nShiftsai\r\n\r\njiyeon@shiftsai.com\r\n'}
2025-04-26 23:45:28,807 - DEBUG - send_request_headers.started request=<Request [b'POST']> stream_id=11
2025-04-26 23:45:28,807 - DEBUG - Adding (b':method', b'POST') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:28,807 - DEBUG - Encoding 3 with 7 bits
2025-04-26 23:45:28,807 - DEBUG - Adding (b':authority', b'ujvbinqvvgbzgwqluian.supabase.co') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:28,807 - DEBUG - Encoding 76 with 7 bits
2025-04-26 23:45:28,807 - DEBUG - Adding (b':scheme', b'https') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:28,807 - DEBUG - Encoding 7 with 7 bits
2025-04-26 23:45:28,807 - DEBUG - Adding (b':path', b'/rest/v1/email_logs') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:28,807 - DEBUG - Encoding 68 with 7 bits
2025-04-26 23:45:28,807 - DEBUG - Adding (b'accept', b'*/*') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:28,807 - DEBUG - Encoding 74 with 7 bits
2025-04-26 23:45:28,807 - DEBUG - Adding (b'accept-encoding', b'gzip, deflate') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:28,808 - DEBUG - Encoding 16 with 7 bits
2025-04-26 23:45:28,808 - DEBUG - Adding (b'user-agent', b'python-httpx/0.28.1') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:28,808 - DEBUG - Encoding 73 with 7 bits
2025-04-26 23:45:28,808 - DEBUG - Adding (b'x-client-info', b'supabase-py/2.15.0') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:28,808 - DEBUG - Encoding 72 with 7 bits
2025-04-26 23:45:28,808 - DEBUG - Adding (b'apikey', b'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:28,808 - DEBUG - Encoding 71 with 7 bits
2025-04-26 23:45:28,808 - DEBUG - Adding (b'authorization', b'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:True, huffman:True
2025-04-26 23:45:28,808 - DEBUG - Encoding 23 with 4 bits
2025-04-26 23:45:28,808 - DEBUG - Encoding 171 with 7 bits
2025-04-26 23:45:28,808 - DEBUG - Adding (b'accept-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:28,808 - DEBUG - Encoding 70 with 7 bits
2025-04-26 23:45:28,808 - DEBUG - Adding (b'content-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:28,808 - DEBUG - Encoding 69 with 7 bits
2025-04-26 23:45:28,808 - DEBUG - Adding (b'prefer', b'return=representation') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:28,808 - DEBUG - Encoding 67 with 7 bits
2025-04-26 23:45:28,808 - DEBUG - Adding (b'content-length', b'1219') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:28,808 - DEBUG - Encoding 28 with 6 bits
2025-04-26 23:45:28,808 - DEBUG - Encoding 3 with 7 bits
2025-04-26 23:45:28,808 - DEBUG - Adding (b'content-type', b'application/json') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:28,808 - DEBUG - Encoding 66 with 7 bits
2025-04-26 23:45:28,808 - DEBUG - Encoded header block to b"\x83\xcc\x87\xc4\xca\x90\xc9\xc8\xc7\x1f\x08\xff,\xbaQ\xd8[\x14/\xac\xb3\xc7\x88\x86\xd4l\xb98{\xc8\x1d&\xc8\x8c\x95ml\x97\xb29\x93\xad\x7f\x9coe}r\xfa\xcbY\x19\xd0mF\xcb\xeeO\xcb\xb3\xf3\xa7\x0f\xbf\xdd\xd9\x11\x92\xac\xb4~\x9b#\x99*\xe3\xdaJr\xd7\x1dXE%2\x18\xb4\xc8\xc99y\x08\xf9a\xb7!\xbc\x18\x94\xbe\x8f\xdd\xd9\x1c\xc9N\x1bc\x13F\xcf{-|\xff6\x1bWL\x0c\xe9\xbf\xb1\xbd;\xe1oU\xfe\x08\xc9O\x16\x89{#\x9a:B-\x17\xf8z\xd3\xd3\xabZ\x7f\x00\xbf\xb768)\xe5'\xefZ(\x0e;\xbaz\xe8\xaa\xefsT\x8f\xcfp\xb7\xe2\xd6\xa7\xdeG\xf4\xed\xc1#6n\xf1\xc6\xc5\xc3\\\x83\x08\x82\xff\xc2"
2025-04-26 23:45:28,808 - DEBUG - send_request_headers.complete
2025-04-26 23:45:28,808 - DEBUG - send_request_body.started request=<Request [b'POST']> stream_id=11
2025-04-26 23:45:28,808 - DEBUG - send_request_body.complete
2025-04-26 23:45:28,809 - DEBUG - receive_response_headers.started request=<Request [b'POST']> stream_id=11
2025-04-26 23:45:28,849 - DEBUG - Decoding b'\xcf\xc2\xdf\xcd\x7f\x1e\x90}\x97\x1c\x92F\x9avBI d\x8dl\x97\xb4\xff\xdd\xdc\xda\xd9\xd8\xcc\xd7\xd6\xd5\xd4\xc4\xd2\xd1'
2025-04-26 23:45:28,849 - DEBUG - Decoded 79, consumed 1 bytes
2025-04-26 23:45:28,849 - DEBUG - Decoded (b':status', b'201'), consumed 1
2025-04-26 23:45:28,849 - DEBUG - Decoded 66, consumed 1 bytes
2025-04-26 23:45:28,849 - DEBUG - Decoded (b'date', b'Sat, 26 Apr 2025 14:45:30 GMT'), consumed 1
2025-04-26 23:45:28,849 - DEBUG - Decoded 95, consumed 1 bytes
2025-04-26 23:45:28,849 - DEBUG - Decoded (b'content-type', b'application/json; charset=utf-8'), consumed 1
2025-04-26 23:45:28,849 - DEBUG - Decoded 77, consumed 1 bytes
2025-04-26 23:45:28,849 - DEBUG - Decoded (b'content-range', <memory at 0x10a108dc0>), consumed 1
2025-04-26 23:45:28,849 - DEBUG - Decoded 93, consumed 2 bytes
2025-04-26 23:45:28,849 - DEBUG - Decoded 16, consumed 1 bytes
2025-04-26 23:45:28,849 - DEBUG - Decoded (b'cf-ray', b'9366dd447dcdd1db-ICN'), total consumed 19 bytes, indexed True
2025-04-26 23:45:28,849 - DEBUG - Decoded 93, consumed 1 bytes
2025-04-26 23:45:28,849 - DEBUG - Decoded (b'cf-cache-status', b'DYNAMIC'), consumed 1
2025-04-26 23:45:28,849 - DEBUG - Decoded 92, consumed 1 bytes
2025-04-26 23:45:28,849 - DEBUG - Decoded (b'content-encoding', b'gzip'), consumed 1
2025-04-26 23:45:28,850 - DEBUG - Decoded 90, consumed 1 bytes
2025-04-26 23:45:28,850 - DEBUG - Decoded (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), consumed 1
2025-04-26 23:45:28,850 - DEBUG - Decoded 89, consumed 1 bytes
2025-04-26 23:45:28,850 - DEBUG - Decoded (b'vary', b'Accept-Encoding'), consumed 1
2025-04-26 23:45:28,850 - DEBUG - Decoded 88, consumed 1 bytes
2025-04-26 23:45:28,850 - DEBUG - Decoded (b'content-profile', b'public'), consumed 1
2025-04-26 23:45:28,850 - DEBUG - Decoded 76, consumed 1 bytes
2025-04-26 23:45:28,850 - DEBUG - Decoded (b'preference-applied', b'return=representation'), consumed 1
2025-04-26 23:45:28,850 - DEBUG - Decoded 87, consumed 1 bytes
2025-04-26 23:45:28,850 - DEBUG - Decoded (b'sb-gateway-version', <memory at 0x10a108640>), consumed 1
2025-04-26 23:45:28,850 - DEBUG - Decoded 86, consumed 1 bytes
2025-04-26 23:45:28,850 - DEBUG - Decoded (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), consumed 1
2025-04-26 23:45:28,850 - DEBUG - Decoded 85, consumed 1 bytes
2025-04-26 23:45:28,850 - DEBUG - Decoded (b'x-content-type-options', b'nosniff'), consumed 1
2025-04-26 23:45:28,850 - DEBUG - Decoded 84, consumed 1 bytes
2025-04-26 23:45:28,850 - DEBUG - Decoded (b'x-envoy-attempt-count', <memory at 0x10a108400>), consumed 1
2025-04-26 23:45:28,850 - DEBUG - Decoded 68, consumed 1 bytes
2025-04-26 23:45:28,850 - DEBUG - Decoded (b'x-envoy-upstream-service-time', <memory at 0x10a108580>), consumed 1
2025-04-26 23:45:28,850 - DEBUG - Decoded 82, consumed 1 bytes
2025-04-26 23:45:28,850 - DEBUG - Decoded (b'server', b'cloudflare'), consumed 1
2025-04-26 23:45:28,850 - DEBUG - Decoded 81, consumed 1 bytes
2025-04-26 23:45:28,850 - DEBUG - Decoded (b'alt-svc', b'h3=":443"; ma=86400'), consumed 1
2025-04-26 23:45:28,850 - DEBUG - receive_response_headers.complete return_value=(201, [(b'date', b'Sat, 26 Apr 2025 14:45:30 GMT'), (b'content-type', b'application/json; charset=utf-8'), (b'content-range', b'*/*'), (b'cf-ray', b'9366dd447dcdd1db-ICN'), (b'cf-cache-status', b'DYNAMIC'), (b'content-encoding', b'gzip'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'vary', b'Accept-Encoding'), (b'content-profile', b'public'), (b'preference-applied', b'return=representation'), (b'sb-gateway-version', b'1'), (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), (b'x-content-type-options', b'nosniff'), (b'x-envoy-attempt-count', b'1'), (b'x-envoy-upstream-service-time', b'6'), (b'server', b'cloudflare'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:28,850 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:45:28,850 - DEBUG - receive_response_body.started request=<Request [b'POST']> stream_id=11
2025-04-26 23:45:28,851 - DEBUG - receive_response_body.complete
2025-04-26 23:45:28,851 - DEBUG - response_closed.started stream_id=11
2025-04-26 23:45:28,851 - DEBUG - response_closed.complete
2025-04-26 23:45:28,851 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:45:28,852 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:45:28,852 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 23:45:28,853 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19661ecddae94e49?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:29,174 - INFO - Is vendor: True
2025-04-26 23:45:29,176 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19661ecddae94e49?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:29,483 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19661ecddae94e49?format=full&alt=json
2025-04-26 23:45:29,802 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a procurement specialist analyzing emails.'}, {'role': 'user', 'content': '\nYou are a procurement specialist assistant.\n\nYour task is to analyze the following email and deliver two outputs:\n\n1. **Summary** (1–3 clear sentences):  \n   Focus specifically on the procurement-related **action** or **request**.  \n   Exclude unnecessary greetings, background stories, or non-actionable information.  \n   Be direct and practical as a procurement professional would expect.\n\n2. **Type** (short 2–3 word category):  \n   Provide a short but clear 2–3 word phrase that best describes the critical **action and purpose** of this email for a procurement specialist.  \n   Avoid vague or generic words. Be specific and professional.\n\nExamples:\n- delivery delay\n- delay confirmation\n- purchase order\n- payment request\n- contract negotiation\n- shipment inquiry\n- invoice issue\n\nPick a phrase that immediately tells a procurement professional what the email is about.\n\n\nFormat your response exactly like this:\n---\nSUMMARY: [your 1–3 sentence summary]  \nTYPE: [your single word]\n---\n\nEmail content:\nDear Jiyeon,\r\n\r\nThank you for your purchase order (*PO No. PO-20250413-001*).\r\n\r\nI found there was an error in the delivery date. We set the expected\r\ndelivery date by April 30, 2025. Please check the date.\r\nWe are pleased to confirm acceptance of the order under the following terms:\r\n\r\n   -\r\n\r\n   *Expected Delivery Date:* April 30, 2025\r\n   -\r\n\r\n   *Delivery Address:* 789 Assembly Line Rd, Houston, TX\r\n   -\r\n\r\n   *Order Details:* Three items with $1,434.31\r\n   -\r\n\r\n   *Additional Notes:* FedEx Freight\r\n\r\nWe have initiated the processing and will ensure on-time delivery.\r\nShould you have any questions or further requests, please don’t hesitate to\r\nreach out.\r\n\r\nWe appreciate your business and look forward to serving you.\r\n\r\nBest regards,\r\n*Mega Industrial Supplies Inc.*\r\nJohn Doe\r\n\r\nddd7913@gmail.com\r\n\r\n2025년 4월 23일 (수) 오후 6:08, Jiyeon Park <jiyeon@shiftsai.com>님이 작성:\r\n\r\n> Dear Vendor,\r\n>\r\n> I hope this message finds you well.\r\n>\r\n> Please find attached our purchase order for the following items\r\n>\r\n> We kindly ask you to confirm receipt of the order and let us know if the\r\n> delivery timeline is feasible. If there are any questions or additional\r\n> information required, feel free to reach out at any time.\r\n>\r\n> Thank you for your continued support.\r\n>\r\n> Best regards,\r\n> Jiyeon Park\r\n>\r\n> Shiftsai\r\n>\r\n> jiyeon@shiftsai.com\r\n>\r\n\n\n'}], 'model': 'gpt-4-turbo', 'max_tokens': 150, 'temperature': 0.0}}
2025-04-26 23:45:29,803 - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-04-26 23:45:29,803 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-26 23:45:29,803 - DEBUG - send_request_headers.complete
2025-04-26 23:45:29,804 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-26 23:45:29,804 - DEBUG - send_request_body.complete
2025-04-26 23:45:29,804 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-26 23:45:31,940 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 26 Apr 2025 14:45:33 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'jiyeon-4fdfbx'), (b'openai-processing-ms', b'1677'), (b'openai-version', b'2020-10-01'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'30000'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'29387'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'1.226s'), (b'x-request-id', b'req_a4fe4ce6e3c1adcac8ee40768937790b'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9366dd4aadedd1df-ICN'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:31,941 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:45:31,941 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-04-26 23:45:31,941 - DEBUG - receive_response_body.complete
2025-04-26 23:45:31,941 - DEBUG - response_closed.started
2025-04-26 23:45:31,941 - DEBUG - response_closed.complete
2025-04-26 23:45:31,942 - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Sat, 26 Apr 2025 14:45:33 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'jiyeon-4fdfbx', 'openai-processing-ms': '1677', 'openai-version': '2020-10-01', 'x-ratelimit-limit-requests': '500', 'x-ratelimit-limit-tokens': '30000', 'x-ratelimit-remaining-requests': '499', 'x-ratelimit-remaining-tokens': '29387', 'x-ratelimit-reset-requests': '120ms', 'x-ratelimit-reset-tokens': '1.226s', 'x-request-id': 'req_a4fe4ce6e3c1adcac8ee40768937790b', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9366dd4aadedd1df-ICN', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-04-26 23:45:31,942 - DEBUG - request_id: req_a4fe4ce6e3c1adcac8ee40768937790b
2025-04-26 23:45:31,942 - INFO - Generated email type: order confirmation
2025-04-26 23:45:31,942 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:45:31,942 - DEBUG - send_request_headers.started request=<Request [b'GET']> stream_id=13
2025-04-26 23:45:31,943 - DEBUG - Adding (b':method', b'GET') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:31,943 - DEBUG - Encoding 2 with 7 bits
2025-04-26 23:45:31,943 - DEBUG - Adding (b':authority', b'ujvbinqvvgbzgwqluian.supabase.co') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:31,943 - DEBUG - Encoding 77 with 7 bits
2025-04-26 23:45:31,943 - DEBUG - Adding (b':scheme', b'https') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:31,943 - DEBUG - Encoding 7 with 7 bits
2025-04-26 23:45:31,943 - DEBUG - Adding (b':path', b'/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:31,943 - DEBUG - Encoding 63 with 7 bits
2025-04-26 23:45:31,943 - DEBUG - Adding (b'accept', b'*/*') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:31,943 - DEBUG - Encoding 75 with 7 bits
2025-04-26 23:45:31,943 - DEBUG - Adding (b'accept-encoding', b'gzip, deflate') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:31,943 - DEBUG - Encoding 16 with 7 bits
2025-04-26 23:45:31,943 - DEBUG - Adding (b'user-agent', b'python-httpx/0.28.1') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:31,943 - DEBUG - Encoding 74 with 7 bits
2025-04-26 23:45:31,943 - DEBUG - Adding (b'x-client-info', b'supabase-py/2.15.0') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:31,943 - DEBUG - Encoding 73 with 7 bits
2025-04-26 23:45:31,943 - DEBUG - Adding (b'apikey', b'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:31,943 - DEBUG - Encoding 72 with 7 bits
2025-04-26 23:45:31,943 - DEBUG - Adding (b'authorization', b'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:True, huffman:True
2025-04-26 23:45:31,943 - DEBUG - Encoding 23 with 4 bits
2025-04-26 23:45:31,943 - DEBUG - Encoding 171 with 7 bits
2025-04-26 23:45:31,943 - DEBUG - Adding (b'accept-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:31,943 - DEBUG - Encoding 71 with 7 bits
2025-04-26 23:45:31,943 - DEBUG - Adding (b'content-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:31,943 - DEBUG - Encoding 70 with 7 bits
2025-04-26 23:45:31,943 - DEBUG - Encoded header block to b"\x82\xcd\x87\xbf\xcb\x90\xca\xc9\xc8\x1f\x08\xff,\xbaQ\xd8[\x14/\xac\xb3\xc7\x88\x86\xd4l\xb98{\xc8\x1d&\xc8\x8c\x95ml\x97\xb29\x93\xad\x7f\x9coe}r\xfa\xcbY\x19\xd0mF\xcb\xeeO\xcb\xb3\xf3\xa7\x0f\xbf\xdd\xd9\x11\x92\xac\xb4~\x9b#\x99*\xe3\xdaJr\xd7\x1dXE%2\x18\xb4\xc8\xc99y\x08\xf9a\xb7!\xbc\x18\x94\xbe\x8f\xdd\xd9\x1c\xc9N\x1bc\x13F\xcf{-|\xff6\x1bWL\x0c\xe9\xbf\xb1\xbd;\xe1oU\xfe\x08\xc9O\x16\x89{#\x9a:B-\x17\xf8z\xd3\xd3\xabZ\x7f\x00\xbf\xb768)\xe5'\xefZ(\x0e;\xbaz\xe8\xaa\xefsT\x8f\xcfp\xb7\xe2\xd6\xa7\xdeG\xf4\xed\xc1#6n\xf1\xc7\xc6"
2025-04-26 23:45:31,944 - DEBUG - send_request_headers.complete
2025-04-26 23:45:31,944 - DEBUG - send_request_body.started request=<Request [b'GET']> stream_id=13
2025-04-26 23:45:31,944 - DEBUG - send_request_body.complete
2025-04-26 23:45:31,944 - DEBUG - receive_response_headers.started request=<Request [b'GET']> stream_id=13
2025-04-26 23:45:32,453 - DEBUG - Decoding b"\x88a\x96\xdc4\xfd('\x14\x86\xbb\x14\x10\x04\xda\x81j\xe3M\xdce\xa51h\xdf\xe1^\x84\x02\xcd1\xf3\x7f!\x8f}\x97\x1c\x92F\xde\x01\t,\x81\x925\xb2^\xd3\xe0\xdf\xc3\xdd\xdc\xdb\xda\xd9\xd8\xd7\x7f\x17\x012\xd6\xd5"
2025-04-26 23:45:32,453 - DEBUG - Decoded 8, consumed 1 bytes
2025-04-26 23:45:32,453 - DEBUG - Decoded (b':status', b'200'), consumed 1
2025-04-26 23:45:32,453 - DEBUG - Decoded 33, consumed 1 bytes
2025-04-26 23:45:32,453 - DEBUG - Decoded 22, consumed 1 bytes
2025-04-26 23:45:32,453 - DEBUG - Decoded (b'date', b'Sat, 26 Apr 2025 14:45:34 GMT'), total consumed 24 bytes, indexed True
2025-04-26 23:45:32,453 - DEBUG - Decoded 97, consumed 1 bytes
2025-04-26 23:45:32,453 - DEBUG - Decoded (b'content-type', b'application/json; charset=utf-8'), consumed 1
2025-04-26 23:45:32,453 - DEBUG - Decoded 30, consumed 1 bytes
2025-04-26 23:45:32,453 - DEBUG - Decoded 4, consumed 1 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded (b'content-range', b'0-4/*'), total consumed 6 bytes, indexed True
2025-04-26 23:45:32,454 - DEBUG - Decoded 96, consumed 2 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded 15, consumed 1 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded (b'cf-ray', b'9366dd580ccfd1db-ICN'), total consumed 18 bytes, indexed True
2025-04-26 23:45:32,454 - DEBUG - Decoded 96, consumed 1 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded (b'cf-cache-status', b'DYNAMIC'), consumed 1
2025-04-26 23:45:32,454 - DEBUG - Decoded 95, consumed 1 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded (b'content-encoding', b'gzip'), consumed 1
2025-04-26 23:45:32,454 - DEBUG - Decoded 67, consumed 1 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded (b'content-location', b'/email_logs?order=sent_at.asc&select=%2A&thread_id=eq.19661e534867a709'), consumed 1
2025-04-26 23:45:32,454 - DEBUG - Decoded 93, consumed 1 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), consumed 1
2025-04-26 23:45:32,454 - DEBUG - Decoded 92, consumed 1 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded (b'vary', b'Accept-Encoding'), consumed 1
2025-04-26 23:45:32,454 - DEBUG - Decoded 91, consumed 1 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded (b'content-profile', b'public'), consumed 1
2025-04-26 23:45:32,454 - DEBUG - Decoded 90, consumed 1 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded (b'sb-gateway-version', <memory at 0x10a108640>), consumed 1
2025-04-26 23:45:32,454 - DEBUG - Decoded 89, consumed 1 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), consumed 1
2025-04-26 23:45:32,454 - DEBUG - Decoded 88, consumed 1 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded (b'x-content-type-options', b'nosniff'), consumed 1
2025-04-26 23:45:32,454 - DEBUG - Decoded 87, consumed 1 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded (b'x-envoy-attempt-count', <memory at 0x10a108400>), consumed 1
2025-04-26 23:45:32,454 - DEBUG - Decoded 86, consumed 2 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded 1, consumed 1 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded (b'x-envoy-upstream-service-time', <memory at 0x10a109840>), total consumed 4 bytes, indexed True
2025-04-26 23:45:32,454 - DEBUG - Decoded 86, consumed 1 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded (b'server', b'cloudflare'), consumed 1
2025-04-26 23:45:32,454 - DEBUG - Decoded 85, consumed 1 bytes
2025-04-26 23:45:32,454 - DEBUG - Decoded (b'alt-svc', b'h3=":443"; ma=86400'), consumed 1
2025-04-26 23:45:32,454 - DEBUG - receive_response_headers.complete return_value=(200, [(b'date', b'Sat, 26 Apr 2025 14:45:34 GMT'), (b'content-type', b'application/json; charset=utf-8'), (b'content-range', b'0-4/*'), (b'cf-ray', b'9366dd580ccfd1db-ICN'), (b'cf-cache-status', b'DYNAMIC'), (b'content-encoding', b'gzip'), (b'content-location', b'/email_logs?order=sent_at.asc&select=%2A&thread_id=eq.19661e534867a709'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'vary', b'Accept-Encoding'), (b'content-profile', b'public'), (b'sb-gateway-version', b'1'), (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), (b'x-content-type-options', b'nosniff'), (b'x-envoy-attempt-count', b'1'), (b'x-envoy-upstream-service-time', b'2'), (b'server', b'cloudflare'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:32,455 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:45:32,455 - DEBUG - receive_response_body.started request=<Request [b'GET']> stream_id=13
2025-04-26 23:45:32,455 - DEBUG - receive_response_body.complete
2025-04-26 23:45:32,455 - DEBUG - response_closed.started stream_id=13
2025-04-26 23:45:32,455 - DEBUG - response_closed.complete
2025-04-26 23:45:32,457 - INFO - Found 5 emails in thread
2025-04-26 23:45:32,458 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a procurement expert. Your task is to find the LATEST delivery date mentioned in the document. Return ONLY the date in YYYY-MM-DD format, with no additional text or explanation.'}, {'role': 'user', 'content': '\nYou are a procurement expert. Analyze the email body and attachments to find the latest delivery date.\n\nYou must carefully read both the email content and the attachment texts to extract the most accurate **delivery date**, also known as "requested delivery date", "expected delivery date", "delivery by", or similar expressions.\n\nThe delivery date may be explicitly stated (e.g., "delivery date: 2025-04-30") or implied using relative expressions (e.g., "delayed by 2 days", "delivery next Friday").\n\nUse the following rules carefully:\n\nRules for Choosing the Delivery Date:\n1. If multiple delivery dates are mentioned, ALWAYS choose the LATEST one.\n2. If a delivery date change is described (e.g., "delivery moved from April 24 to April 30", "delayed by a week"), ALWAYS use the NEW (updated) delivery date.\n3. If a clear explicit date is written, use it ONLY IF there is no later delivery update.\n4. Even if an explicit (clearly written) delivery date exists, if a LATER delay or reschedule is mentioned (even indirectly), calculate and use the NEW latest delivery date instead.\n5. When calculating a delivery date from a **relative expression** (e.g., "2 days later", "delayed by one week", "next Friday"):\n    - Prefer using the **reference_date** (most recent scheduled delivery date) as the base.\n    - If no valid reference_date is available, use the **received_date** (email sent/received date) as the base.\n6. If no valid delivery date can be determined, return only the word **"Null"** (case-sensitive).\n7. Final output must be ONLY a date in **YYYY-MM-DD** format, without any other text.\n\nExamples:\n- "Original delivery was 2025-04-24, changed to 2025-04-30" → **2025-04-30**\n- "First batch delivery on 2025-04-24, second batch on 2025-04-30" → **2025-04-30**\n- "Shipment delayed by 2 days" (reference_date = 2025-04-26) → **2025-04-28**\n- "Delivery next Friday" (received_date = 2025-04-26) → **2025-05-02**\n- "Delivery date: 2025-04-26", but later mentions "delayed by 5 days" → **2025-05-01** (even though explicit 4/26 exists, the latest update matters)\n\nContext information:\n- Sent date (received_date): None\n- Reference delivery date (reference_date): 2025-05-02\n\nEmail content:\nDear Jiyeon,\r\n\r\nThank you for your purchase order (*PO No. PO-20250413-001*).\r\n\r\nI found there was an error in the delivery date. We set the expected\r\ndelivery date by April 30, 2025. Please check the date.\r\nWe are pleased to confirm acceptance of the order under the following terms:\r\n\r\n   -\r\n\r\n   *Expected Delivery Date:* April 30, 2025\r\n   -\r\n\r\n   *Delivery Address:* 789 Assembly Line Rd, Houston, TX\r\n   -\r\n\r\n   *Order Details:* Three items with $1,434.31\r\n   -\r\n\r\n   *Additional Notes:* FedEx Freight\r\n\r\nWe have initiated the processing and will ensure on-time delivery.\r\nShould you have any questions or further requests, please don’t hesitate to\r\nreach out.\r\n\r\nWe appreciate your business and look forward to serving you.\r\n\r\nBest regards,\r\n*Mega Industrial Supplies Inc.*\r\nJohn Doe\r\n\r\nddd7913@gmail.com\r\n\r\n2025년 4월 23일 (수) 오후 6:08, Jiyeon Park <jiyeon@shiftsai.com>님이 작성:\r\n\r\n> Dear Vendor,\r\n>\r\n> I hope this message finds you well.\r\n>\r\n> Please find attached our purchase order for the following items\r\n>\r\n> We kindly ask you to confirm receipt of the order and let us know if the\r\n> delivery timeline is feasible. If there are any questions or additional\r\n> information required, feel free to reach out at any time.\r\n>\r\n> Thank you for your continued support.\r\n>\r\n> Best regards,\r\n> Jiyeon Park\r\n>\r\n> Shiftsai\r\n>\r\n> jiyeon@shiftsai.com\r\n>\r\n\n\nAttachment content:\n\n\nFinal answer (Only one date or "Null"):\n'}], 'model': 'gpt-4-turbo', 'max_tokens': 100, 'temperature': 0.0}}
2025-04-26 23:45:32,458 - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-04-26 23:45:32,459 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-26 23:45:32,459 - DEBUG - send_request_headers.complete
2025-04-26 23:45:32,459 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-26 23:45:32,459 - DEBUG - send_request_body.complete
2025-04-26 23:45:32,459 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-26 23:45:33,475 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 26 Apr 2025 14:45:35 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'jiyeon-4fdfbx'), (b'openai-processing-ms', b'569'), (b'openai-version', b'2020-10-01'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'30000'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'29039'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'1.922s'), (b'x-request-id', b'req_312f8aa28365c6af6b446e95d81f8652'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9366dd5b48cad1df-ICN'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:33,476 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:45:33,476 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-04-26 23:45:33,529 - DEBUG - receive_response_body.complete
2025-04-26 23:45:33,529 - DEBUG - response_closed.started
2025-04-26 23:45:33,529 - DEBUG - response_closed.complete
2025-04-26 23:45:33,529 - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Sat, 26 Apr 2025 14:45:35 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'jiyeon-4fdfbx', 'openai-processing-ms': '569', 'openai-version': '2020-10-01', 'x-ratelimit-limit-requests': '500', 'x-ratelimit-limit-tokens': '30000', 'x-ratelimit-remaining-requests': '499', 'x-ratelimit-remaining-tokens': '29039', 'x-ratelimit-reset-requests': '120ms', 'x-ratelimit-reset-tokens': '1.922s', 'x-request-id': 'req_312f8aa28365c6af6b446e95d81f8652', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9366dd5b48cad1df-ICN', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-04-26 23:45:33,529 - DEBUG - request_id: req_312f8aa28365c6af6b446e95d81f8652
2025-04-26 23:45:33,530 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 23:45:33,530 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:45:33,530 - DEBUG - Email log data: {'thread_id': '19661e534867a709', 'direction': 'inbound', 'sender_email': 'Jiyeon Park <ddd7913@gmail.com>', 'recipient_email': 'Jiyeon Park <jiyeon@shiftsai.com>', 'subject': 'Re: [Purchase Order Attached] Request for Supply – Shiftsai', 'sent_at': None, 'created_at': '2025-04-26T14:45:33.530445', 'updated_at': '2025-04-26T14:45:33.530445', 'received_at': 'Wed, 23 Apr 2025 18:13:42 +0900', 'draft_body': None, 'status': 'received', 'email_type': 'order confirmation', 'has_attachment': False, 'filename': None, 'attachment_types': [], 'summary': 'The supplier has confirmed the acceptance of purchase order PO-20250413-001 with an expected delivery date of April 30, 2025, and has initiated the processing of the order.', 'sender_role': 'vendor', 'parsed_delivery_date': '2025-04-30', 'trigger_reason': None, 'body': 'Dear Jiyeon,\r\n\r\nThank you for your purchase order (*PO No. PO-20250413-001*).\r\n\r\nI found there was an error in the delivery date. We set the expected\r\ndelivery date by April 30, 2025. Please check the date.\r\nWe are pleased to confirm acceptance of the order under the following terms:\r\n\r\n   -\r\n\r\n   *Expected Delivery Date:* April 30, 2025\r\n   -\r\n\r\n   *Delivery Address:* 789 Assembly Line Rd, Houston, TX\r\n   -\r\n\r\n   *Order Details:* Three items with $1,434.31\r\n   -\r\n\r\n   *Additional Notes:* FedEx Freight\r\n\r\nWe have initiated the processing and will ensure on-time delivery.\r\nShould you have any questions or further requests, please don’t hesitate to\r\nreach out.\r\n\r\nWe appreciate your business and look forward to serving you.\r\n\r\nBest regards,\r\n*Mega Industrial Supplies Inc.*\r\nJohn Doe\r\n\r\nddd7913@gmail.com\r\n\r\n2025년 4월 23일 (수) 오후 6:08, Jiyeon Park <jiyeon@shiftsai.com>님이 작성:\r\n\r\n> Dear Vendor,\r\n>\r\n> I hope this message finds you well.\r\n>\r\n> Please find attached our purchase order for the following items\r\n>\r\n> We kindly ask you to confirm receipt of the order and let us know if the\r\n> delivery timeline is feasible. If there are any questions or additional\r\n> information required, feel free to reach out at any time.\r\n>\r\n> Thank you for your continued support.\r\n>\r\n> Best regards,\r\n> Jiyeon Park\r\n>\r\n> Shiftsai\r\n>\r\n> jiyeon@shiftsai.com\r\n>\r\n'}
2025-04-26 23:45:33,530 - DEBUG - send_request_headers.started request=<Request [b'POST']> stream_id=15
2025-04-26 23:45:33,531 - DEBUG - Adding (b':method', b'POST') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:33,531 - DEBUG - Encoding 3 with 7 bits
2025-04-26 23:45:33,531 - DEBUG - Adding (b':authority', b'ujvbinqvvgbzgwqluian.supabase.co') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:33,531 - DEBUG - Encoding 77 with 7 bits
2025-04-26 23:45:33,531 - DEBUG - Adding (b':scheme', b'https') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:33,531 - DEBUG - Encoding 7 with 7 bits
2025-04-26 23:45:33,531 - DEBUG - Adding (b':path', b'/rest/v1/email_logs') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:33,531 - DEBUG - Encoding 69 with 7 bits
2025-04-26 23:45:33,531 - DEBUG - Adding (b'accept', b'*/*') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:33,531 - DEBUG - Encoding 75 with 7 bits
2025-04-26 23:45:33,531 - DEBUG - Adding (b'accept-encoding', b'gzip, deflate') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:33,531 - DEBUG - Encoding 16 with 7 bits
2025-04-26 23:45:33,531 - DEBUG - Adding (b'user-agent', b'python-httpx/0.28.1') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:33,531 - DEBUG - Encoding 74 with 7 bits
2025-04-26 23:45:33,531 - DEBUG - Adding (b'x-client-info', b'supabase-py/2.15.0') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:33,531 - DEBUG - Encoding 73 with 7 bits
2025-04-26 23:45:33,531 - DEBUG - Adding (b'apikey', b'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:33,531 - DEBUG - Encoding 72 with 7 bits
2025-04-26 23:45:33,531 - DEBUG - Adding (b'authorization', b'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:True, huffman:True
2025-04-26 23:45:33,531 - DEBUG - Encoding 23 with 4 bits
2025-04-26 23:45:33,531 - DEBUG - Encoding 171 with 7 bits
2025-04-26 23:45:33,531 - DEBUG - Adding (b'accept-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:33,531 - DEBUG - Encoding 71 with 7 bits
2025-04-26 23:45:33,531 - DEBUG - Adding (b'content-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:33,531 - DEBUG - Encoding 70 with 7 bits
2025-04-26 23:45:33,531 - DEBUG - Adding (b'prefer', b'return=representation') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:33,531 - DEBUG - Encoding 68 with 7 bits
2025-04-26 23:45:33,531 - DEBUG - Adding (b'content-length', b'2267') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:33,531 - DEBUG - Encoding 28 with 6 bits
2025-04-26 23:45:33,532 - DEBUG - Encoding 3 with 7 bits
2025-04-26 23:45:33,532 - DEBUG - Adding (b'content-type', b'application/json') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:33,532 - DEBUG - Encoding 67 with 7 bits
2025-04-26 23:45:33,532 - DEBUG - Encoded header block to b"\x83\xcd\x87\xc5\xcb\x90\xca\xc9\xc8\x1f\x08\xff,\xbaQ\xd8[\x14/\xac\xb3\xc7\x88\x86\xd4l\xb98{\xc8\x1d&\xc8\x8c\x95ml\x97\xb29\x93\xad\x7f\x9coe}r\xfa\xcbY\x19\xd0mF\xcb\xeeO\xcb\xb3\xf3\xa7\x0f\xbf\xdd\xd9\x11\x92\xac\xb4~\x9b#\x99*\xe3\xdaJr\xd7\x1dXE%2\x18\xb4\xc8\xc99y\x08\xf9a\xb7!\xbc\x18\x94\xbe\x8f\xdd\xd9\x1c\xc9N\x1bc\x13F\xcf{-|\xff6\x1bWL\x0c\xe9\xbf\xb1\xbd;\xe1oU\xfe\x08\xc9O\x16\x89{#\x9a:B-\x17\xf8z\xd3\xd3\xabZ\x7f\x00\xbf\xb768)\xe5'\xefZ(\x0e;\xbaz\xe8\xaa\xefsT\x8f\xcfp\xb7\xe2\xd6\xa7\xdeG\xf4\xed\xc1#6n\xf1\xc7\xc6\xc4\\\x83\x10\x9cw\xc3"
2025-04-26 23:45:33,532 - DEBUG - send_request_headers.complete
2025-04-26 23:45:33,532 - DEBUG - send_request_body.started request=<Request [b'POST']> stream_id=15
2025-04-26 23:45:33,532 - DEBUG - send_request_body.complete
2025-04-26 23:45:33,532 - DEBUG - receive_response_headers.started request=<Request [b'POST']> stream_id=15
2025-04-26 23:45:33,565 - DEBUG - Decoding b"\xd4a\x96\xdc4\xfd('\x14\x86\xbb\x14\x10\x04\xda\x81j\xe3M\xdce\xb51h\xdf\xe5\xd3\x7f$\x90}\x97\x1c\x92G\x03+\xed= d\x8dl\x97\xb4\xff\xe3\xe2\xe0\xdf\xde\xd2\xdd\xdc\xdb\xda\xca\xd8\xd7"
2025-04-26 23:45:33,565 - DEBUG - Decoded 84, consumed 1 bytes
2025-04-26 23:45:33,565 - DEBUG - Decoded (b':status', b'201'), consumed 1
2025-04-26 23:45:33,565 - DEBUG - Decoded 33, consumed 1 bytes
2025-04-26 23:45:33,565 - DEBUG - Decoded 22, consumed 1 bytes
2025-04-26 23:45:33,565 - DEBUG - Decoded (b'date', b'Sat, 26 Apr 2025 14:45:35 GMT'), total consumed 24 bytes, indexed True
2025-04-26 23:45:33,565 - DEBUG - Decoded 101, consumed 1 bytes
2025-04-26 23:45:33,565 - DEBUG - Decoded (b'content-type', b'application/json; charset=utf-8'), consumed 1
2025-04-26 23:45:33,565 - DEBUG - Decoded 83, consumed 1 bytes
2025-04-26 23:45:33,565 - DEBUG - Decoded (b'content-range', <memory at 0x10a108dc0>), consumed 1
2025-04-26 23:45:33,565 - DEBUG - Decoded 99, consumed 2 bytes
2025-04-26 23:45:33,565 - DEBUG - Decoded 16, consumed 1 bytes
2025-04-26 23:45:33,565 - DEBUG - Decoded (b'cf-ray', b'9366dd61f948d1db-ICN'), total consumed 19 bytes, indexed True
2025-04-26 23:45:33,565 - DEBUG - Decoded 99, consumed 1 bytes
2025-04-26 23:45:33,565 - DEBUG - Decoded (b'cf-cache-status', b'DYNAMIC'), consumed 1
2025-04-26 23:45:33,566 - DEBUG - Decoded 98, consumed 1 bytes
2025-04-26 23:45:33,566 - DEBUG - Decoded (b'content-encoding', b'gzip'), consumed 1
2025-04-26 23:45:33,566 - DEBUG - Decoded 96, consumed 1 bytes
2025-04-26 23:45:33,566 - DEBUG - Decoded (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), consumed 1
2025-04-26 23:45:33,566 - DEBUG - Decoded 95, consumed 1 bytes
2025-04-26 23:45:33,566 - DEBUG - Decoded (b'vary', b'Accept-Encoding'), consumed 1
2025-04-26 23:45:33,566 - DEBUG - Decoded 94, consumed 1 bytes
2025-04-26 23:45:33,566 - DEBUG - Decoded (b'content-profile', b'public'), consumed 1
2025-04-26 23:45:33,566 - DEBUG - Decoded 82, consumed 1 bytes
2025-04-26 23:45:33,566 - DEBUG - Decoded (b'preference-applied', b'return=representation'), consumed 1
2025-04-26 23:45:33,566 - DEBUG - Decoded 93, consumed 1 bytes
2025-04-26 23:45:33,566 - DEBUG - Decoded (b'sb-gateway-version', <memory at 0x10a108640>), consumed 1
2025-04-26 23:45:33,566 - DEBUG - Decoded 92, consumed 1 bytes
2025-04-26 23:45:33,566 - DEBUG - Decoded (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), consumed 1
2025-04-26 23:45:33,566 - DEBUG - Decoded 91, consumed 1 bytes
2025-04-26 23:45:33,566 - DEBUG - Decoded (b'x-content-type-options', b'nosniff'), consumed 1
2025-04-26 23:45:33,566 - DEBUG - Decoded 90, consumed 1 bytes
2025-04-26 23:45:33,566 - DEBUG - Decoded (b'x-envoy-attempt-count', <memory at 0x10a108400>), consumed 1
2025-04-26 23:45:33,566 - DEBUG - Decoded 74, consumed 1 bytes
2025-04-26 23:45:33,566 - DEBUG - Decoded (b'x-envoy-upstream-service-time', <memory at 0x10a108580>), consumed 1
2025-04-26 23:45:33,566 - DEBUG - Decoded 88, consumed 1 bytes
2025-04-26 23:45:33,566 - DEBUG - Decoded (b'server', b'cloudflare'), consumed 1
2025-04-26 23:45:33,566 - DEBUG - Decoded 87, consumed 1 bytes
2025-04-26 23:45:33,566 - DEBUG - Decoded (b'alt-svc', b'h3=":443"; ma=86400'), consumed 1
2025-04-26 23:45:33,567 - DEBUG - receive_response_headers.complete return_value=(201, [(b'date', b'Sat, 26 Apr 2025 14:45:35 GMT'), (b'content-type', b'application/json; charset=utf-8'), (b'content-range', b'*/*'), (b'cf-ray', b'9366dd61f948d1db-ICN'), (b'cf-cache-status', b'DYNAMIC'), (b'content-encoding', b'gzip'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'vary', b'Accept-Encoding'), (b'content-profile', b'public'), (b'preference-applied', b'return=representation'), (b'sb-gateway-version', b'1'), (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), (b'x-content-type-options', b'nosniff'), (b'x-envoy-attempt-count', b'1'), (b'x-envoy-upstream-service-time', b'6'), (b'server', b'cloudflare'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:33,567 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:45:33,567 - DEBUG - receive_response_body.started request=<Request [b'POST']> stream_id=15
2025-04-26 23:45:33,567 - DEBUG - receive_response_body.complete
2025-04-26 23:45:33,567 - DEBUG - response_closed.started stream_id=15
2025-04-26 23:45:33,567 - DEBUG - response_closed.complete
2025-04-26 23:45:33,568 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:45:33,569 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:45:33,569 - INFO - Processed email: 19661ecddae94e49
2025-04-26 23:45:33,570 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/196651cd71e2d02d?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:33,885 - INFO - Is vendor: False
2025-04-26 23:45:33,886 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/196675e9f37b6406?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:34,193 - INFO - Is vendor: True
2025-04-26 23:45:34,194 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/196675e9f37b6406?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:34,603 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/196675e9f37b6406?format=full&alt=json
2025-04-26 23:45:34,925 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a procurement specialist analyzing emails.'}, {'role': 'user', 'content': '\nYou are a procurement specialist assistant.\n\nYour task is to analyze the following email and deliver two outputs:\n\n1. **Summary** (1–3 clear sentences):  \n   Focus specifically on the procurement-related **action** or **request**.  \n   Exclude unnecessary greetings, background stories, or non-actionable information.  \n   Be direct and practical as a procurement professional would expect.\n\n2. **Type** (short 2–3 word category):  \n   Provide a short but clear 2–3 word phrase that best describes the critical **action and purpose** of this email for a procurement specialist.  \n   Avoid vague or generic words. Be specific and professional.\n\nExamples:\n- delivery delay\n- delay confirmation\n- purchase order\n- payment request\n- contract negotiation\n- shipment inquiry\n- invoice issue\n\nPick a phrase that immediately tells a procurement professional what the email is about.\n\n\nFormat your response exactly like this:\n---\nSUMMARY: [your 1–3 sentence summary]  \nTYPE: [your single word]\n---\n\nEmail content:\nDear Jiyeon,\r\n\r\nWe apologize that we are struggling to meet the delivery date. It is going\r\nto take 2 days more.\r\nSorry about that....\r\n\r\nSincerely\r\n\r\n*Mega Industrial Supplies Inc.*\r\nJohn Doe\r\n\r\nddd7913@gmail.com\r\n\r\n\r\n2025년 4월 23일 (수) 오후 6:13, Jiyeon Park <ddd7913@gmail.com>님이 작성:\r\n\r\n> Dear Jiyeon,\r\n>\r\n> Thank you for your purchase order (*PO No. PO-20250413-001*).\r\n>\r\n> I found there was an error in the delivery date. We set the expected\r\n> delivery date by April 30, 2025. Please check the date.\r\n> We are pleased to confirm acceptance of the order under the following\r\n> terms:\r\n>\r\n>    -\r\n>\r\n>    *Expected Delivery Date:* April 30, 2025\r\n>    -\r\n>\r\n>    *Delivery Address:* 789 Assembly Line Rd, Houston, TX\r\n>    -\r\n>\r\n>    *Order Details:* Three items with $1,434.31\r\n>    -\r\n>\r\n>    *Additional Notes:* FedEx Freight\r\n>\r\n> We have initiated the processing and will ensure on-time delivery.\r\n> Should you have any questions or further requests, please don’t hesitate\r\n> to reach out.\r\n>\r\n> We appreciate your business and look forward to serving you.\r\n>\r\n> Best regards,\r\n> *Mega Industrial Supplies Inc.*\r\n> John Doe\r\n>\r\n> ddd7913@gmail.com\r\n>\r\n> 2025년 4월 23일 (수) 오후 6:08, Jiyeon Park <jiyeon@shiftsai.com>님이 작성:\r\n>\r\n>> Dear Vendor,\r\n>>\r\n>> I hope this message finds you well.\r\n>>\r\n>> Please find attached our purchase order for the following items\r\n>>\r\n>> We kindly ask you to confirm receipt of the order and let us know if the\r\n>> delivery timeline is feasible. If there are any questions or additional\r\n>> information required, feel free to reach out at any time.\r\n>>\r\n>> Thank you for your continued support.\r\n>>\r\n>> Best regards,\r\n>> Jiyeon Park\r\n>>\r\n>> Shiftsai\r\n>>\r\n>> jiyeon@shiftsai.com\r\n>>\r\n>\r\n\n\n'}], 'model': 'gpt-4-turbo', 'max_tokens': 150, 'temperature': 0.0}}
2025-04-26 23:45:34,926 - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-04-26 23:45:34,926 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-26 23:45:34,926 - DEBUG - send_request_headers.complete
2025-04-26 23:45:34,926 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-26 23:45:34,927 - DEBUG - send_request_body.complete
2025-04-26 23:45:34,927 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-26 23:45:36,752 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 26 Apr 2025 14:45:38 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'jiyeon-4fdfbx'), (b'openai-processing-ms', b'1376'), (b'openai-version', b'2020-10-01'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'30000'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'29290'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'1.42s'), (b'x-request-id', b'req_7c0f59361909039c79ad6071714b0999'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9366dd6aba10d1df-ICN'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:36,753 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:45:36,753 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-04-26 23:45:36,753 - DEBUG - receive_response_body.complete
2025-04-26 23:45:36,754 - DEBUG - response_closed.started
2025-04-26 23:45:36,754 - DEBUG - response_closed.complete
2025-04-26 23:45:36,754 - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Sat, 26 Apr 2025 14:45:38 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'jiyeon-4fdfbx', 'openai-processing-ms': '1376', 'openai-version': '2020-10-01', 'x-ratelimit-limit-requests': '500', 'x-ratelimit-limit-tokens': '30000', 'x-ratelimit-remaining-requests': '499', 'x-ratelimit-remaining-tokens': '29290', 'x-ratelimit-reset-requests': '120ms', 'x-ratelimit-reset-tokens': '1.42s', 'x-request-id': 'req_7c0f59361909039c79ad6071714b0999', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9366dd6aba10d1df-ICN', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-04-26 23:45:36,754 - DEBUG - request_id: req_7c0f59361909039c79ad6071714b0999
2025-04-26 23:45:36,754 - INFO - Generated email type: delivery delay
2025-04-26 23:45:36,754 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:45:36,755 - DEBUG - send_request_headers.started request=<Request [b'GET']> stream_id=17
2025-04-26 23:45:36,755 - DEBUG - Adding (b':method', b'GET') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:36,755 - DEBUG - Encoding 2 with 7 bits
2025-04-26 23:45:36,755 - DEBUG - Adding (b':authority', b'ujvbinqvvgbzgwqluian.supabase.co') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:36,755 - DEBUG - Encoding 78 with 7 bits
2025-04-26 23:45:36,755 - DEBUG - Adding (b':scheme', b'https') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:36,755 - DEBUG - Encoding 7 with 7 bits
2025-04-26 23:45:36,755 - DEBUG - Adding (b':path', b'/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:36,755 - DEBUG - Encoding 64 with 7 bits
2025-04-26 23:45:36,755 - DEBUG - Adding (b'accept', b'*/*') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:36,755 - DEBUG - Encoding 76 with 7 bits
2025-04-26 23:45:36,755 - DEBUG - Adding (b'accept-encoding', b'gzip, deflate') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:36,755 - DEBUG - Encoding 16 with 7 bits
2025-04-26 23:45:36,755 - DEBUG - Adding (b'user-agent', b'python-httpx/0.28.1') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:36,755 - DEBUG - Encoding 75 with 7 bits
2025-04-26 23:45:36,755 - DEBUG - Adding (b'x-client-info', b'supabase-py/2.15.0') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:36,755 - DEBUG - Encoding 74 with 7 bits
2025-04-26 23:45:36,755 - DEBUG - Adding (b'apikey', b'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:36,755 - DEBUG - Encoding 73 with 7 bits
2025-04-26 23:45:36,755 - DEBUG - Adding (b'authorization', b'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:True, huffman:True
2025-04-26 23:45:36,755 - DEBUG - Encoding 23 with 4 bits
2025-04-26 23:45:36,755 - DEBUG - Encoding 171 with 7 bits
2025-04-26 23:45:36,755 - DEBUG - Adding (b'accept-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:36,755 - DEBUG - Encoding 72 with 7 bits
2025-04-26 23:45:36,755 - DEBUG - Adding (b'content-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:36,756 - DEBUG - Encoding 71 with 7 bits
2025-04-26 23:45:36,756 - DEBUG - Encoded header block to b"\x82\xce\x87\xc0\xcc\x90\xcb\xca\xc9\x1f\x08\xff,\xbaQ\xd8[\x14/\xac\xb3\xc7\x88\x86\xd4l\xb98{\xc8\x1d&\xc8\x8c\x95ml\x97\xb29\x93\xad\x7f\x9coe}r\xfa\xcbY\x19\xd0mF\xcb\xeeO\xcb\xb3\xf3\xa7\x0f\xbf\xdd\xd9\x11\x92\xac\xb4~\x9b#\x99*\xe3\xdaJr\xd7\x1dXE%2\x18\xb4\xc8\xc99y\x08\xf9a\xb7!\xbc\x18\x94\xbe\x8f\xdd\xd9\x1c\xc9N\x1bc\x13F\xcf{-|\xff6\x1bWL\x0c\xe9\xbf\xb1\xbd;\xe1oU\xfe\x08\xc9O\x16\x89{#\x9a:B-\x17\xf8z\xd3\xd3\xabZ\x7f\x00\xbf\xb768)\xe5'\xefZ(\x0e;\xbaz\xe8\xaa\xefsT\x8f\xcfp\xb7\xe2\xd6\xa7\xdeG\xf4\xed\xc1#6n\xf1\xc8\xc7"
2025-04-26 23:45:36,756 - DEBUG - send_request_headers.complete
2025-04-26 23:45:36,756 - DEBUG - send_request_body.started request=<Request [b'GET']> stream_id=17
2025-04-26 23:45:36,756 - DEBUG - send_request_body.complete
2025-04-26 23:45:36,756 - DEBUG - receive_response_headers.started request=<Request [b'GET']> stream_id=17
2025-04-26 23:45:36,791 - DEBUG - Decoding b"\x88a\x96\xdc4\xfd('\x14\x86\xbb\x14\x10\x04\xda\x81j\xe3M\xdce\xe51h\xdf\xe7^\x84\x02\xcd\xb1\xf3\x7f'\x90}\x97\x1c\x92G\\\x0c\x92\xc7 d\x8dl\x97\xb4\xff\xe6\xe5\xc9\xe3\xe2\xe1\xe0\xdf\xde\xdd\x7f\x1d\x014\xdc\xdb"
2025-04-26 23:45:36,791 - DEBUG - Decoded 8, consumed 1 bytes
2025-04-26 23:45:36,791 - DEBUG - Decoded (b':status', b'200'), consumed 1
2025-04-26 23:45:36,791 - DEBUG - Decoded 33, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded 22, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'date', b'Sat, 26 Apr 2025 14:45:38 GMT'), total consumed 24 bytes, indexed True
2025-04-26 23:45:36,792 - DEBUG - Decoded 103, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'content-type', b'application/json; charset=utf-8'), consumed 1
2025-04-26 23:45:36,792 - DEBUG - Decoded 30, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded 4, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'content-range', b'0-5/*'), total consumed 6 bytes, indexed True
2025-04-26 23:45:36,792 - DEBUG - Decoded 102, consumed 2 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded 16, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'cf-ray', b'9366dd761dfbd1db-ICN'), total consumed 19 bytes, indexed True
2025-04-26 23:45:36,792 - DEBUG - Decoded 102, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'cf-cache-status', b'DYNAMIC'), consumed 1
2025-04-26 23:45:36,792 - DEBUG - Decoded 101, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'content-encoding', b'gzip'), consumed 1
2025-04-26 23:45:36,792 - DEBUG - Decoded 73, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'content-location', b'/email_logs?order=sent_at.asc&select=%2A&thread_id=eq.19661e534867a709'), consumed 1
2025-04-26 23:45:36,792 - DEBUG - Decoded 99, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), consumed 1
2025-04-26 23:45:36,792 - DEBUG - Decoded 98, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'vary', b'Accept-Encoding'), consumed 1
2025-04-26 23:45:36,792 - DEBUG - Decoded 97, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'content-profile', b'public'), consumed 1
2025-04-26 23:45:36,792 - DEBUG - Decoded 96, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'sb-gateway-version', <memory at 0x10a108640>), consumed 1
2025-04-26 23:45:36,792 - DEBUG - Decoded 95, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), consumed 1
2025-04-26 23:45:36,792 - DEBUG - Decoded 94, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'x-content-type-options', b'nosniff'), consumed 1
2025-04-26 23:45:36,792 - DEBUG - Decoded 93, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'x-envoy-attempt-count', <memory at 0x10a108400>), consumed 1
2025-04-26 23:45:36,792 - DEBUG - Decoded 92, consumed 2 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded 1, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'x-envoy-upstream-service-time', <memory at 0x10a10a5c0>), total consumed 4 bytes, indexed True
2025-04-26 23:45:36,792 - DEBUG - Decoded 92, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'server', b'cloudflare'), consumed 1
2025-04-26 23:45:36,792 - DEBUG - Decoded 91, consumed 1 bytes
2025-04-26 23:45:36,792 - DEBUG - Decoded (b'alt-svc', b'h3=":443"; ma=86400'), consumed 1
2025-04-26 23:45:36,792 - DEBUG - receive_response_headers.complete return_value=(200, [(b'date', b'Sat, 26 Apr 2025 14:45:38 GMT'), (b'content-type', b'application/json; charset=utf-8'), (b'content-range', b'0-5/*'), (b'cf-ray', b'9366dd761dfbd1db-ICN'), (b'cf-cache-status', b'DYNAMIC'), (b'content-encoding', b'gzip'), (b'content-location', b'/email_logs?order=sent_at.asc&select=%2A&thread_id=eq.19661e534867a709'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'vary', b'Accept-Encoding'), (b'content-profile', b'public'), (b'sb-gateway-version', b'1'), (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), (b'x-content-type-options', b'nosniff'), (b'x-envoy-attempt-count', b'1'), (b'x-envoy-upstream-service-time', b'4'), (b'server', b'cloudflare'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:36,793 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:45:36,793 - DEBUG - receive_response_body.started request=<Request [b'GET']> stream_id=17
2025-04-26 23:45:36,793 - DEBUG - receive_response_body.complete
2025-04-26 23:45:36,793 - DEBUG - response_closed.started stream_id=17
2025-04-26 23:45:36,793 - DEBUG - response_closed.complete
2025-04-26 23:45:36,793 - INFO - Found 6 emails in thread
2025-04-26 23:45:36,794 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a procurement expert. Your task is to find the LATEST delivery date mentioned in the document. Return ONLY the date in YYYY-MM-DD format, with no additional text or explanation.'}, {'role': 'user', 'content': '\nYou are a procurement expert. Analyze the email body and attachments to find the latest delivery date.\n\nYou must carefully read both the email content and the attachment texts to extract the most accurate **delivery date**, also known as "requested delivery date", "expected delivery date", "delivery by", or similar expressions.\n\nThe delivery date may be explicitly stated (e.g., "delivery date: 2025-04-30") or implied using relative expressions (e.g., "delayed by 2 days", "delivery next Friday").\n\nUse the following rules carefully:\n\nRules for Choosing the Delivery Date:\n1. If multiple delivery dates are mentioned, ALWAYS choose the LATEST one.\n2. If a delivery date change is described (e.g., "delivery moved from April 24 to April 30", "delayed by a week"), ALWAYS use the NEW (updated) delivery date.\n3. If a clear explicit date is written, use it ONLY IF there is no later delivery update.\n4. Even if an explicit (clearly written) delivery date exists, if a LATER delay or reschedule is mentioned (even indirectly), calculate and use the NEW latest delivery date instead.\n5. When calculating a delivery date from a **relative expression** (e.g., "2 days later", "delayed by one week", "next Friday"):\n    - Prefer using the **reference_date** (most recent scheduled delivery date) as the base.\n    - If no valid reference_date is available, use the **received_date** (email sent/received date) as the base.\n6. If no valid delivery date can be determined, return only the word **"Null"** (case-sensitive).\n7. Final output must be ONLY a date in **YYYY-MM-DD** format, without any other text.\n\nExamples:\n- "Original delivery was 2025-04-24, changed to 2025-04-30" → **2025-04-30**\n- "First batch delivery on 2025-04-24, second batch on 2025-04-30" → **2025-04-30**\n- "Shipment delayed by 2 days" (reference_date = 2025-04-26) → **2025-04-28**\n- "Delivery next Friday" (received_date = 2025-04-26) → **2025-05-02**\n- "Delivery date: 2025-04-26", but later mentions "delayed by 5 days" → **2025-05-01** (even though explicit 4/26 exists, the latest update matters)\n\nContext information:\n- Sent date (received_date): None\n- Reference delivery date (reference_date): 2025-04-30\n\nEmail content:\nDear Jiyeon,\r\n\r\nWe apologize that we are struggling to meet the delivery date. It is going\r\nto take 2 days more.\r\nSorry about that....\r\n\r\nSincerely\r\n\r\n*Mega Industrial Supplies Inc.*\r\nJohn Doe\r\n\r\nddd7913@gmail.com\r\n\r\n\r\n2025년 4월 23일 (수) 오후 6:13, Jiyeon Park <ddd7913@gmail.com>님이 작성:\r\n\r\n> Dear Jiyeon,\r\n>\r\n> Thank you for your purchase order (*PO No. PO-20250413-001*).\r\n>\r\n> I found there was an error in the delivery date. We set the expected\r\n> delivery date by April 30, 2025. Please check the date.\r\n> We are pleased to confirm acceptance of the order under the following\r\n> terms:\r\n>\r\n>    -\r\n>\r\n>    *Expected Delivery Date:* April 30, 2025\r\n>    -\r\n>\r\n>    *Delivery Address:* 789 Assembly Line Rd, Houston, TX\r\n>    -\r\n>\r\n>    *Order Details:* Three items with $1,434.31\r\n>    -\r\n>\r\n>    *Additional Notes:* FedEx Freight\r\n>\r\n> We have initiated the processing and will ensure on-time delivery.\r\n> Should you have any questions or further requests, please don’t hesitate\r\n> to reach out.\r\n>\r\n> We appreciate your business and look forward to serving you.\r\n>\r\n> Best regards,\r\n> *Mega Industrial Supplies Inc.*\r\n> John Doe\r\n>\r\n> ddd7913@gmail.com\r\n>\r\n> 2025년 4월 23일 (수) 오후 6:08, Jiyeon Park <jiyeon@shiftsai.com>님이 작성:\r\n>\r\n>> Dear Vendor,\r\n>>\r\n>> I hope this message finds you well.\r\n>>\r\n>> Please find attached our purchase order for the following items\r\n>>\r\n>> We kindly ask you to confirm receipt of the order and let us know if the\r\n>> delivery timeline is feasible. If there are any questions or additional\r\n>> information required, feel free to reach out at any time.\r\n>>\r\n>> Thank you for your continued support.\r\n>>\r\n>> Best regards,\r\n>> Jiyeon Park\r\n>>\r\n>> Shiftsai\r\n>>\r\n>> jiyeon@shiftsai.com\r\n>>\r\n>\r\n\n\nAttachment content:\n\n\nFinal answer (Only one date or "Null"):\n'}], 'model': 'gpt-4-turbo', 'max_tokens': 100, 'temperature': 0.0}}
2025-04-26 23:45:36,795 - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-04-26 23:45:36,795 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-26 23:45:36,795 - DEBUG - send_request_headers.complete
2025-04-26 23:45:36,795 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-26 23:45:36,795 - DEBUG - send_request_body.complete
2025-04-26 23:45:36,795 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-26 23:45:37,879 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 26 Apr 2025 14:45:39 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'jiyeon-4fdfbx'), (b'openai-processing-ms', b'667'), (b'openai-version', b'2020-10-01'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'30000'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'28942'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'2.116s'), (b'x-request-id', b'req_d91ff8a4dabb365b8fa4cdf55fc13cff'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9366dd765d0bd1df-ICN'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:37,879 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:45:37,879 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-04-26 23:45:37,880 - DEBUG - receive_response_body.complete
2025-04-26 23:45:37,880 - DEBUG - response_closed.started
2025-04-26 23:45:37,880 - DEBUG - response_closed.complete
2025-04-26 23:45:37,880 - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Sat, 26 Apr 2025 14:45:39 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'jiyeon-4fdfbx', 'openai-processing-ms': '667', 'openai-version': '2020-10-01', 'x-ratelimit-limit-requests': '500', 'x-ratelimit-limit-tokens': '30000', 'x-ratelimit-remaining-requests': '499', 'x-ratelimit-remaining-tokens': '28942', 'x-ratelimit-reset-requests': '120ms', 'x-ratelimit-reset-tokens': '2.116s', 'x-request-id': 'req_d91ff8a4dabb365b8fa4cdf55fc13cff', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9366dd765d0bd1df-ICN', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-04-26 23:45:37,880 - DEBUG - request_id: req_d91ff8a4dabb365b8fa4cdf55fc13cff
2025-04-26 23:45:37,880 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 23:45:37,880 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:45:37,880 - DEBUG - Email log data: {'thread_id': '19661e534867a709', 'direction': 'inbound', 'sender_email': 'Jiyeon Park <ddd7913@gmail.com>', 'recipient_email': 'Jiyeon Park <jiyeon@shiftsai.com>', 'subject': 'Re: [Purchase Order Attached] Request for Supply – Shiftsai', 'sent_at': None, 'created_at': '2025-04-26T14:45:37.880738', 'updated_at': '2025-04-26T14:45:37.880738', 'received_at': 'Thu, 24 Apr 2025 19:36:04 +0900', 'draft_body': None, 'status': 'received', 'email_type': 'delivery delay', 'has_attachment': False, 'filename': None, 'attachment_types': [], 'summary': 'Mega Industrial Supplies Inc. has informed Jiyeon Park that there will be a 2-day delay in the delivery of the purchase order PO-20250413-001, originally expected by April 30, 2025.', 'sender_role': 'vendor', 'parsed_delivery_date': '2025-05-02', 'trigger_reason': None, 'body': 'Dear Jiyeon,\r\n\r\nWe apologize that we are struggling to meet the delivery date. It is going\r\nto take 2 days more.\r\nSorry about that....\r\n\r\nSincerely\r\n\r\n*Mega Industrial Supplies Inc.*\r\nJohn Doe\r\n\r\nddd7913@gmail.com\r\n\r\n\r\n2025년 4월 23일 (수) 오후 6:13, Jiyeon Park <ddd7913@gmail.com>님이 작성:\r\n\r\n> Dear Jiyeon,\r\n>\r\n> Thank you for your purchase order (*PO No. PO-20250413-001*).\r\n>\r\n> I found there was an error in the delivery date. We set the expected\r\n> delivery date by April 30, 2025. Please check the date.\r\n> We are pleased to confirm acceptance of the order under the following\r\n> terms:\r\n>\r\n>    -\r\n>\r\n>    *Expected Delivery Date:* April 30, 2025\r\n>    -\r\n>\r\n>    *Delivery Address:* 789 Assembly Line Rd, Houston, TX\r\n>    -\r\n>\r\n>    *Order Details:* Three items with $1,434.31\r\n>    -\r\n>\r\n>    *Additional Notes:* FedEx Freight\r\n>\r\n> We have initiated the processing and will ensure on-time delivery.\r\n> Should you have any questions or further requests, please don’t hesitate\r\n> to reach out.\r\n>\r\n> We appreciate your business and look forward to serving you.\r\n>\r\n> Best regards,\r\n> *Mega Industrial Supplies Inc.*\r\n> John Doe\r\n>\r\n> ddd7913@gmail.com\r\n>\r\n> 2025년 4월 23일 (수) 오후 6:08, Jiyeon Park <jiyeon@shiftsai.com>님이 작성:\r\n>\r\n>> Dear Vendor,\r\n>>\r\n>> I hope this message finds you well.\r\n>>\r\n>> Please find attached our purchase order for the following items\r\n>>\r\n>> We kindly ask you to confirm receipt of the order and let us know if the\r\n>> delivery timeline is feasible. If there are any questions or additional\r\n>> information required, feel free to reach out at any time.\r\n>>\r\n>> Thank you for your continued support.\r\n>>\r\n>> Best regards,\r\n>> Jiyeon Park\r\n>>\r\n>> Shiftsai\r\n>>\r\n>> jiyeon@shiftsai.com\r\n>>\r\n>\r\n'}
2025-04-26 23:45:37,881 - DEBUG - send_request_headers.started request=<Request [b'POST']> stream_id=19
2025-04-26 23:45:37,881 - DEBUG - Adding (b':method', b'POST') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:37,881 - DEBUG - Encoding 3 with 7 bits
2025-04-26 23:45:37,881 - DEBUG - Adding (b':authority', b'ujvbinqvvgbzgwqluian.supabase.co') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:37,881 - DEBUG - Encoding 78 with 7 bits
2025-04-26 23:45:37,881 - DEBUG - Adding (b':scheme', b'https') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:37,881 - DEBUG - Encoding 7 with 7 bits
2025-04-26 23:45:37,881 - DEBUG - Adding (b':path', b'/rest/v1/email_logs') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:37,881 - DEBUG - Encoding 70 with 7 bits
2025-04-26 23:45:37,881 - DEBUG - Adding (b'accept', b'*/*') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:37,881 - DEBUG - Encoding 76 with 7 bits
2025-04-26 23:45:37,881 - DEBUG - Adding (b'accept-encoding', b'gzip, deflate') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:37,881 - DEBUG - Encoding 16 with 7 bits
2025-04-26 23:45:37,881 - DEBUG - Adding (b'user-agent', b'python-httpx/0.28.1') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:37,881 - DEBUG - Encoding 75 with 7 bits
2025-04-26 23:45:37,881 - DEBUG - Adding (b'x-client-info', b'supabase-py/2.15.0') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:37,881 - DEBUG - Encoding 74 with 7 bits
2025-04-26 23:45:37,881 - DEBUG - Adding (b'apikey', b'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:37,881 - DEBUG - Encoding 73 with 7 bits
2025-04-26 23:45:37,881 - DEBUG - Adding (b'authorization', b'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:True, huffman:True
2025-04-26 23:45:37,881 - DEBUG - Encoding 23 with 4 bits
2025-04-26 23:45:37,881 - DEBUG - Encoding 171 with 7 bits
2025-04-26 23:45:37,882 - DEBUG - Adding (b'accept-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:37,882 - DEBUG - Encoding 72 with 7 bits
2025-04-26 23:45:37,882 - DEBUG - Adding (b'content-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:37,882 - DEBUG - Encoding 71 with 7 bits
2025-04-26 23:45:37,882 - DEBUG - Adding (b'prefer', b'return=representation') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:37,882 - DEBUG - Encoding 69 with 7 bits
2025-04-26 23:45:37,882 - DEBUG - Adding (b'content-length', b'2696') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:37,882 - DEBUG - Encoding 28 with 6 bits
2025-04-26 23:45:37,882 - DEBUG - Encoding 3 with 7 bits
2025-04-26 23:45:37,882 - DEBUG - Adding (b'content-type', b'application/json') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:37,882 - DEBUG - Encoding 68 with 7 bits
2025-04-26 23:45:37,882 - DEBUG - Encoded header block to b"\x83\xce\x87\xc6\xcc\x90\xcb\xca\xc9\x1f\x08\xff,\xbaQ\xd8[\x14/\xac\xb3\xc7\x88\x86\xd4l\xb98{\xc8\x1d&\xc8\x8c\x95ml\x97\xb29\x93\xad\x7f\x9coe}r\xfa\xcbY\x19\xd0mF\xcb\xeeO\xcb\xb3\xf3\xa7\x0f\xbf\xdd\xd9\x11\x92\xac\xb4~\x9b#\x99*\xe3\xdaJr\xd7\x1dXE%2\x18\xb4\xc8\xc99y\x08\xf9a\xb7!\xbc\x18\x94\xbe\x8f\xdd\xd9\x1c\xc9N\x1bc\x13F\xcf{-|\xff6\x1bWL\x0c\xe9\xbf\xb1\xbd;\xe1oU\xfe\x08\xc9O\x16\x89{#\x9a:B-\x17\xf8z\xd3\xd3\xabZ\x7f\x00\xbf\xb768)\xe5'\xefZ(\x0e;\xbaz\xe8\xaa\xefsT\x8f\xcfp\xb7\xe2\xd6\xa7\xdeG\xf4\xed\xc1#6n\xf1\xc8\xc7\xc5\\\x83\x13\x8f\xb9\xc4"
2025-04-26 23:45:37,882 - DEBUG - send_request_headers.complete
2025-04-26 23:45:37,882 - DEBUG - send_request_body.started request=<Request [b'POST']> stream_id=19
2025-04-26 23:45:37,882 - DEBUG - send_request_body.complete
2025-04-26 23:45:37,882 - DEBUG - receive_response_headers.started request=<Request [b'POST']> stream_id=19
2025-04-26 23:45:37,921 - DEBUG - Decoding b"\xdaa\x96\xdc4\xfd('\x14\x86\xbb\x14\x10\x04\xda\x81j\xe3M\xdch\nb\xd1\xbf\xeb\xd9\x7f*\x8f}\x97\x1c\x92Gd\x10\xd9\x04\x81\x925\xb2^\xd3\xe9\xe8\xe6\xe5\xe4\xd8\xe3\xe2\xe1\xe0\xc0\xde\xdd"
2025-04-26 23:45:37,921 - DEBUG - Decoded 90, consumed 1 bytes
2025-04-26 23:45:37,921 - DEBUG - Decoded (b':status', b'201'), consumed 1
2025-04-26 23:45:37,921 - DEBUG - Decoded 33, consumed 1 bytes
2025-04-26 23:45:37,921 - DEBUG - Decoded 22, consumed 1 bytes
2025-04-26 23:45:37,921 - DEBUG - Decoded (b'date', b'Sat, 26 Apr 2025 14:45:40 GMT'), total consumed 24 bytes, indexed True
2025-04-26 23:45:37,921 - DEBUG - Decoded 107, consumed 1 bytes
2025-04-26 23:45:37,921 - DEBUG - Decoded (b'content-type', b'application/json; charset=utf-8'), consumed 1
2025-04-26 23:45:37,921 - DEBUG - Decoded 89, consumed 1 bytes
2025-04-26 23:45:37,921 - DEBUG - Decoded (b'content-range', <memory at 0x10a108dc0>), consumed 1
2025-04-26 23:45:37,921 - DEBUG - Decoded 105, consumed 2 bytes
2025-04-26 23:45:37,921 - DEBUG - Decoded 15, consumed 1 bytes
2025-04-26 23:45:37,921 - DEBUG - Decoded (b'cf-ray', b'9366dd7d2a30d1db-ICN'), total consumed 18 bytes, indexed True
2025-04-26 23:45:37,921 - DEBUG - Decoded 105, consumed 1 bytes
2025-04-26 23:45:37,922 - DEBUG - Decoded (b'cf-cache-status', b'DYNAMIC'), consumed 1
2025-04-26 23:45:37,922 - DEBUG - Decoded 104, consumed 1 bytes
2025-04-26 23:45:37,922 - DEBUG - Decoded (b'content-encoding', b'gzip'), consumed 1
2025-04-26 23:45:37,922 - DEBUG - Decoded 102, consumed 1 bytes
2025-04-26 23:45:37,922 - DEBUG - Decoded (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), consumed 1
2025-04-26 23:45:37,922 - DEBUG - Decoded 101, consumed 1 bytes
2025-04-26 23:45:37,922 - DEBUG - Decoded (b'vary', b'Accept-Encoding'), consumed 1
2025-04-26 23:45:37,922 - DEBUG - Decoded 100, consumed 1 bytes
2025-04-26 23:45:37,922 - DEBUG - Decoded (b'content-profile', b'public'), consumed 1
2025-04-26 23:45:37,922 - DEBUG - Decoded 88, consumed 1 bytes
2025-04-26 23:45:37,922 - DEBUG - Decoded (b'preference-applied', b'return=representation'), consumed 1
2025-04-26 23:45:37,922 - DEBUG - Decoded 99, consumed 1 bytes
2025-04-26 23:45:37,922 - DEBUG - Decoded (b'sb-gateway-version', <memory at 0x10a108640>), consumed 1
2025-04-26 23:45:37,922 - DEBUG - Decoded 98, consumed 1 bytes
2025-04-26 23:45:37,922 - DEBUG - Decoded (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), consumed 1
2025-04-26 23:45:37,922 - DEBUG - Decoded 97, consumed 1 bytes
2025-04-26 23:45:37,922 - DEBUG - Decoded (b'x-content-type-options', b'nosniff'), consumed 1
2025-04-26 23:45:37,922 - DEBUG - Decoded 96, consumed 1 bytes
2025-04-26 23:45:37,922 - DEBUG - Decoded (b'x-envoy-attempt-count', <memory at 0x10a108400>), consumed 1
2025-04-26 23:45:37,922 - DEBUG - Decoded 64, consumed 1 bytes
2025-04-26 23:45:37,922 - DEBUG - Decoded (b'x-envoy-upstream-service-time', <memory at 0x10a10a5c0>), consumed 1
2025-04-26 23:45:37,922 - DEBUG - Decoded 94, consumed 1 bytes
2025-04-26 23:45:37,922 - DEBUG - Decoded (b'server', b'cloudflare'), consumed 1
2025-04-26 23:45:37,922 - DEBUG - Decoded 93, consumed 1 bytes
2025-04-26 23:45:37,922 - DEBUG - Decoded (b'alt-svc', b'h3=":443"; ma=86400'), consumed 1
2025-04-26 23:45:37,922 - DEBUG - receive_response_headers.complete return_value=(201, [(b'date', b'Sat, 26 Apr 2025 14:45:40 GMT'), (b'content-type', b'application/json; charset=utf-8'), (b'content-range', b'*/*'), (b'cf-ray', b'9366dd7d2a30d1db-ICN'), (b'cf-cache-status', b'DYNAMIC'), (b'content-encoding', b'gzip'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'vary', b'Accept-Encoding'), (b'content-profile', b'public'), (b'preference-applied', b'return=representation'), (b'sb-gateway-version', b'1'), (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), (b'x-content-type-options', b'nosniff'), (b'x-envoy-attempt-count', b'1'), (b'x-envoy-upstream-service-time', b'4'), (b'server', b'cloudflare'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:37,922 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:45:37,922 - DEBUG - receive_response_body.started request=<Request [b'POST']> stream_id=19
2025-04-26 23:45:37,923 - DEBUG - receive_response_body.complete
2025-04-26 23:45:37,923 - DEBUG - response_closed.started stream_id=19
2025-04-26 23:45:37,923 - DEBUG - response_closed.complete
2025-04-26 23:45:37,923 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:45:37,924 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:45:37,924 - INFO - Processed email: 196675e9f37b6406
2025-04-26 23:45:37,925 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19667636e36ec3ed?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:38,289 - INFO - Is vendor: True
2025-04-26 23:45:38,291 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19667636e36ec3ed?format=metadata&metadataHeaders=Subject&metadataHeaders=From&metadataHeaders=Date&metadataHeaders=To&alt=json
2025-04-26 23:45:38,699 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages/19667636e36ec3ed?format=full&alt=json
2025-04-26 23:45:39,110 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a procurement specialist analyzing emails.'}, {'role': 'user', 'content': '\nYou are a procurement specialist assistant.\n\nYour task is to analyze the following email and deliver two outputs:\n\n1. **Summary** (1–3 clear sentences):  \n   Focus specifically on the procurement-related **action** or **request**.  \n   Exclude unnecessary greetings, background stories, or non-actionable information.  \n   Be direct and practical as a procurement professional would expect.\n\n2. **Type** (short 2–3 word category):  \n   Provide a short but clear 2–3 word phrase that best describes the critical **action and purpose** of this email for a procurement specialist.  \n   Avoid vague or generic words. Be specific and professional.\n\nExamples:\n- delivery delay\n- delay confirmation\n- purchase order\n- payment request\n- contract negotiation\n- shipment inquiry\n- invoice issue\n\nPick a phrase that immediately tells a procurement professional what the email is about.\n\n\nFormat your response exactly like this:\n---\nSUMMARY: [your 1–3 sentence summary]  \nTYPE: [your single word]\n---\n\nEmail content:\nAlright.\r\nPlease expedite it at your earliest convenience\r\n\r\nBest Regards\r\nShiftsai\r\nJiyeon Park\r\n\r\n2025년 4월 24일 (목) 오후 7:36, Jiyeon Park <ddd7913@gmail.com>님이 작성:\r\n\r\n> Dear Jiyeon,\r\n>\r\n> We apologize that we are struggling to meet the delivery date. It is going\r\n> to take 2 days more.\r\n> Sorry about that....\r\n>\r\n> Sincerely\r\n>\r\n> *Mega Industrial Supplies Inc.*\r\n> John Doe\r\n>\r\n> ddd7913@gmail.com\r\n>\r\n>\r\n> 2025년 4월 23일 (수) 오후 6:13, Jiyeon Park <ddd7913@gmail.com>님이 작성:\r\n>\r\n>> Dear Jiyeon,\r\n>>\r\n>> Thank you for your purchase order (*PO No. PO-20250413-001*).\r\n>>\r\n>> I found there was an error in the delivery date. We set the expected\r\n>> delivery date by April 30, 2025. Please check the date.\r\n>> We are pleased to confirm acceptance of the order under the following\r\n>> terms:\r\n>>\r\n>>    -\r\n>>\r\n>>    *Expected Delivery Date:* April 30, 2025\r\n>>    -\r\n>>\r\n>>    *Delivery Address:* 789 Assembly Line Rd, Houston, TX\r\n>>    -\r\n>>\r\n>>    *Order Details:* Three items with $1,434.31\r\n>>    -\r\n>>\r\n>>    *Additional Notes:* FedEx Freight\r\n>>\r\n>> We have initiated the processing and will ensure on-time delivery.\r\n>> Should you have any questions or further requests, please don’t hesitate\r\n>> to reach out.\r\n>>\r\n>> We appreciate your business and look forward to serving you.\r\n>>\r\n>> Best regards,\r\n>> *Mega Industrial Supplies Inc.*\r\n>> John Doe\r\n>>\r\n>> ddd7913@gmail.com\r\n>>\r\n>> 2025년 4월 23일 (수) 오후 6:08, Jiyeon Park <jiyeon@shiftsai.com>님이 작성:\r\n>>\r\n>>> Dear Vendor,\r\n>>>\r\n>>> I hope this message finds you well.\r\n>>>\r\n>>> Please find attached our purchase order for the following items\r\n>>>\r\n>>> We kindly ask you to confirm receipt of the order and let us know if the\r\n>>> delivery timeline is feasible. If there are any questions or additional\r\n>>> information required, feel free to reach out at any time.\r\n>>>\r\n>>> Thank you for your continued support.\r\n>>>\r\n>>> Best regards,\r\n>>> Jiyeon Park\r\n>>>\r\n>>> Shiftsai\r\n>>>\r\n>>> jiyeon@shiftsai.com\r\n>>>\r\n>>\r\n\n\n'}], 'model': 'gpt-4-turbo', 'max_tokens': 150, 'temperature': 0.0}}
2025-04-26 23:45:39,111 - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-04-26 23:45:39,111 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-26 23:45:39,112 - DEBUG - send_request_headers.complete
2025-04-26 23:45:39,112 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-26 23:45:39,112 - DEBUG - send_request_body.complete
2025-04-26 23:45:39,112 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-26 23:45:40,849 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 26 Apr 2025 14:45:42 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'jiyeon-4fdfbx'), (b'openai-processing-ms', b'1259'), (b'openai-version', b'2020-10-01'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'30000'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'29223'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'1.554s'), (b'x-request-id', b'req_0ff4929cbcceb27cbd1a005bf7ca1876'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9366dd84d82dd1df-ICN'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:40,849 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:45:40,849 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-04-26 23:45:40,849 - DEBUG - receive_response_body.complete
2025-04-26 23:45:40,849 - DEBUG - response_closed.started
2025-04-26 23:45:40,849 - DEBUG - response_closed.complete
2025-04-26 23:45:40,850 - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Sat, 26 Apr 2025 14:45:42 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'jiyeon-4fdfbx', 'openai-processing-ms': '1259', 'openai-version': '2020-10-01', 'x-ratelimit-limit-requests': '500', 'x-ratelimit-limit-tokens': '30000', 'x-ratelimit-remaining-requests': '499', 'x-ratelimit-remaining-tokens': '29223', 'x-ratelimit-reset-requests': '120ms', 'x-ratelimit-reset-tokens': '1.554s', 'x-request-id': 'req_0ff4929cbcceb27cbd1a005bf7ca1876', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9366dd84d82dd1df-ICN', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-04-26 23:45:40,850 - DEBUG - request_id: req_0ff4929cbcceb27cbd1a005bf7ca1876
2025-04-26 23:45:40,850 - INFO - Generated email type: delivery expedite
2025-04-26 23:45:40,850 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:45:40,850 - DEBUG - send_request_headers.started request=<Request [b'GET']> stream_id=21
2025-04-26 23:45:40,851 - DEBUG - Adding (b':method', b'GET') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:40,851 - DEBUG - Encoding 2 with 7 bits
2025-04-26 23:45:40,851 - DEBUG - Adding (b':authority', b'ujvbinqvvgbzgwqluian.supabase.co') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:40,851 - DEBUG - Encoding 79 with 7 bits
2025-04-26 23:45:40,851 - DEBUG - Adding (b':scheme', b'https') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:40,851 - DEBUG - Encoding 7 with 7 bits
2025-04-26 23:45:40,851 - DEBUG - Adding (b':path', b'/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:40,851 - DEBUG - Encoding 65 with 7 bits
2025-04-26 23:45:40,851 - DEBUG - Adding (b'accept', b'*/*') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:40,851 - DEBUG - Encoding 77 with 7 bits
2025-04-26 23:45:40,851 - DEBUG - Adding (b'accept-encoding', b'gzip, deflate') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:40,851 - DEBUG - Encoding 16 with 7 bits
2025-04-26 23:45:40,851 - DEBUG - Adding (b'user-agent', b'python-httpx/0.28.1') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:40,851 - DEBUG - Encoding 76 with 7 bits
2025-04-26 23:45:40,851 - DEBUG - Adding (b'x-client-info', b'supabase-py/2.15.0') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:40,851 - DEBUG - Encoding 75 with 7 bits
2025-04-26 23:45:40,851 - DEBUG - Adding (b'apikey', b'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:40,851 - DEBUG - Encoding 74 with 7 bits
2025-04-26 23:45:40,851 - DEBUG - Adding (b'authorization', b'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:True, huffman:True
2025-04-26 23:45:40,851 - DEBUG - Encoding 23 with 4 bits
2025-04-26 23:45:40,851 - DEBUG - Encoding 171 with 7 bits
2025-04-26 23:45:40,851 - DEBUG - Adding (b'accept-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:40,851 - DEBUG - Encoding 73 with 7 bits
2025-04-26 23:45:40,851 - DEBUG - Adding (b'content-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:40,851 - DEBUG - Encoding 72 with 7 bits
2025-04-26 23:45:40,851 - DEBUG - Encoded header block to b"\x82\xcf\x87\xc1\xcd\x90\xcc\xcb\xca\x1f\x08\xff,\xbaQ\xd8[\x14/\xac\xb3\xc7\x88\x86\xd4l\xb98{\xc8\x1d&\xc8\x8c\x95ml\x97\xb29\x93\xad\x7f\x9coe}r\xfa\xcbY\x19\xd0mF\xcb\xeeO\xcb\xb3\xf3\xa7\x0f\xbf\xdd\xd9\x11\x92\xac\xb4~\x9b#\x99*\xe3\xdaJr\xd7\x1dXE%2\x18\xb4\xc8\xc99y\x08\xf9a\xb7!\xbc\x18\x94\xbe\x8f\xdd\xd9\x1c\xc9N\x1bc\x13F\xcf{-|\xff6\x1bWL\x0c\xe9\xbf\xb1\xbd;\xe1oU\xfe\x08\xc9O\x16\x89{#\x9a:B-\x17\xf8z\xd3\xd3\xabZ\x7f\x00\xbf\xb768)\xe5'\xefZ(\x0e;\xbaz\xe8\xaa\xefsT\x8f\xcfp\xb7\xe2\xd6\xa7\xdeG\xf4\xed\xc1#6n\xf1\xc9\xc8"
2025-04-26 23:45:40,852 - DEBUG - send_request_headers.complete
2025-04-26 23:45:40,852 - DEBUG - send_request_body.started request=<Request [b'GET']> stream_id=21
2025-04-26 23:45:40,852 - DEBUG - send_request_body.complete
2025-04-26 23:45:40,852 - DEBUG - receive_response_headers.started request=<Request [b'GET']> stream_id=21
2025-04-26 23:45:40,893 - DEBUG - Decoding b"\x88a\x96\xdc4\xfd('\x14\x86\xbb\x14\x10\x04\xda\x81j\xe3M\xdci\x951h\xdf\xed^\x84\x02\xce1\xf3\x7f-\x90}\x97\x1c\x92G\xa5\x8eV\xa3\x902F\xb6K\xda\x7f\xec\xeb\xcf\xe9\xe8\xe7\xe6\xe5\xe4\xe3\x7f#\x0210\xe2\xe1"
2025-04-26 23:45:40,893 - DEBUG - Decoded 8, consumed 1 bytes
2025-04-26 23:45:40,893 - DEBUG - Decoded (b':status', b'200'), consumed 1
2025-04-26 23:45:40,893 - DEBUG - Decoded 33, consumed 1 bytes
2025-04-26 23:45:40,893 - DEBUG - Decoded 22, consumed 1 bytes
2025-04-26 23:45:40,893 - DEBUG - Decoded (b'date', b'Sat, 26 Apr 2025 14:45:43 GMT'), total consumed 24 bytes, indexed True
2025-04-26 23:45:40,893 - DEBUG - Decoded 109, consumed 1 bytes
2025-04-26 23:45:40,893 - DEBUG - Decoded (b'content-type', b'application/json; charset=utf-8'), consumed 1
2025-04-26 23:45:40,893 - DEBUG - Decoded 30, consumed 1 bytes
2025-04-26 23:45:40,893 - DEBUG - Decoded 4, consumed 1 bytes
2025-04-26 23:45:40,893 - DEBUG - Decoded (b'content-range', b'0-6/*'), total consumed 6 bytes, indexed True
2025-04-26 23:45:40,893 - DEBUG - Decoded 108, consumed 2 bytes
2025-04-26 23:45:40,893 - DEBUG - Decoded 16, consumed 1 bytes
2025-04-26 23:45:40,893 - DEBUG - Decoded (b'cf-ray', b'9366dd8fbf4bd1db-ICN'), total consumed 19 bytes, indexed True
2025-04-26 23:45:40,893 - DEBUG - Decoded 108, consumed 1 bytes
2025-04-26 23:45:40,893 - DEBUG - Decoded (b'cf-cache-status', b'DYNAMIC'), consumed 1
2025-04-26 23:45:40,893 - DEBUG - Decoded 107, consumed 1 bytes
2025-04-26 23:45:40,893 - DEBUG - Decoded (b'content-encoding', b'gzip'), consumed 1
2025-04-26 23:45:40,893 - DEBUG - Decoded 79, consumed 1 bytes
2025-04-26 23:45:40,893 - DEBUG - Decoded (b'content-location', b'/email_logs?order=sent_at.asc&select=%2A&thread_id=eq.19661e534867a709'), consumed 1
2025-04-26 23:45:40,893 - DEBUG - Decoded 105, consumed 1 bytes
2025-04-26 23:45:40,893 - DEBUG - Decoded (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), consumed 1
2025-04-26 23:45:40,893 - DEBUG - Decoded 104, consumed 1 bytes
2025-04-26 23:45:40,893 - DEBUG - Decoded (b'vary', b'Accept-Encoding'), consumed 1
2025-04-26 23:45:40,893 - DEBUG - Decoded 103, consumed 1 bytes
2025-04-26 23:45:40,893 - DEBUG - Decoded (b'content-profile', b'public'), consumed 1
2025-04-26 23:45:40,893 - DEBUG - Decoded 102, consumed 1 bytes
2025-04-26 23:45:40,893 - DEBUG - Decoded (b'sb-gateway-version', <memory at 0x10a108640>), consumed 1
2025-04-26 23:45:40,893 - DEBUG - Decoded 101, consumed 1 bytes
2025-04-26 23:45:40,894 - DEBUG - Decoded (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), consumed 1
2025-04-26 23:45:40,894 - DEBUG - Decoded 100, consumed 1 bytes
2025-04-26 23:45:40,894 - DEBUG - Decoded (b'x-content-type-options', b'nosniff'), consumed 1
2025-04-26 23:45:40,894 - DEBUG - Decoded 99, consumed 1 bytes
2025-04-26 23:45:40,894 - DEBUG - Decoded (b'x-envoy-attempt-count', <memory at 0x10a108400>), consumed 1
2025-04-26 23:45:40,894 - DEBUG - Decoded 98, consumed 2 bytes
2025-04-26 23:45:40,894 - DEBUG - Decoded 2, consumed 1 bytes
2025-04-26 23:45:40,894 - DEBUG - Decoded (b'x-envoy-upstream-service-time', <memory at 0x10a109f00>), total consumed 5 bytes, indexed True
2025-04-26 23:45:40,894 - DEBUG - Decoded 98, consumed 1 bytes
2025-04-26 23:45:40,894 - DEBUG - Decoded (b'server', b'cloudflare'), consumed 1
2025-04-26 23:45:40,894 - DEBUG - Decoded 97, consumed 1 bytes
2025-04-26 23:45:40,894 - DEBUG - Decoded (b'alt-svc', b'h3=":443"; ma=86400'), consumed 1
2025-04-26 23:45:40,894 - DEBUG - receive_response_headers.complete return_value=(200, [(b'date', b'Sat, 26 Apr 2025 14:45:43 GMT'), (b'content-type', b'application/json; charset=utf-8'), (b'content-range', b'0-6/*'), (b'cf-ray', b'9366dd8fbf4bd1db-ICN'), (b'cf-cache-status', b'DYNAMIC'), (b'content-encoding', b'gzip'), (b'content-location', b'/email_logs?order=sent_at.asc&select=%2A&thread_id=eq.19661e534867a709'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'vary', b'Accept-Encoding'), (b'content-profile', b'public'), (b'sb-gateway-version', b'1'), (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), (b'x-content-type-options', b'nosniff'), (b'x-envoy-attempt-count', b'1'), (b'x-envoy-upstream-service-time', b'10'), (b'server', b'cloudflare'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:40,894 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:45:40,894 - DEBUG - receive_response_body.started request=<Request [b'GET']> stream_id=21
2025-04-26 23:45:40,894 - DEBUG - receive_response_body.complete
2025-04-26 23:45:40,895 - DEBUG - response_closed.started stream_id=21
2025-04-26 23:45:40,895 - DEBUG - response_closed.complete
2025-04-26 23:45:40,895 - INFO - Found 7 emails in thread
2025-04-26 23:45:40,895 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are a procurement expert. Your task is to find the LATEST delivery date mentioned in the document. Return ONLY the date in YYYY-MM-DD format, with no additional text or explanation.'}, {'role': 'user', 'content': '\nYou are a procurement expert. Analyze the email body and attachments to find the latest delivery date.\n\nYou must carefully read both the email content and the attachment texts to extract the most accurate **delivery date**, also known as "requested delivery date", "expected delivery date", "delivery by", or similar expressions.\n\nThe delivery date may be explicitly stated (e.g., "delivery date: 2025-04-30") or implied using relative expressions (e.g., "delayed by 2 days", "delivery next Friday").\n\nUse the following rules carefully:\n\nRules for Choosing the Delivery Date:\n1. If multiple delivery dates are mentioned, ALWAYS choose the LATEST one.\n2. If a delivery date change is described (e.g., "delivery moved from April 24 to April 30", "delayed by a week"), ALWAYS use the NEW (updated) delivery date.\n3. If a clear explicit date is written, use it ONLY IF there is no later delivery update.\n4. Even if an explicit (clearly written) delivery date exists, if a LATER delay or reschedule is mentioned (even indirectly), calculate and use the NEW latest delivery date instead.\n5. When calculating a delivery date from a **relative expression** (e.g., "2 days later", "delayed by one week", "next Friday"):\n    - Prefer using the **reference_date** (most recent scheduled delivery date) as the base.\n    - If no valid reference_date is available, use the **received_date** (email sent/received date) as the base.\n6. If no valid delivery date can be determined, return only the word **"Null"** (case-sensitive).\n7. Final output must be ONLY a date in **YYYY-MM-DD** format, without any other text.\n\nExamples:\n- "Original delivery was 2025-04-24, changed to 2025-04-30" → **2025-04-30**\n- "First batch delivery on 2025-04-24, second batch on 2025-04-30" → **2025-04-30**\n- "Shipment delayed by 2 days" (reference_date = 2025-04-26) → **2025-04-28**\n- "Delivery next Friday" (received_date = 2025-04-26) → **2025-05-02**\n- "Delivery date: 2025-04-26", but later mentions "delayed by 5 days" → **2025-05-01** (even though explicit 4/26 exists, the latest update matters)\n\nContext information:\n- Sent date (received_date): None\n- Reference delivery date (reference_date): 2025-05-02\n\nEmail content:\nAlright.\r\nPlease expedite it at your earliest convenience\r\n\r\nBest Regards\r\nShiftsai\r\nJiyeon Park\r\n\r\n2025년 4월 24일 (목) 오후 7:36, Jiyeon Park <ddd7913@gmail.com>님이 작성:\r\n\r\n> Dear Jiyeon,\r\n>\r\n> We apologize that we are struggling to meet the delivery date. It is going\r\n> to take 2 days more.\r\n> Sorry about that....\r\n>\r\n> Sincerely\r\n>\r\n> *Mega Industrial Supplies Inc.*\r\n> John Doe\r\n>\r\n> ddd7913@gmail.com\r\n>\r\n>\r\n> 2025년 4월 23일 (수) 오후 6:13, Jiyeon Park <ddd7913@gmail.com>님이 작성:\r\n>\r\n>> Dear Jiyeon,\r\n>>\r\n>> Thank you for your purchase order (*PO No. PO-20250413-001*).\r\n>>\r\n>> I found there was an error in the delivery date. We set the expected\r\n>> delivery date by April 30, 2025. Please check the date.\r\n>> We are pleased to confirm acceptance of the order under the following\r\n>> terms:\r\n>>\r\n>>    -\r\n>>\r\n>>    *Expected Delivery Date:* April 30, 2025\r\n>>    -\r\n>>\r\n>>    *Delivery Address:* 789 Assembly Line Rd, Houston, TX\r\n>>    -\r\n>>\r\n>>    *Order Details:* Three items with $1,434.31\r\n>>    -\r\n>>\r\n>>    *Additional Notes:* FedEx Freight\r\n>>\r\n>> We have initiated the processing and will ensure on-time delivery.\r\n>> Should you have any questions or further requests, please don’t hesitate\r\n>> to reach out.\r\n>>\r\n>> We appreciate your business and look forward to serving you.\r\n>>\r\n>> Best regards,\r\n>> *Mega Industrial Supplies Inc.*\r\n>> John Doe\r\n>>\r\n>> ddd7913@gmail.com\r\n>>\r\n>> 2025년 4월 23일 (수) 오후 6:08, Jiyeon Park <jiyeon@shiftsai.com>님이 작성:\r\n>>\r\n>>> Dear Vendor,\r\n>>>\r\n>>> I hope this message finds you well.\r\n>>>\r\n>>> Please find attached our purchase order for the following items\r\n>>>\r\n>>> We kindly ask you to confirm receipt of the order and let us know if the\r\n>>> delivery timeline is feasible. If there are any questions or additional\r\n>>> information required, feel free to reach out at any time.\r\n>>>\r\n>>> Thank you for your continued support.\r\n>>>\r\n>>> Best regards,\r\n>>> Jiyeon Park\r\n>>>\r\n>>> Shiftsai\r\n>>>\r\n>>> jiyeon@shiftsai.com\r\n>>>\r\n>>\r\n\n\nAttachment content:\n\n\nFinal answer (Only one date or "Null"):\n'}], 'model': 'gpt-4-turbo', 'max_tokens': 100, 'temperature': 0.0}}
2025-04-26 23:45:40,896 - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-04-26 23:45:40,896 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-04-26 23:45:40,896 - DEBUG - send_request_headers.complete
2025-04-26 23:45:40,896 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-04-26 23:45:40,896 - DEBUG - send_request_body.complete
2025-04-26 23:45:40,897 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-04-26 23:45:41,770 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 26 Apr 2025 14:45:43 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'jiyeon-4fdfbx'), (b'openai-processing-ms', b'451'), (b'openai-version', b'2020-10-01'), (b'x-ratelimit-limit-requests', b'500'), (b'x-ratelimit-limit-tokens', b'30000'), (b'x-ratelimit-remaining-requests', b'499'), (b'x-ratelimit-remaining-tokens', b'28875'), (b'x-ratelimit-reset-requests', b'120ms'), (b'x-ratelimit-reset-tokens', b'2.25s'), (b'x-request-id', b'req_1b7f7a9e2e8e286a230b279b94e923a0'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'cf-cache-status', b'DYNAMIC'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9366dd900d43d1df-ICN'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:41,771 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:45:41,771 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-04-26 23:45:41,771 - DEBUG - receive_response_body.complete
2025-04-26 23:45:41,771 - DEBUG - response_closed.started
2025-04-26 23:45:41,771 - DEBUG - response_closed.complete
2025-04-26 23:45:41,772 - DEBUG - HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Sat, 26 Apr 2025 14:45:43 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'jiyeon-4fdfbx', 'openai-processing-ms': '451', 'openai-version': '2020-10-01', 'x-ratelimit-limit-requests': '500', 'x-ratelimit-limit-tokens': '30000', 'x-ratelimit-remaining-requests': '499', 'x-ratelimit-remaining-tokens': '28875', 'x-ratelimit-reset-requests': '120ms', 'x-ratelimit-reset-tokens': '2.25s', 'x-request-id': 'req_1b7f7a9e2e8e286a230b279b94e923a0', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'cf-cache-status': 'DYNAMIC', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9366dd900d43d1df-ICN', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-04-26 23:45:41,772 - DEBUG - request_id: req_1b7f7a9e2e8e286a230b279b94e923a0
2025-04-26 23:45:41,772 - INFO - Parsed delivery date: 2025-05-04
2025-04-26 23:45:41,772 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:45:41,772 - DEBUG - Email log data: {'thread_id': '19661e534867a709', 'direction': 'outbound', 'sender_email': 'Jiyeon Park <jiyeon@shiftsai.com>', 'recipient_email': 'Jiyeon Park <ddd7913@gmail.com>', 'subject': 'Re: [Purchase Order Attached] Request for Supply – Shiftsai', 'sent_at': 'Thu, 24 Apr 2025 19:41:31 +0900', 'created_at': '2025-04-26T14:45:41.772877', 'updated_at': '2025-04-26T14:45:41.772877', 'received_at': None, 'draft_body': None, 'status': 'sent', 'email_type': 'delivery expedite', 'has_attachment': False, 'filename': None, 'attachment_types': [], 'summary': 'Jiyeon Park from Shiftsai requests Mega Industrial Supplies Inc. to expedite the delivery of an order that is delayed by two days beyond the initially confirmed date of April 30, 2025.', 'sender_role': 'admin', 'parsed_delivery_date': '2025-05-04', 'trigger_reason': None, 'body': 'Alright.\r\nPlease expedite it at your earliest convenience\r\n\r\nBest Regards\r\nShiftsai\r\nJiyeon Park\r\n\r\n2025년 4월 24일 (목) 오후 7:36, Jiyeon Park <ddd7913@gmail.com>님이 작성:\r\n\r\n> Dear Jiyeon,\r\n>\r\n> We apologize that we are struggling to meet the delivery date. It is going\r\n> to take 2 days more.\r\n> Sorry about that....\r\n>\r\n> Sincerely\r\n>\r\n> *Mega Industrial Supplies Inc.*\r\n> John Doe\r\n>\r\n> ddd7913@gmail.com\r\n>\r\n>\r\n> 2025년 4월 23일 (수) 오후 6:13, Jiyeon Park <ddd7913@gmail.com>님이 작성:\r\n>\r\n>> Dear Jiyeon,\r\n>>\r\n>> Thank you for your purchase order (*PO No. PO-20250413-001*).\r\n>>\r\n>> I found there was an error in the delivery date. We set the expected\r\n>> delivery date by April 30, 2025. Please check the date.\r\n>> We are pleased to confirm acceptance of the order under the following\r\n>> terms:\r\n>>\r\n>>    -\r\n>>\r\n>>    *Expected Delivery Date:* April 30, 2025\r\n>>    -\r\n>>\r\n>>    *Delivery Address:* 789 Assembly Line Rd, Houston, TX\r\n>>    -\r\n>>\r\n>>    *Order Details:* Three items with $1,434.31\r\n>>    -\r\n>>\r\n>>    *Additional Notes:* FedEx Freight\r\n>>\r\n>> We have initiated the processing and will ensure on-time delivery.\r\n>> Should you have any questions or further requests, please don’t hesitate\r\n>> to reach out.\r\n>>\r\n>> We appreciate your business and look forward to serving you.\r\n>>\r\n>> Best regards,\r\n>> *Mega Industrial Supplies Inc.*\r\n>> John Doe\r\n>>\r\n>> ddd7913@gmail.com\r\n>>\r\n>> 2025년 4월 23일 (수) 오후 6:08, Jiyeon Park <jiyeon@shiftsai.com>님이 작성:\r\n>>\r\n>>> Dear Vendor,\r\n>>>\r\n>>> I hope this message finds you well.\r\n>>>\r\n>>> Please find attached our purchase order for the following items\r\n>>>\r\n>>> We kindly ask you to confirm receipt of the order and let us know if the\r\n>>> delivery timeline is feasible. If there are any questions or additional\r\n>>> information required, feel free to reach out at any time.\r\n>>>\r\n>>> Thank you for your continued support.\r\n>>>\r\n>>> Best regards,\r\n>>> Jiyeon Park\r\n>>>\r\n>>> Shiftsai\r\n>>>\r\n>>> jiyeon@shiftsai.com\r\n>>>\r\n>>\r\n'}
2025-04-26 23:45:41,774 - DEBUG - send_request_headers.started request=<Request [b'POST']> stream_id=23
2025-04-26 23:45:41,774 - DEBUG - Adding (b':method', b'POST') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:41,775 - DEBUG - Encoding 3 with 7 bits
2025-04-26 23:45:41,775 - DEBUG - Adding (b':authority', b'ujvbinqvvgbzgwqluian.supabase.co') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:41,775 - DEBUG - Encoding 79 with 7 bits
2025-04-26 23:45:41,775 - DEBUG - Adding (b':scheme', b'https') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:41,775 - DEBUG - Encoding 7 with 7 bits
2025-04-26 23:45:41,775 - DEBUG - Adding (b':path', b'/rest/v1/email_logs') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:41,775 - DEBUG - Encoding 71 with 7 bits
2025-04-26 23:45:41,775 - DEBUG - Adding (b'accept', b'*/*') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:41,775 - DEBUG - Encoding 77 with 7 bits
2025-04-26 23:45:41,775 - DEBUG - Adding (b'accept-encoding', b'gzip, deflate') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:41,775 - DEBUG - Encoding 16 with 7 bits
2025-04-26 23:45:41,775 - DEBUG - Adding (b'user-agent', b'python-httpx/0.28.1') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:41,775 - DEBUG - Encoding 76 with 7 bits
2025-04-26 23:45:41,775 - DEBUG - Adding (b'x-client-info', b'supabase-py/2.15.0') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:41,775 - DEBUG - Encoding 75 with 7 bits
2025-04-26 23:45:41,775 - DEBUG - Adding (b'apikey', b'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:41,775 - DEBUG - Encoding 74 with 7 bits
2025-04-26 23:45:41,775 - DEBUG - Adding (b'authorization', b'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqdmJpbnF2dmdiemd3cWx1aWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5NTA5ODUsImV4cCI6MjA2MDUyNjk4NX0.z6Q62hfcZkll1HBNkMnBvinsXzA5wu4hTc9NREd3rSw') to the header table, sensitive:True, huffman:True
2025-04-26 23:45:41,775 - DEBUG - Encoding 23 with 4 bits
2025-04-26 23:45:41,775 - DEBUG - Encoding 171 with 7 bits
2025-04-26 23:45:41,775 - DEBUG - Adding (b'accept-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:41,775 - DEBUG - Encoding 73 with 7 bits
2025-04-26 23:45:41,775 - DEBUG - Adding (b'content-profile', b'public') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:41,775 - DEBUG - Encoding 72 with 7 bits
2025-04-26 23:45:41,775 - DEBUG - Adding (b'prefer', b'return=representation') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:41,775 - DEBUG - Encoding 70 with 7 bits
2025-04-26 23:45:41,775 - DEBUG - Adding (b'content-length', b'2984') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:41,775 - DEBUG - Encoding 28 with 6 bits
2025-04-26 23:45:41,775 - DEBUG - Encoding 3 with 7 bits
2025-04-26 23:45:41,775 - DEBUG - Adding (b'content-type', b'application/json') to the header table, sensitive:False, huffman:True
2025-04-26 23:45:41,775 - DEBUG - Encoding 69 with 7 bits
2025-04-26 23:45:41,775 - DEBUG - Encoded header block to b"\x83\xcf\x87\xc7\xcd\x90\xcc\xcb\xca\x1f\x08\xff,\xbaQ\xd8[\x14/\xac\xb3\xc7\x88\x86\xd4l\xb98{\xc8\x1d&\xc8\x8c\x95ml\x97\xb29\x93\xad\x7f\x9coe}r\xfa\xcbY\x19\xd0mF\xcb\xeeO\xcb\xb3\xf3\xa7\x0f\xbf\xdd\xd9\x11\x92\xac\xb4~\x9b#\x99*\xe3\xdaJr\xd7\x1dXE%2\x18\xb4\xc8\xc99y\x08\xf9a\xb7!\xbc\x18\x94\xbe\x8f\xdd\xd9\x1c\xc9N\x1bc\x13F\xcf{-|\xff6\x1bWL\x0c\xe9\xbf\xb1\xbd;\xe1oU\xfe\x08\xc9O\x16\x89{#\x9a:B-\x17\xf8z\xd3\xd3\xabZ\x7f\x00\xbf\xb768)\xe5'\xefZ(\x0e;\xbaz\xe8\xaa\xefsT\x8f\xcfp\xb7\xe2\xd6\xa7\xdeG\xf4\xed\xc1#6n\xf1\xc9\xc8\xc6\\\x83\x13\xef5\xc5"
2025-04-26 23:45:41,776 - DEBUG - send_request_headers.complete
2025-04-26 23:45:41,776 - DEBUG - send_request_body.started request=<Request [b'POST']> stream_id=23
2025-04-26 23:45:41,776 - DEBUG - send_request_body.complete
2025-04-26 23:45:41,776 - DEBUG - receive_response_headers.started request=<Request [b'POST']> stream_id=23
2025-04-26 23:45:41,810 - DEBUG - Decoding b'\xe0\xc1\xf0\xde\x7f/\x90}\x97\x1c\x92G\xdbzP\xcb d\x8dl\x97\xb4\xff\xee\xed\xeb\xea\xe9\xdd\xe8\xe7\xe6\xe5\xd8\xe3\xe2'
2025-04-26 23:45:41,810 - DEBUG - Decoded 96, consumed 1 bytes
2025-04-26 23:45:41,810 - DEBUG - Decoded (b':status', b'201'), consumed 1
2025-04-26 23:45:41,810 - DEBUG - Decoded 65, consumed 1 bytes
2025-04-26 23:45:41,810 - DEBUG - Decoded (b'date', b'Sat, 26 Apr 2025 14:45:43 GMT'), consumed 1
2025-04-26 23:45:41,810 - DEBUG - Decoded 112, consumed 1 bytes
2025-04-26 23:45:41,810 - DEBUG - Decoded (b'content-type', b'application/json; charset=utf-8'), consumed 1
2025-04-26 23:45:41,810 - DEBUG - Decoded 94, consumed 1 bytes
2025-04-26 23:45:41,810 - DEBUG - Decoded (b'content-range', <memory at 0x10a108dc0>), consumed 1
2025-04-26 23:45:41,810 - DEBUG - Decoded 110, consumed 2 bytes
2025-04-26 23:45:41,810 - DEBUG - Decoded 16, consumed 1 bytes
2025-04-26 23:45:41,810 - DEBUG - Decoded (b'cf-ray', b'9366dd958f1fd1db-ICN'), total consumed 19 bytes, indexed True
2025-04-26 23:45:41,810 - DEBUG - Decoded 110, consumed 1 bytes
2025-04-26 23:45:41,810 - DEBUG - Decoded (b'cf-cache-status', b'DYNAMIC'), consumed 1
2025-04-26 23:45:41,810 - DEBUG - Decoded 109, consumed 1 bytes
2025-04-26 23:45:41,810 - DEBUG - Decoded (b'content-encoding', b'gzip'), consumed 1
2025-04-26 23:45:41,810 - DEBUG - Decoded 107, consumed 1 bytes
2025-04-26 23:45:41,810 - DEBUG - Decoded (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), consumed 1
2025-04-26 23:45:41,810 - DEBUG - Decoded 106, consumed 1 bytes
2025-04-26 23:45:41,810 - DEBUG - Decoded (b'vary', b'Accept-Encoding'), consumed 1
2025-04-26 23:45:41,810 - DEBUG - Decoded 105, consumed 1 bytes
2025-04-26 23:45:41,810 - DEBUG - Decoded (b'content-profile', b'public'), consumed 1
2025-04-26 23:45:41,810 - DEBUG - Decoded 93, consumed 1 bytes
2025-04-26 23:45:41,811 - DEBUG - Decoded (b'preference-applied', b'return=representation'), consumed 1
2025-04-26 23:45:41,811 - DEBUG - Decoded 104, consumed 1 bytes
2025-04-26 23:45:41,811 - DEBUG - Decoded (b'sb-gateway-version', <memory at 0x10a108640>), consumed 1
2025-04-26 23:45:41,811 - DEBUG - Decoded 103, consumed 1 bytes
2025-04-26 23:45:41,811 - DEBUG - Decoded (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), consumed 1
2025-04-26 23:45:41,811 - DEBUG - Decoded 102, consumed 1 bytes
2025-04-26 23:45:41,811 - DEBUG - Decoded (b'x-content-type-options', b'nosniff'), consumed 1
2025-04-26 23:45:41,811 - DEBUG - Decoded 101, consumed 1 bytes
2025-04-26 23:45:41,811 - DEBUG - Decoded (b'x-envoy-attempt-count', <memory at 0x10a108400>), consumed 1
2025-04-26 23:45:41,811 - DEBUG - Decoded 88, consumed 1 bytes
2025-04-26 23:45:41,811 - DEBUG - Decoded (b'x-envoy-upstream-service-time', <memory at 0x10a108ac0>), consumed 1
2025-04-26 23:45:41,811 - DEBUG - Decoded 99, consumed 1 bytes
2025-04-26 23:45:41,811 - DEBUG - Decoded (b'server', b'cloudflare'), consumed 1
2025-04-26 23:45:41,811 - DEBUG - Decoded 98, consumed 1 bytes
2025-04-26 23:45:41,811 - DEBUG - Decoded (b'alt-svc', b'h3=":443"; ma=86400'), consumed 1
2025-04-26 23:45:41,811 - DEBUG - receive_response_headers.complete return_value=(201, [(b'date', b'Sat, 26 Apr 2025 14:45:43 GMT'), (b'content-type', b'application/json; charset=utf-8'), (b'content-range', b'*/*'), (b'cf-ray', b'9366dd958f1fd1db-ICN'), (b'cf-cache-status', b'DYNAMIC'), (b'content-encoding', b'gzip'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'vary', b'Accept-Encoding'), (b'content-profile', b'public'), (b'preference-applied', b'return=representation'), (b'sb-gateway-version', b'1'), (b'sb-project-ref', b'ujvbinqvvgbzgwqluian'), (b'x-content-type-options', b'nosniff'), (b'x-envoy-attempt-count', b'1'), (b'x-envoy-upstream-service-time', b'3'), (b'server', b'cloudflare'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-04-26 23:45:41,811 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:45:41,811 - DEBUG - receive_response_body.started request=<Request [b'POST']> stream_id=23
2025-04-26 23:45:41,811 - DEBUG - receive_response_body.complete
2025-04-26 23:45:41,811 - DEBUG - response_closed.started stream_id=23
2025-04-26 23:45:41,812 - DEBUG - response_closed.complete
2025-04-26 23:45:41,812 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:45:41,813 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:45:41,813 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 23:45:41,813 - INFO - GmailWatcher initialized
2025-04-26 23:45:41,814 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages?labelIds=INBOX&q=is%3Aunread+after%3A2025%2F04%2F26&maxResults=10&alt=json
2025-04-26 23:46:42,184 - DEBUG - URL being requested: GET https://gmail.googleapis.com/gmail/v1/users/me/messages?labelIds=INBOX&q=is%3Aunread+after%3A2025%2F04%2F26&maxResults=10&alt=json
2025-04-26 23:47:01,785 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x10a08bb00>
2025-04-26 23:47:01,786 - DEBUG - close.started
2025-04-26 23:47:01,786 - DEBUG - close.complete
2025-04-26 23:51:52,873 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:51:52,874 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'yeonip7913@gmail.com', 'jiyeon@shiftsai.com']
2025-04-26 23:51:52,875 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 23:51:53,052 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 23:51:53,099 - INFO - Supabase client initialized successfully
2025-04-26 23:51:53,099 - INFO - Searching emails with query: after:2025/03/27
2025-04-26 23:52:03,816 - INFO - Is vendor: False
2025-04-26 23:52:04,098 - INFO - Is vendor: False
2025-04-26 23:52:04,376 - INFO - Is vendor: False
2025-04-26 23:52:04,664 - INFO - Is vendor: False
2025-04-26 23:52:04,951 - INFO - Is vendor: False
2025-04-26 23:52:05,234 - INFO - Is vendor: False
2025-04-26 23:52:05,574 - INFO - Is vendor: False
2025-04-26 23:52:05,881 - INFO - Is vendor: False
2025-04-26 23:52:06,189 - INFO - Is vendor: False
2025-04-26 23:52:06,496 - INFO - Is vendor: False
2025-04-26 23:52:06,803 - INFO - Is vendor: False
2025-04-26 23:52:07,095 - INFO - Is vendor: False
2025-04-26 23:52:07,418 - INFO - Is vendor: False
2025-04-26 23:52:07,725 - INFO - Is vendor: False
2025-04-26 23:52:08,032 - INFO - Is vendor: False
2025-04-26 23:52:08,341 - INFO - Is vendor: False
2025-04-26 23:52:08,650 - INFO - Is vendor: False
2025-04-26 23:52:08,954 - INFO - Is vendor: False
2025-04-26 23:52:09,262 - INFO - Is vendor: False
2025-04-26 23:52:09,569 - INFO - Is vendor: False
2025-04-26 23:52:09,877 - INFO - Is vendor: False
2025-04-26 23:52:10,156 - INFO - Is vendor: False
2025-04-26 23:52:10,491 - INFO - Is vendor: True
2025-04-26 23:52:12,340 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:52:12,347 - INFO - Generated email type: document submission
2025-04-26 23:52:13,465 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/object/attachments-from-vendor/None "HTTP/2 200 OK"
2025-04-26 23:52:13,465 - ERROR - Error downloading attachment: 'UploadResponse' object has no attribute 'status_code'
2025-04-26 23:52:13,465 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 23:52:13,574 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:52:13,577 - INFO - Found 0 emails in thread
2025-04-26 23:52:14,693 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:52:14,694 - INFO - Parsed delivery date: None
2025-04-26 23:52:14,694 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 23:52:14,748 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:52:14,749 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 23:52:14,752 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 23:52:14,752 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 23:52:15,101 - INFO - Is vendor: True
2025-04-26 23:52:16,842 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:52:16,843 - INFO - Generated email type: purchase request
2025-04-26 23:52:17,228 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/object/attachments-from-vendor/None "HTTP/2 400 Bad Request"
2025-04-26 23:52:17,229 - ERROR - Error downloading attachment: {'statusCode': 409, 'error': Duplicate, 'message': The resource already exists}
2025-04-26 23:52:17,229 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 23:52:17,275 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:52:17,277 - INFO - Found 0 emails in thread
2025-04-26 23:52:17,995 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:52:18,000 - INFO - Parsed delivery date: None
2025-04-26 23:52:18,000 - INFO - Attempting to save email log: purchase request
2025-04-26 23:52:18,041 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:52:18,041 - INFO - Email saved successfully: purchase request
2025-04-26 23:52:18,043 - INFO - Message sent to MCP server: purchase request
2025-04-26 23:52:18,043 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 23:52:18,379 - INFO - Is vendor: False
2025-04-26 23:52:18,685 - INFO - Is vendor: False
2025-04-26 23:52:18,992 - INFO - Is vendor: True
2025-04-26 23:52:21,153 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:52:21,155 - INFO - Generated email type: order confirmation
2025-04-26 23:52:21,583 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/object/attachments-from-vendor/None "HTTP/2 400 Bad Request"
2025-04-26 23:52:21,583 - ERROR - Error downloading attachment: {'statusCode': 409, 'error': Duplicate, 'message': The resource already exists}
2025-04-26 23:52:21,584 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:52:21,624 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:52:21,626 - INFO - Found 0 emails in thread
2025-04-26 23:52:22,475 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:52:22,476 - INFO - Parsed delivery date: None
2025-04-26 23:52:22,476 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:52:22,513 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:52:22,514 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:52:22,515 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:52:22,515 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 23:52:22,884 - INFO - Is vendor: True
2025-04-26 23:52:25,037 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:52:25,037 - INFO - Generated email type: order confirmation
2025-04-26 23:52:25,037 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:52:25,077 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:52:25,078 - INFO - Found 1 emails in thread
2025-04-26 23:52:26,367 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:52:26,367 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 23:52:26,367 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:52:26,402 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:52:26,403 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:52:26,404 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:52:26,404 - INFO - Processed email: 19661ecddae94e49
2025-04-26 23:52:26,779 - INFO - Is vendor: False
2025-04-26 23:52:27,083 - INFO - Is vendor: True
2025-04-26 23:52:29,440 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:52:29,441 - INFO - Generated email type: delivery delay
2025-04-26 23:52:29,441 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:52:29,482 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:52:29,484 - INFO - Found 2 emails in thread
2025-04-26 23:52:30,668 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:52:30,669 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 23:52:30,669 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:52:30,715 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:52:30,716 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:52:30,718 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:52:30,718 - INFO - Processed email: 196675e9f37b6406
2025-04-26 23:52:31,077 - INFO - Is vendor: True
2025-04-26 23:52:34,720 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:52:34,722 - INFO - Generated email type: delivery expedite
2025-04-26 23:52:34,722 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:52:34,771 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:52:34,772 - INFO - Found 3 emails in thread
2025-04-26 23:52:35,556 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:52:35,559 - INFO - Parsed delivery date: 2025-05-04
2025-04-26 23:52:35,559 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:52:35,624 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:52:35,624 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:52:35,626 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:52:35,626 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 23:52:35,626 - INFO - GmailWatcher initialized
2025-04-26 23:54:31,838 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:54:31,838 - INFO - Loaded 3 vendor emails: ['ddd7913@gmail.com', 'jiyeon@shiftsai.com', 'yeonip7913@gmail.com']
2025-04-26 23:54:31,839 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 23:54:32,013 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 23:54:32,060 - INFO - Supabase client initialized successfully
2025-04-26 23:54:32,061 - INFO - Searching emails with query: after:2025/03/27
2025-04-26 23:54:43,755 - INFO - Is vendor: False
2025-04-26 23:54:44,100 - INFO - Is vendor: False
2025-04-26 23:54:44,407 - INFO - Is vendor: False
2025-04-26 23:54:44,709 - INFO - Is vendor: False
2025-04-26 23:54:44,989 - INFO - Is vendor: False
2025-04-26 23:54:45,330 - INFO - Is vendor: False
2025-04-26 23:54:45,636 - INFO - Is vendor: False
2025-04-26 23:54:45,920 - INFO - Is vendor: False
2025-04-26 23:54:46,251 - INFO - Is vendor: False
2025-04-26 23:54:46,557 - INFO - Is vendor: False
2025-04-26 23:54:46,843 - INFO - Is vendor: False
2025-04-26 23:54:47,582 - INFO - Is vendor: False
2025-04-26 23:54:47,891 - INFO - Is vendor: False
2025-04-26 23:54:48,196 - INFO - Is vendor: False
2025-04-26 23:54:48,504 - INFO - Is vendor: False
2025-04-26 23:54:48,810 - INFO - Is vendor: False
2025-04-26 23:54:49,119 - INFO - Is vendor: False
2025-04-26 23:54:49,424 - INFO - Is vendor: False
2025-04-26 23:54:49,732 - INFO - Is vendor: False
2025-04-26 23:54:50,040 - INFO - Is vendor: False
2025-04-26 23:54:50,346 - INFO - Is vendor: False
2025-04-26 23:54:51,063 - INFO - Is vendor: False
2025-04-26 23:54:51,370 - INFO - Is vendor: True
2025-04-26 23:54:53,319 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:54:53,327 - INFO - Generated email type: document submission
2025-04-26 23:54:54,136 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/object/attachments-from-vendor/None "HTTP/2 400 Bad Request"
2025-04-26 23:54:54,137 - ERROR - Error downloading attachment: {'statusCode': 409, 'error': Duplicate, 'message': The resource already exists}
2025-04-26 23:54:54,137 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 23:54:54,239 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:54:54,243 - INFO - Found 1 emails in thread
2025-04-26 23:54:59,255 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:54:59,257 - INFO - Parsed delivery date: None
2025-04-26 23:54:59,257 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 23:54:59,327 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:54:59,328 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 23:54:59,331 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 23:54:59,331 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 23:54:59,665 - INFO - Is vendor: True
2025-04-26 23:55:04,202 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:55:04,207 - INFO - Generated email type: purchase request
2025-04-26 23:55:04,620 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/object/attachments-from-vendor/None "HTTP/2 400 Bad Request"
2025-04-26 23:55:04,621 - ERROR - Error downloading attachment: {'statusCode': 409, 'error': Duplicate, 'message': The resource already exists}
2025-04-26 23:55:04,621 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 23:55:04,698 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:55:04,702 - INFO - Found 1 emails in thread
2025-04-26 23:55:05,401 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:55:05,403 - INFO - Parsed delivery date: None
2025-04-26 23:55:05,403 - INFO - Attempting to save email log: purchase request
2025-04-26 23:55:05,454 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:55:05,454 - INFO - Email saved successfully: purchase request
2025-04-26 23:55:05,455 - ERROR - Error sending message to MCP server: [Errno 54] Connection reset by peer
2025-04-26 23:55:05,455 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 23:55:05,810 - INFO - Is vendor: False
2025-04-26 23:55:06,094 - INFO - Is vendor: False
2025-04-26 23:55:06,423 - INFO - Is vendor: True
2025-04-26 23:55:08,473 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:55:08,474 - INFO - Generated email type: order confirmation
2025-04-26 23:55:08,971 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/object/attachments-from-vendor/None "HTTP/2 400 Bad Request"
2025-04-26 23:55:08,972 - ERROR - Error downloading attachment: {'statusCode': 409, 'error': Duplicate, 'message': The resource already exists}
2025-04-26 23:55:08,972 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:55:09,023 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:55:09,026 - INFO - Found 4 emails in thread
2025-04-26 23:55:09,701 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:55:09,702 - INFO - Parsed delivery date: None
2025-04-26 23:55:09,702 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:55:09,751 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:55:09,754 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:55:09,757 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:55:09,757 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 23:55:10,110 - INFO - Is vendor: True
2025-04-26 23:55:12,407 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:55:12,408 - INFO - Generated email type: order confirmation
2025-04-26 23:55:12,408 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:55:12,450 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:55:12,452 - INFO - Found 5 emails in thread
2025-04-26 23:55:13,284 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:55:13,285 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 23:55:13,285 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:55:13,324 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:55:13,326 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:55:13,327 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:55:13,327 - INFO - Processed email: 19661ecddae94e49
2025-04-26 23:55:13,696 - INFO - Is vendor: False
2025-04-26 23:55:14,001 - INFO - Is vendor: True
2025-04-26 23:55:17,033 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:55:17,035 - INFO - Generated email type: delivery delay
2025-04-26 23:55:17,035 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:55:17,088 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:55:17,091 - INFO - Found 6 emails in thread
2025-04-26 23:55:17,997 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:55:17,999 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 23:55:17,999 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:55:18,054 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:55:18,055 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:55:18,057 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:55:18,057 - INFO - Processed email: 196675e9f37b6406
2025-04-26 23:55:18,405 - INFO - Is vendor: True
2025-04-26 23:55:21,101 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:55:21,112 - INFO - Generated email type: delivery expedite
2025-04-26 23:55:21,112 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:55:21,155 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:55:21,157 - INFO - Found 7 emails in thread
2025-04-26 23:55:21,989 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:55:21,991 - INFO - Parsed delivery date: 2025-05-04
2025-04-26 23:55:21,991 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:55:22,089 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:55:22,090 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:55:22,092 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:55:22,092 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 23:55:22,092 - INFO - GmailWatcher initialized
2025-04-26 23:56:30,524 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x117791850>
2025-04-26 23:57:10,380 - INFO - Vendor CSV path from .env: /Users/jiyeon/Desktop/project/ShiftsAI/Procurement/Vendor_list/vendor - 시트1.csv
2025-04-26 23:57:10,381 - INFO - Loaded 3 vendor emails: ['yeonip7913@gmail.com', 'jiyeon@shiftsai.com', 'ddd7913@gmail.com']
2025-04-26 23:57:10,383 - INFO - file_cache is only supported with oauth2client<4.0.0
2025-04-26 23:57:10,571 - INFO - Initializing Supabase client with URL: https://ujvbinqvvgbzgwqluian.supabase.co
2025-04-26 23:57:10,618 - INFO - Supabase client initialized successfully
2025-04-26 23:57:10,621 - INFO - Searching emails with query: after:2025/03/27
2025-04-26 23:57:23,337 - INFO - Is vendor: False
2025-04-26 23:57:23,621 - INFO - Is vendor: False
2025-04-26 23:57:24,292 - INFO - Is vendor: False
2025-04-26 23:57:24,970 - INFO - Is vendor: False
2025-04-26 23:57:25,249 - INFO - Is vendor: False
2025-04-26 23:57:25,924 - INFO - Is vendor: False
2025-04-26 23:57:26,217 - INFO - Is vendor: False
2025-04-26 23:57:26,510 - INFO - Is vendor: False
2025-04-26 23:57:26,796 - INFO - Is vendor: False
2025-04-26 23:57:27,130 - INFO - Is vendor: False
2025-04-26 23:57:27,535 - INFO - Is vendor: False
2025-04-26 23:57:27,844 - INFO - Is vendor: False
2025-04-26 23:57:28,559 - INFO - Is vendor: False
2025-04-26 23:57:28,868 - INFO - Is vendor: False
2025-04-26 23:57:29,173 - INFO - Is vendor: False
2025-04-26 23:57:29,482 - INFO - Is vendor: False
2025-04-26 23:57:29,788 - INFO - Is vendor: False
2025-04-26 23:57:30,096 - INFO - Is vendor: False
2025-04-26 23:57:30,509 - INFO - Is vendor: False
2025-04-26 23:57:30,813 - INFO - Is vendor: False
2025-04-26 23:57:31,119 - INFO - Is vendor: False
2025-04-26 23:57:31,403 - INFO - Is vendor: False
2025-04-26 23:57:31,734 - INFO - Is vendor: True
2025-04-26 23:57:33,635 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:57:33,641 - INFO - Generated email type: document submission
2025-04-26 23:57:53,997 - ERROR - Error downloading attachment: The read operation timed out
2025-04-26 23:57:53,999 - INFO - Fetching thread history for thread_id: 1965e3ccd4a098a9
2025-04-26 23:57:54,109 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ccd4a098a9&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:57:54,114 - INFO - Found 0 emails in thread
2025-04-26 23:57:54,775 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:57:54,776 - INFO - Parsed delivery date: None
2025-04-26 23:57:54,777 - INFO - Attempting to save email log: [purchase request]I want to purchase some stuffs
2025-04-26 23:57:54,817 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:57:54,817 - INFO - Email saved successfully: [purchase request]I want to purchase some stuffs
2025-04-26 23:57:54,822 - INFO - Message sent to MCP server: [purchase request]I want to purchase some stuffs
2025-04-26 23:57:54,822 - INFO - Processed email: 1965e3ccd4a098a9
2025-04-26 23:57:55,184 - INFO - Is vendor: True
2025-04-26 23:57:56,822 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:57:56,823 - INFO - Generated email type: purchase request
2025-04-26 23:57:57,248 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/object/attachments-from-vendor/None "HTTP/2 400 Bad Request"
2025-04-26 23:57:57,249 - ERROR - Error downloading attachment: {'statusCode': 409, 'error': Duplicate, 'message': The resource already exists}
2025-04-26 23:57:57,249 - INFO - Fetching thread history for thread_id: 1965e3ffd06abe66
2025-04-26 23:57:57,300 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.1965e3ffd06abe66&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:57:57,300 - INFO - Found 0 emails in thread
2025-04-26 23:57:58,154 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:57:58,155 - INFO - Parsed delivery date: None
2025-04-26 23:57:58,155 - INFO - Attempting to save email log: purchase request
2025-04-26 23:57:58,199 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:57:58,200 - INFO - Email saved successfully: purchase request
2025-04-26 23:57:58,201 - INFO - Message sent to MCP server: purchase request
2025-04-26 23:57:58,202 - INFO - Processed email: 1965e3ffd06abe66
2025-04-26 23:57:58,566 - INFO - Is vendor: False
2025-04-26 23:57:58,870 - INFO - Is vendor: False
2025-04-26 23:57:59,177 - INFO - Is vendor: True
2025-04-26 23:58:01,534 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:58:01,535 - INFO - Generated email type: order confirmation
2025-04-26 23:58:01,966 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/storage/v1/object/attachments-from-vendor/None "HTTP/2 400 Bad Request"
2025-04-26 23:58:01,967 - ERROR - Error downloading attachment: {'statusCode': 409, 'error': Duplicate, 'message': The resource already exists}
2025-04-26 23:58:01,967 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:58:01,999 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:58:02,000 - INFO - Found 0 emails in thread
2025-04-26 23:58:03,069 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:58:03,070 - INFO - Parsed delivery date: None
2025-04-26 23:58:03,070 - INFO - Attempting to save email log: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:58:03,115 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:58:03,115 - INFO - Email saved successfully: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:58:03,117 - INFO - Message sent to MCP server: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:58:03,117 - INFO - Processed email: 19661e7fd594a8a4
2025-04-26 23:58:03,478 - INFO - Is vendor: True
2025-04-26 23:58:05,525 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:58:05,526 - INFO - Generated email type: order confirmation
2025-04-26 23:58:05,526 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:58:05,566 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:58:05,566 - INFO - Found 1 emails in thread
2025-04-26 23:58:06,283 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:58:06,285 - INFO - Parsed delivery date: 2025-04-30
2025-04-26 23:58:06,285 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:58:06,351 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:58:06,352 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:58:06,353 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:58:06,353 - INFO - Processed email: 19661ecddae94e49
2025-04-26 23:58:07,062 - INFO - Is vendor: False
2025-04-26 23:58:07,369 - INFO - Is vendor: True
2025-04-26 23:58:09,831 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:58:09,832 - INFO - Generated email type: delivery delay
2025-04-26 23:58:09,832 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:58:09,883 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:58:09,883 - INFO - Found 2 emails in thread
2025-04-26 23:58:10,853 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:58:10,854 - INFO - Parsed delivery date: 2025-05-02
2025-04-26 23:58:10,854 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:58:10,892 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:58:10,892 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:58:10,893 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:58:10,894 - INFO - Processed email: 196675e9f37b6406
2025-04-26 23:58:11,261 - INFO - Is vendor: True
2025-04-26 23:58:13,823 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:58:13,823 - INFO - Generated email type: delivery expedite
2025-04-26 23:58:13,823 - INFO - Fetching thread history for thread_id: 19661e534867a709
2025-04-26 23:58:13,864 - INFO - HTTP Request: GET https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs?select=%2A&thread_id=eq.19661e534867a709&order=sent_at.asc "HTTP/2 200 OK"
2025-04-26 23:58:13,865 - INFO - Found 3 emails in thread
2025-04-26 23:58:14,746 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-04-26 23:58:14,747 - INFO - Parsed delivery date: 2025-05-04
2025-04-26 23:58:14,747 - INFO - Attempting to save email log: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:58:14,784 - INFO - HTTP Request: POST https://ujvbinqvvgbzgwqluian.supabase.co/rest/v1/email_logs "HTTP/2 201 Created"
2025-04-26 23:58:14,785 - INFO - Email saved successfully: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:58:14,786 - INFO - Message sent to MCP server: Re: [Purchase Order Attached] Request for Supply – Shiftsai
2025-04-26 23:58:14,787 - INFO - Processed email: 19667636e36ec3ed
2025-04-26 23:58:14,787 - INFO - GmailWatcher initialized
2025-04-26 23:58:52,571 - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x10a19aa20>
